(window.webpackJsonp=window.webpackJsonp||[]).push([[0],[,,,,,,,,,,,function(t,e,n){"use strict";n.r(e),n.d(e,"firebase",(function(){return b}));var r,i,o=n(12),a=n(14),s=n(13),u=n(16),c=((r={})["no-app"]="No Firebase App '{$appName}' has been created - call Firebase App.initializeApp()",r["bad-app-name"]="Illegal App name: '{$appName}",r["duplicate-app"]="Firebase App named '{$appName}' already exists",r["app-deleted"]="Firebase App named '{$appName}' already deleted",r["invalid-app-argument"]="firebase.{$appName}() takes either no argument or a Firebase App instance.",r),h=new a.c("app","Firebase",c),l="@firebase/app",f=((i={})[l]="fire-core",i["@firebase/analytics"]="fire-analytics",i["@firebase/auth"]="fire-auth",i["@firebase/database"]="fire-rtdb",i["@firebase/functions"]="fire-fn",i["@firebase/installations"]="fire-iid",i["@firebase/messaging"]="fire-fcm",i["@firebase/performance"]="fire-perf",i["@firebase/remote-config"]="fire-rc",i["@firebase/storage"]="fire-gcs",i["@firebase/firestore"]="fire-fst",i["fire-js"]="fire-js",i["firebase-wrapper"]="fire-js-all",i),p=new u.b("@firebase/app"),d=function(){function t(t,e,n){var r,i,u=this;this.firebase_=n,this.isDeleted_=!1,this.name_=e.name,this.automaticDataCollectionEnabled_=e.automaticDataCollectionEnabled||!1,this.options_=Object(a.l)(t),this.container=new s.b(e.name),this._addComponent(new s.a("app",(function(){return u}),"PUBLIC"));try{for(var c=Object(o.h)(this.firebase_.INTERNAL.components.values()),h=c.next();!h.done;h=c.next()){var l=h.value;this._addComponent(l)}}catch(t){r={error:t}}finally{try{h&&!h.done&&(i=c.return)&&i.call(c)}finally{if(r)throw r.error}}}return Object.defineProperty(t.prototype,"automaticDataCollectionEnabled",{get:function(){return this.checkDestroyed_(),this.automaticDataCollectionEnabled_},set:function(t){this.checkDestroyed_(),this.automaticDataCollectionEnabled_=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"name",{get:function(){return this.checkDestroyed_(),this.name_},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"options",{get:function(){return this.checkDestroyed_(),this.options_},enumerable:!0,configurable:!0}),t.prototype.delete=function(){var t=this;return new Promise((function(e){t.checkDestroyed_(),e()})).then((function(){return t.firebase_.INTERNAL.removeApp(t.name_),Promise.all(t.container.getProviders().map((function(t){return t.delete()})))})).then((function(){t.isDeleted_=!0}))},t.prototype._getService=function(t,e){return void 0===e&&(e="[DEFAULT]"),this.checkDestroyed_(),this.container.getProvider(t).getImmediate({identifier:e})},t.prototype._removeServiceInstance=function(t,e){void 0===e&&(e="[DEFAULT]"),this.container.getProvider(t).clearInstance(e)},t.prototype._addComponent=function(t){try{this.container.addComponent(t)}catch(e){p.debug("Component "+t.name+" failed to register with FirebaseApp "+this.name,e)}},t.prototype._addOrOverwriteComponent=function(t){this.container.addOrOverwriteComponent(t)},t.prototype.checkDestroyed_=function(){if(this.isDeleted_)throw h.create("app-deleted",{appName:this.name_})},t}();d.prototype.name&&d.prototype.options||d.prototype.delete||console.log("dc");var m=
/**
 * @license
 * Copyright 2019 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function t(){var e=
/**
 * @license
 * Copyright 2019 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function(t){var e={},n=new Map,r={__esModule:!0,initializeApp:function(n,i){void 0===i&&(i={});if("object"!=typeof i||null===i){i={name:i}}var o=i;void 0===o.name&&(o.name="[DEFAULT]");var s=o.name;if("string"!=typeof s||!s)throw h.create("bad-app-name",{appName:String(s)});if(Object(a.j)(e,s))throw h.create("duplicate-app",{appName:s});var u=new t(n,o,r);return e[s]=u,u},app:i,registerVersion:function(t,e,n){var r,i=null!==(r=f[t])&&void 0!==r?r:t;n&&(i+="-"+n);var o=i.match(/\s|\//),a=e.match(/\s|\//);if(o||a){var c=['Unable to register library "'+i+'" with version "'+e+'":'];return o&&c.push('library name "'+i+'" contains illegal characters (whitespace or "/")'),o&&a&&c.push("and"),a&&c.push('version name "'+e+'" contains illegal characters (whitespace or "/")'),void p.warn(c.join(" "))}u(new s.a(i+"-version",(function(){return{library:i,version:e}}),"VERSION"))},apps:null,SDK_VERSION:"7.6.2",INTERNAL:{registerComponent:u,removeApp:function(t){delete e[t]},components:n,useAsService:function(t,e){if("serverAuth"===e)return null;return e}}};function i(t){if(t=t||"[DEFAULT]",!Object(a.j)(e,t))throw h.create("no-app",{appName:t});return e[t]}function u(s){var u,c,l=s.name;if(n.has(l))return p.debug("There were multiple attempts to register component "+l+"."),"PUBLIC"===s.type?r[l]:null;if(n.set(l,s),"PUBLIC"===s.type){var f=function(t){if(void 0===t&&(t=i()),"function"!=typeof t[l])throw h.create("invalid-app-argument",{appName:l});return t[l]()};void 0!==s.serviceProps&&Object(a.m)(f,s.serviceProps),r[l]=f,t.prototype[l]=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=this._getService.bind(this,l);return n.apply(this,s.multipleInstances?t:[])}}try{for(var d=Object(o.h)(Object.keys(e)),m=d.next();!m.done;m=d.next()){var y=m.value;e[y]._addComponent(s)}}catch(t){u={error:t}}finally{try{m&&!m.done&&(c=d.return)&&c.call(d)}finally{if(u)throw u.error}}return"PUBLIC"===s.type?r[l]:null}return(r.default=r,Object.defineProperty(r,"apps",{get:function(){return Object.keys(e).map((function(t){return e[t]}))}}),i.App=t,r)}(d);return e.INTERNAL=Object(o.a)(Object(o.a)({},e.INTERNAL),{createFirebaseNamespace:t,extendNamespace:function(t){Object(a.m)(e,t)},createSubscribe:a.k,ErrorFactory:a.c,deepExtend:a.m}),e}(),y=function(){function t(t){this.container=t}return t.prototype.getPlatformInfoString=function(){return this.container.getProviders().map((function(t){if(function(t){var e,n=t.getComponent();return"VERSION"===(null===(e=n)||void 0===e?void 0:e.type)}
/**
 * @license
 * Copyright 2019 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */(t)){var e=t.getImmediate();return e.library+"/"+e.version}return null})).filter((function(t){return t})).join(" ")},t}();
/**
 * @license
 * Copyright 2019 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
if(Object(a.q)()&&void 0!==self.firebase){p.warn("\n    Warning: Firebase is already defined in the global scope. Please make sure\n    Firebase library is only loaded once.\n  ");var g=self.firebase.SDK_VERSION;g&&g.indexOf("LITE")>=0&&p.warn("\n    Warning: You are trying to load Firebase while using Firebase Performance standalone script.\n    You should load Firebase Performance with this instance of Firebase to avoid loading duplicate code.\n    ")}var v=m.initializeApp;m.initializeApp=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return Object(a.v)()&&p.warn('\n      Warning: This is a browser-targeted Firebase bundle but it appears it is being\n      run in a Node environment.  If running in a Node environment, make sure you\n      are using the bundle specified by the "main" field in package.json.\n      \n      If you are using Webpack, you can specify "main" as the first item in\n      "resolve.mainFields":\n      https://webpack.js.org/configuration/resolve/#resolvemainfields\n      \n      If using Rollup, use the rollup-plugin-node-resolve plugin and specify "main"\n      as the first item in "mainFields", e.g. [\'main\', \'module\'].\n      https://github.com/rollup/rollup-plugin-node-resolve\n      '),v.apply(void 0,t)};var b=m;!function(t,e){t.INTERNAL.registerComponent(new s.a("platform-logger",(function(t){return new y(t)}),"PRIVATE")),t.registerVersion(l,"0.5.1",e),t.registerVersion("fire-js","")}(b),e.default=b},function(t,e,n){"use strict";n.d(e,"c",(function(){return i})),n.d(e,"a",(function(){return o})),n.d(e,"b",(function(){return a})),n.d(e,"d",(function(){return s})),n.d(e,"h",(function(){return u})),n.d(e,"e",(function(){return c})),n.d(e,"f",(function(){return h})),n.d(e,"g",(function(){return l}));
/*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */
var r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)};function i(t,e){function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}var o=function(){return(o=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)};function a(t,e,n,r){return new(n||(n=Promise))((function(i,o){function a(t){try{u(r.next(t))}catch(t){o(t)}}function s(t){try{u(r.throw(t))}catch(t){o(t)}}function u(t){t.done?i(t.value):new n((function(e){e(t.value)})).then(a,s)}u((r=r.apply(t,e||[])).next())}))}function s(t,e){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=(i=a.trys).length>0&&i[i.length-1])&&(6===o[0]||2===o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=e.call(t,a)}catch(t){o=[6,t],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}}function u(t){var e="function"==typeof Symbol&&t[Symbol.iterator],n=0;return e?e.call(t):{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}}}function c(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var r,i,o=n.call(t),a=[];try{for(;(void 0===e||e-- >0)&&!(r=o.next()).done;)a.push(r.value)}catch(t){i={error:t}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return a}function h(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(c(arguments[e]));return t}function l(){for(var t=0,e=0,n=arguments.length;e<n;e++)t+=arguments[e].length;var r=Array(t),i=0;for(e=0;e<n;e++)for(var o=arguments[e],a=0,s=o.length;a<s;a++,i++)r[i]=o[a];return r}},function(t,e,n){"use strict";n.d(e,"a",(function(){return o})),n.d(e,"b",(function(){return s}));var r=n(12),i=n(14),o=function(){function t(t,e,n){this.name=t,this.instanceFactory=e,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY"}return t.prototype.setInstantiationMode=function(t){return this.instantiationMode=t,this},t.prototype.setMultipleInstances=function(t){return this.multipleInstances=t,this},t.prototype.setServiceProps=function(t){return this.serviceProps=t,this},t}(),a=function(){function t(t,e){this.name=t,this.container=e,this.component=null,this.instances=new Map,this.instancesDeferred=new Map}return t.prototype.get=function(t){void 0===t&&(t="[DEFAULT]");var e=this.normalizeInstanceIdentifier(t);if(!this.instancesDeferred.has(e)){var n=new i.b;this.instancesDeferred.set(e,n);try{var r=this.getOrInitializeService(e);r&&n.resolve(r)}catch(t){}}return this.instancesDeferred.get(e).promise},t.prototype.getImmediate=function(t){var e=Object(r.a)({identifier:"[DEFAULT]",optional:!1},t),n=e.identifier,i=e.optional,o=this.normalizeInstanceIdentifier(n);try{var a=this.getOrInitializeService(o);if(!a){if(i)return null;throw Error("Service "+this.name+" is not available")}return a}catch(t){if(i)return null;throw t}},t.prototype.getComponent=function(){return this.component},t.prototype.setComponent=function(t){var e,n;if(t.name!==this.name)throw Error("Mismatching Component "+t.name+" for Provider "+this.name+".");if(this.component)throw Error("Component for "+this.name+" has already been provided");if(this.component=t,function(t){return"EAGER"===t.instantiationMode}
/**
 * @license
 * Copyright 2019 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */(t))try{this.getOrInitializeService("[DEFAULT]")}catch(t){}try{for(var i=Object(r.h)(this.instancesDeferred.entries()),o=i.next();!o.done;o=i.next()){var a=Object(r.e)(o.value,2),s=a[0],u=a[1],c=this.normalizeInstanceIdentifier(s);try{var h=this.getOrInitializeService(c);u.resolve(h)}catch(t){}}}catch(t){e={error:t}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(e)throw e.error}}},t.prototype.clearInstance=function(t){void 0===t&&(t="[DEFAULT]"),this.instancesDeferred.delete(t),this.instances.delete(t)},t.prototype.delete=function(){return Object(r.b)(this,void 0,void 0,(function(){var t;return Object(r.d)(this,(function(e){switch(e.label){case 0:return t=Array.from(this.instances.values()),[4,Promise.all(t.filter((function(t){return"INTERNAL"in t})).map((function(t){return t.INTERNAL.delete()})))];case 1:return e.sent(),[2]}}))}))},t.prototype.isComponentSet=function(){return null!=this.component},t.prototype.getOrInitializeService=function(t){var e=this.instances.get(t);return!e&&this.component&&(e=this.component.instanceFactory(this.container,function(t){return"[DEFAULT]"===t?void 0:t}(t)),this.instances.set(t,e)),e||null},t.prototype.normalizeInstanceIdentifier=function(t){return this.component?this.component.multipleInstances?t:"[DEFAULT]":t},t}();var s=function(){function t(t){this.name=t,this.providers=new Map}return t.prototype.addComponent=function(t){var e=this.getProvider(t.name);if(e.isComponentSet())throw new Error("Component "+t.name+" has already been registered with "+this.name);e.setComponent(t)},t.prototype.addOrOverwriteComponent=function(t){this.getProvider(t.name).isComponentSet()&&this.providers.delete(t.name),this.addComponent(t)},t.prototype.getProvider=function(t){if(this.providers.has(t))return this.providers.get(t);var e=new a(t,this);return this.providers.set(t,e),e},t.prototype.getProviders=function(){return Array.from(this.providers.values())},t}()},function(t,e,n){"use strict";(function(t){n.d(e,"a",(function(){return i})),n.d(e,"b",(function(){return p})),n.d(e,"c",(function(){return S})),n.d(e,"d",(function(){return E})),n.d(e,"e",(function(){return F})),n.d(e,"f",(function(){return o})),n.d(e,"g",(function(){return a})),n.d(e,"h",(function(){return u})),n.d(e,"i",(function(){return c})),n.d(e,"j",(function(){return R})),n.d(e,"k",(function(){return j})),n.d(e,"l",(function(){return l})),n.d(e,"m",(function(){return f})),n.d(e,"n",(function(){return B})),n.d(e,"o",(function(){return d})),n.d(e,"p",(function(){return k})),n.d(e,"q",(function(){return g})),n.d(e,"r",(function(){return b})),n.d(e,"s",(function(){return M})),n.d(e,"t",(function(){return w})),n.d(e,"u",(function(){return m})),n.d(e,"v",(function(){return y})),n.d(e,"w",(function(){return _})),n.d(e,"x",(function(){return v})),n.d(e,"y",(function(){return T})),n.d(e,"z",(function(){return O})),n.d(e,"A",(function(){return N})),n.d(e,"B",(function(){return L})),n.d(e,"C",(function(){return x})),n.d(e,"D",(function(){return P})),n.d(e,"E",(function(){return G})),n.d(e,"F",(function(){return Q})),n.d(e,"G",(function(){return D})),n.d(e,"H",(function(){return V})),n.d(e,"I",(function(){return W})),n.d(e,"J",(function(){return K}));var r=n(12),i={NODE_CLIENT:!1,NODE_ADMIN:!1,SDK_VERSION:"${JSCORE_VERSION}"},o=function(t,e){if(!t)throw a(e)},a=function(t){return new Error("Firebase Database ("+i.SDK_VERSION+") INTERNAL ASSERT FAILED: "+t)},s=function(t){for(var e=[],n=0,r=0;r<t.length;r++){var i=t.charCodeAt(r);i<128?e[n++]=i:i<2048?(e[n++]=i>>6|192,e[n++]=63&i|128):55296==(64512&i)&&r+1<t.length&&56320==(64512&t.charCodeAt(r+1))?(i=65536+((1023&i)<<10)+(1023&t.charCodeAt(++r)),e[n++]=i>>18|240,e[n++]=i>>12&63|128,e[n++]=i>>6&63|128,e[n++]=63&i|128):(e[n++]=i>>12|224,e[n++]=i>>6&63|128,e[n++]=63&i|128)}return e},u={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"==typeof atob,encodeByteArray:function(t,e){if(!Array.isArray(t))throw Error("encodeByteArray takes an array as a parameter");this.init_();for(var n=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[],i=0;i<t.length;i+=3){var o=t[i],a=i+1<t.length,s=a?t[i+1]:0,u=i+2<t.length,c=u?t[i+2]:0,h=o>>2,l=(3&o)<<4|s>>4,f=(15&s)<<2|c>>6,p=63&c;u||(p=64,a||(f=64)),r.push(n[h],n[l],n[f],n[p])}return r.join("")},encodeString:function(t,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(t):this.encodeByteArray(s(t),e)},decodeString:function(t,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(t):function(t){for(var e=[],n=0,r=0;n<t.length;){var i=t[n++];if(i<128)e[r++]=String.fromCharCode(i);else if(i>191&&i<224){var o=t[n++];e[r++]=String.fromCharCode((31&i)<<6|63&o)}else if(i>239&&i<365){var a=((7&i)<<18|(63&(o=t[n++]))<<12|(63&(s=t[n++]))<<6|63&t[n++])-65536;e[r++]=String.fromCharCode(55296+(a>>10)),e[r++]=String.fromCharCode(56320+(1023&a))}else{o=t[n++];var s=t[n++];e[r++]=String.fromCharCode((15&i)<<12|(63&o)<<6|63&s)}}return e.join("")}(this.decodeStringToByteArray(t,e))},decodeStringToByteArray:function(t,e){this.init_();for(var n=e?this.charToByteMapWebSafe_:this.charToByteMap_,r=[],i=0;i<t.length;){var o=n[t.charAt(i++)],a=i<t.length?n[t.charAt(i)]:0,s=++i<t.length?n[t.charAt(i)]:64,u=++i<t.length?n[t.charAt(i)]:64;if(++i,null==o||null==a||null==s||null==u)throw Error();var c=o<<2|a>>4;if(r.push(c),64!==s){var h=a<<4&240|s>>2;if(r.push(h),64!==u){var l=s<<6&192|u;r.push(l)}}}return r},init_:function(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(var t=0;t<this.ENCODED_VALS.length;t++)this.byteToCharMap_[t]=this.ENCODED_VALS.charAt(t),this.charToByteMap_[this.byteToCharMap_[t]]=t,this.byteToCharMapWebSafe_[t]=this.ENCODED_VALS_WEBSAFE.charAt(t),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[t]]=t,t>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(t)]=t,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(t)]=t)}}},c=function(t){var e=s(t);return u.encodeByteArray(e,!0)},h=function(t){try{return u.decodeString(t,!0)}catch(t){console.error("base64Decode failed: ",t)}return null};
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function l(t){return f(void 0,t)}function f(t,e){if(!(e instanceof Object))return e;switch(e.constructor){case Date:return new Date(e.getTime());case Object:void 0===t&&(t={});break;case Array:t=[];break;default:return e}for(var n in e)e.hasOwnProperty(n)&&(t[n]=f(t[n],e[n]));return t}
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var p=function(){function t(){var t=this;this.reject=function(){},this.resolve=function(){},this.promise=new Promise((function(e,n){t.resolve=e,t.reject=n}))}return t.prototype.wrapCallback=function(t){var e=this;return function(n,r){n?e.reject(n):e.resolve(r),"function"==typeof t&&(e.promise.catch((function(){})),1===t.length?t(n):t(n,r))}},t}();
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function d(){return"undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:""}function m(){return"undefined"!=typeof window&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(d())}function y(){try{return"[object process]"===Object.prototype.toString.call(t.process)}catch(t){return!1}}function g(){return"object"==typeof self&&self.self===self}function v(){return"object"==typeof navigator&&"ReactNative"===navigator.product}function b(){return d().indexOf("Electron/")>=0}function w(){var t=d();return t.indexOf("MSIE ")>=0||t.indexOf("Trident/")>=0}function T(){return d().indexOf("MSAppHost/")>=0}function _(){return!0===i.NODE_CLIENT||!0===i.NODE_ADMIN}
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var E=function(t){function e(n,r){var i=t.call(this,r)||this;return i.code=n,i.name="FirebaseError",Object.setPrototypeOf(i,e.prototype),Error.captureStackTrace&&Error.captureStackTrace(i,S.prototype.create),i}return Object(r.c)(e,t),e}(Error),S=function(){function t(t,e,n){this.service=t,this.serviceName=e,this.errors=n}return t.prototype.create=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];for(var r=e[0]||{},i=this.service+"/"+t,o=this.errors[t],a=o?I(o,r):"Error",s=this.serviceName+": "+a+" ("+i+").",u=new E(i,s),c=0,h=Object.keys(r);c<h.length;c++){var l=h[c];"_"!==l.slice(-1)&&(l in u&&console.warn('Overwriting FirebaseError base field "'+l+'" can cause unexpected behavior.'),u[l]=r[l])}return u},t}();function I(t,e){return t.replace(C,(function(t,n){var r=e[n];return null!=r?r.toString():"<"+n+"?>"}))}var C=/\{\$([^}]+)}/g;
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function N(t){return JSON.parse(t)}function D(t){return JSON.stringify(t)}
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var A=function(t){var e={},n={},r={},i="";try{var o=t.split(".");e=N(h(o[0])||""),n=N(h(o[1])||""),i=o[2],r=n.d||{},delete n.d}catch(t){}return{header:e,claims:n,data:r,signature:i}},O=function(t){var e=A(t).claims;return!!e&&"object"==typeof e&&e.hasOwnProperty("iat")},k=function(t){var e=A(t).claims;return"object"==typeof e&&!0===e.admin};
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function R(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function P(t,e){return Object.prototype.hasOwnProperty.call(t,e)?t[e]:void 0}function M(t){for(var e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}function L(t,e,n){var r={};for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(r[i]=e.call(n,t[i],i,t));return r}
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function x(t){for(var e=[],n=function(t,n){Array.isArray(n)?n.forEach((function(n){e.push(encodeURIComponent(t)+"="+encodeURIComponent(n))})):e.push(encodeURIComponent(t)+"="+encodeURIComponent(n))},r=0,i=Object.entries(t);r<i.length;r++){var o=i[r];n(o[0],o[1])}return e.length?"&"+e.join("&"):""}
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var F=function(){function t(){this.chain_=[],this.buf_=[],this.W_=[],this.pad_=[],this.inbuf_=0,this.total_=0,this.blockSize=64,this.pad_[0]=128;for(var t=1;t<this.blockSize;++t)this.pad_[t]=0;this.reset()}return t.prototype.reset=function(){this.chain_[0]=1732584193,this.chain_[1]=4023233417,this.chain_[2]=2562383102,this.chain_[3]=271733878,this.chain_[4]=3285377520,this.inbuf_=0,this.total_=0},t.prototype.compress_=function(t,e){e||(e=0);var n=this.W_;if("string"==typeof t)for(var r=0;r<16;r++)n[r]=t.charCodeAt(e)<<24|t.charCodeAt(e+1)<<16|t.charCodeAt(e+2)<<8|t.charCodeAt(e+3),e+=4;else for(r=0;r<16;r++)n[r]=t[e]<<24|t[e+1]<<16|t[e+2]<<8|t[e+3],e+=4;for(r=16;r<80;r++){var i=n[r-3]^n[r-8]^n[r-14]^n[r-16];n[r]=4294967295&(i<<1|i>>>31)}var o,a,s=this.chain_[0],u=this.chain_[1],c=this.chain_[2],h=this.chain_[3],l=this.chain_[4];for(r=0;r<80;r++){r<40?r<20?(o=h^u&(c^h),a=1518500249):(o=u^c^h,a=1859775393):r<60?(o=u&c|h&(u|c),a=2400959708):(o=u^c^h,a=3395469782);i=(s<<5|s>>>27)+o+l+a+n[r]&4294967295;l=h,h=c,c=4294967295&(u<<30|u>>>2),u=s,s=i}this.chain_[0]=this.chain_[0]+s&4294967295,this.chain_[1]=this.chain_[1]+u&4294967295,this.chain_[2]=this.chain_[2]+c&4294967295,this.chain_[3]=this.chain_[3]+h&4294967295,this.chain_[4]=this.chain_[4]+l&4294967295},t.prototype.update=function(t,e){if(null!=t){void 0===e&&(e=t.length);for(var n=e-this.blockSize,r=0,i=this.buf_,o=this.inbuf_;r<e;){if(0===o)for(;r<=n;)this.compress_(t,r),r+=this.blockSize;if("string"==typeof t){for(;r<e;)if(i[o]=t.charCodeAt(r),++r,++o===this.blockSize){this.compress_(i),o=0;break}}else for(;r<e;)if(i[o]=t[r],++r,++o===this.blockSize){this.compress_(i),o=0;break}}this.inbuf_=o,this.total_+=e}},t.prototype.digest=function(){var t=[],e=8*this.total_;this.inbuf_<56?this.update(this.pad_,56-this.inbuf_):this.update(this.pad_,this.blockSize-(this.inbuf_-56));for(var n=this.blockSize-1;n>=56;n--)this.buf_[n]=255&e,e/=256;this.compress_(this.buf_);var r=0;for(n=0;n<5;n++)for(var i=24;i>=0;i-=8)t[r]=this.chain_[n]>>i&255,++r;return t},t}();function j(t,e){var n=new U(t,e);return n.subscribe.bind(n)}var U=function(){function t(t,e){var n=this;this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=e,this.task.then((function(){t(n)})).catch((function(t){n.error(t)}))}return t.prototype.next=function(t){this.forEachObserver((function(e){e.next(t)}))},t.prototype.error=function(t){this.forEachObserver((function(e){e.error(t)})),this.close(t)},t.prototype.complete=function(){this.forEachObserver((function(t){t.complete()})),this.close()},t.prototype.subscribe=function(t,e,n){var r,i=this;if(void 0===t&&void 0===e&&void 0===n)throw new Error("Missing Observer.");void 0===(r=function(t,e){if("object"!=typeof t||null===t)return!1;for(var n=0,r=e;n<r.length;n++){var i=r[n];if(i in t&&"function"==typeof t[i])return!0}return!1}(t,["next","error","complete"])?t:{next:t,error:e,complete:n}).next&&(r.next=q),void 0===r.error&&(r.error=q),void 0===r.complete&&(r.complete=q);var o=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then((function(){try{i.finalError?r.error(i.finalError):r.complete()}catch(t){}})),this.observers.push(r),o},t.prototype.unsubscribeOne=function(t){void 0!==this.observers&&void 0!==this.observers[t]&&(delete this.observers[t],this.observerCount-=1,0===this.observerCount&&void 0!==this.onNoObservers&&this.onNoObservers(this))},t.prototype.forEachObserver=function(t){if(!this.finalized)for(var e=0;e<this.observers.length;e++)this.sendOne(e,t)},t.prototype.sendOne=function(t,e){var n=this;this.task.then((function(){if(void 0!==n.observers&&void 0!==n.observers[t])try{e(n.observers[t])}catch(t){"undefined"!=typeof console&&console.error&&console.error(t)}}))},t.prototype.close=function(t){var e=this;this.finalized||(this.finalized=!0,void 0!==t&&(this.finalError=t),this.task.then((function(){e.observers=void 0,e.onNoObservers=void 0})))},t}();function q(){}
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var V=function(t,e,n,r){var i;if(r<e?i="at least "+e:r>n&&(i=0===n?"none":"no more than "+n),i)throw new Error(t+" failed: Was called with "+r+(1===r?" argument.":" arguments.")+" Expects "+i+".")};function B(t,e,n){var r="";switch(e){case 1:r=n?"first":"First";break;case 2:r=n?"second":"Second";break;case 3:r=n?"third":"Third";break;case 4:r=n?"fourth":"Fourth";break;default:throw new Error("errorPrefix called with argumentNumber > 4.  Need to update it?")}var i=t+" failed: ";return i+=r+" argument "}function W(t,e,n,r){if((!r||n)&&"function"!=typeof n)throw new Error(B(t,e,r)+"must be a valid function.")}function K(t,e,n,r){if((!r||n)&&("object"!=typeof n||null===n))throw new Error(B(t,e,r)+"must be a valid context object.")}
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Q=function(t){for(var e=[],n=0,r=0;r<t.length;r++){var i=t.charCodeAt(r);if(i>=55296&&i<=56319){var a=i-55296;r++,o(r<t.length,"Surrogate pair missing trail surrogate."),i=65536+(a<<10)+(t.charCodeAt(r)-56320)}i<128?e[n++]=i:i<2048?(e[n++]=i>>6|192,e[n++]=63&i|128):i<65536?(e[n++]=i>>12|224,e[n++]=i>>6&63|128,e[n++]=63&i|128):(e[n++]=i>>18|240,e[n++]=i>>12&63|128,e[n++]=i>>6&63|128,e[n++]=63&i|128)}return e},G=function(t){for(var e=0,n=0;n<t.length;n++){var r=t.charCodeAt(n);r<128?e++:r<2048?e+=2:r>=55296&&r<=56319?(e+=4,n++):e+=3}return e}}).call(this,n(3))},,function(t,e,n){"use strict";
/*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */
function r(){for(var t=0,e=0,n=arguments.length;e<n;e++)t+=arguments[e].length;var r=Array(t),i=0;for(e=0;e<n;e++)for(var o=arguments[e],a=0,s=o.length;a<s;a++,i++)r[i]=o[a];return r}
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */n.d(e,"a",(function(){return i})),n.d(e,"b",(function(){return u}));var i,o=[];!function(t){t[t.DEBUG=0]="DEBUG",t[t.VERBOSE=1]="VERBOSE",t[t.INFO=2]="INFO",t[t.WARN=3]="WARN",t[t.ERROR=4]="ERROR",t[t.SILENT=5]="SILENT"}(i||(i={}));var a=i.INFO,s=function(t,e){for(var n=[],o=2;o<arguments.length;o++)n[o-2]=arguments[o];if(!(e<t.logLevel)){var a=(new Date).toISOString();switch(e){case i.DEBUG:case i.VERBOSE:console.log.apply(console,r(["["+a+"]  "+t.name+":"],n));break;case i.INFO:console.info.apply(console,r(["["+a+"]  "+t.name+":"],n));break;case i.WARN:console.warn.apply(console,r(["["+a+"]  "+t.name+":"],n));break;case i.ERROR:console.error.apply(console,r(["["+a+"]  "+t.name+":"],n));break;default:throw new Error("Attempted to log a message with an invalid logType (value: "+e+")")}}},u=function(){function t(t){this.name=t,this._logLevel=a,this._logHandler=s,o.push(this)}return Object.defineProperty(t.prototype,"logLevel",{get:function(){return this._logLevel},set:function(t){if(!(t in i))throw new TypeError("Invalid value assigned to `logLevel`");this._logLevel=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"logHandler",{get:function(){return this._logHandler},set:function(t){if("function"!=typeof t)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=t},enumerable:!0,configurable:!0}),t.prototype.debug=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._logHandler.apply(this,r([this,i.DEBUG],t))},t.prototype.log=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._logHandler.apply(this,r([this,i.VERBOSE],t))},t.prototype.info=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._logHandler.apply(this,r([this,i.INFO],t))},t.prototype.warn=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._logHandler.apply(this,r([this,i.WARN],t))},t.prototype.error=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._logHandler.apply(this,r([this,i.ERROR],t))},t}()},function(t,e,n){(function(t,e){!function(n){"use strict";try{(function(){n=n&&n.hasOwnProperty("default")?n.default:n;var r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)};function i(t,e){function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}var o,a,s=function(){return(s=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)};function u(t,e,n,r){return new(n=n||Promise)((function(i,o){function a(t){try{u(r.next(t))}catch(t){o(t)}}function s(t){try{u(r.throw(t))}catch(t){o(t)}}function u(t){t.done?i(t.value):new n((function(e){e(t.value)})).then(a,s)}u((r=r.apply(t,e||[])).next())}))}function c(t,e){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=0<(i=a.trys).length&&i[i.length-1])&&(6===o[0]||2===o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=e.call(t,a)}catch(t){o=[6,t],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}}function h(){for(var t=0,e=0,n=arguments.length;e<n;e++)t+=arguments[e].length;var r=Array(t),i=0;for(e=0;e<n;e++)for(var o=arguments[e],a=0,s=o.length;a<s;a++,i++)r[i]=o[a];return r}function l(){for(var t=0,e=0,n=arguments.length;e<n;e++)t+=arguments[e].length;var r=Array(t),i=0;for(e=0;e<n;e++)for(var o=arguments[e],a=0,s=o.length;a<s;a++,i++)r[i]=o[a];return r}function f(t,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];if(!(e<t.logLevel)){var i=(new Date).toISOString();switch(e){case o.DEBUG:case o.VERBOSE:console.log.apply(console,l(["["+i+"]  "+t.name+":"],n));break;case o.INFO:console.info.apply(console,l(["["+i+"]  "+t.name+":"],n));break;case o.WARN:console.warn.apply(console,l(["["+i+"]  "+t.name+":"],n));break;case o.ERROR:console.error.apply(console,l(["["+i+"]  "+t.name+":"],n));break;default:throw new Error("Attempted to log a message with an invalid logType (value: "+e+")")}}}(a=o=o||{})[a.DEBUG=0]="DEBUG",a[a.VERBOSE=1]="VERBOSE",a[a.INFO=2]="INFO",a[a.WARN=3]="WARN",a[a.ERROR=4]="ERROR",a[a.SILENT=5]="SILENT";var p=o.INFO,d=(Object.defineProperty(m.prototype,"logLevel",{get:function(){return this._logLevel},set:function(t){if(!(t in o))throw new TypeError("Invalid value assigned to `logLevel`");this._logLevel=t},enumerable:!0,configurable:!0}),Object.defineProperty(m.prototype,"logHandler",{get:function(){return this._logHandler},set:function(t){if("function"!=typeof t)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=t},enumerable:!0,configurable:!0}),m.prototype.debug=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._logHandler.apply(this,l([this,o.DEBUG],t))},m.prototype.log=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._logHandler.apply(this,l([this,o.VERBOSE],t))},m.prototype.info=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._logHandler.apply(this,l([this,o.INFO],t))},m.prototype.warn=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._logHandler.apply(this,l([this,o.WARN],t))},m.prototype.error=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._logHandler.apply(this,l([this,o.ERROR],t))},m);function m(t){this.name=t,this._logLevel=p,this._logHandler=f}function y(){return"undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:""}var g,v=(i(b,g=Error),b);function b(t,e){var n=g.call(this,e)||this;return n.code=t,n.name="FirebaseError",Object.setPrototypeOf(n,b.prototype),Error.captureStackTrace&&Error.captureStackTrace(n,w.prototype.create),n}var w=(T.prototype.create=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];for(var r=e[0]||{},i=this.service+"/"+t,o=this.errors[t],a=o?function(t,e){return t.replace(_,(function(t,n){var r=e[n];return null!=r?r.toString():"<"+n+"?>"}))}(o,r):"Error",s=this.serviceName+": "+a+" ("+i+").",u=new v(i,s),c=0,h=Object.keys(r);c<h.length;c++){var l=h[c];"_"!==l.slice(-1)&&(l in u&&console.warn('Overwriting FirebaseError base field "'+l+'" can cause unexpected behavior.'),u[l]=r[l])}return u},T);function T(t,e,n){this.service=t,this.serviceName=e,this.errors=n}var _=/\{\$([^}]+)}/g,E=(S.prototype.setInstantiationMode=function(t){return this.instantiationMode=t,this},S.prototype.setMultipleInstances=function(t){return this.multipleInstances=t,this},S.prototype.setServiceProps=function(t){return this.serviceProps=t,this},S);function S(t,e,n){this.name=t,this.instanceFactory=e,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY"}var I,C="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:void 0!==t?t:"undefined"!=typeof self?self:{},N=N||{},D=C;function A(t){return"string"==typeof t}function O(t){return"number"==typeof t}function k(t,e){t=t.split("."),e=e||D;for(var n=0;n<t.length;n++)if(null==(e=e[t[n]]))return null;return e}function R(){}function P(t){var e=typeof t;if("object"==e){if(!t)return"null";if(t instanceof Array)return"array";if(t instanceof Object)return e;var n=Object.prototype.toString.call(t);if("[object Window]"==n)return"object";if("[object Array]"==n||"number"==typeof t.length&&void 0!==t.splice&&void 0!==t.propertyIsEnumerable&&!t.propertyIsEnumerable("splice"))return"array";if("[object Function]"==n||void 0!==t.call&&void 0!==t.propertyIsEnumerable&&!t.propertyIsEnumerable("call"))return"function"}else if("function"==e&&void 0===t.call)return"object";return e}function M(t){return"array"==P(t)}function L(t){var e=P(t);return"array"==e||"object"==e&&"number"==typeof t.length}function x(t){var e=typeof t;return"object"==e&&null!=t||"function"==e}var F="closure_uid_"+(1e9*Math.random()>>>0),j=0;function U(t,e,n){return t.call.apply(t.bind,arguments)}function q(t,e,n){if(!t)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var n=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(n,r),t.apply(e,n)}}return function(){return t.apply(e,arguments)}}function V(t,e,n){return(V=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?U:q).apply(null,arguments)}function B(t,e){var n=Array.prototype.slice.call(arguments,1);return function(){var e=n.slice();return e.push.apply(e,arguments),t.apply(this,e)}}var W=Date.now||function(){return+new Date};function K(t,e){function n(){}n.prototype=e.prototype,t.N=e.prototype,t.prototype=new n,(t.prototype.constructor=t).xb=function(t,n,r){for(var i=Array(arguments.length-2),o=2;o<arguments.length;o++)i[o-2]=arguments[o];return e.prototype[n].apply(t,i)}}function Q(){this.j=this.j,this.i=this.i}Q.prototype.j=!1,Q.prototype.la=function(){!this.j&&(this.j=!0,this.G(),0)&&(this[F]||(this[F]=++j))},Q.prototype.G=function(){if(this.i)for(;this.i.length;)this.i.shift()()};var G=Array.prototype.indexOf?function(t,e){return Array.prototype.indexOf.call(t,e,void 0)}:function(t,e){if(A(t))return A(e)&&1==e.length?t.indexOf(e,0):-1;for(var n=0;n<t.length;n++)if(n in t&&t[n]===e)return n;return-1},H=Array.prototype.forEach?function(t,e,n){Array.prototype.forEach.call(t,e,n)}:function(t,e,n){for(var r=t.length,i=A(t)?t.split(""):t,o=0;o<r;o++)o in i&&e.call(n,i[o],o,t)};function z(t){return Array.prototype.concat.apply([],arguments)}function Y(t){var e=t.length;if(0<e){for(var n=Array(e),r=0;r<e;r++)n[r]=t[r];return n}return[]}function X(t){return/^[\s\xa0]*$/.test(t)}var J,$=String.prototype.trim?function(t){return t.trim()}:function(t){return/^[\s\xa0]*([\s\S]*?)[\s\xa0]*$/.exec(t)[1]};function Z(t,e){return-1!=t.indexOf(e)}function tt(t,e){return t<e?-1:e<t?1:0}t:{var et=D.navigator;if(et){var nt=et.userAgent;if(nt){J=nt;break t}}J=""}function rt(t,e,n){for(var r in t)e.call(n,t[r],r,t)}function it(t){var e,n={};for(e in t)n[e]=t[e];return n}var ot="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function at(t,e){for(var n,r,i=1;i<arguments.length;i++){for(n in r=arguments[i])t[n]=r[n];for(var o=0;o<ot.length;o++)n=ot[o],Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}}function st(t){return st[" "](t),t}st[" "]=R;var ut,ct,ht=Z(J,"Opera"),lt=Z(J,"Trident")||Z(J,"MSIE"),ft=Z(J,"Edge"),pt=ft||lt,dt=Z(J,"Gecko")&&!(Z(J.toLowerCase(),"webkit")&&!Z(J,"Edge"))&&!(Z(J,"Trident")||Z(J,"MSIE"))&&!Z(J,"Edge"),mt=Z(J.toLowerCase(),"webkit")&&!Z(J,"Edge");function yt(){var t=D.document;return t?t.documentMode:void 0}t:{var gt="",vt=(ct=J,dt?/rv:([^\);]+)(\)|;)/.exec(ct):ft?/Edge\/([\d\.]+)/.exec(ct):lt?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(ct):mt?/WebKit\/(\S+)/.exec(ct):ht?/(?:Version)[ \/]?(\S+)/.exec(ct):void 0);if(vt&&(gt=vt?vt[1]:""),lt){var bt=yt();if(null!=bt&&bt>parseFloat(gt)){ut=String(bt);break t}}ut=gt}var wt,Tt={};function _t(t){return function(e,n){var r=Tt;return Object.prototype.hasOwnProperty.call(r,e)?r[e]:r[e]=function(){for(var e=0,n=$(String(ut)).split("."),r=$(String(t)).split("."),i=Math.max(n.length,r.length),o=0;0==e&&o<i;o++){var a=n[o]||"",s=r[o]||"";do{if(a=/(\d*)(\D*)(.*)/.exec(a)||["","","",""],s=/(\d*)(\D*)(.*)/.exec(s)||["","","",""],0==a[0].length&&0==s[0].length)break;e=tt(0==a[1].length?0:parseInt(a[1],10),0==s[1].length?0:parseInt(s[1],10))||tt(0==a[2].length,0==s[2].length)||tt(a[2],s[2]),a=a[3],s=s[3]}while(0==e)}return 0<=e}()}(t)}var Et=D.document;wt=Et&&lt?yt()||("CSS1Compat"==Et.compatMode?parseInt(ut,10):5):void 0;var St=!lt||9<=Number(wt),It=lt&&!_t("9"),Ct=function(){if(!D.addEventListener||!Object.defineProperty)return!1;var t=!1,e=Object.defineProperty({},"passive",{get:function(){t=!0}});try{D.addEventListener("test",R,e),D.removeEventListener("test",R,e)}catch(t){}return t}();function Nt(t,e){this.type=t,this.a=this.target=e,this.Ia=!0}function Dt(t,e){if(Nt.call(this,t?t.type:""),this.relatedTarget=this.a=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.pointerId=0,this.pointerType="",this.c=null,t){var n=this.type=t.type,r=t.changedTouches&&t.changedTouches.length?t.changedTouches[0]:null;if(this.target=t.target||t.srcElement,this.a=e,e=t.relatedTarget){if(dt){t:{try{st(e.nodeName);var i=!0;break t}catch(t){}i=!1}i||(e=null)}}else"mouseover"==n?e=t.fromElement:"mouseout"==n&&(e=t.toElement);this.relatedTarget=e,r?(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=void 0!==t.clientX?t.clientX:t.pageX,this.clientY=void 0!==t.clientY?t.clientY:t.pageY,this.screenX=t.screenX||0,this.screenY=t.screenY||0),this.button=t.button,this.key=t.key||"",this.ctrlKey=t.ctrlKey,this.altKey=t.altKey,this.shiftKey=t.shiftKey,this.metaKey=t.metaKey,this.pointerId=t.pointerId||0,this.pointerType=A(t.pointerType)?t.pointerType:At[t.pointerType]||"",(this.c=t).defaultPrevented&&this.b()}}Nt.prototype.b=function(){this.Ia=!1},K(Dt,Nt);var At={2:"touch",3:"pen",4:"mouse"};Dt.prototype.b=function(){Dt.N.b.call(this);var t=this.c;if(t.preventDefault)t.preventDefault();else if(t.returnValue=!1,It)try{(t.ctrlKey||112<=t.keyCode&&t.keyCode<=123)&&(t.keyCode=-1)}catch(t){}};var Ot="closure_listenable_"+(1e6*Math.random()|0),kt=0;function Rt(t,e,n,r,i){this.listener=t,this.proxy=null,this.src=e,this.type=n,this.capture=!!r,this.da=i,this.key=++kt,this.X=this.Z=!1}function Pt(t){t.X=!0,t.listener=null,t.proxy=null,t.src=null,t.da=null}function Mt(t){this.src=t,this.a={},this.b=0}function Lt(t,e){var n=e.type;if(n in t.a){var r,i=t.a[n],o=G(i,e);(r=0<=o)&&Array.prototype.splice.call(i,o,1),r&&(Pt(e),0==t.a[n].length&&(delete t.a[n],t.b--))}}function xt(t,e,n,r){for(var i=0;i<t.length;++i){var o=t[i];if(!o.X&&o.listener==e&&o.capture==!!n&&o.da==r)return i}return-1}Mt.prototype.add=function(t,e,n,r,i){var o=t.toString();(t=this.a[o])||(t=this.a[o]=[],this.b++);var a=xt(t,e,r,i);return-1<a?(e=t[a],n||(e.Z=!1)):((e=new Rt(e,this.src,o,!!r,i)).Z=n,t.push(e)),e};var Ft="closure_lm_"+(1e6*Math.random()|0),jt={};function Ut(t,e,n,r,i){if(r&&r.once)return function t(e,n,r,i,o){if(M(n)){for(var a=0;a<n.length;a++)t(e,n[a],r,i,o);return null}return r=Ht(r),e&&e[Ot]?e.Aa(n,r,x(i)?!!i.capture:!!i,o):qt(e,n,r,!0,i,o)}(t,e,n,r,i);if(M(e)){for(var o=0;o<e.length;o++)Ut(t,e[o],n,r,i);return null}return n=Ht(n),t&&t[Ot]?t.za(e,n,x(r)?!!r.capture:!!r,i):qt(t,e,n,!1,r,i)}function qt(t,e,n,r,i,o){if(!e)throw Error("Invalid event type");var a=x(i)?!!i.capture:!!i;if(a&&!St)return null;var s=Qt(t);if(s||(t[Ft]=s=new Mt(t)),(n=s.add(e,n,r,a,o)).proxy)return n;if(r=function(){var t=Kt,e=St?function(n){return t.call(e.src,e.listener,n)}:function(n){if(!(n=t.call(e.src,e.listener,n)))return n};return e}(),(n.proxy=r).src=t,r.listener=n,t.addEventListener)Ct||(i=a),void 0===i&&(i=!1),t.addEventListener(e.toString(),r,i);else if(t.attachEvent)t.attachEvent(Bt(e.toString()),r);else{if(!t.addListener||!t.removeListener)throw Error("addEventListener and attachEvent are unavailable.");t.addListener(r)}return n}function Vt(t){if(!O(t)&&t&&!t.X){var e=t.src;if(e&&e[Ot])Lt(e.c,t);else{var n=t.type,r=t.proxy;e.removeEventListener?e.removeEventListener(n,r,t.capture):e.detachEvent?e.detachEvent(Bt(n),r):e.addListener&&e.removeListener&&e.removeListener(r),(n=Qt(e))?(Lt(n,t),0==n.b&&(n.src=null,e[Ft]=null)):Pt(t)}}}function Bt(t){return t in jt?jt[t]:jt[t]="on"+t}function Wt(t,e){var n=t.listener,r=t.da||t.src;return t.Z&&Vt(t),n.call(r,e)}function Kt(t,e){return!!t.X||Wt(t,St?new Dt(e,this):e=new Dt(e||k("window.event"),this))}function Qt(t){return(t=t[Ft])instanceof Mt?t:null}var Gt="__closure_events_fn_"+(1e9*Math.random()>>>0);function Ht(t){return"function"==P(t)?t:(t[Gt]||(t[Gt]=function(e){return t.handleEvent(e)}),t[Gt])}function zt(){Q.call(this),this.c=new Mt(this),(this.J=this).B=null}function Yt(t,e,n,r){if(!(e=t.c.a[String(e)]))return!0;e=e.concat();for(var i=!0,o=0;o<e.length;++o){var a=e[o];if(a&&!a.X&&a.capture==n){var s=a.listener,u=a.da||a.src;a.Z&&Lt(t.c,a),i=!1!==s.call(u,r)&&i}}return i&&0!=r.Ia}K(zt,Q),zt.prototype[Ot]=!0,(I=zt.prototype).addEventListener=function(t,e,n,r){Ut(this,t,e,n,r)},I.removeEventListener=function(t,e,n,r){!function t(e,n,r,i,o){if(M(n))for(var a=0;a<n.length;a++)t(e,n[a],r,i,o);else i=x(i)?!!i.capture:!!i,r=Ht(r),e&&e[Ot]?(e=e.c,(n=String(n).toString())in e.a&&-1<(r=xt(a=e.a[n],r,i,o))&&(Pt(a[r]),Array.prototype.splice.call(a,r,1),0==a.length&&(delete e.a[n],e.b--))):(e=e&&Qt(e))&&(n=e.a[n.toString()],e=-1,n&&(e=xt(n,r,i,o)),(r=-1<e?n[e]:null)&&Vt(r))}(this,t,e,n,r)},I.dispatchEvent=function(t){var e,n=this.B;if(n)for(e=[];n;n=n.B)e.push(n);n=this.J;var r=t.type||t;if(A(t))t=new Nt(t,n);else if(t instanceof Nt)t.target=t.target||n;else{var i=t;at(t=new Nt(r,n),i)}if(i=!0,e)for(var o=e.length-1;0<=o;o--){var a=t.a=e[o];i=Yt(a,r,!0,t)&&i}if(i=Yt(a=t.a=n,r,!0,t)&&i,i=Yt(a,r,!1,t)&&i,e)for(o=0;o<e.length;o++)i=Yt(a=t.a=e[o],r,!1,t)&&i;return i},I.G=function(){if(zt.N.G.call(this),this.c){var t,e=this.c;for(t in e.a){for(var n=e.a[t],r=0;r<n.length;r++)Pt(n[r]);delete e.a[t],e.b--}}this.B=null},I.za=function(t,e,n,r){return this.c.add(String(t),e,!1,n,r)},I.Aa=function(t,e,n,r){return this.c.add(String(t),e,!0,n,r)};var Xt=D.JSON.stringify;function Jt(t,e){this.c=t,this.f=e,this.b=0,this.a=null}function $t(){this.b=this.a=null}Jt.prototype.get=function(){if(0<this.b){this.b--;var t=this.a;this.a=t.next,t.next=null}else t=this.c();return t};var Zt,te=new Jt((function(){return new ee}),(function(t){t.reset()}));function ee(){this.next=this.b=this.a=null}function ne(t){D.setTimeout((function(){throw t}),0)}function re(t,e){Zt||function(){var t=D.Promise.resolve(void 0);Zt=function(){t.then(ae)}}(),ie||(Zt(),ie=!0),oe.add(t,e)}$t.prototype.add=function(t,e){var n=te.get();n.set(t,e),this.b?this.b.next=n:this.a=n,this.b=n},ee.prototype.set=function(t,e){this.a=t,this.b=e,this.next=null};var ie=!(ee.prototype.reset=function(){this.next=this.b=this.a=null}),oe=new $t;function ae(){for(var t;r=n=void 0,r=null,(n=oe).a&&(r=n.a,n.a=n.a.next,n.a||(n.b=null),r.next=null),t=r;){try{t.a.call(t.b)}catch(t){ne(t)}var e=te;e.f(t),e.b<100&&(e.b++,t.next=e.a,e.a=t)}var n,r;ie=!1}function se(t,e){zt.call(this),this.b=t||1,this.a=e||D,this.f=V(this.fb,this),this.g=W()}function ue(t){t.ba=!1,t.L&&(t.a.clearTimeout(t.L),t.L=null)}function ce(t,e,n){if("function"==P(t))n&&(t=V(t,n));else{if(!t||"function"!=typeof t.handleEvent)throw Error("Invalid listener argument");t=V(t.handleEvent,t)}return 2147483647<Number(e)?-1:D.setTimeout(t,e||0)}function he(t,e,n){Q.call(this),this.f=null!=n?V(t,n):t,this.c=e,this.b=V(this.$a,this),this.a=[]}function le(t){t.U=ce(t.b,t.c),t.f.apply(null,t.a)}function fe(t){Q.call(this),this.b=t,this.a={}}K(se,zt),(I=se.prototype).ba=!1,I.L=null,I.fb=function(){if(this.ba){var t=W()-this.g;0<t&&t<.8*this.b?this.L=this.a.setTimeout(this.f,this.b-t):(this.L&&(this.a.clearTimeout(this.L),this.L=null),this.dispatchEvent("tick"),this.ba&&(ue(this),this.start()))}},I.start=function(){this.ba=!0,this.L||(this.L=this.a.setTimeout(this.f,this.b),this.g=W())},I.G=function(){se.N.G.call(this),ue(this),delete this.a},K(he,Q),(I=he.prototype).ea=!1,I.U=null,I.Ta=function(t){this.a=arguments,this.U?this.ea=!0:le(this)},I.G=function(){he.N.G.call(this),this.U&&(D.clearTimeout(this.U),this.U=null,this.ea=!1,this.a=[])},I.$a=function(){this.U=null,this.ea&&(this.ea=!1,le(this))},K(fe,Q);var pe=[];function de(t,e,n,r){M(n)||(n&&(pe[0]=n.toString()),n=pe);for(var i=0;i<n.length;i++){var o=Ut(e,n[i],r||t.handleEvent,!1,t.b||t);if(!o)break;t.a[o.key]=o}}function me(t){rt(t.a,(function(t,e){this.a.hasOwnProperty(e)&&Vt(t)}),t),t.a={}}function ye(){}fe.prototype.G=function(){fe.N.G.call(this),me(this)},fe.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var ge=new zt;function ve(t){Nt.call(this,"serverreachability",t)}function be(t){ge.dispatchEvent(new ve(ge,t))}function we(t){Nt.call(this,"statevent",t)}function Te(t){ge.dispatchEvent(new we(ge,t))}function _e(t){Nt.call(this,"timingevent",t)}function Ee(t,e){if("function"!=P(t))throw Error("Fn must not be null and must be a function");return D.setTimeout((function(){t()}),e)}K(ve,Nt),K(we,Nt),K(_e,Nt);var Se={NO_ERROR:0,gb:1,nb:2,mb:3,jb:4,lb:5,ob:6,La:7,TIMEOUT:8,rb:9},Ie={ib:"complete",vb:"success",Ma:"error",La:"abort",tb:"ready",ub:"readystatechange",TIMEOUT:"timeout",pb:"incrementaldata",sb:"progress",kb:"downloadprogress",wb:"uploadprogress"};function Ce(){}function Ne(t){var e;return(e=t.a)||(e=t.a={}),e}function De(){}Ce.prototype.a=null;var Ae,Oe={OPEN:"a",hb:"b",Ma:"c",qb:"d"};function ke(){Nt.call(this,"d")}function Re(){Nt.call(this,"c")}function Pe(){}function Me(t,e,n){this.g=t,this.W=e,this.V=n||1,this.I=new fe(this),this.O=Le,t=pt?125:void 0,this.P=new se(t),this.h=null,this.b=!1,this.l=this.D=this.f=this.F=this.v=this.R=this.i=null,this.j=[],this.a=null,this.A=0,this.c=this.w=null,this.o=-1,this.m=!1,this.J=0,this.B=null,this.s=this.S=this.H=!1}K(ke,Nt),K(Re,Nt),K(Pe,Ce),Ae=new Pe;var Le=45e3,xe={},Fe={};function je(t,e,n){t.F=1,t.f=hn(nn(e)),t.l=n,t.H=!0,qe(t,null)}function Ue(t,e,n,r){t.F=1,t.f=hn(nn(e)),t.l=null,t.H=n,qe(t,r)}function qe(t,e){t.v=W(),We(t),t.D=nn(t.f),cn(t.D,"t",t.V),t.A=0,t.a=t.g.$(t.g.Y()?e:null),0<t.J&&(t.B=new he(V(t.Ja,t,t.a),t.J)),de(t.I,t.a,"readystatechange",t.cb),e=t.h?it(t.h):{},t.l?(t.w||(t.w="POST"),e["Content-Type"]="application/x-www-form-urlencoded",t.a.ca(t.D,t.w,t.l,e)):(t.w="GET",t.a.ca(t.D,t.w,null,e)),be(1)}function Ve(t,e,n){for(var r=!0;!t.m&&t.A<n.length;){var i=Be(t,n);if(i==Fe){4==e&&(t.c=4,Te(14),r=!1);break}if(i==xe){t.c=4,Te(15),r=!1;break}ze(t,i)}4==e&&0==n.length&&(t.c=1,Te(16),r=!1),t.b=t.b&&r,r||(He(t),Ge(t))}function Be(t,e){var n=t.A,r=e.indexOf("\n",n);return-1==r?Fe:(n=Number(e.substring(n,r)),isNaN(n)?xe:(r+=1)+n>e.length?Fe:(e=e.substr(r,n),t.A=r+n,e))}function We(t){t.R=W()+t.O,Ke(t,t.O)}function Ke(t,e){if(null!=t.i)throw Error("WatchDog timer not null");t.i=Ee(V(t.ab,t),e)}function Qe(t){t.i&&(D.clearTimeout(t.i),t.i=null)}function Ge(t){t.g.Ca()||t.m||t.g.na(t)}function He(t){Qe(t);var e=t.B;e&&"function"==typeof e.la&&e.la(),t.B=null,ue(t.P),me(t.I),t.a&&(e=t.a,t.a=null,e.abort(),e.la())}function ze(t,e){try{t.g.Fa(t,e),be(4)}catch(t){}}function Ye(t,e){if(t.forEach&&"function"==typeof t.forEach)t.forEach(e,void 0);else if(L(t)||A(t))H(t,e,void 0);else{if(t.K&&"function"==typeof t.K)var n=t.K();else if(t.C&&"function"==typeof t.C)n=void 0;else if(L(t)||A(t)){n=[];for(var r=t.length,i=0;i<r;i++)n.push(i)}else for(i in n=[],r=0,t)n[r++]=i;i=(r=function(t){if(t.C&&"function"==typeof t.C)return t.C();if(A(t))return t.split("");if(L(t)){for(var e=[],n=t.length,r=0;r<n;r++)e.push(t[r]);return e}for(r in e=[],n=0,t)e[n++]=t[r];return e}(t)).length;for(var o=0;o<i;o++)e.call(void 0,r[o],n&&n[o],t)}}function Xe(t,e){this.b={},this.a=[],this.c=0;var n=arguments.length;if(1<n){if(n%2)throw Error("Uneven number of arguments");for(var r=0;r<n;r+=2)this.set(arguments[r],arguments[r+1])}else if(t)if(t instanceof Xe)for(n=t.K(),r=0;r<n.length;r++)this.set(n[r],t.get(n[r]));else for(r in t)this.set(r,t[r])}function Je(t,e){Ze(t.b,e)&&(delete t.b[e],t.c--,t.a.length>2*t.c&&$e(t))}function $e(t){if(t.c!=t.a.length){for(var e=0,n=0;e<t.a.length;){var r=t.a[e];Ze(t.b,r)&&(t.a[n++]=r),e++}t.a.length=n}if(t.c!=t.a.length){var i={};for(n=e=0;e<t.a.length;)Ze(i,r=t.a[e])||(i[t.a[n++]=r]=1),e++;t.a.length=n}}function Ze(t,e){return Object.prototype.hasOwnProperty.call(t,e)}(I=Me.prototype).setTimeout=function(t){this.O=t},I.cb=function(t){t=t.target;var e=this.B;e&&3==nr(t)?e.Ta():this.Ja(t)},I.Ja=function(t){try{if(t==this.a)t:{var e=nr(this.a),n=this.a.ya(),r=this.a.T();if(!(e<3||3==e&&!pt&&!this.a.aa())){this.m||4!=e||7==n||be(8==n||r<=0?3:2),Qe(this);var i=this.a.T();this.o=i;var o=this.a.aa();if(this.b=200==i){if(this.S&&!this.s){e:{if(this.a){var a=rr(this.a,"X-HTTP-Initial-Response");if(a&&!X(a)){var s=a;break e}}s=null}if(!s){this.b=!1,this.c=3,Te(12),He(this),Ge(this);break t}this.s=!0,ze(this,s)}this.H?(Ve(this,e,o),pt&&this.b&&3==e&&(de(this.I,this.P,"tick",this.bb),this.P.start())):ze(this,o),4==e&&He(this),this.b&&!this.m&&(4==e?this.g.na(this):(this.b=!1,We(this)))}else 400==i&&0<o.indexOf("Unknown SID")?(this.c=3,Te(12)):(this.c=0,Te(13)),He(this),Ge(this)}}}catch(t){}},I.bb=function(){if(this.a){var t=nr(this.a),e=this.a.aa();this.A<e.length&&(Qe(this),Ve(this,t,e),this.b&&4!=t&&We(this))}},I.cancel=function(){this.m=!0,He(this)},I.ab=function(){this.i=null;var t=W();0<=t-this.R?(2!=this.F&&(be(3),Te(17)),He(this),this.c=2,Ge(this)):Ke(this,this.R-t)},(I=Xe.prototype).C=function(){$e(this);for(var t=[],e=0;e<this.a.length;e++)t.push(this.b[this.a[e]]);return t},I.K=function(){return $e(this),this.a.concat()},I.get=function(t,e){return Ze(this.b,t)?this.b[t]:e},I.set=function(t,e){Ze(this.b,t)||(this.c++,this.a.push(t)),this.b[t]=e},I.forEach=function(t,e){for(var n=this.K(),r=0;r<n.length;r++){var i=n[r],o=this.get(i);t.call(e,o,i,this)}};var tn=/^(?:([^:/?#.]+):)?(?:\/\/(?:([^/?#]*)@)?([^/#?]*?)(?::([0-9]+))?(?=[/#?]|$))?([^?#]+)?(?:\?([^#]*))?(?:#([\s\S]*))?$/;function en(t,e){var n;this.b=this.j=this.f="",this.i=null,this.g=this.a="",this.h=!1,t instanceof en?(this.h=void 0!==e?e:t.h,rn(this,t.f),this.j=t.j,on(this,t.b),an(this,t.i),this.a=t.a,sn(this,Sn(t.c)),this.g=t.g):t&&(n=String(t).match(tn))?(this.h=!!e,rn(this,n[1]||"",!0),this.j=ln(n[2]||""),on(this,n[3]||"",!0),an(this,n[4]),this.a=ln(n[5]||"",!0),sn(this,n[6]||"",!0),this.g=ln(n[7]||"")):(this.h=!!e,this.c=new bn(null,this.h))}function nn(t){return new en(t)}function rn(t,e,n){t.f=n?ln(e,!0):e,t.f&&(t.f=t.f.replace(/:$/,""))}function on(t,e,n){t.b=n?ln(e,!0):e}function an(t,e){if(e){if(e=Number(e),isNaN(e)||e<0)throw Error("Bad port number "+e);t.i=e}else t.i=null}function sn(t,e,n){e instanceof bn?(t.c=e,function(t,e){e&&!t.f&&(wn(t),t.c=null,t.a.forEach((function(t,e){var n=e.toLowerCase();e!=n&&(Tn(this,e),En(this,n,t))}),t)),t.f=e}(t.c,t.h)):(n||(e=fn(e,gn)),t.c=new bn(e,t.h))}function un(t,e,n){t.c.set(e,n)}function cn(t,e,n){M(n)||(n=[String(n)]),En(t.c,e,n)}function hn(t){return un(t,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^W()).toString(36)),t}function ln(t,e){return t?e?decodeURI(t.replace(/%25/g,"%2525")):decodeURIComponent(t):""}function fn(t,e,n){return A(t)?(t=encodeURI(t).replace(e,pn),n&&(t=t.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),t):null}function pn(t){return"%"+((t=t.charCodeAt(0))>>4&15).toString(16)+(15&t).toString(16)}en.prototype.toString=function(){var t=[],e=this.f;e&&t.push(fn(e,dn,!0),":");var n=this.b;return!n&&"file"!=e||(t.push("//"),(e=this.j)&&t.push(fn(e,dn,!0),"@"),t.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.i)&&t.push(":",String(n))),(n=this.a)&&(this.b&&"/"!=n.charAt(0)&&t.push("/"),t.push(fn(n,"/"==n.charAt(0)?yn:mn,!0))),(n=this.c.toString())&&t.push("?",n),(n=this.g)&&t.push("#",fn(n,vn)),t.join("")},en.prototype.resolve=function(t){var e=nn(this),n=!!t.f;n?rn(e,t.f):n=!!t.j,n?e.j=t.j:n=!!t.b,n?on(e,t.b):n=null!=t.i;var r=t.a;if(n)an(e,t.i);else if(n=!!t.a){if("/"!=r.charAt(0))if(this.b&&!this.a)r="/"+r;else{var i=e.a.lastIndexOf("/");-1!=i&&(r=e.a.substr(0,i+1)+r)}if(".."==(i=r)||"."==i)r="";else if(Z(i,"./")||Z(i,"/.")){r=0==i.lastIndexOf("/",0),i=i.split("/");for(var o=[],a=0;a<i.length;){var s=i[a++];"."==s?r&&a==i.length&&o.push(""):".."==s?((1<o.length||1==o.length&&""!=o[0])&&o.pop(),r&&a==i.length&&o.push("")):(o.push(s),r=!0)}r=o.join("/")}else r=i}return n?e.a=r:n=""!==t.c.toString(),n?sn(e,Sn(t.c)):n=!!t.g,n&&(e.g=t.g),e};var dn=/[#\/\?@]/g,mn=/[#\?:]/g,yn=/[#\?]/g,gn=/[#\?@]/g,vn=/#/g;function bn(t,e){this.b=this.a=null,this.c=t||null,this.f=!!e}function wn(t){t.a||(t.a=new Xe,t.b=0,t.c&&function(t,e){if(t){t=t.split("&");for(var n=0;n<t.length;n++){var r=t[n].indexOf("="),i=null;if(0<=r){var o=t[n].substring(0,r);i=t[n].substring(r+1)}else o=t[n];e(o,i?decodeURIComponent(i.replace(/\+/g," ")):"")}}}(t.c,(function(e,n){t.add(decodeURIComponent(e.replace(/\+/g," ")),n)})))}function Tn(t,e){wn(t),e=In(t,e),Ze(t.a.b,e)&&(t.c=null,t.b-=t.a.get(e).length,Je(t.a,e))}function _n(t,e){return wn(t),e=In(t,e),Ze(t.a.b,e)}function En(t,e,n){Tn(t,e),0<n.length&&(t.c=null,t.a.set(In(t,e),Y(n)),t.b+=n.length)}function Sn(t){var e=new bn;return e.c=t.c,t.a&&(e.a=new Xe(t.a),e.b=t.b),e}function In(t,e){return e=String(e),t.f&&(e=e.toLowerCase()),e}function Cn(t){this.a=t,this.b=this.h=null,this.g=!1,this.i=null,this.c=-1,this.l=this.f=null}function Nn(t){var e=t.a.F.a;if(null!=e)Te(4),e?(Te(10),mr(t.a,t,!1)):(Te(11),mr(t.a,t,!0));else{t.b=new Me(t,void 0,void 0),t.b.h=t.h,e=wr(e=t.a,e.Y()?t.f:null,t.i),Te(4),cn(e,"TYPE","xmlhttp");var n=t.a.j,r=t.a.I;n&&r&&un(e,n,r),Ue(t.b,e,!1,t.f)}}function Dn(){this.a=this.b=null}function An(){this.a=new Xe}function On(t){var e=typeof t;return"object"==e&&t||"function"==e?"o"+(t[F]||(t[F]=++j)):e.charAt(0)+t}function kn(t,e){this.b=t,this.a=e}function Rn(t){this.g=t||Pn,t=D.PerformanceNavigationTiming?0<(t=D.performance.getEntriesByType("navigation")).length&&("hq"==t[0].nextHopProtocol||"h2"==t[0].nextHopProtocol):!!(D.ka&&D.ka.Da&&D.ka.Da()&&D.ka.Da().yb),this.f=t?this.g:1,this.a=null,1<this.f&&(this.a=new An),this.b=null,this.c=[]}(I=bn.prototype).add=function(t,e){wn(this),this.c=null,t=In(this,t);var n=this.a.get(t);return n||this.a.set(t,n=[]),n.push(e),this.b+=1,this},I.forEach=function(t,e){wn(this),this.a.forEach((function(n,r){H(n,(function(n){t.call(e,n,r,this)}),this)}),this)},I.K=function(){wn(this);for(var t=this.a.C(),e=this.a.K(),n=[],r=0;r<e.length;r++)for(var i=t[r],o=0;o<i.length;o++)n.push(e[r]);return n},I.C=function(t){wn(this);var e=[];if(A(t))_n(this,t)&&(e=z(e,this.a.get(In(this,t))));else{t=this.a.C();for(var n=0;n<t.length;n++)e=z(e,t[n])}return e},I.set=function(t,e){return wn(this),this.c=null,_n(this,t=In(this,t))&&(this.b-=this.a.get(t).length),this.a.set(t,[e]),this.b+=1,this},I.get=function(t,e){return t&&0<(t=this.C(t)).length?String(t[0]):e},I.toString=function(){if(this.c)return this.c;if(!this.a)return"";for(var t=[],e=this.a.K(),n=0;n<e.length;n++){var r=e[n],i=encodeURIComponent(String(r));r=this.C(r);for(var o=0;o<r.length;o++){var a=i;""!==r[o]&&(a+="="+encodeURIComponent(String(r[o]))),t.push(a)}}return this.c=t.join("&")},K((function(){}),(function(){})),(I=Cn.prototype).M=null,I.$=function(t){return this.a.$(t)},I.abort=function(){this.b&&(this.b.cancel(),this.b=null),this.c=-1},I.Ca=function(){return!1},I.Fa=function(t,e){if(this.c=t.o,0==this.M){if(!this.a.o&&(t=t.a)){var n=rr(t,"X-Client-Wire-Protocol");this.l=n||null,this.a.j&&(t=rr(t,"X-HTTP-Session-Id"))&&(this.a.I=t)}if(e){try{var r=this.a.ja.a.parse(e)}catch(t){return(e=this.a).m=this.c,void vr(e,2)}this.f=r[0]}else(e=this.a).m=this.c,vr(e,2)}else 1==this.M&&(this.g?Te(6):"11111"==e?(Te(5),this.g=!0,(!lt||10<=Number(wt))&&(this.c=200,this.b.cancel(),Te(11),mr(this.a,this,!0))):(Te(7),this.g=!1))},I.na=function(){if(this.c=this.b.o,this.b.b)0==this.M?(this.M=1,Nn(this)):1==this.M&&(this.g?(Te(11),mr(this.a,this,!0)):(Te(10),mr(this.a,this,!1)));else{0==this.M?Te(8):1==this.M&&Te(9);var t=this.a;t.m=this.c,vr(t,2)}},I.Y=function(){return this.a.Y()},I.ma=function(){return this.a.ma()},An.prototype.add=function(t){this.a.set(On(t),t)},An.prototype.C=function(){return this.a.C()};var Pn=10;function Mn(t,e){!t.a&&(Z(e,"spdy")||Z(e,"quic")||Z(e,"h2"))&&(t.f=t.g,t.a=new An,t.b&&(jn(t,t.b),t.b=null))}function Ln(t){return!!t.b||!!t.a&&t.a.a.c>=t.f}function xn(t){return t.b?1:t.a?t.a.a.c:0}function Fn(t,e){return t.b?t.b==e:!!t.a&&(e=On(e),Ze(t.a.a.b,e))}function jn(t,e){t.a?t.a.add(e):t.b=e}function Un(t,e){var n;t.b&&t.b==e?t.b=null:((n=t.a)&&(n=On(e),n=Ze(t.a.a.b,n)),n&&Je(t.a.a,On(e)))}function qn(t){if(null!=t.b)return t.c.concat(t.b.j);if(null==t.a||0==t.a.a.c)return Y(t.c);var e=t.c;return H(t.a.C(),(function(t){e=e.concat(t.j)})),e}function Vn(){}function Bn(){this.a=new Vn}function Wn(t,e,n){var r=n||"";try{Ye(t,(function(t,n){var i=t;x(t)&&(i=Xt(t)),e.push(r+n+"="+encodeURIComponent(i))}))}catch(t){throw e.push(r+"type="+encodeURIComponent("_badmap")),t}}function Kn(t,e,n,r,i){try{e.onload=null,e.onerror=null,e.onabort=null,e.ontimeout=null,i(r)}catch(t){}}Rn.prototype.cancel=function(){this.c=qn(this),this.b?(this.b.cancel(),this.b=null):this.a&&0!=this.a.a.c&&(H(this.a.C(),(function(t){t.cancel()})),function(t){t.b={},t.a.length=0,t.c=0}(this.a.a))},Vn.prototype.stringify=function(t){return D.JSON.stringify(t,void 0)},Vn.prototype.parse=function(t){return D.JSON.parse(t,void 0)};var Qn=D.JSON.parse;function Gn(t){zt.call(this),this.headers=new Xe,this.H=t||null,this.b=!1,this.s=this.a=null,this.A="",this.h=0,this.f="",this.g=this.w=this.l=this.v=!1,this.o=0,this.m=null,this.I=Hn,this.D=this.F=!1}K(Gn,zt);var Hn="",zn=/^https?$/i,Yn=["POST","PUT"];function Xn(t){return"content-type"==t.toLowerCase()}function Jn(t,e){t.b=!1,t.a&&(t.g=!0,t.a.abort(),t.g=!1),t.f=e,t.h=5,$n(t),tr(t)}function $n(t){t.v||(t.v=!0,t.dispatchEvent("complete"),t.dispatchEvent("error"))}function Zn(t){if(t.b&&void 0!==N&&(!t.s[1]||4!=nr(t)||2!=t.T()))if(t.l&&4==nr(t))ce(t.Ea,0,t);else if(t.dispatchEvent("readystatechange"),4==nr(t)){t.b=!1;try{var e,n=t.T();t:switch(n){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var r=!0;break t;default:r=!1}if(!(e=r)){var i;if(i=0===n){var o=String(t.A).match(tn)[1]||null;if(!o&&D.self&&D.self.location){var a=D.self.location.protocol;o=a.substr(0,a.length-1)}i=!zn.test(o?o.toLowerCase():"")}e=i}if(e)t.dispatchEvent("complete"),t.dispatchEvent("success");else{t.h=6;try{var s=2<nr(t)?t.a.statusText:""}catch(t){s=""}t.f=s+" ["+t.T()+"]",$n(t)}}finally{tr(t)}}}function tr(t,e){if(t.a){er(t);var n=t.a,r=t.s[0]?R:null;t.a=null,t.s=null,e||t.dispatchEvent("ready");try{n.onreadystatechange=r}catch(t){}}}function er(t){t.a&&t.D&&(t.a.ontimeout=null),t.m&&(D.clearTimeout(t.m),t.m=null)}function nr(t){return t.a?t.a.readyState:0}function rr(t,e){return t.a?t.a.getResponseHeader(e):null}function ir(t,e,n){t:{for(r in n){var r=!1;break t}r=!0}if(r)return t;if(n=function(t){var e="";return rt(t,(function(t,n){e+=n,e+=":",e+=t,e+="\r\n"})),e}(n),A(t)){if(e=encodeURIComponent(String(e)),e+=n=null!=n?"="+encodeURIComponent(String(n)):""){if((n=t.indexOf("#"))<0&&(n=t.length),(r=t.indexOf("?"))<0||n<r){r=n;var i=""}else i=t.substring(r+1,n);n=(t=[t.substr(0,r),i,t.substr(n)])[1],t[1]=e?n?n+"&"+e:e:n,t=t[0]+(t[1]?"?"+t[1]:"")+t[2]}return t}return un(t,e,n),t}function or(t){this.f=[],this.F=new Dn,this.ga=this.pa=this.B=this.ha=this.a=this.I=this.j=this.V=this.g=this.J=this.i=null,this.Qa=this.P=0,this.Oa=!!k("internalChannelParams.failFast",t),this.ia=this.w=this.s=this.l=this.h=this.c=null,this.oa=!0,this.m=this.ra=this.O=-1,this.S=this.v=this.A=0,this.Na=k("internalChannelParams.baseRetryDelayMs",t)||5e3,this.Ra=k("internalChannelParams.retryDelaySeedMs",t)||1e4,this.Pa=k("internalChannelParams.forwardChannelMaxRetries",t)||2,this.qa=k("internalChannelParams.forwardChannelRequestTimeoutMs",t)||2e4,this.Ka=t&&t.zb||void 0,this.D=void 0,this.R=t&&t.supportsCrossDomainXhr||!1,this.H="",this.b=new Rn(t&&t.concurrentRequestLimit),this.ja=new Bn,this.o=!t||void 0===t.backgroundChannelTest||t.backgroundChannelTest,(this.W=t&&t.fastHandshake||!1)&&!this.o&&(this.o=!0),t&&t.forceLongPolling&&(this.oa=!1),this.fa=void 0}function ar(t){if(sr(t),3==t.u){var e=t.P++,n=nn(t.B);un(n,"SID",t.H),un(n,"RID",e),un(n,"TYPE","terminate"),lr(t,n),(e=new Me(t,e,void 0)).F=2,e.f=hn(nn(n)),n=!1,D.navigator&&D.navigator.sendBeacon&&(n=D.navigator.sendBeacon(e.f.toString(),"")),!n&&D.Image&&((new Image).src=e.f,n=!0),n||(e.a=e.g.$(null),e.a.ca(e.f)),e.v=W(),We(e)}br(t)}function sr(t){t.w&&(t.w.abort(),t.w=null),t.a&&(t.a.cancel(),t.a=null),t.l&&(D.clearTimeout(t.l),t.l=null),yr(t),t.b.cancel(),t.h&&(O(t.h)&&D.clearTimeout(t.h),t.h=null)}function ur(t,e){t.f.push(new kn(t.Qa++,e)),3==t.u&&cr(t)}function cr(t){Ln(t.b)||t.h||(t.h=!0,re(t.Ha,t),t.A=0)}function hr(t,e){var n;n=e?e.W:t.P++;var r=nn(t.B);un(r,"SID",t.H),un(r,"RID",n),un(r,"AID",t.O),lr(t,r),t.g&&t.i&&ir(r,t.g,t.i),n=new Me(t,n,t.A+1),null===t.g&&(n.h=t.i),e&&(t.f=e.j.concat(t.f)),e=fr(t,n,1e3),n.setTimeout(Math.round(.5*t.qa)+Math.round(.5*t.qa*Math.random())),jn(t.b,n),je(n,r,e)}function lr(t,e){t.c&&Ye({},(function(t,n){un(e,n,t)}))}function fr(t,e,n){n=Math.min(t.f.length,n);var r=t.c?V(t.c.Sa,t.c,t):null;t:for(var i=t.f,o=-1;;){var a=["count="+n];-1==o?0<n?(o=i[0].b,a.push("ofs="+o)):o=0:a.push("ofs="+o);for(var s=!0,u=0;u<n;u++){var c=i[u].b,h=i[u].a;if((c-=o)<0)o=Math.max(0,i[u].b-100),s=!1;else try{Wn(h,a,"req"+c+"_")}catch(t){r&&r(h)}}if(s){r=a.join("&");break t}}return t=t.f.splice(0,n),e.j=t,r}function pr(t){t.a||t.l||(t.S=1,re(t.Ga,t),t.v=0)}function dr(t){return!(t.a||t.l||3<=t.v||(t.S++,t.l=Ee(V(t.Ga,t),gr(t,t.v)),t.v++,0))}function mr(t,e,n){var r=e.l;r&&Mn(t.b,r),t.ia=t.oa&&n,t.m=e.c,t.B=wr(t,null,t.ha),cr(t)}function yr(t){null!=t.s&&(D.clearTimeout(t.s),t.s=null)}function gr(t,e){var n=t.Na+Math.floor(Math.random()*t.Ra);return t.ma()||(n*=2),n*e}function vr(t,e){if(2==e){var n=null;t.c&&(n=null);var r=V(t.eb,t);n||(n=new en("//www.google.com/images/cleardot.gif"),D.location&&"http"==D.location.protocol||rn(n,"https"),hn(n)),function(t,e){var n=new ye;if(D.Image){var r=new Image;r.onload=B(Kn,n,r,"TestLoadImage: loaded",!0,e),r.onerror=B(Kn,n,r,"TestLoadImage: error",!1,e),r.onabort=B(Kn,n,r,"TestLoadImage: abort",!1,e),r.ontimeout=B(Kn,n,r,"TestLoadImage: timeout",!1,e),D.setTimeout((function(){r.ontimeout&&r.ontimeout()}),1e4),r.src=t}else e(!1)}(n.toString(),r)}else Te(2);t.u=0,t.c&&t.c.ta(e),br(t),sr(t)}function br(t){t.u=0,t.m=-1,t.c&&(0==qn(t.b).length&&0==t.f.length||(t.b.c.length=0,Y(t.f),t.f.length=0),t.c.sa())}function wr(t,e,n){var r=function(t){return t instanceof en?nn(t):new en(t,void 0)}(n);if(""!=r.b)e&&on(r,e+"."+r.b),an(r,r.i);else{var i,o=D.location;i=e?e+"."+o.hostname:o.hostname,r=function(t,e,n,r){var i=new en(null,void 0);return t&&rn(i,t),e&&on(i,e),n&&an(i,n),r&&(i.a=r),i}(o.protocol,i,+o.port,n)}return t.V&&rt(t.V,(function(t,e){un(r,e,t)})),e=t.j,n=t.I,e&&n&&un(r,e,n),un(r,"VER",t.wa),lr(t,r),r}function Tr(){}function _r(){if(lt&&!(10<=Number(wt)))throw Error("Environmental error: no available transport.")}function Er(t,e){zt.call(this),this.a=new or(e),this.g=t,this.m=e&&e.testUrl?e.testUrl:function(t){for(var e=t,n=1;n<arguments.length;n++){var r,i=arguments[n];0==i.lastIndexOf("/",0)?e=i:((r=""==e)||(r=0<=(r=e.length-1)&&e.indexOf("/",r)==r),e+=r?i:"/"+i)}return e}(this.g,"test"),this.b=e&&e.messageUrlParams||null,t=e&&e.messageHeaders||null,e&&e.clientProtocolHeaderRequired&&(t?t["X-Client-Protocol"]="webchannel":t={"X-Client-Protocol":"webchannel"}),this.a.i=t,t=e&&e.initMessageHeaders||null,e&&e.messageContentType&&(t?t["X-WebChannel-Content-Type"]=e.messageContentType:t={"X-WebChannel-Content-Type":e.messageContentType}),e&&e.xa&&(t?t["X-WebChannel-Client-Profile"]=e.xa:t={"X-WebChannel-Client-Profile":e.xa}),this.a.J=t,(t=e&&e.httpHeadersOverwriteParam)&&!X(t)&&(this.a.g=t),this.l=e&&e.supportsCrossDomainXhr||!1,this.h=e&&e.sendRawJson||!1,(e=e&&e.httpSessionIdParam)&&!X(e)&&(this.a.j=e,null!==(t=this.b)&&e in t&&e in(t=this.b)&&delete t[e]),this.f=new Cr(this)}function Sr(t){ke.call(this);var e=t.__sm__;if(e){t:{for(var n in e){t=n;break t}t=void 0}(this.c=t)?(t=this.c,this.data=null!==e&&t in e?e[t]:void 0):this.data=e}else this.data=t}function Ir(){Re.call(this),this.status=1}function Cr(t){this.a=t}(I=Gn.prototype).ca=function(t,e,n,r){if(this.a)throw Error("[goog.net.XhrIo] Object is active with another request="+this.A+"; newUri="+t);e=e?e.toUpperCase():"GET",this.A=t,this.f="",this.h=0,this.v=!1,this.b=!0,this.a=new XMLHttpRequest,this.s=this.H?Ne(this.H):Ne(Ae),this.a.onreadystatechange=V(this.Ea,this);try{this.w=!0,this.a.open(e,String(t),!0),this.w=!1}catch(t){return void Jn(this,t)}t=n||"";var i=new Xe(this.headers);r&&Ye(r,(function(t,e){i.set(e,t)})),r=function(t){t:{for(var e=Xn,n=t.length,r=A(t)?t.split(""):t,i=0;i<n;i++)if(i in r&&e.call(void 0,r[i],i,t)){e=i;break t}e=-1}return e<0?null:A(t)?t.charAt(e):t[e]}(i.K()),n=D.FormData&&t instanceof D.FormData,0<=G(Yn,e)&&!r&&!n&&i.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8"),i.forEach((function(t,e){this.a.setRequestHeader(e,t)}),this),this.I&&(this.a.responseType=this.I),"withCredentials"in this.a&&this.a.withCredentials!==this.F&&(this.a.withCredentials=this.F);try{er(this),0<this.o&&((this.D=function(t){return lt&&_t(9)&&O(t.timeout)&&void 0!==t.ontimeout}(this.a))?(this.a.timeout=this.o,this.a.ontimeout=V(this.Ba,this)):this.m=ce(this.Ba,this.o,this)),this.l=!0,this.a.send(t),this.l=!1}catch(t){Jn(this,t)}},I.Ba=function(){void 0!==N&&this.a&&(this.f="Timed out after "+this.o+"ms, aborting",this.h=8,this.dispatchEvent("timeout"),this.abort(8))},I.abort=function(t){this.a&&this.b&&(this.b=!1,this.g=!0,this.a.abort(),this.g=!1,this.h=t||7,this.dispatchEvent("complete"),this.dispatchEvent("abort"),tr(this))},I.G=function(){this.a&&(this.b&&(this.b=!1,this.g=!0,this.a.abort(),this.g=!1),tr(this,!0)),Gn.N.G.call(this)},I.Ea=function(){this.j||(this.w||this.l||this.g?Zn(this):this.Za())},I.Za=function(){Zn(this)},I.T=function(){try{return 2<nr(this)?this.a.status:-1}catch(t){return-1}},I.aa=function(){try{return this.a?this.a.responseText:""}catch(t){return""}},I.Ua=function(t){if(this.a){var e=this.a.responseText;return t&&0==e.indexOf(t)&&(e=e.substring(t.length)),Qn(e)}},I.ya=function(){return this.h},I.Xa=function(){return A(this.f)?this.f:String(this.f)},(I=or.prototype).wa=8,I.u=1,I.Ca=function(){return 0==this.u},I.Ha=function(t){if(this.h)if(this.h=null,1==this.u){if(!t){this.P=Math.floor(1e5*Math.random());var e,n=new Me(this,t=this.P++,void 0),r=this.i;if(this.J&&(r?at(r=it(r),this.J):r=this.J),null===this.g&&(n.h=r),this.W)t:{for(var i=e=0;i<this.f.length;i++){var o=this.f[i];if(void 0===(o="__data__"in o.a&&A(o=o.a.__data__)?o.length:void 0))break;if(4096<(e+=o)){e=i;break t}if(4096===e||i===this.f.length-1){e=i+1;break t}}e=1e3}else e=1e3;e=fr(this,n,e),un(i=nn(this.B),"RID",t),un(i,"CVER",22),this.o&&this.j&&un(i,"X-HTTP-Session-Id",this.j),lr(this,i),this.g&&r&&ir(i,this.g,r),jn(this.b,n),this.W?(un(i,"$req",e),un(i,"SID","null"),n.S=!0,je(n,i,null)):je(n,i,e),this.u=2}}else 3==this.u&&(t?hr(this,t):0==this.f.length||Ln(this.b)||hr(this))},I.Ga=function(){this.l=null,this.a=new Me(this,"rpc",this.S),null===this.g&&(this.a.h=this.i),this.a.J=0;var t=nn(this.pa);un(t,"RID","rpc"),un(t,"SID",this.H),un(t,"CI",this.ia?"0":"1"),un(t,"AID",this.O),lr(this,t),un(t,"TYPE","xmlhttp"),this.g&&this.i&&ir(t,this.g,this.i),this.D&&this.a.setTimeout(this.D),Ue(this.a,t,!0,this.ga)},I.Fa=function(t,e){if(0!=this.u&&(this.a==t||Fn(this.b,t)))if(this.m=t.o,!t.s&&Fn(this.b,t)&&3==this.u){try{var n=this.ja.a.parse(e)}catch(t){n=null}if(M(n)&&3==n.length){if(0==(e=n)[0]){t:if(!this.l){if(this.a){if(!(this.a.v+3e3<t.v))break t;yr(this),this.a.cancel(),this.a=null}dr(this),Te(18)}}else this.ra=e[1],0<this.ra-this.O&&e[2]<37500&&this.ia&&0==this.v&&!this.s&&(this.s=Ee(V(this.Ya,this),6e3));if(xn(this.b)<=1&&this.fa){try{this.fa()}catch(t){}this.fa=void 0}}else vr(this,11)}else if(!t.s&&this.a!=t||yr(this),!X(e))for(e=n=this.ja.a.parse(e),n=0;n<e.length;n++){var r=e[n];if(this.O=r[0],r=r[1],2==this.u)if("c"==r[0]){this.H=r[1],this.ga=r[2];var i=r[3];null!=i&&(this.wa=i),null!=(r=r[5])&&O(r)&&0<r&&(this.D=1.5*r),this.o&&(r=t.a)&&((i=rr(r,"X-Client-Wire-Protocol"))&&Mn(this.b,i),this.j&&(r=rr(r,"X-HTTP-Session-Id")))&&(this.I=r,un(this.B,this.j,r)),this.u=3,this.c&&this.c.va(),r=t,this.pa=wr(this,this.Y()?this.ga:null,this.ha),r.s?(Un(this.b,r),(i=this.D)&&r.setTimeout(i),r.i&&(Qe(r),We(r)),this.a=r):pr(this),0<this.f.length&&cr(this)}else"stop"!=r[0]&&"close"!=r[0]||vr(this,7);else 3==this.u&&("stop"==r[0]||"close"==r[0]?"stop"==r[0]?vr(this,7):ar(this):"noop"!=r[0]&&this.c&&this.c.ua(r),this.v=0)}},I.Ya=function(){null!=this.s&&(this.s=null,this.a.cancel(),this.a=null,dr(this),Te(19))},I.na=function(t){var e=null;if(this.a==t){yr(this),this.a=null;var n=2}else{if(!Fn(this.b,t))return;e=t.j,Un(this.b,t),n=1}if(this.m=t.o,0!=this.u)if(t.b)1==n?(e=W()-t.v,ge.dispatchEvent(new _e(ge,t.l?t.l.length:0,e,this.A)),cr(this)):pr(this);else{var r=t.c;if(3==r||0==r&&0<this.m||!(1==n&&function(t,e){return!(xn(t.b)>=t.b.f-(t.h?1:0)||(t.h?(t.f=e.j.concat(t.f),0):1==t.u||2==t.u||t.A>=(t.Oa?0:t.Pa)||(t.h=Ee(V(t.Ha,t,e),gr(t,t.A)),t.A++,0)))}(this,t)||2==n&&dr(this)))switch(e&&0<e.length&&(t=this.b,t.c=t.c.concat(e)),r){case 1:vr(this,5);break;case 4:vr(this,10);break;case 3:vr(this,6);break;default:vr(this,2)}}},I.eb=function(t){Te(t?2:1)},I.$=function(t){if(t&&!this.R)throw Error("Can't create secondary domain capable XhrIo object.");return(t=new Gn(this.Ka)).F=this.R,t},I.ma=function(){return!!this.c&&!0},I.Y=function(){return this.R},(I=Tr.prototype).va=function(){},I.ua=function(){},I.ta=function(){},I.sa=function(){},I.Sa=function(){},_r.prototype.a=function(t,e){return new Er(t,e)},K(Er,zt),(I=Er.prototype).addEventListener=function(t,e,n,r){Er.N.addEventListener.call(this,t,e,n,r)},I.removeEventListener=function(t,e,n,r){Er.N.removeEventListener.call(this,t,e,n,r)},I.Va=function(){this.a.c=this.f,this.l&&(this.a.R=!0);var t=this.a,e=this.m,n=this.g,r=this.b||void 0;Te(0),t.ha=n,t.V=r||{},t.o&&(t.F.b=[],t.F.a=!1),t.w=new Cn(t),null===t.g&&(t.w.h=t.i),n=e,t.g&&t.i&&(n=ir(e,t.g,t.i)),(t=t.w).i=n,e=wr(t.a,null,t.i),Te(3),null!=(n=t.a.F.b)?(t.f=n[0],t.M=1,Nn(t)):(cn(e,"MODE","init"),!t.a.o&&t.a.j&&cn(e,"X-HTTP-Session-Id",t.a.j),t.b=new Me(t,void 0,void 0),t.b.h=t.h,Ue(t.b,e,!1,null),t.M=0)},I.close=function(){ar(this.a)},I.Wa=function(t){if(A(t)){var e={};e.__data__=t,ur(this.a,e)}else this.h?((e={}).__data__=Xt(t),ur(this.a,e)):ur(this.a,t)},I.G=function(){this.a.c=null,delete this.f,ar(this.a),delete this.a,Er.N.G.call(this)},K(Sr,ke),K(Ir,Re),K(Cr,Tr),Cr.prototype.va=function(){this.a.dispatchEvent("a")},Cr.prototype.ua=function(t){this.a.dispatchEvent(new Sr(t))},Cr.prototype.ta=function(t){this.a.dispatchEvent(new Ir(t))},Cr.prototype.sa=function(){this.a.dispatchEvent("b")};var Nr=B((function(t,e){function n(){}n.prototype=t.prototype;var r=new n;return t.apply(r,Array.prototype.slice.call(arguments,1)),r}),_r);_r.prototype.createWebChannel=_r.prototype.a,Er.prototype.send=Er.prototype.Wa,Er.prototype.open=Er.prototype.Va,Er.prototype.close=Er.prototype.close,Se.NO_ERROR=0,Se.TIMEOUT=8,Se.HTTP_ERROR=6,Ie.COMPLETE="complete",(De.EventType=Oe).OPEN="a",Oe.CLOSE="b",Oe.ERROR="c",Oe.MESSAGE="d",zt.prototype.listen=zt.prototype.za,Gn.prototype.listenOnce=Gn.prototype.Aa,Gn.prototype.getLastError=Gn.prototype.Xa,Gn.prototype.getLastErrorCode=Gn.prototype.ya,Gn.prototype.getStatus=Gn.prototype.T,Gn.prototype.getResponseJson=Gn.prototype.Ua,Gn.prototype.getResponseText=Gn.prototype.aa,Gn.prototype.send=Gn.prototype.ca;var Dr,Ar,Or={createWebChannelTransport:Nr,ErrorCode:Se,EventType:Ie,WebChannel:De,XhrIo:Gn},kr=Or.createWebChannelTransport,Rr=Or.ErrorCode,Pr=Or.EventType,Mr=Or.WebChannel,Lr=Or.XhrIo,xr=n.SDK_VERSION,Fr=new d("@firebase/firestore");function jr(){return Fr.logLevel===o.DEBUG?Dr.DEBUG:Fr.logLevel===o.SILENT?Dr.SILENT:Dr.ERROR}function Ur(t){switch(t){case Dr.DEBUG:Fr.logLevel=o.DEBUG;break;case Dr.ERROR:Fr.logLevel=o.ERROR;break;case Dr.SILENT:Fr.logLevel=o.SILENT;break;default:Fr.error("Firestore ("+xr+"): Invalid value passed to `setLogLevel`")}}function qr(t,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];if(Fr.logLevel<=o.DEBUG){var i=n.map(Br);Fr.debug.apply(Fr,h(["Firestore ("+xr+") ["+t+"]: "+e],i))}}function Vr(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];if(Fr.logLevel<=o.ERROR){var r=e.map(Br);Fr.error.apply(Fr,h(["Firestore ("+xr+"): "+t],r))}}function Br(t){if("string"==typeof t)return t;var e=Qr.getPlatform();try{return e.formatJSON(t)}catch(e){return t}}function Wr(t){var e="FIRESTORE ("+xr+") INTERNAL ASSERTION FAILED: "+t;throw Vr(e),new Error(e)}function Kr(t,e){t||Wr(e)}(Ar=Dr=Dr||{})[Ar.DEBUG=0]="DEBUG",Ar[Ar.ERROR=1]="ERROR",Ar[Ar.SILENT=2]="SILENT";var Qr=(Gr.setPlatform=function(t){Gr.platform&&Wr("Platform already defined"),Gr.platform=t},Gr.getPlatform=function(){return Gr.platform||Wr("Platform not set"),Gr.platform},Gr);function Gr(){}function Hr(){return Qr.getPlatform().emptyByteString}var zr,Yr={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},Xr=(i(Jr,zr=Error),Jr);function Jr(t,e){var n=zr.call(this,e)||this;return n.code=t,n.message=e,n.name="FirebaseError",n.toString=function(){return n.name+": [code="+n.code+"]: "+n.message},n}function $r(t,e){function n(){var t="This constructor is private.";throw e&&(t+=" ",t+=e),new Xr(Yr.INVALID_ARGUMENT,t)}for(var r in n.prototype=t.prototype,t)t.hasOwnProperty(r)&&(n[r]=t[r]);return n}function Zr(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function ti(t,e){return void 0!==t?t:e}function ei(t,e){for(var n in t)if(Object.prototype.hasOwnProperty.call(t,n)){var r=Number(n);isNaN(r)||e(r,t[n])}}function ni(t,e){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e(n,t[n])}function ri(t){for(var e in Kr(null!=t&&"object"==typeof t,"isEmpty() expects object parameter."),t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}function ii(t,e){if(0!==e.length)throw new Xr(Yr.INVALID_ARGUMENT,"Function "+t+"() does not support arguments, but was called with "+Ti(e.length,"argument")+".")}function oi(t,e,n){if(e.length!==n)throw new Xr(Yr.INVALID_ARGUMENT,"Function "+t+"() requires "+Ti(n,"argument")+", but was called with "+Ti(e.length,"argument")+".")}function ai(t,e,n){if(e.length<n)throw new Xr(Yr.INVALID_ARGUMENT,"Function "+t+"() requires at least "+Ti(n,"argument")+", but was called with "+Ti(e.length,"argument")+".")}function si(t,e,n,r){if(e.length<n||e.length>r)throw new Xr(Yr.INVALID_ARGUMENT,"Function "+t+"() requires between "+n+" and "+r+" arguments, but was called with "+Ti(e.length,"argument")+".")}function ui(t,e,n,r){pi(t,e,wi(n)+" argument",r)}function ci(t,e,n,r){void 0!==r&&ui(t,e,n,r)}function hi(t,e,n,r){pi(t,e,n+" option",r)}function li(t,e,n,r){void 0!==r&&hi(t,e,n,r)}function fi(t,e,n,r,i){void 0!==r&&function(t,e,n,r,i){for(var o=[],a=0,s=i;a<s.length;a++){var u=s[a];if(u===r)return;o.push(mi(u))}var c=mi(r);throw new Xr(Yr.INVALID_ARGUMENT,"Invalid value "+c+" provided to function "+t+'() for option "'+n+'". Acceptable values: '+o.join(", "))}(t,0,n,r,i)}function pi(t,e,n,r){if(!("object"===e?di(r):"non-empty string"===e?"string"==typeof r&&""!==r:typeof r===e)){var i=mi(r);throw new Xr(Yr.INVALID_ARGUMENT,"Function "+t+"() requires its "+n+" to be of type "+e+", but it was: "+i)}}function di(t){return"object"==typeof t&&null!==t&&(Object.getPrototypeOf(t)===Object.prototype||null===Object.getPrototypeOf(t))}function mi(t){if(void 0===t)return"undefined";if(null===t)return"null";if("string"==typeof t)return 20<t.length&&(t=t.substring(0,20)+"..."),JSON.stringify(t);if("number"==typeof t||"boolean"==typeof t)return""+t;if("object"!=typeof t)return"function"==typeof t?"a function":Wr("Unknown wrong type: "+typeof t);if(t instanceof Array)return"an array";var e=function(t){if(t.constructor){var e=/function\s+([^\s(]+)\s*\(/.exec(t.constructor.toString());if(e&&1<e.length)return e[1]}return null}(t);return e?"a custom "+e+" object":"an object"}function yi(t,e,n){if(void 0===n)throw new Xr(Yr.INVALID_ARGUMENT,"Function "+t+"() requires a valid "+wi(e)+" argument, but it was undefined.")}function gi(t,e,n){ni(e,(function(e,r){if(n.indexOf(e)<0)throw new Xr(Yr.INVALID_ARGUMENT,"Unknown option '"+e+"' passed to function "+t+"(). Available options: "+n.join(", "))}))}function vi(t,e,n,r){var i=mi(r);return new Xr(Yr.INVALID_ARGUMENT,"Function "+t+"() requires its "+wi(n)+" argument to be a "+e+", but it was: "+i)}function bi(t,e,n){if(n<=0)throw new Xr(Yr.INVALID_ARGUMENT,'Function "'+t+'()" requires its '+wi(e)+" argument to be a positive number, but it was: "+n+".")}function wi(t){switch(t){case 1:return"first";case 2:return"second";case 3:return"third";default:return t+"th"}}function Ti(t,e){return t+" "+e+(1===t?"":"s")}var _i=(Ei.newId=function(){for(var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",e="",n=0;n<20;n++)e+=t.charAt(Math.floor(Math.random()*t.length));return Kr(20===e.length,"Invalid auto ID: "+e),e},Ei);function Ei(){}function Si(t,e){return t<e?-1:e<t?1:0}function Ii(t,e){if(t.length!==e.length)return!1;for(var n=0;n<t.length;n++)if(!t[n].isEqual(e[n]))return!1;return!0}function Ci(t){return t+"\0"}function Ni(){if("undefined"==typeof Uint8Array)throw new Xr(Yr.UNIMPLEMENTED,"Uint8Arrays are not available in this environment.")}function Di(){if(!Qr.getPlatform().base64Available)throw new Xr(Yr.UNIMPLEMENTED,"Blobs are unavailable in Firestore in this environment.")}var Ai=(Oi.fromBase64String=function(t){oi("Blob.fromBase64String",arguments,1),ui("Blob.fromBase64String","string",1,t),Di();try{return new Oi(Qr.getPlatform().atob(t))}catch(t){throw new Xr(Yr.INVALID_ARGUMENT,"Failed to construct Blob from Base64 string: "+t)}},Oi.fromUint8Array=function(t){if(oi("Blob.fromUint8Array",arguments,1),Ni(),!(t instanceof Uint8Array))throw vi("Blob.fromUint8Array","Uint8Array",1,t);return new Oi(Array.prototype.map.call(t,(function(t){return String.fromCharCode(t)})).join(""))},Oi.prototype.toBase64=function(){return oi("Blob.toBase64",arguments,0),Di(),Qr.getPlatform().btoa(this._binaryString)},Oi.prototype.toUint8Array=function(){oi("Blob.toUint8Array",arguments,0),Ni();for(var t=new Uint8Array(this._binaryString.length),e=0;e<this._binaryString.length;e++)t[e]=this._binaryString.charCodeAt(e);return t},Oi.prototype.toString=function(){return"Blob(base64: "+this.toBase64()+")"},Oi.prototype.isEqual=function(t){return this._binaryString===t._binaryString},Oi.prototype._compareTo=function(t){return Si(this._binaryString,t._binaryString)},Oi);function Oi(t){Di(),this._binaryString=t}var ki=$r(Ai,"Use Blob.fromUint8Array() or Blob.fromBase64String() instead."),Ri=function(t,e,n,r,i){this.databaseId=t,this.persistenceKey=e,this.host=n,this.ssl=r,this.forceLongPolling=i},Pi="(default)",Mi=(Object.defineProperty(Li.prototype,"isDefaultDatabase",{get:function(){return this.database===Pi},enumerable:!0,configurable:!0}),Li.prototype.isEqual=function(t){return t instanceof Li&&t.projectId===this.projectId&&t.database===this.database},Li.prototype.compareTo=function(t){return Si(this.projectId,t.projectId)||Si(this.database,t.database)},Li);function Li(t,e){this.projectId=t,this.database=e||Pi}var xi=(Fi.prototype.setPreviousValue=function(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue},Fi.prototype.next=function(){var t=++this.previousValue;return this.writeNewSequenceNumber&&this.writeNewSequenceNumber(t),t},Fi.INVALID=-1,Fi);function Fi(t,e){var n=this;this.previousValue=t,e&&(e.sequenceNumberHandler=function(t){return n.setPreviousValue(t)},this.writeNewSequenceNumber=function(t){return e.writeSequenceNumber(t)})}var ji="__name__",Ui=(Object.defineProperty(qi.prototype,"length",{get:function(){return this.len},enumerable:!0,configurable:!0}),qi.prototype.isEqual=function(t){return 0===qi.comparator(this,t)},qi.prototype.child=function(t){var e=this.segments.slice(this.offset,this.limit());return t instanceof qi?t.forEach((function(t){e.push(t)})):e.push(t),this.construct(e)},qi.prototype.limit=function(){return this.offset+this.length},qi.prototype.popFirst=function(t){return t=void 0===t?1:t,Kr(this.length>=t,"Can't call popFirst() with less segments"),this.construct(this.segments,this.offset+t,this.length-t)},qi.prototype.popLast=function(){return Kr(!this.isEmpty(),"Can't call popLast() on empty path"),this.construct(this.segments,this.offset,this.length-1)},qi.prototype.firstSegment=function(){return Kr(!this.isEmpty(),"Can't call firstSegment() on empty path"),this.segments[this.offset]},qi.prototype.lastSegment=function(){return this.get(this.length-1)},qi.prototype.get=function(t){return Kr(t<this.length,"Index out of range"),this.segments[this.offset+t]},qi.prototype.isEmpty=function(){return 0===this.length},qi.prototype.isPrefixOf=function(t){if(t.length<this.length)return!1;for(var e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0},qi.prototype.isImmediateParentOf=function(t){if(this.length+1!==t.length)return!1;for(var e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0},qi.prototype.forEach=function(t){for(var e=this.offset,n=this.limit();e<n;e++)t(this.segments[e])},qi.prototype.toArray=function(){return this.segments.slice(this.offset,this.limit())},qi.comparator=function(t,e){for(var n=Math.min(t.length,e.length),r=0;r<n;r++){var i=t.get(r),o=e.get(r);if(i<o)return-1;if(o<i)return 1}return t.length<e.length?-1:t.length>e.length?1:0},qi);function qi(t,e,n){void 0===e?e=0:e>t.length&&Wr("offset "+e+" out of range "+t.length),void 0===n?n=t.length-e:n>t.length-e&&Wr("length "+n+" out of range "+(t.length-e)),this.segments=t,this.offset=e,this.len=n}var Vi,Bi=(i(Wi,Vi=Ui),Wi.prototype.construct=function(t,e,n){return new Wi(t,e,n)},Wi.prototype.canonicalString=function(){return this.toArray().join("/")},Wi.prototype.toString=function(){return this.canonicalString()},Wi.fromString=function(t){if(0<=t.indexOf("//"))throw new Xr(Yr.INVALID_ARGUMENT,"Invalid path ("+t+"). Paths must not contain // in them.");return new Wi(t.split("/").filter((function(t){return 0<t.length})))},Wi.EMPTY_PATH=new Wi([]),Wi);function Wi(){return null!==Vi&&Vi.apply(this,arguments)||this}var Ki,Qi=/^[_a-zA-Z][_a-zA-Z0-9]*$/,Gi=(i(Hi,Ki=Ui),Hi.prototype.construct=function(t,e,n){return new Hi(t,e,n)},Hi.isValidIdentifier=function(t){return Qi.test(t)},Hi.prototype.canonicalString=function(){return this.toArray().map((function(t){return t=t.replace("\\","\\\\").replace("`","\\`"),Hi.isValidIdentifier(t)||(t="`"+t+"`"),t})).join(".")},Hi.prototype.toString=function(){return this.canonicalString()},Hi.prototype.isKeyField=function(){return 1===this.length&&this.get(0)===ji},Hi.keyField=function(){return new Hi([ji])},Hi.fromServerFormat=function(t){for(var e=[],n="",r=0,i=function(){if(0===n.length)throw new Xr(Yr.INVALID_ARGUMENT,"Invalid field path ("+t+"). Paths must not be empty, begin with '.', end with '.', or contain '..'");e.push(n),n=""},o=!1;r<t.length;){var a=t[r];if("\\"===a){if(r+1===t.length)throw new Xr(Yr.INVALID_ARGUMENT,"Path has trailing escape character: "+t);var s=t[r+1];if("\\"!==s&&"."!==s&&"`"!==s)throw new Xr(Yr.INVALID_ARGUMENT,"Path has invalid escape sequence: "+t);n+=s,r+=2}else"`"===a?o=!o:"."!==a||o?n+=a:i(),r++}if(i(),o)throw new Xr(Yr.INVALID_ARGUMENT,"Unterminated ` in path: "+t);return new Hi(e)},Hi.EMPTY_PATH=new Hi([]),Hi);function Hi(){return null!==Ki&&Ki.apply(this,arguments)||this}var zi=(Yi.prototype.hasCollectionId=function(t){return 2<=this.path.length&&this.path.get(this.path.length-2)===t},Yi.prototype.isEqual=function(t){return null!==t&&0===Bi.comparator(this.path,t.path)},Yi.prototype.toString=function(){return this.path.toString()},Yi.comparator=function(t,e){return Bi.comparator(t.path,e.path)},Yi.isDocumentKey=function(t){return t.length%2==0},Yi.fromSegments=function(t){return new Yi(new Bi(t.slice()))},Yi.fromPathString=function(t){return new Yi(Bi.fromString(t))},Yi.EMPTY=new Yi(new Bi([])),Yi);function Yi(t){this.path=t,Kr(Yi.isDocumentKey(t),"Invalid DocumentKey with an odd number of segments: "+t.toArray().join("/"))}var Xi,Ji,$i=function(){var t=this;this.promise=new Promise((function(e,n){t.resolve=e,t.reject=n}))};(Ji=Xi=Xi||{}).All="all",Ji.ListenStreamIdle="listen_stream_idle",Ji.ListenStreamConnectionBackoff="listen_stream_connection_backoff",Ji.WriteStreamIdle="write_stream_idle",Ji.WriteStreamConnectionBackoff="write_stream_connection_backoff",Ji.OnlineStateTimeout="online_state_timeout",Ji.ClientMetadataRefresh="client_metadata_refresh",Ji.LruGarbageCollection="lru_garbage_collection",Ji.RetryTransaction="retry_transaction";var Zi=(to.createAndSchedule=function(t,e,n,r,i){var o=new to(t,e,Date.now()+n,r,i);return o.start(n),o},to.prototype.start=function(t){var e=this;this.timerHandle=setTimeout((function(){return e.handleDelayElapsed()}),t)},to.prototype.skipDelay=function(){return this.handleDelayElapsed()},to.prototype.cancel=function(t){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new Xr(Yr.CANCELLED,"Operation cancelled"+(t?": "+t:""))))},to.prototype.handleDelayElapsed=function(){var t=this;this.asyncQueue.enqueueAndForget((function(){return null!==t.timerHandle?(t.clearTimeout(),t.op().then((function(e){return t.deferred.resolve(e)}))):Promise.resolve()}))},to.prototype.clearTimeout=function(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)},to);function to(t,e,n,r,i){this.asyncQueue=t,this.timerId=e,this.targetTimeMs=n,this.op=r,this.removalCallback=i,this.deferred=new $i,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.catch=this.deferred.promise.catch.bind(this.deferred.promise),this.deferred.promise.catch((function(t){}))}var eo=(Object.defineProperty(no.prototype,"isShuttingDown",{get:function(){return this._isShuttingDown},enumerable:!0,configurable:!0}),no.prototype.enqueueAndForget=function(t){this.enqueue(t)},no.prototype.enqueueAndForgetEvenAfterShutdown=function(t){this.verifyNotFailed(),this.enqueueInternal(t)},no.prototype.enqueueEvenAfterShutdown=function(t){return this.verifyNotFailed(),this.enqueueInternal(t)},no.prototype.enqueueAndInitiateShutdown=function(t){return u(this,void 0,void 0,(function(){return c(this,(function(e){switch(e.label){case 0:return this.verifyNotFailed(),this._isShuttingDown?[3,2]:(this._isShuttingDown=!0,[4,this.enqueueEvenAfterShutdown(t)]);case 1:e.sent(),e.label=2;case 2:return[2]}}))}))},no.prototype.enqueue=function(t){return this.verifyNotFailed(),this._isShuttingDown?new Promise((function(t){})):this.enqueueInternal(t)},no.prototype.enqueueInternal=function(t){var e=this,n=this.tail.then((function(){return e.operationInProgress=!0,t().catch((function(t){e.failure=t,e.operationInProgress=!1;var n=t.stack||t.message||"";throw Vr("INTERNAL UNHANDLED ERROR: ",n),n.indexOf("Firestore Test Simulated Error")<0&&setTimeout((function(){throw t}),0),t})).then((function(t){return e.operationInProgress=!1,t}))}));return this.tail=n},no.prototype.enqueueAfterDelay=function(t,e,n){var r=this;this.verifyNotFailed(),Kr(0<=e,"Attempted to schedule an operation with a negative delay of "+e),-1<this.timerIdsToSkip.indexOf(t)&&(e=0);var i=Zi.createAndSchedule(this,t,e,n,(function(t){return r.removeDelayedOperation(t)}));return this.delayedOperations.push(i),i},no.prototype.verifyNotFailed=function(){this.failure&&Wr("AsyncQueue is already failed: "+(this.failure.stack||this.failure.message))},no.prototype.verifyOperationInProgress=function(){Kr(this.operationInProgress,"verifyOpInProgress() called when no op in progress on this queue.")},no.prototype.drain=function(){return this.enqueueEvenAfterShutdown((function(){return Promise.resolve()}))},no.prototype.containsDelayedOperation=function(t){for(var e=0,n=this.delayedOperations;e<n.length;e++)if(n[e].timerId===t)return!0;return!1},no.prototype.runDelayedOperationsEarly=function(t){var e=this;return this.drain().then((function(){Kr(t===Xi.All||e.containsDelayedOperation(t),"Attempted to drain to missing operation "+t),e.delayedOperations.sort((function(t,e){return t.targetTimeMs-e.targetTimeMs}));for(var n=0,r=e.delayedOperations;n<r.length;n++){var i=r[n];if(i.skipDelay(),t!==Xi.All&&i.timerId===t)break}return e.drain()}))},no.prototype.skipDelaysForTimerId=function(t){this.timerIdsToSkip.push(t)},no.prototype.removeDelayedOperation=function(t){var e=this.delayedOperations.indexOf(t);Kr(0<=e,"Delayed operation not found."),this.delayedOperations.splice(e,1)},no);function no(){this.tail=Promise.resolve(),this._isShuttingDown=!1,this.delayedOperations=[],this.failure=null,this.operationInProgress=!1,this.timerIdsToSkip=[]}function ro(t){for(var e="",n=0;n<t.length;n++)0<e.length&&(e=oo(e)),e=io(t.get(n),e);return oo(e)}function io(t,e){for(var n=e,r=t.length,i=0;i<r;i++){var o=t.charAt(i);switch(o){case"\0":n+="";break;case"":n+="";break;default:n+=o}}return n}function oo(t){return t+""}function ao(t){var e=t.length;if(Kr(2<=e,"Invalid path "+t),2===e)return Kr(""===t.charAt(0)&&""===t.charAt(1),"Non-empty path "+t+" had length 2"),Bi.EMPTY_PATH;for(var n=e-2,r=[],i="",o=0;o<e;){var a=t.indexOf("",o);switch((a<0||n<a)&&Wr('Invalid encoded resource path: "'+t+'"'),t.charAt(a+1)){case"":var s=t.substring(o,a),u=void 0;0===i.length?u=s:(u=i+=s,i=""),r.push(u);break;case"":i+=t.substring(o,a),i+="\0";break;case"":i+=t.substring(o,a+1);break;default:Wr('Invalid encoded resource path: "'+t+'"')}o=a+2}return new Bi(r)}var so=(uo.now=function(){return uo.fromMillis(Date.now())},uo.fromDate=function(t){return uo.fromMillis(t.getTime())},uo.fromMillis=function(t){var e=Math.floor(t/1e3);return new uo(e,1e6*(t-1e3*e))},uo.prototype.toDate=function(){return new Date(this.toMillis())},uo.prototype.toMillis=function(){return 1e3*this.seconds+this.nanoseconds/1e6},uo.prototype._compareTo=function(t){return this.seconds===t.seconds?Si(this.nanoseconds,t.nanoseconds):Si(this.seconds,t.seconds)},uo.prototype.isEqual=function(t){return t.seconds===this.seconds&&t.nanoseconds===this.nanoseconds},uo.prototype.toString=function(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"},uo);function uo(t,e){if(this.seconds=t,(this.nanoseconds=e)<0)throw new Xr(Yr.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(1e9<=e)throw new Xr(Yr.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(t<-62135596800)throw new Xr(Yr.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t);if(253402300800<=t)throw new Xr(Yr.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t)}var co=(ho.fromMicroseconds=function(t){var e=Math.floor(t/1e6);return new ho(new so(e,t%1e6*1e3))},ho.fromTimestamp=function(t){return new ho(t)},ho.forDeletedDoc=function(){return ho.MIN},ho.prototype.compareTo=function(t){return this.timestamp._compareTo(t.timestamp)},ho.prototype.isEqual=function(t){return this.timestamp.isEqual(t.timestamp)},ho.prototype.toMicroseconds=function(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3},ho.prototype.toString=function(){return"SnapshotVersion("+this.timestamp.toString()+")"},ho.prototype.toTimestamp=function(){return this.timestamp},ho.MIN=new ho(new so(0,0)),ho);function ho(t){this.timestamp=t}var lo=(fo.prototype.insert=function(t,e){return new fo(this.comparator,this.root.insert(t,e,this.comparator).copy(null,null,yo.BLACK,null,null))},fo.prototype.remove=function(t){return new fo(this.comparator,this.root.remove(t,this.comparator).copy(null,null,yo.BLACK,null,null))},fo.prototype.get=function(t){for(var e=this.root;!e.isEmpty();){var n=this.comparator(t,e.key);if(0===n)return e.value;n<0?e=e.left:0<n&&(e=e.right)}return null},fo.prototype.indexOf=function(t){for(var e=0,n=this.root;!n.isEmpty();){var r=this.comparator(t,n.key);if(0===r)return e+n.left.size;n=r<0?n.left:(e+=n.left.size+1,n.right)}return-1},fo.prototype.isEmpty=function(){return this.root.isEmpty()},Object.defineProperty(fo.prototype,"size",{get:function(){return this.root.size},enumerable:!0,configurable:!0}),fo.prototype.minKey=function(){return this.root.minKey()},fo.prototype.maxKey=function(){return this.root.maxKey()},fo.prototype.inorderTraversal=function(t){return this.root.inorderTraversal(t)},fo.prototype.forEach=function(t){this.inorderTraversal((function(e,n){return t(e,n),!1}))},fo.prototype.toString=function(){var t=[];return this.inorderTraversal((function(e,n){return t.push(e+":"+n),!1})),"{"+t.join(", ")+"}"},fo.prototype.reverseTraversal=function(t){return this.root.reverseTraversal(t)},fo.prototype.getIterator=function(){return new po(this.root,null,this.comparator,!1)},fo.prototype.getIteratorFrom=function(t){return new po(this.root,t,this.comparator,!1)},fo.prototype.getReverseIterator=function(){return new po(this.root,null,this.comparator,!0)},fo.prototype.getReverseIteratorFrom=function(t){return new po(this.root,t,this.comparator,!0)},fo);function fo(t,e){this.comparator=t,this.root=e||yo.EMPTY}var po=(mo.prototype.getNext=function(){Kr(0<this.nodeStack.length,"getNext() called on iterator when hasNext() is false.");var t=this.nodeStack.pop(),e={key:t.key,value:t.value};if(this.isReverse)for(t=t.left;!t.isEmpty();)this.nodeStack.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack.push(t),t=t.left;return e},mo.prototype.hasNext=function(){return 0<this.nodeStack.length},mo.prototype.peek=function(){if(0===this.nodeStack.length)return null;var t=this.nodeStack[this.nodeStack.length-1];return{key:t.key,value:t.value}},mo);function mo(t,e,n,r){this.isReverse=r,this.nodeStack=[];for(var i=1;!t.isEmpty();)if(i=e?n(t.key,e):1,r&&(i*=-1),i<0)t=this.isReverse?t.left:t.right;else{if(0===i){this.nodeStack.push(t);break}this.nodeStack.push(t),t=this.isReverse?t.right:t.left}}var yo=(go.prototype.copy=function(t,e,n,r,i){return new go(null!=t?t:this.key,null!=e?e:this.value,null!=n?n:this.color,null!=r?r:this.left,null!=i?i:this.right)},go.prototype.isEmpty=function(){return!1},go.prototype.inorderTraversal=function(t){return this.left.inorderTraversal(t)||t(this.key,this.value)||this.right.inorderTraversal(t)},go.prototype.reverseTraversal=function(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)},go.prototype.min=function(){return this.left.isEmpty()?this:this.left.min()},go.prototype.minKey=function(){return this.min().key},go.prototype.maxKey=function(){return this.right.isEmpty()?this.key:this.right.maxKey()},go.prototype.insert=function(t,e,n){var r=this,i=n(t,r.key);return(r=i<0?r.copy(null,null,null,r.left.insert(t,e,n),null):0===i?r.copy(null,e,null,null,null):r.copy(null,null,null,null,r.right.insert(t,e,n))).fixUp()},go.prototype.removeMin=function(){if(this.left.isEmpty())return go.EMPTY;var t=this;return t.left.isRed()||t.left.left.isRed()||(t=t.moveRedLeft()),(t=t.copy(null,null,null,t.left.removeMin(),null)).fixUp()},go.prototype.remove=function(t,e){var n,r=this;if(e(t,r.key)<0)r.left.isEmpty()||r.left.isRed()||r.left.left.isRed()||(r=r.moveRedLeft()),r=r.copy(null,null,null,r.left.remove(t,e),null);else{if(r.left.isRed()&&(r=r.rotateRight()),r.right.isEmpty()||r.right.isRed()||r.right.left.isRed()||(r=r.moveRedRight()),0===e(t,r.key)){if(r.right.isEmpty())return go.EMPTY;n=r.right.min(),r=r.copy(n.key,n.value,null,null,r.right.removeMin())}r=r.copy(null,null,null,null,r.right.remove(t,e))}return r.fixUp()},go.prototype.isRed=function(){return this.color},go.prototype.fixUp=function(){var t=this;return t.right.isRed()&&!t.left.isRed()&&(t=t.rotateLeft()),t.left.isRed()&&t.left.left.isRed()&&(t=t.rotateRight()),t.left.isRed()&&t.right.isRed()&&(t=t.colorFlip()),t},go.prototype.moveRedLeft=function(){var t=this.colorFlip();return t.right.left.isRed()&&(t=(t=(t=t.copy(null,null,null,null,t.right.rotateRight())).rotateLeft()).colorFlip()),t},go.prototype.moveRedRight=function(){var t=this.colorFlip();return t.left.left.isRed()&&(t=(t=t.rotateRight()).colorFlip()),t},go.prototype.rotateLeft=function(){var t=this.copy(null,null,go.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)},go.prototype.rotateRight=function(){var t=this.copy(null,null,go.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)},go.prototype.colorFlip=function(){var t=this.left.copy(null,null,!this.left.color,null,null),e=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,e)},go.prototype.checkMaxDepth=function(){var t=this.check();return Math.pow(2,t)<=this.size+1},go.prototype.check=function(){if(this.isRed()&&this.left.isRed())throw Wr("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed())throw Wr("Right child of ("+this.key+","+this.value+") is red");var t=this.left.check();if(t!==this.right.check())throw Wr("Black depths differ");return t+(this.isRed()?0:1)},go.EMPTY=null,go.RED=!0,go.BLACK=!1,go);function go(t,e,n,r,i){this.key=t,this.value=e,this.color=null!=n?n:go.RED,this.left=null!=r?r:go.EMPTY,this.right=null!=i?i:go.EMPTY,this.size=this.left.size+1+this.right.size}var vo=(Object.defineProperty(bo.prototype,"key",{get:function(){throw Wr("LLRBEmptyNode has no key.")},enumerable:!0,configurable:!0}),Object.defineProperty(bo.prototype,"value",{get:function(){throw Wr("LLRBEmptyNode has no value.")},enumerable:!0,configurable:!0}),Object.defineProperty(bo.prototype,"color",{get:function(){throw Wr("LLRBEmptyNode has no color.")},enumerable:!0,configurable:!0}),Object.defineProperty(bo.prototype,"left",{get:function(){throw Wr("LLRBEmptyNode has no left child.")},enumerable:!0,configurable:!0}),Object.defineProperty(bo.prototype,"right",{get:function(){throw Wr("LLRBEmptyNode has no right child.")},enumerable:!0,configurable:!0}),bo.prototype.copy=function(t,e,n,r,i){return this},bo.prototype.insert=function(t,e,n){return new yo(t,e)},bo.prototype.remove=function(t,e){return this},bo.prototype.isEmpty=function(){return!0},bo.prototype.inorderTraversal=function(t){return!1},bo.prototype.reverseTraversal=function(t){return!1},bo.prototype.minKey=function(){return null},bo.prototype.maxKey=function(){return null},bo.prototype.isRed=function(){return!1},bo.prototype.checkMaxDepth=function(){return!0},bo.prototype.check=function(){return 0},bo);function bo(){this.size=0}yo.EMPTY=new vo;var wo=(To.fromMapKeys=function(t){var e=new To(t.comparator);return t.forEach((function(t){e=e.add(t)})),e},To.prototype.has=function(t){return null!==this.data.get(t)},To.prototype.first=function(){return this.data.minKey()},To.prototype.last=function(){return this.data.maxKey()},Object.defineProperty(To.prototype,"size",{get:function(){return this.data.size},enumerable:!0,configurable:!0}),To.prototype.indexOf=function(t){return this.data.indexOf(t)},To.prototype.forEach=function(t){this.data.inorderTraversal((function(e,n){return t(e),!1}))},To.prototype.forEachInRange=function(t,e){for(var n=this.data.getIteratorFrom(t[0]);n.hasNext();){var r=n.getNext();if(0<=this.comparator(r.key,t[1]))return;e(r.key)}},To.prototype.forEachWhile=function(t,e){var n;for(n=void 0!==e?this.data.getIteratorFrom(e):this.data.getIterator();n.hasNext();)if(!t(n.getNext().key))return},To.prototype.firstAfterOrEqual=function(t){var e=this.data.getIteratorFrom(t);return e.hasNext()?e.getNext().key:null},To.prototype.getIterator=function(){return new _o(this.data.getIterator())},To.prototype.getIteratorFrom=function(t){return new _o(this.data.getIteratorFrom(t))},To.prototype.add=function(t){return this.copy(this.data.remove(t).insert(t,!0))},To.prototype.delete=function(t){return this.has(t)?this.copy(this.data.remove(t)):this},To.prototype.isEmpty=function(){return this.data.isEmpty()},To.prototype.unionWith=function(t){var e=this;return t.forEach((function(t){e=e.add(t)})),e},To.prototype.isEqual=function(t){if(!(t instanceof To))return!1;if(this.size!==t.size)return!1;for(var e=this.data.getIterator(),n=t.data.getIterator();e.hasNext();){var r=e.getNext().key,i=n.getNext().key;if(0!==this.comparator(r,i))return!1}return!0},To.prototype.toArray=function(){var t=[];return this.forEach((function(e){t.push(e)})),t},To.prototype.toString=function(){var t=[];return this.forEach((function(e){return t.push(e)})),"SortedSet("+t.toString()+")"},To.prototype.copy=function(t){var e=new To(this.comparator);return e.data=t,e},To);function To(t){this.comparator=t,this.data=new lo(this.comparator)}var _o=(Eo.prototype.getNext=function(){return this.iter.getNext().key},Eo.prototype.hasNext=function(){return this.iter.hasNext()},Eo);function Eo(t){this.iter=t}var So=new lo(zi.comparator);function Io(){return So}function Co(){return Io()}var No=new lo(zi.comparator);function Do(){return No}var Ao=new lo(zi.comparator);function Oo(){return Ao}var ko=new wo(zi.comparator);function Ro(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var n=ko,r=0,i=t;r<i.length;r++){var o=i[r];n=n.add(o)}return n}var Po=new wo(Si);function Mo(){return Po}var Lo=(xo.prototype.applyToRemoteDocument=function(t,e,n){e&&Kr(e.key.isEqual(t),"applyToRemoteDocument: key "+t+" should match maybeDoc key\n        "+e.key);var r=n.mutationResults;Kr(r.length===this.mutations.length,"Mismatch between mutations length\n      ("+this.mutations.length+") and mutation results length\n      ("+r.length+").");for(var i=0;i<this.mutations.length;i++){var o=this.mutations[i];if(o.key.isEqual(t)){var a=r[i];e=o.applyToRemoteDocument(e,a)}}return e},xo.prototype.applyToLocalView=function(t,e){e&&Kr(e.key.isEqual(t),"applyToLocalDocument: key "+t+" should match maybeDoc key\n        "+e.key);for(var n=0,r=this.baseMutations;n<r.length;n++)(s=r[n]).key.isEqual(t)&&(e=s.applyToLocalView(e,e,this.localWriteTime));for(var i=e,o=0,a=this.mutations;o<a.length;o++){var s;(s=a[o]).key.isEqual(t)&&(e=s.applyToLocalView(e,i,this.localWriteTime))}return e},xo.prototype.applyToLocalDocumentSet=function(t){var e=this,n=t;return this.mutations.forEach((function(r){var i=e.applyToLocalView(r.key,t.get(r.key));i&&(n=n.insert(r.key,i))})),n},xo.prototype.keys=function(){return this.mutations.reduce((function(t,e){return t.add(e.key)}),Ro())},xo.prototype.isEqual=function(t){return this.batchId===t.batchId&&Ii(this.mutations,t.mutations)&&Ii(this.baseMutations,t.baseMutations)},xo);function xo(t,e,n,r){this.batchId=t,this.localWriteTime=e,this.baseMutations=n,Kr(0<(this.mutations=r).length,"Cannot create an empty mutation batch")}var Fo=(jo.from=function(t,e,n,r){Kr(t.mutations.length===n.length,"Mutations sent "+t.mutations.length+" must equal results received "+n.length);for(var i=Oo(),o=t.mutations,a=0;a<o.length;a++)i=i.insert(o[a].key,n[a].version);return new jo(t,e,n,r,i)},jo);function jo(t,e,n,r,i){this.batch=t,this.commitVersion=e,this.mutationResults=n,this.streamToken=r,this.docVersions=i}var Uo=(qo.prototype.catch=function(t){return this.next(void 0,t)},qo.prototype.next=function(t,e){var n=this;return this.callbackAttached&&Wr("Called next() or catch() twice for PersistencePromise"),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(e,this.error):this.wrapSuccess(t,this.result):new qo((function(r,i){n.nextCallback=function(e){n.wrapSuccess(t,e).next(r,i)},n.catchCallback=function(t){n.wrapFailure(e,t).next(r,i)}}))},qo.prototype.toPromise=function(){var t=this;return new Promise((function(e,n){t.next(e,n)}))},qo.prototype.wrapUserFunction=function(t){try{var e=t();return e instanceof qo?e:qo.resolve(e)}catch(t){return qo.reject(t)}},qo.prototype.wrapSuccess=function(t,e){return t?this.wrapUserFunction((function(){return t(e)})):qo.resolve(e)},qo.prototype.wrapFailure=function(t,e){return t?this.wrapUserFunction((function(){return t(e)})):qo.reject(e)},qo.resolve=function(t){return new qo((function(e,n){e(t)}))},qo.reject=function(t){return new qo((function(e,n){n(t)}))},qo.waitFor=function(t){return new qo((function(e,n){var r=0,i=0,o=!1;t.forEach((function(t){++r,t.next((function(){++i,o&&i===r&&e()}),(function(t){return n(t)}))})),o=!0,i===r&&e()}))},qo.or=function(t){for(var e=qo.resolve(!1),n=function(t){e=e.next((function(e){return e?qo.resolve(e):t()}))},r=0,i=t;r<i.length;r++)n(i[r]);return e},qo.forEach=function(t,e){var n=this,r=[];return t.forEach((function(t,i){r.push(e.call(n,t,i))})),this.waitFor(r)},qo);function qo(t){var e=this;this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,t((function(t){e.isDone=!0,e.result=t,e.nextCallback&&e.nextCallback(t)}),(function(t){e.isDone=!0,e.error=t,e.catchCallback&&e.catchCallback(t)}))}var Vo="SimpleDb",Bo=(Wo.openOrCreate=function(t,e,n){return Kr(Wo.isAvailable(),"IndexedDB not supported in current environment."),qr(Vo,"Opening database:",t),new Uo((function(r,i){var o=window.indexedDB.open(t,e);o.onsuccess=function(t){var e=t.target.result;r(new Wo(e))},o.onblocked=function(){i(new Xr(Yr.FAILED_PRECONDITION,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},o.onerror=function(t){var e=t.target.error;"VersionError"===e.name?i(new Xr(Yr.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):i(e)},o.onupgradeneeded=function(e){qr(Vo,'Database "'+t+'" requires upgrade from version:',e.oldVersion);var r=e.target.result;n.createOrUpgrade(r,o.transaction,e.oldVersion,su).next((function(){qr(Vo,"Database upgrade to version "+su+" complete")}))}})).toPromise()},Wo.delete=function(t){return qr(Vo,"Removing database:",t),Xo(window.indexedDB.deleteDatabase(t)).toPromise()},Wo.isAvailable=function(){if("undefined"==typeof window||null==window.indexedDB)return!1;if(Wo.isMockPersistence())return!0;if(void 0===window.navigator)return!1;var t=y(),e=Wo.getIOSVersion(t),n=0<e&&e<10,r=Wo.getAndroidVersion(t),i=0<r&&r<4.5;return!(0<t.indexOf("MSIE ")||0<t.indexOf("Trident/")||0<t.indexOf("Edge/")||n||i)},Wo.isMockPersistence=function(){var t;return void 0!==e&&"YES"===(null===(t=e.env)||void 0===t?void 0:t.USE_MOCK_PERSISTENCE)},Wo.getStore=function(t,e){return t.store(e)},Wo.getIOSVersion=function(t){var e=t.match(/i(?:phone|pad|pod) os ([\d_]+)/i),n=e?e[1].split("_").slice(0,2).join("."):"-1";return Number(n)},Wo.getAndroidVersion=function(t){var e=t.match(/Android ([\d.]+)/i),n=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(n)},Wo.prototype.setVersionChangeListener=function(t){this.db.onversionchange=function(e){return t(e)}},Wo.prototype.runTransaction=function(t,e,n){return u(this,void 0,void 0,(function(){var r,i,o,a,s,u;return c(this,(function(h){switch(h.label){case 0:r=t.startsWith("readonly"),i=t.endsWith("idempotent"),o=0,a=function(){var t,a,u,h;return c(this,(function(c){switch(c.label){case 0:++o,t=Go.open(s.db,r?"readonly":"readwrite",e),c.label=1;case 1:return c.trys.push([1,3,,4]),(a=n(t).catch((function(e){return t.abort(e),Uo.reject(e)})).toPromise()).catch((function(){})),[4,t.completionPromise];case 2:return c.sent(),[2,{value:a}];case 3:return u=c.sent(),h=i&&"FirebaseError"!==u.name&&o<3,qr(Vo,"Transaction failed with error: %s. Retrying: %s.",u.message,h),h?[3,4]:[2,{value:Promise.reject(u)}];case 4:return[2]}}))},s=this,h.label=1;case 1:return[5,a()];case 2:return"object"==typeof(u=h.sent())?[2,u.value]:[3,1];case 3:return[2]}}))}))},Wo.prototype.close=function(){this.db.close()},Wo);function Wo(t){this.db=t,12.2===Wo.getIOSVersion(y())&&Vr("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}var Ko=(Object.defineProperty(Qo.prototype,"isDone",{get:function(){return this.shouldStop},enumerable:!0,configurable:!0}),Object.defineProperty(Qo.prototype,"skipToKey",{get:function(){return this.nextKey},enumerable:!0,configurable:!0}),Object.defineProperty(Qo.prototype,"cursor",{set:function(t){this.dbCursor=t},enumerable:!0,configurable:!0}),Qo.prototype.done=function(){this.shouldStop=!0},Qo.prototype.skip=function(t){this.nextKey=t},Qo.prototype.delete=function(){return Xo(this.dbCursor.delete())},Qo);function Qo(t){this.dbCursor=t,this.shouldStop=!1,this.nextKey=null}var Go=(Ho.open=function(t,e,n){return new Ho(t.transaction(n,e))},Object.defineProperty(Ho.prototype,"completionPromise",{get:function(){return this.completionDeferred.promise},enumerable:!0,configurable:!0}),Ho.prototype.abort=function(t){t&&this.completionDeferred.reject(t),this.aborted||(qr(Vo,"Aborting transaction:",t?t.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())},Ho.prototype.store=function(t){var e=this.transaction.objectStore(t);return Kr(!!e,"Object store not part of transaction: "+t),new zo(e)},Ho);function Ho(t){var e=this;this.transaction=t,this.aborted=!1,this.completionDeferred=new $i,this.transaction.oncomplete=function(){e.completionDeferred.resolve()},this.transaction.onabort=function(){t.error?e.completionDeferred.reject(t.error):e.completionDeferred.resolve()},this.transaction.onerror=function(t){var n=$o(t.target.error);e.completionDeferred.reject(n)}}var zo=(Yo.prototype.put=function(t,e){return Xo(void 0!==e?(qr(Vo,"PUT",this.store.name,t,e),this.store.put(e,t)):(qr(Vo,"PUT",this.store.name,"<auto-key>",t),this.store.put(t)))},Yo.prototype.add=function(t){return qr(Vo,"ADD",this.store.name,t,t),Xo(this.store.add(t))},Yo.prototype.get=function(t){var e=this;return Xo(this.store.get(t)).next((function(n){return void 0===n&&(n=null),qr(Vo,"GET",e.store.name,t,n),n}))},Yo.prototype.delete=function(t){return qr(Vo,"DELETE",this.store.name,t),Xo(this.store.delete(t))},Yo.prototype.count=function(){return qr(Vo,"COUNT",this.store.name),Xo(this.store.count())},Yo.prototype.loadAll=function(t,e){var n=this.cursor(this.options(t,e)),r=[];return this.iterateCursor(n,(function(t,e){r.push(e)})).next((function(){return r}))},Yo.prototype.deleteAll=function(t,e){qr(Vo,"DELETE ALL",this.store.name);var n=this.options(t,e);n.keysOnly=!1;var r=this.cursor(n);return this.iterateCursor(r,(function(t,e,n){return n.delete()}))},Yo.prototype.iterate=function(t,e){var n;e?n=t:(n={},e=t);var r=this.cursor(n);return this.iterateCursor(r,e)},Yo.prototype.iterateSerial=function(t){var e=this.cursor({});return new Uo((function(n,r){e.onerror=function(t){var e=$o(t.target.error);r(e)},e.onsuccess=function(e){var r=e.target.result;r?t(r.primaryKey,r.value).next((function(t){t?r.continue():n()})):n()}}))},Yo.prototype.iterateCursor=function(t,e){var n=[];return new Uo((function(r,i){t.onerror=function(t){i(t.target.error)},t.onsuccess=function(t){var i=t.target.result;if(i){var o=new Ko(i),a=e(i.primaryKey,i.value,o);if(a instanceof Uo){var s=a.catch((function(t){return o.done(),Uo.reject(t)}));n.push(s)}o.isDone?r():null===o.skipToKey?i.continue():i.continue(o.skipToKey)}else r()}})).next((function(){return Uo.waitFor(n)}))},Yo.prototype.options=function(t,e){var n=void 0;return void 0!==t&&("string"==typeof t?n=t:(Kr(void 0===e,"3rd argument must not be defined if 2nd is a range."),e=t)),{index:n,range:e}},Yo.prototype.cursor=function(t){var e="next";if(t.reverse&&(e="prev"),t.index){var n=this.store.index(t.index);return t.keysOnly?n.openKeyCursor(t.range,e):n.openCursor(t.range,e)}return this.store.openCursor(t.range,e)},Yo);function Yo(t){this.store=t}function Xo(t){return new Uo((function(e,n){t.onsuccess=function(t){var n=t.target.result;e(n)},t.onerror=function(t){var e=$o(t.target.error);n(e)}}))}var Jo=!1;function $o(t){var e=Bo.getIOSVersion(y());if(12.2<=e&&e<13){var n="An internal error was encountered in the Indexed Database server";if(0<=t.message.indexOf(n)){var r=new Xr("internal","IOS_INDEXEDDB_BUG1: IndexedDb has thrown '"+n+"'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.");return Jo||(Jo=!0,setTimeout((function(){throw r}),0)),r}}return t}var Zo,ta,ea=(na.forUser=function(t,e,n,r){return Kr(""!==t.uid,"UserID must not be an empty string."),new na(t.isAuthenticated()?t.uid:"",e,n,r)},na.prototype.checkEmpty=function(t){var e=!0,n=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return aa(t).iterate({index:mu.userMutationsIndex,range:n},(function(t,n,r){e=!1,r.done()})).next((function(){return e}))},na.prototype.acknowledgeBatch=function(t,e,n){return this.getMutationQueueMetadata(t).next((function(e){return e.lastStreamToken=oa(n),ua(t).put(e)}))},na.prototype.getLastStreamToken=function(t){return this.getMutationQueueMetadata(t).next((function(t){return t.lastStreamToken}))},na.prototype.setLastStreamToken=function(t,e){return this.getMutationQueueMetadata(t).next((function(n){return n.lastStreamToken=oa(e),ua(t).put(n)}))},na.prototype.addMutationBatch=function(t,e,n,r){var i=this,o=sa(t),a=aa(t);return a.add({}).next((function(s){Kr("number"==typeof s,"Auto-generated key is not a number");for(var u=new Lo(s,e,n,r),c=i.serializer.toDbMutationBatch(i.userId,u),h=[],l=new wo((function(t,e){return Si(t.canonicalString(),e.canonicalString())})),f=0,p=r;f<p.length;f++){var d=p[f],m=gu.key(i.userId,d.key.path,s);l=l.add(d.key.path.popLast()),h.push(a.put(c)),h.push(o.put(m,gu.PLACEHOLDER))}return l.forEach((function(e){h.push(i.indexManager.addToCollectionParentIndex(t,e))})),t.addOnCommittedListener((function(){i.documentKeysByBatchId[s]=u.keys()})),Uo.waitFor(h).next((function(){return u}))}))},na.prototype.lookupMutationBatch=function(t,e){var n=this;return aa(t).get(e).next((function(t){return t?(Kr(t.userId===n.userId,"Unexpected user '"+t.userId+"' for mutation batch "+e),n.serializer.fromDbMutationBatch(t)):null}))},na.prototype.lookupMutationKeys=function(t,e){var n=this;return this.documentKeysByBatchId[e]?Uo.resolve(this.documentKeysByBatchId[e]):this.lookupMutationBatch(t,e).next((function(t){if(t){var r=t.keys();return n.documentKeysByBatchId[e]=r}return null}))},na.prototype.getNextMutationBatchAfterBatchId=function(t,e){var n=this,r=e+1,i=IDBKeyRange.lowerBound([this.userId,r]),o=null;return aa(t).iterate({index:mu.userMutationsIndex,range:i},(function(t,e,i){e.userId===n.userId&&(Kr(e.batchId>=r,"Should have found mutation after "+r),o=n.serializer.fromDbMutationBatch(e)),i.done()})).next((function(){return o}))},na.prototype.getHighestUnacknowledgedBatchId=function(t){var e=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]),n=-1;return aa(t).iterate({index:mu.userMutationsIndex,range:e,reverse:!0},(function(t,e,r){n=e.batchId,r.done()})).next((function(){return n}))},na.prototype.getAllMutationBatches=function(t){var e=this,n=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return aa(t).loadAll(mu.userMutationsIndex,n).next((function(t){return t.map((function(t){return e.serializer.fromDbMutationBatch(t)}))}))},na.prototype.getAllMutationBatchesAffectingDocumentKey=function(t,e){var n=this,r=gu.prefixForPath(this.userId,e.path),i=IDBKeyRange.lowerBound(r),o=[];return sa(t).iterate({range:i},(function(r,i,a){var s=r[0],u=r[1],c=r[2],h=ao(u);if(s===n.userId&&e.path.isEqual(h))return aa(t).get(c).next((function(t){if(!t)throw Wr("Dangling document-mutation reference found: "+r+" which points to "+c);Kr(t.userId===n.userId,"Unexpected user '"+t.userId+"' for mutation batch "+c),o.push(n.serializer.fromDbMutationBatch(t))}));a.done()})).next((function(){return o}))},na.prototype.getAllMutationBatchesAffectingDocumentKeys=function(t,e){var n=this,r=new wo(Si),i=[];return e.forEach((function(e){var o=gu.prefixForPath(n.userId,e.path),a=IDBKeyRange.lowerBound(o),s=sa(t).iterate({range:a},(function(t,i,o){var a=t[0],s=t[1],u=t[2],c=ao(s);a===n.userId&&e.path.isEqual(c)?r=r.add(u):o.done()}));i.push(s)})),Uo.waitFor(i).next((function(){return n.lookupMutationBatches(t,r)}))},na.prototype.getAllMutationBatchesAffectingQuery=function(t,e){var n=this;Kr(!e.isDocumentQuery(),"Document queries shouldn't go down this path"),Kr(!e.isCollectionGroupQuery(),"CollectionGroup queries should be handled in LocalDocumentsView");var r=e.path,i=r.length+1,o=gu.prefixForPath(this.userId,r),a=IDBKeyRange.lowerBound(o),s=new wo(Si);return sa(t).iterate({range:a},(function(t,e,o){var a=t[0],u=t[1],c=t[2],h=ao(u);a===n.userId&&r.isPrefixOf(h)?h.length===i&&(s=s.add(c)):o.done()})).next((function(){return n.lookupMutationBatches(t,s)}))},na.prototype.lookupMutationBatches=function(t,e){var n=this,r=[],i=[];return e.forEach((function(e){i.push(aa(t).get(e).next((function(t){if(null===t)throw Wr("Dangling document-mutation reference found, which points to "+e);Kr(t.userId===n.userId,"Unexpected user '"+t.userId+"' for mutation batch "+e),r.push(n.serializer.fromDbMutationBatch(t))})))})),Uo.waitFor(i).next((function(){return r}))},na.prototype.removeMutationBatch=function(t,e){var n=this;return ia(t.simpleDbTransaction,this.userId,e).next((function(r){return t.addOnCommittedListener((function(){n.removeCachedMutationKeys(e.batchId)})),Uo.forEach(r,(function(e){return n.referenceDelegate.removeMutationReference(t,e)}))}))},na.prototype.removeCachedMutationKeys=function(t){delete this.documentKeysByBatchId[t]},na.prototype.performConsistencyCheck=function(t){var e=this;return this.checkEmpty(t).next((function(n){if(!n)return Uo.resolve();var r=IDBKeyRange.lowerBound(gu.prefixForUser(e.userId)),i=[];return sa(t).iterate({range:r},(function(t,n,r){if(t[0]===e.userId){var o=ao(t[1]);i.push(o)}else r.done()})).next((function(){Kr(0===i.length,"Document leak -- detected dangling mutation references when queue is empty. Dangling keys: "+i.map((function(t){return t.canonicalString()})))}))}))},na.prototype.containsKey=function(t,e){return ra(t,this.userId,e)},na.prototype.getMutationQueueMetadata=function(t){var e=this;return ua(t).get(this.userId).next((function(t){return t||new pu(e.userId,-1,"")}))},na);function na(t,e,n,r){this.userId=t,this.serializer=e,this.indexManager=n,this.referenceDelegate=r,this.documentKeysByBatchId={}}function ra(t,e,n){var r=gu.prefixForPath(e,n.path),i=r[1],o=IDBKeyRange.lowerBound(r),a=!1;return sa(t).iterate({range:o,keysOnly:!0},(function(t,n,r){var o=t[0],s=t[1];t[2],o===e&&s===i&&(a=!0),r.done()})).next((function(){return a}))}function ia(t,e,n){var r=t.store(mu.store),i=t.store(gu.store),o=[],a=IDBKeyRange.only(n.batchId),s=0,u=r.iterate({range:a},(function(t,e,n){return s++,n.delete()}));o.push(u.next((function(){Kr(1===s,"Dangling document-mutation reference found: Missing batch "+n.batchId)})));for(var c=[],h=0,l=n.mutations;h<l.length;h++){var f=l[h],p=gu.key(e,f.key.path,n.batchId);o.push(i.delete(p)),c.push(f.key)}return Uo.waitFor(o).next((function(){return c}))}function oa(t){return t instanceof Uint8Array?(Kr(Bo.isMockPersistence(),"Persisting non-string stream tokens is only supported with mock persistence."),t.toString()):t}function aa(t){return hc.getStore(t,mu.store)}function sa(t){return hc.getStore(t,gu.store)}function ua(t){return hc.getStore(t,pu.store)}(ta=Zo=Zo||{})[ta.QueryCache=0]="QueryCache",ta[ta.SyncEngine=1]="SyncEngine";var ca=(ha.prototype.next=function(){var t=this.nextId;return this.nextId+=2,t},ha.prototype.after=function(t){return this.seek(t+2),this.next()},ha.prototype.seek=function(t){Kr((1&t)===this.generatorId,"Cannot supply target ID from different generator ID"),this.nextId=t},ha.forTargetCache=function(){return new ha(Zo.QueryCache,2)},ha.forSyncEngine=function(){return new ha(Zo.SyncEngine)},ha);function ha(t,e){Kr((1&(this.generatorId=t))===t,"Generator ID "+t+" contains more than 1 reserved bits"),this.seek(void 0!==e?e:this.generatorId)}var la=(fa.prototype.allocateTargetId=function(t){var e=this;return this.retrieveMetadata(t).next((function(n){return n.highestTargetId=e.targetIdGenerator.after(n.highestTargetId),e.saveMetadata(t,n).next((function(){return n.highestTargetId}))}))},fa.prototype.getLastRemoteSnapshotVersion=function(t){return this.retrieveMetadata(t).next((function(t){return co.fromTimestamp(new so(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds))}))},fa.prototype.getHighestSequenceNumber=function(t){return ma(t.simpleDbTransaction)},fa.prototype.setTargetsMetadata=function(t,e,n){var r=this;return this.retrieveMetadata(t).next((function(i){return i.highestListenSequenceNumber=e,n&&(i.lastRemoteSnapshotVersion=n.toTimestamp()),e>i.highestListenSequenceNumber&&(i.highestListenSequenceNumber=e),r.saveMetadata(t,i)}))},fa.prototype.addTargetData=function(t,e){var n=this;return this.saveTargetData(t,e).next((function(){return n.retrieveMetadata(t).next((function(r){return r.targetCount+=1,n.updateMetadataFromTargetData(e,r),n.saveMetadata(t,r)}))}))},fa.prototype.updateTargetData=function(t,e){return this.saveTargetData(t,e)},fa.prototype.removeTargetData=function(t,e){var n=this;return this.removeMatchingKeysForTargetId(t,e.targetId).next((function(){return pa(t).delete(e.targetId)})).next((function(){return n.retrieveMetadata(t)})).next((function(e){return Kr(0<e.targetCount,"Removing from an empty target cache"),e.targetCount-=1,n.saveMetadata(t,e)}))},fa.prototype.removeTargets=function(t,e,n){var r=this,i=0,o=[];return pa(t).iterate((function(a,s){var u=r.serializer.fromDbTarget(s);u.sequenceNumber<=e&&null===n.get(u.targetId)&&(i++,o.push(r.removeTargetData(t,u)))})).next((function(){return Uo.waitFor(o)})).next((function(){return i}))},fa.prototype.forEachTarget=function(t,e){var n=this;return pa(t).iterate((function(t,r){var i=n.serializer.fromDbTarget(r);e(i)}))},fa.prototype.retrieveMetadata=function(t){return da(t.simpleDbTransaction)},fa.prototype.saveMetadata=function(t,e){return function(t){return hc.getStore(t,Au.store)}(t).put(Au.key,e)},fa.prototype.saveTargetData=function(t,e){return pa(t).put(this.serializer.toDbTarget(e))},fa.prototype.updateMetadataFromTargetData=function(t,e){var n=!1;return t.targetId>e.highestTargetId&&(e.highestTargetId=t.targetId,n=!0),t.sequenceNumber>e.highestListenSequenceNumber&&(e.highestListenSequenceNumber=t.sequenceNumber,n=!0),n},fa.prototype.getTargetCount=function(t){return this.retrieveMetadata(t).next((function(t){return t.targetCount}))},fa.prototype.getTargetData=function(t,e){var n=this,r=e.canonicalId(),i=IDBKeyRange.bound([r,Number.NEGATIVE_INFINITY],[r,Number.POSITIVE_INFINITY]),o=null;return pa(t).iterate({range:i,index:Iu.queryTargetsIndexName},(function(t,r,i){var a=n.serializer.fromDbTarget(r);e.isEqual(a.target)&&(o=a,i.done())})).next((function(){return o}))},fa.prototype.addMatchingKeys=function(t,e,n){var r=this,i=[],o=ya(t);return e.forEach((function(e){var a=ro(e.path);i.push(o.put(new Nu(n,a))),i.push(r.referenceDelegate.addReference(t,e))})),Uo.waitFor(i)},fa.prototype.removeMatchingKeys=function(t,e,n){var r=this,i=ya(t);return Uo.forEach(e,(function(e){var o=ro(e.path);return Uo.waitFor([i.delete([n,o]),r.referenceDelegate.removeReference(t,e)])}))},fa.prototype.removeMatchingKeysForTargetId=function(t,e){var n=ya(t),r=IDBKeyRange.bound([e],[e+1],!1,!0);return n.delete(r)},fa.prototype.getMatchingKeysForTargetId=function(t,e){var n=IDBKeyRange.bound([e],[e+1],!1,!0),r=ya(t),i=Ro();return r.iterate({range:n,keysOnly:!0},(function(t,e,n){var r=ao(t[1]),o=new zi(r);i=i.add(o)})).next((function(){return i}))},fa.prototype.containsKey=function(t,e){var n=ro(e.path),r=IDBKeyRange.bound([n],[Ci(n)],!1,!0),i=0;return ya(t).iterate({index:Nu.documentTargetsIndex,keysOnly:!0,range:r},(function(t,e,n){var r=t[0];t[1],0!==r&&(i++,n.done())})).next((function(){return 0<i}))},fa.prototype.getTargetDataForTarget=function(t,e){var n=this;return pa(t).get(e).next((function(t){return t?n.serializer.fromDbTarget(t):null}))},fa);function fa(t,e){this.referenceDelegate=t,this.serializer=e,this.targetIdGenerator=ca.forTargetCache()}function pa(t){return hc.getStore(t,Iu.store)}function da(t){return Bo.getStore(t,Au.store).get(Au.key).next((function(t){return Kr(null!==t,"Missing metadata row."),t}))}function ma(t){return da(t).next((function(t){return t.highestListenSequenceNumber}))}function ya(t){return hc.getStore(t,Nu.store)}var ga=(va.fromSet=function(t){return new va(t)},va.fromArray=function(t){var e=new wo(Gi.comparator);return t.forEach((function(t){return e=e.add(t)})),new va(e)},va.prototype.covers=function(t){var e=!1;return this.fields.forEach((function(n){n.isPrefixOf(t)&&(e=!0)})),e},va.prototype.isEqual=function(t){return this.fields.isEqual(t.fields)},va);function va(t){this.fields=t}var ba=(wa.prototype.isEqual=function(t){return this.field.isEqual(t.field)&&this.transform.isEqual(t.transform)},wa);function wa(t,e){this.field=t,this.transform=e}var Ta,_a,Ea=function(t,e){this.version=t,this.transformResults=e};(_a=Ta=Ta||{})[_a.Set=0]="Set",_a[_a.Patch=1]="Patch",_a[_a.Transform=2]="Transform",_a[_a.Delete=3]="Delete";var Sa=(Ia.exists=function(t){return new Ia(void 0,t)},Ia.updateTime=function(t){return new Ia(t)},Object.defineProperty(Ia.prototype,"isNone",{get:function(){return void 0===this.updateTime&&void 0===this.exists},enumerable:!0,configurable:!0}),Ia.prototype.isValidFor=function(t){return void 0!==this.updateTime?t instanceof Fs&&t.version.isEqual(this.updateTime):void 0!==this.exists?this.exists===t instanceof Fs:(Kr(this.isNone,"Precondition should be empty"),!0)},Ia.prototype.isEqual=function(t){return function(t,e){return null!=t?!(!e||!t.isEqual(e)):t===e}(this.updateTime,t.updateTime)&&this.exists===t.exists},Ia.NONE=new Ia,Ia);function Ia(t,e){this.updateTime=t,this.exists=e,Kr(void 0===t||void 0===e,'Precondition can specify "exists" or "updateTime" but not both')}var Ca=(Na.prototype.verifyKeyMatches=function(t){null!=t&&Kr(t.key.isEqual(this.key),"Can only apply a mutation to a document with the same key")},Na.getPostMutationVersion=function(t){return t instanceof Fs?t.version:co.MIN},Na);function Na(){}var Da,Aa=(i(Oa,Da=Ca),Oa.prototype.applyToRemoteDocument=function(t,e){this.verifyKeyMatches(t),Kr(null==e.transformResults,"Transform results received by SetMutation.");var n=e.version;return new Fs(this.key,n,{hasCommittedMutations:!0},this.value)},Oa.prototype.applyToLocalView=function(t,e,n){if(this.verifyKeyMatches(t),!this.precondition.isValidFor(t))return t;var r=Ca.getPostMutationVersion(t);return new Fs(this.key,r,{hasLocalMutations:!0},this.value)},Oa.prototype.extractBaseValue=function(t){return null},Oa.prototype.isEqual=function(t){return t instanceof Oa&&this.key.isEqual(t.key)&&this.value.isEqual(t.value)&&this.precondition.isEqual(t.precondition)},Oa);function Oa(t,e,n){var r=Da.call(this)||this;return r.key=t,r.value=e,r.precondition=n,r.type=Ta.Set,r}var ka,Ra=(i(Pa,ka=Ca),Pa.prototype.applyToRemoteDocument=function(t,e){if(this.verifyKeyMatches(t),Kr(null==e.transformResults,"Transform results received by PatchMutation."),!this.precondition.isValidFor(t))return new Ws(this.key,e.version);var n=this.patchDocument(t);return new Fs(this.key,e.version,{hasCommittedMutations:!0},n)},Pa.prototype.applyToLocalView=function(t,e,n){if(this.verifyKeyMatches(t),!this.precondition.isValidFor(t))return t;var r=Ca.getPostMutationVersion(t),i=this.patchDocument(t);return new Fs(this.key,r,{hasLocalMutations:!0},i)},Pa.prototype.extractBaseValue=function(t){return null},Pa.prototype.isEqual=function(t){return t instanceof Pa&&this.key.isEqual(t.key)&&this.fieldMask.isEqual(t.fieldMask)&&this.precondition.isEqual(t.precondition)},Pa.prototype.patchDocument=function(t){var e;return e=t instanceof Fs?t.data():As.EMPTY,this.patchObject(e)},Pa.prototype.patchObject=function(t){var e=this;return this.fieldMask.fields.forEach((function(n){if(!n.isEmpty()){var r=e.data.field(n);t=null!==r?t.set(n,r):t.delete(n)}})),t},Pa);function Pa(t,e,n,r){var i=ka.call(this)||this;return i.key=t,i.data=e,i.fieldMask=n,i.precondition=r,i.type=Ta.Patch,i}var Ma,La=(i(xa,Ma=Ca),xa.prototype.applyToRemoteDocument=function(t,e){if(this.verifyKeyMatches(t),Kr(null!=e.transformResults,"Transform results missing for TransformMutation."),!this.precondition.isValidFor(t))return new Ws(this.key,e.version);var n=this.requireDocument(t),r=this.serverTransformResults(t,e.transformResults),i=e.version,o=this.transformObject(n.data(),r);return new Fs(this.key,i,{hasCommittedMutations:!0},o)},xa.prototype.applyToLocalView=function(t,e,n){if(this.verifyKeyMatches(t),!this.precondition.isValidFor(t))return t;var r=this.requireDocument(t),i=this.localTransformResults(n,t,e),o=this.transformObject(r.data(),i);return new Fs(this.key,r.version,{hasLocalMutations:!0},o)},xa.prototype.extractBaseValue=function(t){for(var e=null,n=0,r=this.fieldTransforms;n<r.length;n++){var i=r[n],o=t instanceof Fs?t.field(i.field):void 0,a=i.transform.computeBaseValue(o||null);null!=a&&(e=null==e?As.EMPTY.set(i.field,a):e.set(i.field,a))}return e},xa.prototype.isEqual=function(t){return t instanceof xa&&this.key.isEqual(t.key)&&Ii(this.fieldTransforms,t.fieldTransforms)&&this.precondition.isEqual(t.precondition)},xa.prototype.requireDocument=function(t){return Kr(t instanceof Fs,"Unknown MaybeDocument type "+t),Kr(t.key.isEqual(this.key),"Can only transform a document with the same key"),t},xa.prototype.serverTransformResults=function(t,e){var n=[];Kr(this.fieldTransforms.length===e.length,"server transform result count ("+e.length+") should match field transform count ("+this.fieldTransforms.length+")");for(var r=0;r<e.length;r++){var i=this.fieldTransforms[r],o=i.transform,a=null;t instanceof Fs&&(a=t.field(i.field)),n.push(o.applyToRemoteDocument(a,e[r]))}return n},xa.prototype.localTransformResults=function(t,e,n){for(var r=[],i=0,o=this.fieldTransforms;i<o.length;i++){var a=o[i],s=a.transform,u=null;e instanceof Fs&&(u=e.field(a.field)),null===u&&n instanceof Fs&&(u=n.field(a.field)),r.push(s.applyToLocalView(u,t))}return r},xa.prototype.transformObject=function(t,e){Kr(e.length===this.fieldTransforms.length,"TransformResults length mismatch.");for(var n=0;n<this.fieldTransforms.length;n++){var r=this.fieldTransforms[n].field;t=t.set(r,e[n])}return t},xa);function xa(t,e){var n=Ma.call(this)||this;return n.key=t,n.fieldTransforms=e,n.type=Ta.Transform,n.precondition=Sa.exists(!0),n}var Fa,ja,Ua,qa,Va,Ba=(i(Wa,Fa=Ca),Wa.prototype.applyToRemoteDocument=function(t,e){return this.verifyKeyMatches(t),Kr(null==e.transformResults,"Transform results received by DeleteMutation."),new qs(this.key,e.version,{hasCommittedMutations:!0})},Wa.prototype.applyToLocalView=function(t,e,n){return this.verifyKeyMatches(t),this.precondition.isValidFor(t)?(t&&Kr(t.key.isEqual(this.key),"Can only apply mutation to document with same key"),new qs(this.key,co.forDeletedDoc())):t},Wa.prototype.extractBaseValue=function(t){return null},Wa.prototype.isEqual=function(t){return t instanceof Wa&&this.key.isEqual(t.key)&&this.precondition.isEqual(t.precondition)},Wa);function Wa(t,e){var n=Fa.call(this)||this;return n.key=t,n.precondition=e,n.type=Ta.Delete,n}(Ua=ja=ja||{})[Ua.NullValue=0]="NullValue",Ua[Ua.BooleanValue=1]="BooleanValue",Ua[Ua.NumberValue=2]="NumberValue",Ua[Ua.TimestampValue=3]="TimestampValue",Ua[Ua.StringValue=4]="StringValue",Ua[Ua.BlobValue=5]="BlobValue",Ua[Ua.RefValue=6]="RefValue",Ua[Ua.GeoPointValue=7]="GeoPointValue",Ua[Ua.ArrayValue=8]="ArrayValue",Ua[Ua.ObjectValue=9]="ObjectValue",(Va=qa=qa||{})[Va.Default=0]="Default",Va[Va.Estimate=1]="Estimate",Va[Va.Previous=2]="Previous";var Ka=(Qa.fromSnapshotOptions=function(t,e){switch(t.serverTimestamps){case"estimate":return new Qa(qa.Estimate,e);case"previous":return new Qa(qa.Previous,e);case"none":case void 0:return new Qa(qa.Default,e);default:return Wr("fromSnapshotOptions() called with invalid options.")}},Qa);function Qa(t,e){this.serverTimestampBehavior=t,this.timestampsInSnapshots=e}var Ga=(Ha.prototype.toString=function(){var t=this.value();return null===t?"null":t.toString()},Ha.prototype.defaultCompareTo=function(t){return Kr(this.typeOrder!==t.typeOrder,"Default compareTo should not be used for values of same type."),Si(this.typeOrder,t.typeOrder)},Ha);function Ha(){}var za,Ya=(i(Xa,za=Ga),Xa.prototype.value=function(t){return null},Xa.prototype.isEqual=function(t){return t instanceof Xa},Xa.prototype.compareTo=function(t){return t instanceof Xa?0:this.defaultCompareTo(t)},Xa.INSTANCE=new Xa,Xa);function Xa(){var t=za.call(this)||this;return t.typeOrder=ja.NullValue,t.internalValue=null,t}var Ja,$a=(i(Za,Ja=Ga),Za.prototype.value=function(t){return this.internalValue},Za.prototype.isEqual=function(t){return t instanceof Za&&this.internalValue===t.internalValue},Za.prototype.compareTo=function(t){return t instanceof Za?Si(this,t):this.defaultCompareTo(t)},Za.of=function(t){return t?Za.TRUE:Za.FALSE},Za.TRUE=new Za(!0),Za.FALSE=new Za(!1),Za);function Za(t){var e=Ja.call(this)||this;return e.internalValue=t,e.typeOrder=ja.BooleanValue,e}var ts,es=(i(ns,ts=Ga),ns.prototype.value=function(t){return this.internalValue},ns.prototype.compareTo=function(t){return t instanceof ns?function(t,e){return t<e?-1:e<t?1:t===e?0:isNaN(t)?isNaN(e)?0:-1:1}(this.internalValue,t.internalValue):this.defaultCompareTo(t)},ns);function ns(t){var e=ts.call(this)||this;return e.internalValue=t,e.typeOrder=ja.NumberValue,e}function rs(t,e){return t===e?0!==t||1/t==1/e:t!=t&&e!=e}var is,os=(i(as,is=es),as.prototype.isEqual=function(t){return t instanceof as&&rs(this.internalValue,t.internalValue)},as);function as(){return null!==is&&is.apply(this,arguments)||this}var ss,us=(i(cs,ss=es),cs.prototype.isEqual=function(t){return t instanceof cs&&rs(this.internalValue,t.internalValue)},cs.NAN=new cs(NaN),cs.POSITIVE_INFINITY=new cs(1/0),cs.NEGATIVE_INFINITY=new cs(-1/0),cs);function cs(){return null!==ss&&ss.apply(this,arguments)||this}var hs,ls=(i(fs,hs=Ga),fs.prototype.value=function(t){return this.internalValue},fs.prototype.isEqual=function(t){return t instanceof fs&&this.internalValue===t.internalValue},fs.prototype.compareTo=function(t){return t instanceof fs?Si(this.internalValue,t.internalValue):this.defaultCompareTo(t)},fs);function fs(t){var e=hs.call(this)||this;return e.internalValue=t,e.typeOrder=ja.StringValue,e}var ps,ds=(i(ms,ps=Ga),ms.prototype.value=function(t){return!t||t.timestampsInSnapshots?this.internalValue:this.internalValue.toDate()},ms.prototype.isEqual=function(t){return t instanceof ms&&this.internalValue.isEqual(t.internalValue)},ms.prototype.compareTo=function(t){return t instanceof ms?this.internalValue._compareTo(t.internalValue):t instanceof gs?-1:this.defaultCompareTo(t)},ms);function ms(t){var e=ps.call(this)||this;return e.internalValue=t,e.typeOrder=ja.TimestampValue,e}var ys,gs=(i(vs,ys=Ga),vs.prototype.value=function(t){return t&&t.serverTimestampBehavior===qa.Estimate?new ds(this.localWriteTime).value(t):t&&t.serverTimestampBehavior===qa.Previous&&this.previousValue?this.previousValue.value(t):null},vs.prototype.isEqual=function(t){return t instanceof vs&&this.localWriteTime.isEqual(t.localWriteTime)},vs.prototype.compareTo=function(t){return t instanceof vs?this.localWriteTime._compareTo(t.localWriteTime):t instanceof ds?1:this.defaultCompareTo(t)},vs.prototype.toString=function(){return"<ServerTimestamp localTime="+this.localWriteTime.toString()+">"},vs);function vs(t,e){var n=ys.call(this)||this;return n.localWriteTime=t,n.previousValue=e,n.typeOrder=ja.TimestampValue,n}var bs,ws=(i(Ts,bs=Ga),Ts.prototype.value=function(t){return this.internalValue},Ts.prototype.isEqual=function(t){return t instanceof Ts&&this.internalValue.isEqual(t.internalValue)},Ts.prototype.compareTo=function(t){return t instanceof Ts?this.internalValue._compareTo(t.internalValue):this.defaultCompareTo(t)},Ts);function Ts(t){var e=bs.call(this)||this;return e.internalValue=t,e.typeOrder=ja.BlobValue,e}var _s,Es=(i(Ss,_s=Ga),Ss.prototype.value=function(t){return this.key},Ss.prototype.isEqual=function(t){return t instanceof Ss&&this.key.isEqual(t.key)&&this.databaseId.isEqual(t.databaseId)},Ss.prototype.compareTo=function(t){if(t instanceof Ss){var e=this.databaseId.compareTo(t.databaseId);return 0!==e?e:zi.comparator(this.key,t.key)}return this.defaultCompareTo(t)},Ss);function Ss(t,e){var n=_s.call(this)||this;return n.databaseId=t,n.key=e,n.typeOrder=ja.RefValue,n}var Is,Cs=(i(Ns,Is=Ga),Ns.prototype.value=function(t){return this.internalValue},Ns.prototype.isEqual=function(t){return t instanceof Ns&&this.internalValue.isEqual(t.internalValue)},Ns.prototype.compareTo=function(t){return t instanceof Ns?this.internalValue._compareTo(t.internalValue):this.defaultCompareTo(t)},Ns);function Ns(t){var e=Is.call(this)||this;return e.internalValue=t,e.typeOrder=ja.GeoPointValue,e}var Ds,As=(i(Os,Ds=Ga),Os.prototype.value=function(t){var e={};return this.internalValue.inorderTraversal((function(n,r){e[n]=r.value(t)})),e},Os.prototype.forEach=function(t){this.internalValue.inorderTraversal(t)},Os.prototype.isEqual=function(t){if(t instanceof Os){for(var e=this.internalValue.getIterator(),n=t.internalValue.getIterator();e.hasNext()&&n.hasNext();){var r=e.getNext(),i=n.getNext();if(r.key!==i.key||!r.value.isEqual(i.value))return!1}return!e.hasNext()&&!n.hasNext()}return!1},Os.prototype.compareTo=function(t){if(t instanceof Os){for(var e=this.internalValue.getIterator(),n=t.internalValue.getIterator();e.hasNext()&&n.hasNext();){var r=e.getNext(),i=n.getNext(),o=Si(r.key,i.key)||r.value.compareTo(i.value);if(o)return o}return Si(e.hasNext(),n.hasNext())}return this.defaultCompareTo(t)},Os.prototype.set=function(t,e){if(Kr(!t.isEmpty(),"Cannot set field for empty path on ObjectValue"),1===t.length)return this.setChild(t.firstSegment(),e);var n=this.child(t.firstSegment());n instanceof Os||(n=Os.EMPTY);var r=n.set(t.popFirst(),e);return this.setChild(t.firstSegment(),r)},Os.prototype.delete=function(t){if(Kr(!t.isEmpty(),"Cannot delete field for empty path on ObjectValue"),1===t.length)return new Os(this.internalValue.remove(t.firstSegment()));var e=this.child(t.firstSegment());if(e instanceof Os){var n=e.delete(t.popFirst());return new Os(this.internalValue.insert(t.firstSegment(),n))}return this},Os.prototype.contains=function(t){return null!==this.field(t)},Os.prototype.field=function(t){Kr(!t.isEmpty(),"Can't get field of empty path");var e=this;return t.forEach((function(t){e=e instanceof Os?e.internalValue.get(t):null})),e},Os.prototype.fieldMask=function(){var t=new wo(Gi.comparator);return this.internalValue.forEach((function(e,n){var r=new Gi([e]);if(n instanceof Os){var i=n.fieldMask().fields;i.isEmpty()?t=t.add(r):i.forEach((function(e){t=t.add(r.child(e))}))}else t=t.add(r)})),ga.fromSet(t)},Os.prototype.toString=function(){return this.internalValue.toString()},Os.prototype.child=function(t){return this.internalValue.get(t)||void 0},Os.prototype.setChild=function(t,e){return new Os(this.internalValue.insert(t,e))},Os.EMPTY=new Os(new lo(Si)),Os);function Os(t){var e=Ds.call(this)||this;return e.internalValue=t,e.typeOrder=ja.ObjectValue,e}var ks,Rs=(i(Ps,ks=Ga),Ps.prototype.value=function(t){return this.internalValue.map((function(e){return e.value(t)}))},Ps.prototype.contains=function(t){for(var e=0,n=this.internalValue;e<n.length;e++)if(n[e].isEqual(t))return!0;return!1},Ps.prototype.forEach=function(t){this.internalValue.forEach(t)},Ps.prototype.isEqual=function(t){if(t instanceof Ps){if(this.internalValue.length!==t.internalValue.length)return!1;for(var e=0;e<this.internalValue.length;e++)if(!this.internalValue[e].isEqual(t.internalValue[e]))return!1;return!0}return!1},Ps.prototype.compareTo=function(t){if(t instanceof Ps){for(var e=Math.min(this.internalValue.length,t.internalValue.length),n=0;n<e;n++){var r=this.internalValue[n].compareTo(t.internalValue[n]);if(r)return r}return Si(this.internalValue.length,t.internalValue.length)}return this.defaultCompareTo(t)},Ps.prototype.toString=function(){return"["+this.internalValue.map((function(t){return t.toString()})).join(",")+"]"},Ps);function Ps(t){var e=ks.call(this)||this;return e.internalValue=t,e.typeOrder=ja.ArrayValue,e}var Ms=(Ls.compareByKey=function(t,e){return zi.comparator(t.key,e.key)},Ls);function Ls(t,e){this.key=t,this.version=e}var xs,Fs=(i(js,xs=Ms),js.prototype.field=function(t){if(this.objectValue)return this.objectValue.field(t);this.fieldValueCache||(this.fieldValueCache=new Map);var e=t.canonicalString(),n=this.fieldValueCache.get(e);if(void 0===n){var r=this.getProtoField(t);n=void 0===r?null:this.converter(r),this.fieldValueCache.set(e,n)}return n},js.prototype.data=function(){var t=this;if(!this.objectValue){var e=As.EMPTY;ni(this.proto.fields||{},(function(n,r){e=e.set(new Gi([n]),t.converter(r))})),this.objectValue=e,this.fieldValueCache=void 0}return this.objectValue},js.prototype.value=function(){return this.data().value()},js.prototype.isEqual=function(t){return t instanceof js&&this.key.isEqual(t.key)&&this.version.isEqual(t.version)&&this.hasLocalMutations===t.hasLocalMutations&&this.hasCommittedMutations===t.hasCommittedMutations&&this.data().isEqual(t.data())},js.prototype.toString=function(){return"Document("+this.key+", "+this.version+", "+this.data().toString()+", {hasLocalMutations: "+this.hasLocalMutations+"}), {hasCommittedMutations: "+this.hasCommittedMutations+"})"},Object.defineProperty(js.prototype,"hasPendingWrites",{get:function(){return this.hasLocalMutations||this.hasCommittedMutations},enumerable:!0,configurable:!0}),js.prototype.getProtoField=function(t){Kr(void 0!==this.proto,"Can only call getProtoField() when proto is defined");for(var e=this.proto.fields?this.proto.fields[t.firstSegment()]:void 0,n=1;n<t.length;++n){if(!e||!e.mapValue||!e.mapValue.fields)return;e=e.mapValue.fields[t.get(n)]}return e},js.compareByField=function(t,e,n){var r=e.field(t),i=n.field(t);return null!==r&&null!==i?r.compareTo(i):Wr("Trying to compare documents on fields that don't exist")},js);function js(t,e,n,r,i,o){var a=xs.call(this,t,e)||this;return a.objectValue=r,a.proto=i,a.converter=o,Kr(void 0!==a.objectValue||void 0!==a.proto&&void 0!==a.converter,"If objectValue is not defined, proto and converter need to be set."),a.hasLocalMutations=!!n.hasLocalMutations,a.hasCommittedMutations=!!n.hasCommittedMutations,a}var Us,qs=(i(Vs,Us=Ms),Vs.prototype.toString=function(){return"NoDocument("+this.key+", "+this.version+")"},Object.defineProperty(Vs.prototype,"hasPendingWrites",{get:function(){return this.hasCommittedMutations},enumerable:!0,configurable:!0}),Vs.prototype.isEqual=function(t){return t instanceof Vs&&t.hasCommittedMutations===this.hasCommittedMutations&&t.version.isEqual(this.version)&&t.key.isEqual(this.key)},Vs);function Vs(t,e,n){var r=Us.call(this,t,e)||this;return r.hasCommittedMutations=!(!n||!n.hasCommittedMutations),r}var Bs,Ws=(i(Ks,Bs=Ms),Ks.prototype.toString=function(){return"UnknownDocument("+this.key+", "+this.version+")"},Object.defineProperty(Ks.prototype,"hasPendingWrites",{get:function(){return!0},enumerable:!0,configurable:!0}),Ks.prototype.isEqual=function(t){return t instanceof Ks&&t.version.isEqual(this.version)&&t.key.isEqual(this.key)},Ks);function Ks(){return null!==Bs&&Bs.apply(this,arguments)||this}var Qs=(Gs.prototype.get=function(t){var e=this.mapKeyFn(t),n=this.inner[e];if(void 0!==n)for(var r=0,i=n;r<i.length;r++){var o=i[r],a=o[0],s=o[1];if(a.isEqual(t))return s}},Gs.prototype.has=function(t){return void 0!==this.get(t)},Gs.prototype.set=function(t,e){var n=this.mapKeyFn(t),r=this.inner[n];if(void 0!==r){for(var i=0;i<r.length;i++)if(r[i][0].isEqual(t))return void(r[i]=[t,e]);r.push([t,e])}else this.inner[n]=[[t,e]]},Gs.prototype.delete=function(t){var e=this.mapKeyFn(t),n=this.inner[e];if(void 0===n)return!1;for(var r=0;r<n.length;r++)if(n[r][0].isEqual(t))return 1===n.length?delete this.inner[e]:n.splice(r,1),!0;return!1},Gs.prototype.forEach=function(t){ni(this.inner,(function(e,n){for(var r=0,i=n;r<i.length;r++){var o=i[r],a=o[0],s=o[1];t(a,s)}}))},Gs.prototype.isEmpty=function(){return ri(this.inner)},Gs);function Gs(t){this.mapKeyFn=t,this.inner={}}var Hs=(Object.defineProperty(zs.prototype,"readTime",{get:function(){return Kr(void 0!==this._readTime,"Read time is not set. All removeEntry() calls must include a readTime if `trackRemovals` is used."),this._readTime},set:function(t){Kr(void 0===this._readTime||this._readTime.isEqual(t),"All changes in a RemoteDocumentChangeBuffer must have the same read time"),this._readTime=t},enumerable:!0,configurable:!0}),zs.prototype.addEntry=function(t,e){this.assertNotApplied(),this.readTime=e,this.changes.set(t.key,t)},zs.prototype.removeEntry=function(t,e){this.assertNotApplied(),e&&(this.readTime=e),this.changes.set(t,null)},zs.prototype.getEntry=function(t,e){this.assertNotApplied();var n=this.changes.get(e);return void 0!==n?Uo.resolve(n):this.getFromCache(t,e)},zs.prototype.getEntries=function(t,e){return this.getAllFromCache(t,e)},zs.prototype.apply=function(t){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(t)},zs.prototype.assertNotApplied=function(){Kr(!this.changesApplied,"Changes have already been applied.")},zs);function zs(){this.changes=new Qs((function(t){return t.toString()})),this.changesApplied=!1}var Ys,Xs=(Js.prototype.addEntry=function(t,e,n){return tu(t).put(eu(e),n)},Js.prototype.removeEntry=function(t,e){var n=tu(t),r=eu(e);return n.delete(r)},Js.prototype.updateMetadata=function(t,e){var n=this;return this.getMetadata(t).next((function(r){return r.byteSize+=e,n.setMetadata(t,r)}))},Js.prototype.getEntry=function(t,e){var n=this;return tu(t).get(eu(e)).next((function(t){return n.maybeDecodeDocument(t)}))},Js.prototype.getSizedEntry=function(t,e){var n=this;return tu(t).get(eu(e)).next((function(t){var e=n.maybeDecodeDocument(t);return e?{maybeDocument:e,size:nu(t)}:null}))},Js.prototype.getEntries=function(t,e){var n=this,r=Co();return this.forEachDbEntry(t,e,(function(t,e){var i=n.maybeDecodeDocument(e);r=r.insert(t,i)})).next((function(){return r}))},Js.prototype.getSizedEntries=function(t,e){var n=this,r=Co(),i=new lo(zi.comparator);return this.forEachDbEntry(t,e,(function(t,e){var o=n.maybeDecodeDocument(e);i=o?(r=r.insert(t,o),i.insert(t,nu(e))):(r=r.insert(t,null),i.insert(t,0))})).next((function(){return{maybeDocuments:r,sizeMap:i}}))},Js.prototype.forEachDbEntry=function(t,e,n){if(e.isEmpty())return Uo.resolve();var r=IDBKeyRange.bound(e.first().path.toArray(),e.last().path.toArray()),i=e.getIterator(),o=i.getNext();return tu(t).iterate({range:r},(function(t,e,r){for(var a=zi.fromSegments(t);o&&zi.comparator(o,a)<0;)n(o,null),o=i.getNext();o&&o.isEqual(a)&&(n(o,e),o=i.hasNext()?i.getNext():null),o?r.skip(o.path.toArray()):r.done()})).next((function(){for(;o;)n(o,null),o=i.hasNext()?i.getNext():null}))},Js.prototype.getDocumentsMatchingQuery=function(t,e,n){var r=this;Kr(!e.isCollectionGroupQuery(),"CollectionGroup queries should be handled in LocalDocumentsView");var i=Do(),o=e.path.length+1,a={};if(n.isEqual(co.MIN)){var s=e.path.toArray();a.range=IDBKeyRange.lowerBound(s)}else{var u=e.path.toArray(),c=this.serializer.toDbTimestampKey(n);a.range=IDBKeyRange.lowerBound([u,c],!0),a.index=Tu.collectionReadTimeIndex}return tu(t).iterate(a,(function(t,n,a){if(t.length===o){var s=r.serializer.fromDbRemoteDocument(n);e.path.isPrefixOf(s.key.path)?s instanceof Fs&&e.matches(s)&&(i=i.insert(s.key,s)):a.done()}})).next((function(){return i}))},Js.prototype.getNewDocumentChanges=function(t,e){var n=this,r=Io(),i=this.serializer.toDbTimestampKey(e),o=tu(t),a=IDBKeyRange.lowerBound(i,!0);return o.iterate({index:Tu.readTimeIndex,range:a},(function(t,e){var o=n.serializer.fromDbRemoteDocument(e);r=r.insert(o.key,o),i=e.readTime})).next((function(){return{changedDocs:r,readTime:n.serializer.fromDbTimestampKey(i)}}))},Js.prototype.getLastDocumentChange=function(t){var e,n=this,r=tu(t),i=co.MIN;return r.iterate({index:Tu.readTimeIndex,reverse:!0},(function(t,r,o){e=n.serializer.fromDbRemoteDocument(r),r.readTime&&(i=n.serializer.fromDbTimestampKey(r.readTime)),o.done()})).next((function(){return{changedDoc:e,readTime:i}}))},Js.prototype.newChangeBuffer=function(t){return new Js.RemoteDocumentChangeBuffer(this,!!t&&t.trackRemovals)},Js.prototype.getSize=function(t){return this.getMetadata(t).next((function(t){return t.byteSize}))},Js.prototype.getMetadata=function(t){return Zs(t).get(Eu.key).next((function(t){return Kr(!!t,"Missing document cache metadata"),t}))},Js.prototype.setMetadata=function(t,e){return Zs(t).put(Eu.key,e)},Js.prototype.maybeDecodeDocument=function(t){if(t){var e=this.serializer.fromDbRemoteDocument(t);return e instanceof qs&&e.version.isEqual(co.forDeletedDoc())?null:e}return null},Js.RemoteDocumentChangeBuffer=(i($s,Ys=Hs),$s.prototype.applyChanges=function(t){var e=this,n=[],r=0,i=new wo((function(t,e){return Si(t.canonicalString(),e.canonicalString())}));return this.changes.forEach((function(o,a){var s=e.documentSizes.get(o);if(Kr(void 0!==s,"Cannot modify a document that wasn't read (for "+o+")"),a){Kr(!e.readTime.isEqual(co.MIN),"Cannot add a document with a read time of zero");var u=e.documentCache.serializer.toDbRemoteDocument(a,e.readTime);i=i.add(o.path.popLast());var c=nu(u);r+=c-s,n.push(e.documentCache.addEntry(t,o,u))}else if(r-=s,e.trackRemovals){var h=e.documentCache.serializer.toDbRemoteDocument(new qs(o,co.forDeletedDoc()),e.readTime);n.push(e.documentCache.addEntry(t,o,h))}else n.push(e.documentCache.removeEntry(t,o))})),i.forEach((function(r){n.push(e.documentCache.indexManager.addToCollectionParentIndex(t,r))})),n.push(this.documentCache.updateMetadata(t,r)),Uo.waitFor(n)},$s.prototype.getFromCache=function(t,e){var n=this;return this.documentCache.getSizedEntry(t,e).next((function(t){return null===t?(n.documentSizes.set(e,0),null):(n.documentSizes.set(e,t.size),t.maybeDocument)}))},$s.prototype.getAllFromCache=function(t,e){var n=this;return this.documentCache.getSizedEntries(t,e).next((function(t){var e=t.maybeDocuments;return t.sizeMap.forEach((function(t,e){n.documentSizes.set(t,e)})),e}))},$s),Js);function Js(t,e){this.serializer=t,this.indexManager=e}function $s(t,e){var n=Ys.call(this)||this;return n.documentCache=t,n.trackRemovals=e,n.documentSizes=new Qs((function(t){return t.toString()})),n}function Zs(t){return hc.getStore(t,Eu.store)}function tu(t){return hc.getStore(t,Tu.store)}function eu(t){return t.path.toArray()}function nu(t){var e;if(t.document)e=t.document;else if(t.unknownDocument)e=t.unknownDocument;else{if(!t.noDocument)throw Wr("Unknown remote document type");e=t.noDocument}return JSON.stringify(e).length}var ru=(iu.prototype.addToCollectionParentIndex=function(t,e){return this.collectionParentIndex.add(e),Uo.resolve()},iu.prototype.getCollectionParents=function(t,e){return Uo.resolve(this.collectionParentIndex.getEntries(e))},iu);function iu(){this.collectionParentIndex=new ou}var ou=(au.prototype.add=function(t){Kr(t.length%2==1,"Expected a collection path.");var e=t.lastSegment(),n=t.popLast(),r=this.index[e]||new wo(Bi.comparator),i=!r.has(n);return this.index[e]=r.add(n),i},au.prototype.has=function(t){var e=t.lastSegment(),n=t.popLast(),r=this.index[e];return r&&r.has(n)},au.prototype.getEntries=function(t){return(this.index[t]||new wo(Bi.comparator)).toArray()},au);function au(){this.index={}}var su=9,uu=(cu.prototype.createOrUpgrade=function(t,e,n,r){var i=this;Kr(n<r&&0<=n&&r<=su,"Unexpected schema upgrade from v"+n+" to v{toVersion}.");var o=new Go(e);n<1&&1<=r&&(function(t){t.createObjectStore(lu.store)}(t),function(t){t.createObjectStore(pu.store,{keyPath:pu.keyPath}),t.createObjectStore(mu.store,{keyPath:mu.keyPath,autoIncrement:!0}).createIndex(mu.userMutationsIndex,mu.userMutationsKeyPath,{unique:!0}),t.createObjectStore(gu.store)}(t),Pu(t),function(t){t.createObjectStore(Tu.store)}(t));var a=Uo.resolve();return n<3&&3<=r&&(0!==n&&(function(t){t.deleteObjectStore(Nu.store),t.deleteObjectStore(Iu.store),t.deleteObjectStore(Au.store)}(t),Pu(t)),a=a.next((function(){return function(t){var e=t.store(Au.store),n=new Au(0,0,co.MIN.toTimestamp(),0);return e.put(Au.key,n)}(o)}))),n<4&&4<=r&&(0!==n&&(a=a.next((function(){return function(t,e){return e.store(mu.store).loadAll().next((function(n){t.deleteObjectStore(mu.store),t.createObjectStore(mu.store,{keyPath:mu.keyPath,autoIncrement:!0}).createIndex(mu.userMutationsIndex,mu.userMutationsKeyPath,{unique:!0});var r=e.store(mu.store),i=n.map((function(t){return r.put(t)}));return Uo.waitFor(i)}))}(t,o)}))),a=a.next((function(){!function(t){t.createObjectStore(Mu.store,{keyPath:Mu.keyPath})}(t)}))),n<5&&5<=r&&(a=a.next((function(){return i.removeAcknowledgedMutations(o)}))),n<6&&6<=r&&(a=a.next((function(){return function(t){t.createObjectStore(Eu.store)}(t),i.addDocumentGlobal(o)}))),n<7&&7<=r&&(a=a.next((function(){return i.ensureSequenceNumbers(o)}))),n<8&&8<=r&&(a=a.next((function(){return i.createCollectionParentIndex(t,o)}))),n<9&&9<=r&&(a=a.next((function(){!function(t){t.objectStoreNames.contains("remoteDocumentChanges")&&t.deleteObjectStore("remoteDocumentChanges")}(t),function(t){var e=t.objectStore(Tu.store);e.createIndex(Tu.readTimeIndex,Tu.readTimeIndexPath,{unique:!1}),e.createIndex(Tu.collectionReadTimeIndex,Tu.collectionReadTimeIndexPath,{unique:!1})}(e)}))),a},cu.prototype.addDocumentGlobal=function(t){var e=0;return t.store(Tu.store).iterate((function(t,n){e+=nu(n)})).next((function(){var n=new Eu(e);return t.store(Eu.store).put(Eu.key,n)}))},cu.prototype.removeAcknowledgedMutations=function(t){var e=this,n=t.store(pu.store),r=t.store(mu.store);return n.loadAll().next((function(n){return Uo.forEach(n,(function(n){var i=IDBKeyRange.bound([n.userId,-1],[n.userId,n.lastAcknowledgedBatchId]);return r.loadAll(mu.userMutationsIndex,i).next((function(r){return Uo.forEach(r,(function(r){Kr(r.userId===n.userId,"Cannot process batch "+r.batchId+" from unexpected user");var i=e.serializer.fromDbMutationBatch(r);return ia(t,n.userId,i).next((function(){}))}))}))}))}))},cu.prototype.ensureSequenceNumbers=function(t){var e=t.store(Nu.store),n=t.store(Tu.store);return ma(t).next((function(t){var r=[];return n.iterate((function(n,i){var o=new Bi(n),a=function(t){return[0,ro(t)]}(o);r.push(e.get(a).next((function(n){return n?Uo.resolve():function(n){return e.put(new Nu(0,ro(n),t))}(o)})))})).next((function(){return Uo.waitFor(r)}))}))},cu.prototype.createCollectionParentIndex=function(t,e){function n(t){if(i.add(t)){var e=t.lastSegment(),n=t.popLast();return r.put({collectionId:e,parent:ro(n)})}}t.createObjectStore(ku.store,{keyPath:ku.keyPath});var r=e.store(ku.store),i=new ou;return e.store(Tu.store).iterate({keysOnly:!0},(function(t,e){return n(new Bi(t).popLast())})).next((function(){return e.store(gu.store).iterate({keysOnly:!0},(function(t,e){t[0];var r=t[1];return n((t[2],ao(r)).popLast())}))}))},cu);function cu(t){this.serializer=t}var hu=function(t,e){this.seconds=t,this.nanoseconds=e},lu=(fu.store="owner",fu.key="owner",fu);function fu(t,e,n){this.ownerId=t,this.allowTabSynchronization=e,this.leaseTimestampMs=n}var pu=(du.store="mutationQueues",du.keyPath="userId",du);function du(t,e,n){this.userId=t,this.lastAcknowledgedBatchId=e,this.lastStreamToken=n}var mu=(yu.store="mutations",yu.keyPath="batchId",yu.userMutationsIndex="userMutationsIndex",yu.userMutationsKeyPath=["userId","batchId"],yu);function yu(t,e,n,r,i){this.userId=t,this.batchId=e,this.localWriteTimeMs=n,this.baseMutations=r,this.mutations=i}var gu=(vu.prefixForUser=function(t){return[t]},vu.prefixForPath=function(t,e){return[t,ro(e)]},vu.key=function(t,e,n){return[t,ro(e),n]},vu.store="documentMutations",vu.PLACEHOLDER=new vu,vu);function vu(){}var bu=function(t,e){this.path=t,this.readTime=e},wu=function(t,e){this.path=t,this.version=e},Tu=(_u.store="remoteDocuments",_u.readTimeIndex="readTimeIndex",_u.readTimeIndexPath="readTime",_u.collectionReadTimeIndex="collectionReadTimeIndex",_u.collectionReadTimeIndexPath=["parentPath","readTime"],_u);function _u(t,e,n,r,i,o){this.unknownDocument=t,this.noDocument=e,this.document=n,this.hasCommittedMutations=r,this.readTime=i,this.parentPath=o}var Eu=(Su.store="remoteDocumentGlobal",Su.key="remoteDocumentGlobalKey",Su);function Su(t){this.byteSize=t}var Iu=(Cu.store="targets",Cu.keyPath="targetId",Cu.queryTargetsIndexName="queryTargetsIndex",Cu.queryTargetsKeyPath=["canonicalId","targetId"],Cu);function Cu(t,e,n,r,i,o,a){this.targetId=t,this.canonicalId=e,this.readTime=n,this.resumeToken=r,this.lastListenSequenceNumber=i,this.lastLimboFreeSnapshotVersion=o,this.query=a}var Nu=(Du.store="targetDocuments",Du.keyPath=["targetId","path"],Du.documentTargetsIndex="documentTargetsIndex",Du.documentTargetsKeyPath=["path","targetId"],Du);function Du(t,e,n){this.targetId=t,this.path=e,Kr(0===t==(void 0!==(this.sequenceNumber=n)),"A target-document row must either have targetId == 0 and a defined sequence number, or a non-zero targetId and no sequence number")}var Au=(Ou.key="targetGlobalKey",Ou.store="targetGlobal",Ou);function Ou(t,e,n,r){this.highestTargetId=t,this.highestListenSequenceNumber=e,this.lastRemoteSnapshotVersion=n,this.targetCount=r}var ku=(Ru.store="collectionParents",Ru.keyPath=["collectionId","parent"],Ru);function Ru(t,e){this.collectionId=t,this.parent=e}function Pu(t){t.createObjectStore(Nu.store,{keyPath:Nu.keyPath}).createIndex(Nu.documentTargetsIndex,Nu.documentTargetsKeyPath,{unique:!0}),t.createObjectStore(Iu.store,{keyPath:Iu.keyPath}).createIndex(Iu.queryTargetsIndexName,Iu.queryTargetsKeyPath,{unique:!0}),t.createObjectStore(Au.store)}var Mu=(Lu.store="clientMetadata",Lu.keyPath="clientId",Lu);function Lu(t,e,n,r){this.clientId=t,this.updateTimeMs=e,this.networkEnabled=n,this.inForeground=r}var xu,Fu,ju=h(h(h([pu.store,mu.store,gu.store,Tu.store,Iu.store,lu.store,Au.store,Nu.store],[Mu.store]),[Eu.store]),[ku.store]),Uu=(qu.prototype.addToCollectionParentIndex=function(t,e){var n=this;if(Kr(e.length%2==1,"Expected a collection path."),this.collectionParentsCache.has(e))return Uo.resolve();var r=e.lastSegment(),i=e.popLast();t.addOnCommittedListener((function(){n.collectionParentsCache.add(e)}));var o={collectionId:r,parent:ro(i)};return Vu(t).put(o)},qu.prototype.getCollectionParents=function(t,e){var n=[],r=IDBKeyRange.bound([e,""],[Ci(e),""],!1,!0);return Vu(t).loadAll(r).next((function(t){for(var r=0,i=t;r<i.length;r++){var o=i[r];if(o.collectionId!==e)break;n.push(ao(o.parent))}return n}))},qu);function qu(){this.collectionParentsCache=new ou}function Vu(t){return hc.getStore(t,ku.store)}(Fu=xu=xu||{})[Fu.Listen=0]="Listen",Fu[Fu.ExistenceFilterMismatch=1]="ExistenceFilterMismatch",Fu[Fu.LimboResolution=2]="LimboResolution";var Bu=(Wu.prototype.withSequenceNumber=function(t){return new Wu(this.target,this.targetId,this.purpose,t,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken)},Wu.prototype.withResumeToken=function(t,e){return new Wu(this.target,this.targetId,this.purpose,this.sequenceNumber,e,this.lastLimboFreeSnapshotVersion,t)},Wu.prototype.withLastLimboFreeSnapshotVersion=function(t){return new Wu(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,t,this.resumeToken)},Wu.prototype.isEqual=function(t){return this.targetId===t.targetId&&this.purpose===t.purpose&&this.sequenceNumber===t.sequenceNumber&&this.snapshotVersion.isEqual(t.snapshotVersion)&&this.lastLimboFreeSnapshotVersion.isEqual(t.lastLimboFreeSnapshotVersion)&&this.resumeToken===t.resumeToken&&this.target.isEqual(t.target)},Wu);function Wu(t,e,n,r,i,o,a){void 0===i&&(i=co.MIN),void 0===o&&(o=co.MIN),void 0===a&&(a=Hr()),this.target=t,this.targetId=e,this.purpose=n,this.sequenceNumber=r,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=a}var Ku=(Qu.prototype.fromDbRemoteDocument=function(t){if(t.document)return this.remoteSerializer.fromDocument(t.document,!!t.hasCommittedMutations);if(t.noDocument){var e=zi.fromSegments(t.noDocument.path),n=this.fromDbTimestamp(t.noDocument.readTime);return new qs(e,n,{hasCommittedMutations:!!t.hasCommittedMutations})}return t.unknownDocument?(e=zi.fromSegments(t.unknownDocument.path),n=this.fromDbTimestamp(t.unknownDocument.version),new Ws(e,n)):Wr("Unexpected DbRemoteDocument")},Qu.prototype.toDbRemoteDocument=function(t,e){var n=this.toDbTimestampKey(e),r=t.key.path.popLast().toArray();if(t instanceof Fs){var i=t.proto?t.proto:this.remoteSerializer.toDocument(t),o=t.hasCommittedMutations;return new Tu(null,null,i,o,n,r)}if(t instanceof qs){var a=t.key.path.toArray(),s=this.toDbTimestamp(t.version);return o=t.hasCommittedMutations,new Tu(null,new bu(a,s),null,o,n,r)}if(t instanceof Ws){a=t.key.path.toArray();var u=this.toDbTimestamp(t.version);return new Tu(new wu(a,u),null,null,!0,n,r)}return Wr("Unexpected MaybeDocument")},Qu.prototype.toDbTimestampKey=function(t){var e=t.toTimestamp();return[e.seconds,e.nanoseconds]},Qu.prototype.fromDbTimestampKey=function(t){var e=new so(t[0],t[1]);return co.fromTimestamp(e)},Qu.prototype.toDbTimestamp=function(t){var e=t.toTimestamp();return new hu(e.seconds,e.nanoseconds)},Qu.prototype.fromDbTimestamp=function(t){var e=new so(t.seconds,t.nanoseconds);return co.fromTimestamp(e)},Qu.prototype.toDbMutationBatch=function(t,e){var n=this,r=e.baseMutations.map((function(t){return n.remoteSerializer.toMutation(t)})),i=e.mutations.map((function(t){return n.remoteSerializer.toMutation(t)}));return new mu(t,e.batchId,e.localWriteTime.toMillis(),r,i)},Qu.prototype.fromDbMutationBatch=function(t){var e=this,n=(t.baseMutations||[]).map((function(t){return e.remoteSerializer.fromMutation(t)})),r=t.mutations.map((function(t){return e.remoteSerializer.fromMutation(t)})),i=so.fromMillis(t.localWriteTimeMs);return new Lo(t.batchId,i,n,r)},Qu.prototype.toDbResourcePaths=function(t){var e=[];return t.forEach((function(t){e.push(ro(t.path))})),e},Qu.prototype.fromDbResourcePaths=function(t){for(var e=Ro(),n=0,r=t;n<r.length;n++){var i=r[n];e=e.add(new zi(ao(i)))}return e},Qu.prototype.fromDbTarget=function(t){var e,n=this.fromDbTimestamp(t.readTime),r=void 0!==t.lastLimboFreeSnapshotVersion?this.fromDbTimestamp(t.lastLimboFreeSnapshotVersion):co.MIN,i=t.resumeToken;return e=function(t){return void 0!==t.documents}(t.query)?this.remoteSerializer.fromDocumentsTarget(t.query):this.remoteSerializer.fromQueryTarget(t.query),new Bu(e,t.targetId,xu.Listen,t.lastListenSequenceNumber,n,r,i)},Qu.prototype.toDbTarget=function(t){Kr(xu.Listen===t.purpose,"Only queries with purpose "+xu.Listen+" may be stored, got "+t.purpose);var e,n,r=this.toDbTimestamp(t.snapshotVersion),i=this.toDbTimestamp(t.lastLimboFreeSnapshotVersion);return e=t.target.isDocumentQuery()?this.remoteSerializer.toDocumentsTarget(t.target):this.remoteSerializer.toQueryTarget(t.target),n=t.resumeToken instanceof Uint8Array?(Kr(Bo.isMockPersistence(),"Persisting non-string stream tokens is only supported with mock persistence ."),t.resumeToken.toString()):t.resumeToken,new Iu(t.targetId,t.target.canonicalId(),r,n,t.sequenceNumber,i,e)},Qu);function Qu(t){this.remoteSerializer=t}function Gu(t,e){var n=t[0],r=t[1],i=e[0],o=e[1],a=Si(n,i);return 0===a?Si(r,o):a}var Hu=(zu.prototype.nextIndex=function(){return++this.previousIndex},zu.prototype.addElement=function(t){var e=[t,this.nextIndex()];if(this.buffer.size<this.maxElements)this.buffer=this.buffer.add(e);else{var n=this.buffer.last();Gu(e,n)<0&&(this.buffer=this.buffer.delete(n).add(e))}},Object.defineProperty(zu.prototype,"maxValue",{get:function(){return this.buffer.last()[0]},enumerable:!0,configurable:!0}),zu);function zu(t){this.maxElements=t,this.buffer=new wo(Gu),this.previousIndex=0}var Yu={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},Xu=(Ju.withCacheSize=function(t){return new Ju(t,Ju.DEFAULT_COLLECTION_PERCENTILE,Ju.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)},Ju.COLLECTION_DISABLED=-1,Ju.MINIMUM_CACHE_SIZE_BYTES=1048576,Ju.DEFAULT=new Ju(Ju.DEFAULT_CACHE_SIZE_BYTES=41943040,Ju.DEFAULT_COLLECTION_PERCENTILE=10,Ju.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3),Ju.DISABLED=new Ju(Ju.COLLECTION_DISABLED,0,0),Ju);function Ju(t,e,n){this.cacheSizeCollectionThreshold=t,this.percentileToCollect=e,this.maximumSequenceNumbersToCollect=n}var $u=(Zu.prototype.start=function(){Kr(null===this.gcTask,"Cannot start an already started LruScheduler"),this.garbageCollector.params.cacheSizeCollectionThreshold!==Xu.COLLECTION_DISABLED&&this.scheduleGC()},Zu.prototype.stop=function(){this.gcTask&&(this.gcTask.cancel(),this.gcTask=null)},Object.defineProperty(Zu.prototype,"started",{get:function(){return null!==this.gcTask},enumerable:!0,configurable:!0}),Zu.prototype.scheduleGC=function(){var t=this;Kr(null===this.gcTask,"Cannot schedule GC while a task is pending");var e=this.hasRun?3e5:6e4;qr("LruGarbageCollector","Garbage collection scheduled in "+e+"ms"),this.gcTask=this.asyncQueue.enqueueAfterDelay(Xi.LruGarbageCollection,e,(function(){return t.gcTask=null,t.hasRun=!0,t.localStore.collectGarbage(t.garbageCollector).then((function(){return t.scheduleGC()})).catch(fc)}))},Zu);function Zu(t,e,n){this.garbageCollector=t,this.asyncQueue=e,this.localStore=n,this.hasRun=!1,this.gcTask=null}var tc=(ec.prototype.calculateTargetCount=function(t,e){return this.delegate.getSequenceNumberCount(t).next((function(t){return Math.floor(e/100*t)}))},ec.prototype.nthSequenceNumber=function(t,e){var n=this;if(0===e)return Uo.resolve(xi.INVALID);var r=new Hu(e);return this.delegate.forEachTarget(t,(function(t){return r.addElement(t.sequenceNumber)})).next((function(){return n.delegate.forEachOrphanedDocumentSequenceNumber(t,(function(t){return r.addElement(t)}))})).next((function(){return r.maxValue}))},ec.prototype.removeTargets=function(t,e,n){return this.delegate.removeTargets(t,e,n)},ec.prototype.removeOrphanedDocuments=function(t,e){return this.delegate.removeOrphanedDocuments(t,e)},ec.prototype.collect=function(t,e){var n=this;return this.params.cacheSizeCollectionThreshold===Xu.COLLECTION_DISABLED?(qr("LruGarbageCollector","Garbage collection skipped; disabled"),Uo.resolve(Yu)):this.getCacheSize(t).next((function(r){return r<n.params.cacheSizeCollectionThreshold?(qr("LruGarbageCollector","Garbage collection skipped; Cache size "+r+" is lower than threshold "+n.params.cacheSizeCollectionThreshold),Yu):n.runGarbageCollection(t,e)}))},ec.prototype.getCacheSize=function(t){return this.delegate.getCacheSize(t)},ec.prototype.runGarbageCollection=function(t,e){var n,r,i,o,a,s,u,c=this,h=Date.now();return this.calculateTargetCount(t,this.params.percentileToCollect).next((function(e){return r=e>c.params.maximumSequenceNumbersToCollect?(qr("LruGarbageCollector","Capping sequence numbers to collect down to the maximum of "+c.params.maximumSequenceNumbersToCollect+" from "+e),c.params.maximumSequenceNumbersToCollect):e,o=Date.now(),c.nthSequenceNumber(t,r)})).next((function(r){return n=r,a=Date.now(),c.removeTargets(t,n,e)})).next((function(e){return i=e,s=Date.now(),c.removeOrphanedDocuments(t,n)})).next((function(t){return u=Date.now(),jr()<=Dr.DEBUG&&qr("LruGarbageCollector","LRU Garbage Collection\n\tCounted targets in "+(o-h)+"ms\n\tDetermined least recently used "+r+" in "+(a-o)+"ms\n\tRemoved "+i+" targets in "+(s-a)+"ms\n\tRemoved "+t+" documents in "+(u-s)+"ms\nTotal Duration: "+(u-h)+"ms"),Uo.resolve({didRun:!0,sequenceNumbersCollected:r,targetsRemoved:i,documentsRemoved:t})}))},ec);function ec(t,e){this.delegate=t,this.params=e}var nc=(rc.prototype.addOnCommittedListener=function(t){this.onCommittedListeners.push(t)},rc.prototype.raiseOnCommittedEvent=function(){this.onCommittedListeners.forEach((function(t){return t()}))},rc);function rc(){this.onCommittedListeners=[]}var ic,oc="IndexedDbPersistence",ac="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.",sc="Another tab has exclusive access to the persistence layer. To allow shared access, make sure to invoke `enablePersistence()` with `synchronizeTabs:true` in all tabs.",uc=(i(cc,ic=nc),cc);function cc(t,e){var n=ic.call(this)||this;return n.simpleDbTransaction=t,n.currentSequenceNumber=e,n}var hc=(lc.getStore=function(t,e){if(t instanceof uc)return Bo.getStore(t.simpleDbTransaction,e);throw Wr("IndexedDbPersistence must use instances of IndexedDbTransaction")},lc.createIndexedDbPersistence=function(t){return u(this,void 0,void 0,(function(){var e;return c(this,(function(n){switch(n.label){case 0:if(!lc.isAvailable())throw new Xr(Yr.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");return[4,(e=new lc(t.allowTabSynchronization,t.persistenceKey,t.clientId,t.platform,t.lruParams,t.queue,t.serializer,t.sequenceNumberSyncer)).start()];case 1:return n.sent(),[2,e]}}))}))},lc.prototype.start=function(){var t=this;return Kr(!this.started,"IndexedDbPersistence double-started!"),Kr(null!==this.window,"Expected 'window' to be defined"),Bo.openOrCreate(this.dbName,su,new uu(this.serializer)).then((function(e){return t.simpleDb=e,t.updateClientMetadataAndTryBecomePrimary()})).then((function(){return t.attachVisibilityHandler(),t.attachWindowUnloadHook(),t.scheduleClientMetadataAndPrimaryLeaseRefreshes(),t.simpleDb.runTransaction("readonly-idempotent",[Au.store],(function(t){return ma(t)}))})).then((function(e){t.listenSequence=new xi(e,t.sequenceNumberSyncer)})).then((function(){t._started=!0})).catch((function(e){return t.simpleDb&&t.simpleDb.close(),Promise.reject(e)}))},lc.prototype.setPrimaryStateListener=function(t){var e=this;return this.primaryStateListener=function(n){return u(e,void 0,void 0,(function(){return c(this,(function(e){return this.started?[2,t(n)]:[2]}))}))},t(this.isPrimary)},lc.prototype.setDatabaseDeletedListener=function(t){var e=this;this.simpleDb.setVersionChangeListener((function(n){return u(e,void 0,void 0,(function(){return c(this,(function(e){switch(e.label){case 0:return null!==n.newVersion?[3,2]:[4,t()];case 1:e.sent(),e.label=2;case 2:return[2]}}))}))}))},lc.prototype.setNetworkEnabled=function(t){var e=this;this.networkEnabled!==t&&(this.networkEnabled=t,this.queue.enqueueAndForget((function(){return u(e,void 0,void 0,(function(){return c(this,(function(t){switch(t.label){case 0:return this.started?[4,this.updateClientMetadataAndTryBecomePrimary()]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}}))}))})))},lc.prototype.updateClientMetadataAndTryBecomePrimary=function(){var t=this;return this.simpleDb.runTransaction("readwrite-idempotent",ju,(function(e){return dc(e).put(new Mu(t.clientId,Date.now(),t.networkEnabled,t.inForeground)).next((function(){if(t.isPrimary)return t.verifyPrimaryLease(e).next((function(e){e||(t.isPrimary=!1,t.queue.enqueueAndForget((function(){return t.primaryStateListener(!1)})))}))})).next((function(){return t.canActAsPrimary(e)})).next((function(n){return t.isPrimary&&!n?t.releasePrimaryLeaseIfHeld(e).next((function(){return!1})):!!n&&t.acquireOrExtendPrimaryLease(e).next((function(){return!0}))}))})).catch((function(e){if(!t.allowTabSynchronization)throw e;return qr(oc,"Releasing owner lease after error during lease refresh",e),!1})).then((function(e){t.isPrimary!==e&&t.queue.enqueueAndForget((function(){return t.primaryStateListener(e)})),t.isPrimary=e}))},lc.prototype.verifyPrimaryLease=function(t){var e=this;return pc(t).get(lu.key).next((function(t){return Uo.resolve(e.isLocalClient(t))}))},lc.prototype.removeClientMetadata=function(t){return dc(t).delete(this.clientId)},lc.prototype.maybeGarbageCollectMultiClientState=function(){return u(this,void 0,void 0,(function(){var t=this;return c(this,(function(e){switch(e.label){case 0:return!this.isPrimary||this.isWithinAge(this.lastGarbageCollectionTime,18e5)?[3,2]:(this.lastGarbageCollectionTime=Date.now(),[4,this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary-idempotent",(function(e){var n=lc.getStore(e,Mu.store);return n.loadAll().next((function(e){var r=t.filterActiveClients(e,18e5),i=e.filter((function(t){return-1===r.indexOf(t)}));return Uo.forEach(i,(function(t){return n.delete(t.clientId)})).next((function(){return i}))}))}))]);case 1:e.sent().forEach((function(e){t.window.localStorage.removeItem(t.zombiedClientLocalStorageKey(e.clientId))})),e.label=2;case 2:return[2]}}))}))},lc.prototype.scheduleClientMetadataAndPrimaryLeaseRefreshes=function(){var t=this;this.clientMetadataRefresher=this.queue.enqueueAfterDelay(Xi.ClientMetadataRefresh,4e3,(function(){return t.updateClientMetadataAndTryBecomePrimary().then((function(){return t.maybeGarbageCollectMultiClientState()})).then((function(){return t.scheduleClientMetadataAndPrimaryLeaseRefreshes()}))}))},lc.prototype.isLocalClient=function(t){return!!t&&t.ownerId===this.clientId},lc.prototype.canActAsPrimary=function(t){var e=this;return pc(t).get(lu.key).next((function(n){if(null!==n&&e.isWithinAge(n.leaseTimestampMs,5e3)&&!e.isClientZombied(n.ownerId)){if(e.isLocalClient(n)&&e.networkEnabled)return!0;if(!e.isLocalClient(n)){if(!n.allowTabSynchronization)throw new Xr(Yr.FAILED_PRECONDITION,sc);return!1}}return!(!e.networkEnabled||!e.inForeground)||dc(t).loadAll().next((function(t){return void 0===e.filterActiveClients(t,5e3).find((function(t){if(e.clientId!==t.clientId){var n=!e.networkEnabled&&t.networkEnabled,r=!e.inForeground&&t.inForeground,i=e.networkEnabled===t.networkEnabled;if(n||r&&i)return!0}return!1}))}))})).next((function(t){return e.isPrimary!==t&&qr(oc,"Client "+(t?"is":"is not")+" eligible for a primary lease."),t}))},lc.prototype.shutdown=function(){return u(this,void 0,void 0,(function(){var t=this;return c(this,(function(e){switch(e.label){case 0:return this._started=!1,this.markClientZombied(),this.clientMetadataRefresher&&(this.clientMetadataRefresher.cancel(),this.clientMetadataRefresher=null),this.detachVisibilityHandler(),this.detachWindowUnloadHook(),[4,this.simpleDb.runTransaction("readwrite-idempotent",[lu.store,Mu.store],(function(e){return t.releasePrimaryLeaseIfHeld(e).next((function(){return t.removeClientMetadata(e)}))}))];case 1:return e.sent(),this.simpleDb.close(),this.removeClientZombiedEntry(),[2]}}))}))},lc.prototype.filterActiveClients=function(t,e){var n=this;return t.filter((function(t){return n.isWithinAge(t.updateTimeMs,e)&&!n.isClientZombied(t.clientId)}))},lc.prototype.getActiveClients=function(){var t=this;return this.simpleDb.runTransaction("readonly-idempotent",[Mu.store],(function(e){return dc(e).loadAll().next((function(e){return t.filterActiveClients(e,18e5).map((function(t){return t.clientId}))}))}))},lc.clearPersistence=function(t){return u(this,void 0,void 0,(function(){var e;return c(this,(function(n){switch(n.label){case 0:return lc.isAvailable()?(e=t+lc.MAIN_DATABASE,[4,Bo.delete(e)]):[2,Promise.resolve()];case 1:return n.sent(),[2]}}))}))},Object.defineProperty(lc.prototype,"started",{get:function(){return this._started},enumerable:!0,configurable:!0}),lc.prototype.getMutationQueue=function(t){return Kr(this.started,"Cannot initialize MutationQueue before persistence is started."),ea.forUser(t,this.serializer,this.indexManager,this.referenceDelegate)},lc.prototype.getTargetCache=function(){return Kr(this.started,"Cannot initialize TargetCache before persistence is started."),this.targetCache},lc.prototype.getRemoteDocumentCache=function(){return Kr(this.started,"Cannot initialize RemoteDocumentCache before persistence is started."),this.remoteDocumentCache},lc.prototype.getIndexManager=function(){return Kr(this.started,"Cannot initialize IndexManager before persistence is started."),this.indexManager},lc.prototype.runTransaction=function(t,e,n){var r=this;qr(oc,"Starting transaction:",t);var i,o=e.endsWith("idempotent"),a=e.startsWith("readonly")?o?"readonly-idempotent":"readonly":o?"readwrite-idempotent":"readwrite";return this.simpleDb.runTransaction(a,ju,(function(o){return i=new uc(o,r.listenSequence.next()),"readwrite-primary"===e||"readwrite-primary-idempotent"===e?r.verifyPrimaryLease(o).next((function(t){return!!t||r.canActAsPrimary(o)})).next((function(e){if(!e)throw Vr("Failed to obtain primary lease for action '"+t+"'."),r.isPrimary=!1,r.queue.enqueueAndForget((function(){return r.primaryStateListener(!1)})),new Xr(Yr.FAILED_PRECONDITION,ac);return n(i)})).next((function(t){return r.acquireOrExtendPrimaryLease(o).next((function(){return t}))})):r.verifyAllowTabSynchronization(o).next((function(){return n(i)}))})).then((function(t){return i.raiseOnCommittedEvent(),t}))},lc.prototype.verifyAllowTabSynchronization=function(t){var e=this;return pc(t).get(lu.key).next((function(t){if(null!==t&&e.isWithinAge(t.leaseTimestampMs,5e3)&&!e.isClientZombied(t.ownerId)&&!e.isLocalClient(t)&&!t.allowTabSynchronization)throw new Xr(Yr.FAILED_PRECONDITION,sc)}))},lc.prototype.acquireOrExtendPrimaryLease=function(t){var e=new lu(this.clientId,this.allowTabSynchronization,Date.now());return pc(t).put(lu.key,e)},lc.isAvailable=function(){return Bo.isAvailable()},lc.buildStoragePrefix=function(t){var e=t.databaseId.projectId;return t.databaseId.isDefaultDatabase||(e+="."+t.databaseId.database),"firestore/"+t.persistenceKey+"/"+e+"/"},lc.prototype.releasePrimaryLeaseIfHeld=function(t){var e=this,n=pc(t);return n.get(lu.key).next((function(t){return e.isLocalClient(t)?(qr(oc,"Releasing primary lease."),n.delete(lu.key)):Uo.resolve()}))},lc.prototype.isWithinAge=function(t,e){var n=Date.now();return!(t<n-e||n<t&&(Vr("Detected an update time that is in the future: "+t+" > "+n),1))},lc.prototype.attachVisibilityHandler=function(){var t=this;null!==this.document&&"function"==typeof this.document.addEventListener&&(this.documentVisibilityHandler=function(){t.queue.enqueueAndForget((function(){return t.inForeground="visible"===t.document.visibilityState,t.updateClientMetadataAndTryBecomePrimary()}))},this.document.addEventListener("visibilitychange",this.documentVisibilityHandler),this.inForeground="visible"===this.document.visibilityState)},lc.prototype.detachVisibilityHandler=function(){this.documentVisibilityHandler&&(Kr(null!==this.document&&"function"==typeof this.document.addEventListener,"Expected 'document.addEventListener' to be a function"),this.document.removeEventListener("visibilitychange",this.documentVisibilityHandler),this.documentVisibilityHandler=null)},lc.prototype.attachWindowUnloadHook=function(){var t=this;"function"==typeof this.window.addEventListener&&(this.windowUnloadHandler=function(){t.markClientZombied(),t.queue.enqueueAndForget((function(){return t.shutdown()}))},this.window.addEventListener("unload",this.windowUnloadHandler))},lc.prototype.detachWindowUnloadHook=function(){this.windowUnloadHandler&&(Kr("function"==typeof this.window.removeEventListener,"Expected 'window.removeEventListener' to be a function"),this.window.removeEventListener("unload",this.windowUnloadHandler),this.windowUnloadHandler=null)},lc.prototype.isClientZombied=function(t){try{var e=null!==this.webStorage.getItem(this.zombiedClientLocalStorageKey(t));return qr(oc,"Client '"+t+"' "+(e?"is":"is not")+" zombied in LocalStorage"),e}catch(t){return Vr(oc,"Failed to get zombied client id.",t),!1}},lc.prototype.markClientZombied=function(){try{this.webStorage.setItem(this.zombiedClientLocalStorageKey(this.clientId),String(Date.now()))}catch(t){Vr("Failed to set zombie client id.",t)}},lc.prototype.removeClientZombiedEntry=function(){try{this.webStorage.removeItem(this.zombiedClientLocalStorageKey(this.clientId))}catch(t){}},lc.prototype.zombiedClientLocalStorageKey=function(t){return"firestore_zombie_"+this.persistenceKey+"_"+t},lc.MAIN_DATABASE="main",lc);function lc(t,e,n,r,i,o,a,s){if(this.allowTabSynchronization=t,this.persistenceKey=e,this.clientId=n,this.queue=o,this.sequenceNumberSyncer=s,this._started=!1,this.isPrimary=!1,this.networkEnabled=!0,this.windowUnloadHandler=null,this.inForeground=!1,this.documentVisibilityHandler=null,this.clientMetadataRefresher=null,this.lastGarbageCollectionTime=Number.NEGATIVE_INFINITY,this.primaryStateListener=function(t){return Promise.resolve()},this.referenceDelegate=new mc(this,i),this.dbName=e+lc.MAIN_DATABASE,this.serializer=new Ku(a),this.document=r.document,this.targetCache=new la(this.referenceDelegate,this.serializer),this.indexManager=new Uu,this.remoteDocumentCache=new Xs(this.serializer,this.indexManager),!r.window||!r.window.localStorage)throw new Xr(Yr.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");this.window=r.window,this.webStorage=this.window.localStorage}function fc(t){return u(this,void 0,void 0,(function(){return c(this,(function(e){if(!function(t){return t.code===Yr.FAILED_PRECONDITION&&t.message===ac}(t))throw t;return qr(oc,"Unexpectedly lost primary lease"),[2]}))}))}function pc(t){return t.store(lu.store)}function dc(t){return t.store(Mu.store)}var mc=(yc.prototype.getSequenceNumberCount=function(t){var e=this.orphanedDocmentCount(t);return this.db.getTargetCache().getTargetCount(t).next((function(t){return e.next((function(e){return t+e}))}))},yc.prototype.orphanedDocmentCount=function(t){var e=0;return this.forEachOrphanedDocumentSequenceNumber(t,(function(t){e++})).next((function(){return e}))},yc.prototype.forEachTarget=function(t,e){return this.db.getTargetCache().forEachTarget(t,e)},yc.prototype.forEachOrphanedDocumentSequenceNumber=function(t,e){return this.forEachOrphanedDocument(t,(function(t,n){return e(n)}))},yc.prototype.setInMemoryPins=function(t){this.inMemoryPins=t},yc.prototype.addReference=function(t,e){return gc(t,e)},yc.prototype.removeReference=function(t,e){return gc(t,e)},yc.prototype.removeTargets=function(t,e,n){return this.db.getTargetCache().removeTargets(t,e,n)},yc.prototype.removeMutationReference=function(t,e){return gc(t,e)},yc.prototype.isPinned=function(t,e){return this.inMemoryPins.containsKey(e)?Uo.resolve(!0):function(t,e){var n=!1;return ua(t).iterateSerial((function(r){return ra(t,r,e).next((function(t){return t&&(n=!0),Uo.resolve(!t)}))})).next((function(){return n}))}(t,e)},yc.prototype.removeOrphanedDocuments=function(t,e){var n=this,r=this.db.getRemoteDocumentCache().newChangeBuffer(),i=[],o=0;return this.forEachOrphanedDocument(t,(function(a,s){if(s<=e){var u=n.isPinned(t,a).next((function(e){if(!e)return o++,r.getEntry(t,a).next((function(){return r.removeEntry(a),ya(t).delete(function(t){return[0,ro(t.path)]}(a))}))}));i.push(u)}})).next((function(){return Uo.waitFor(i)})).next((function(){return r.apply(t)})).next((function(){return o}))},yc.prototype.removeTarget=function(t,e){var n=e.withSequenceNumber(t.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(t,n)},yc.prototype.updateLimboDocument=function(t,e){return gc(t,e)},yc.prototype.forEachOrphanedDocument=function(t,e){var n,r=ya(t),i=xi.INVALID;return r.iterate({index:Nu.documentTargetsIndex},(function(t,r){var o=t[0],a=(t[1],r.path),s=r.sequenceNumber;0===o?(i!==xi.INVALID&&e(new zi(ao(n)),i),i=s,n=a):i=xi.INVALID})).next((function(){i!==xi.INVALID&&e(new zi(ao(n)),i)}))},yc.prototype.getCacheSize=function(t){return this.db.getRemoteDocumentCache().getSize(t)},yc);function yc(t,e){this.db=t,this.inMemoryPins=null,this.garbageCollector=new tc(this,e)}function gc(t,e){return ya(t).put(function(t,e){return new Nu(0,ro(t.path),e)}(e,t.currentSequenceNumber))}var vc=Number,bc=vc.MIN_SAFE_INTEGER||-(Math.pow(2,53)-1),wc=vc.MAX_SAFE_INTEGER||Math.pow(2,53)-1,Tc=vc.isInteger||function(t){return"number"==typeof t&&isFinite(t)&&Math.floor(t)===t};function _c(t){return null==t}function Ec(t){return Tc(t)&&t<=wc&&bc<=t}var Sc,Ic,Cc=(Nc.prototype.canonicalId=function(){if(null===this.memoizedCanonicalId){var t=this.path.canonicalString();null!==this.collectionGroup&&(t+="|cg:"+this.collectionGroup),t+="|f:";for(var e=0,n=this.filters;e<n.length;e++)t+=n[e].canonicalId(),t+=",";t+="|ob:";for(var r=0,i=this.orderBy;r<i.length;r++)t+=i[r].canonicalId(),t+=",";_c(this.limit)||(t+="|l:",t+=this.limit),this.startAt&&(t+="|lb:",t+=this.startAt.canonicalId()),this.endAt&&(t+="|ub:",t+=this.endAt.canonicalId()),this.memoizedCanonicalId=t}return this.memoizedCanonicalId},Nc.prototype.toString=function(){var t=this.path.canonicalString();return null!==this.collectionGroup&&(t+=" collectionGroup="+this.collectionGroup),0<this.filters.length&&(t+=", filters: ["+this.filters.join(", ")+"]"),_c(this.limit)||(t+=", limit: "+this.limit),0<this.orderBy.length&&(t+=", orderBy: ["+this.orderBy.join(", ")+"]"),this.startAt&&(t+=", startAt: "+this.startAt.canonicalId()),this.endAt&&(t+=", endAt: "+this.endAt.canonicalId()),"Target("+t+")"},Nc.prototype.isEqual=function(t){if(this.limit!==t.limit)return!1;if(this.orderBy.length!==t.orderBy.length)return!1;for(var e=0;e<this.orderBy.length;e++)if(!this.orderBy[e].isEqual(t.orderBy[e]))return!1;if(this.filters.length!==t.filters.length)return!1;for(e=0;e<this.filters.length;e++)if(!this.filters[e].isEqual(t.filters[e]))return!1;return this.collectionGroup===t.collectionGroup&&!!this.path.isEqual(t.path)&&!(null!==this.startAt?!this.startAt.isEqual(t.startAt):null!==t.startAt)&&(null!==this.endAt?this.endAt.isEqual(t.endAt):null===t.endAt)},Nc.prototype.isDocumentQuery=function(){return zi.isDocumentKey(this.path)&&null===this.collectionGroup&&0===this.filters.length},Nc);function Nc(t,e,n,r,i,o,a){void 0===e&&(e=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o=null),void 0===a&&(a=null),this.path=t,this.collectionGroup=e,this.orderBy=n,this.filters=r,this.limit=i,this.startAt=o,this.endAt=a,this.memoizedCanonicalId=null}(Ic=Sc=Sc||{}).First="F",Ic.Last="L";var Dc=(Ac.atPath=function(t){return new Ac(t)},Object.defineProperty(Ac.prototype,"orderBy",{get:function(){if(null===this.memoizedOrderBy){var t=this.getInequalityFilterField(),e=this.getFirstOrderByField();if(null!==t&&null===e)t.isKeyField()?this.memoizedOrderBy=[nh]:this.memoizedOrderBy=[new th(t),nh];else{Kr(null===t||null!==e&&t.isEqual(e),"First orderBy should match inequality field.");for(var n=!(this.memoizedOrderBy=[]),r=0,i=this.explicitOrderBy;r<i.length;r++){var o=i[r];this.memoizedOrderBy.push(o),o.field.isKeyField()&&(n=!0)}if(!n){var a=0<this.explicitOrderBy.length?this.explicitOrderBy[this.explicitOrderBy.length-1].dir:Xc.ASCENDING;this.memoizedOrderBy.push(a===Xc.ASCENDING?nh:rh)}}}return this.memoizedOrderBy},enumerable:!0,configurable:!0}),Ac.prototype.addFilter=function(t){Kr(null==this.getInequalityFilterField()||!(t instanceof Pc)||!t.isInequality()||t.field.isEqual(this.getInequalityFilterField()),"Query must only have one inequality field."),Kr(!this.isDocumentQuery(),"No filtering allowed for document query");var e=this.filters.concat([t]);return new Ac(this.path,this.collectionGroup,this.explicitOrderBy.slice(),e,this.limit,this.limitType,this.startAt,this.endAt)},Ac.prototype.addOrderBy=function(t){Kr(!this.startAt&&!this.endAt,"Bounds must be set after orderBy");var e=this.explicitOrderBy.concat([t]);return new Ac(this.path,this.collectionGroup,e,this.filters.slice(),this.limit,this.limitType,this.startAt,this.endAt)},Ac.prototype.withLimitToFirst=function(t){return new Ac(this.path,this.collectionGroup,this.explicitOrderBy.slice(),this.filters.slice(),t,Sc.First,this.startAt,this.endAt)},Ac.prototype.withLimitToLast=function(t){return new Ac(this.path,this.collectionGroup,this.explicitOrderBy.slice(),this.filters.slice(),t,Sc.Last,this.startAt,this.endAt)},Ac.prototype.withStartAt=function(t){return new Ac(this.path,this.collectionGroup,this.explicitOrderBy.slice(),this.filters.slice(),this.limit,this.limitType,t,this.endAt)},Ac.prototype.withEndAt=function(t){return new Ac(this.path,this.collectionGroup,this.explicitOrderBy.slice(),this.filters.slice(),this.limit,this.limitType,this.startAt,t)},Ac.prototype.asCollectionQueryAtPath=function(t){return new Ac(t,null,this.explicitOrderBy.slice(),this.filters.slice(),this.limit,this.limitType,this.startAt,this.endAt)},Ac.prototype.matchesAllDocuments=function(){return 0===this.filters.length&&null===this.limit&&null==this.startAt&&null==this.endAt&&(0===this.explicitOrderBy.length||1===this.explicitOrderBy.length&&this.explicitOrderBy[0].field.isKeyField())},Ac.prototype.canonicalId=function(){return this.toTarget().canonicalId()+"|lt:"+this.limitType},Ac.prototype.toString=function(){return"Query(target="+this.toTarget().toString()+"; limitType="+this.limitType+")"},Ac.prototype.isEqual=function(t){return this.toTarget().isEqual(t.toTarget())&&this.limitType===t.limitType},Ac.prototype.docComparator=function(t,e){for(var n=!1,r=0,i=this.orderBy;r<i.length;r++){var o=i[r],a=o.compare(t,e);if(0!==a)return a;n=n||o.field.isKeyField()}return Kr(n,"orderBy used that doesn't compare on key field"),0},Ac.prototype.matches=function(t){return this.matchesPathAndCollectionGroup(t)&&this.matchesOrderBy(t)&&this.matchesFilters(t)&&this.matchesBounds(t)},Ac.prototype.hasLimitToFirst=function(){return!_c(this.limit)&&this.limitType===Sc.First},Ac.prototype.hasLimitToLast=function(){return!_c(this.limit)&&this.limitType===Sc.Last},Ac.prototype.getFirstOrderByField=function(){return 0<this.explicitOrderBy.length?this.explicitOrderBy[0].field:null},Ac.prototype.getInequalityFilterField=function(){for(var t=0,e=this.filters;t<e.length;t++){var n=e[t];if(n instanceof Pc&&n.isInequality())return n.field}return null},Ac.prototype.findFilterOperator=function(t){for(var e=0,n=this.filters;e<n.length;e++){var r=n[e];if(r instanceof Pc&&0<=t.indexOf(r.op))return r.op}return null},Ac.prototype.isDocumentQuery=function(){return this.toTarget().isDocumentQuery()},Ac.prototype.isCollectionGroupQuery=function(){return null!==this.collectionGroup},Ac.prototype.toTarget=function(){if(!this.memoizedTarget)if(this.limitType===Sc.First)this.memoizedTarget=new Cc(this.path,this.collectionGroup,this.orderBy,this.filters,this.limit,this.startAt,this.endAt);else{for(var t=[],e=0,n=this.orderBy;e<n.length;e++){var r=n[e],i=r.dir===Xc.DESCENDING?Xc.ASCENDING:Xc.DESCENDING;t.push(new th(r.field,i))}var o=this.endAt?new $c(this.endAt.position,!this.endAt.before):null,a=this.startAt?new $c(this.startAt.position,!this.startAt.before):null;this.memoizedTarget=new Cc(this.path,this.collectionGroup,t,this.filters,this.limit,o,a)}return this.memoizedTarget},Ac.prototype.matchesPathAndCollectionGroup=function(t){var e=t.key.path;return null!==this.collectionGroup?t.key.hasCollectionId(this.collectionGroup)&&this.path.isPrefixOf(e):zi.isDocumentKey(this.path)?this.path.isEqual(e):this.path.isImmediateParentOf(e)},Ac.prototype.matchesOrderBy=function(t){for(var e=0,n=this.explicitOrderBy;e<n.length;e++){var r=n[e];if(!r.field.isKeyField()&&null===t.field(r.field))return!1}return!0},Ac.prototype.matchesFilters=function(t){for(var e=0,n=this.filters;e<n.length;e++)if(!n[e].matches(t))return!1;return!0},Ac.prototype.matchesBounds=function(t){return!(this.startAt&&!this.startAt.sortsBeforeDocument(this.orderBy,t)||this.endAt&&this.endAt.sortsBeforeDocument(this.orderBy,t))},Ac.prototype.assertValidBound=function(t){Kr(t.position.length<=this.orderBy.length,"Bound is longer than orderBy")},Ac);function Ac(t,e,n,r,i,o,a,s){void 0===e&&(e=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o=Sc.First),void 0===a&&(a=null),void 0===s&&(s=null),this.path=t,this.collectionGroup=e,this.explicitOrderBy=n,this.filters=r,this.limit=i,this.limitType=o,this.startAt=a,this.endAt=s,this.memoizedOrderBy=null,this.memoizedTarget=null,this.startAt&&this.assertValidBound(this.startAt),this.endAt&&this.assertValidBound(this.endAt)}var Oc=(kc.fromString=function(t){switch(t){case"<":return kc.LESS_THAN;case"<=":return kc.LESS_THAN_OR_EQUAL;case"==":return kc.EQUAL;case">=":return kc.GREATER_THAN_OR_EQUAL;case">":return kc.GREATER_THAN;case"array-contains":return kc.ARRAY_CONTAINS;case"in":return kc.IN;case"array-contains-any":return kc.ARRAY_CONTAINS_ANY;default:return Wr("Unknown FieldFilter operator: "+t)}},kc.prototype.toString=function(){return this.name},kc.prototype.isEqual=function(t){return this.name===t.name},kc.LESS_THAN=new kc("<"),kc.LESS_THAN_OR_EQUAL=new kc("<="),kc.EQUAL=new kc("=="),kc.GREATER_THAN=new kc(">"),kc.GREATER_THAN_OR_EQUAL=new kc(">="),kc.ARRAY_CONTAINS=new kc("array-contains"),kc.IN=new kc("in"),kc.ARRAY_CONTAINS_ANY=new kc("array-contains-any"),kc);function kc(t){this.name=t}var Rc,Pc=(i(Mc,Rc=function(){}),Mc.create=function(t,e,n){if(t.isKeyField())return e===Oc.IN?(Kr(n instanceof Rs,"Comparing on key with IN, but filter value not an ArrayValue"),Kr(n.internalValue.every((function(t){return t instanceof Es})),"Comparing on key with IN, but an array value was not a RefValue"),new Uc(t,n)):(Kr(n instanceof Es,"Comparing on key, but filter value not a RefValue"),Kr(e!==Oc.ARRAY_CONTAINS&&e!==Oc.ARRAY_CONTAINS_ANY,"'"+e.toString()+"' queries don't make sense on document keys."),new xc(t,e,n));if(n.isEqual(Ya.INSTANCE)){if(e!==Oc.EQUAL)throw new Xr(Yr.INVALID_ARGUMENT,"Invalid query. Null supports only equality comparisons.");return new Mc(t,e,n)}if(n.isEqual(us.NAN)){if(e!==Oc.EQUAL)throw new Xr(Yr.INVALID_ARGUMENT,"Invalid query. NaN supports only equality comparisons.");return new Mc(t,e,n)}return e===Oc.ARRAY_CONTAINS?new Bc(t,n):e===Oc.IN?(Kr(n instanceof Rs,"IN filter has invalid value: "+n.toString()),new Qc(t,n)):e===Oc.ARRAY_CONTAINS_ANY?(Kr(n instanceof Rs,"ARRAY_CONTAINS_ANY filter has invalid value: "+n.toString()),new zc(t,n)):new Mc(t,e,n)},Mc.prototype.matches=function(t){var e=t.field(this.field);return null!==e&&this.value.typeOrder===e.typeOrder&&this.matchesComparison(e.compareTo(this.value))},Mc.prototype.matchesComparison=function(t){switch(this.op){case Oc.LESS_THAN:return t<0;case Oc.LESS_THAN_OR_EQUAL:return t<=0;case Oc.EQUAL:return 0===t;case Oc.GREATER_THAN:return 0<t;case Oc.GREATER_THAN_OR_EQUAL:return 0<=t;default:return Wr("Unknown FieldFilter operator: "+this.op)}},Mc.prototype.isInequality=function(){return 0<=[Oc.LESS_THAN,Oc.LESS_THAN_OR_EQUAL,Oc.GREATER_THAN,Oc.GREATER_THAN_OR_EQUAL].indexOf(this.op)},Mc.prototype.canonicalId=function(){return this.field.canonicalString()+this.op.toString()+this.value.toString()},Mc.prototype.isEqual=function(t){return t instanceof Mc&&this.op.isEqual(t.op)&&this.field.isEqual(t.field)&&this.value.isEqual(t.value)},Mc.prototype.toString=function(){return this.field.canonicalString()+" "+this.op+" "+this.value.value()},Mc);function Mc(t,e,n){var r=Rc.call(this)||this;return r.field=t,r.op=e,r.value=n,r}var Lc,xc=(i(Fc,Lc=Pc),Fc.prototype.matches=function(t){var e=this.value,n=zi.comparator(t.key,e.key);return this.matchesComparison(n)},Fc);function Fc(){return null!==Lc&&Lc.apply(this,arguments)||this}var jc,Uc=(i(qc,jc=Pc),qc.prototype.matches=function(t){return this.value.internalValue.some((function(e){return t.key.isEqual(e.key)}))},qc);function qc(t,e){var n=jc.call(this,t,Oc.IN,e)||this;return n.value=e,n}var Vc,Bc=(i(Wc,Vc=Pc),Wc.prototype.matches=function(t){var e=t.field(this.field);return e instanceof Rs&&e.contains(this.value)},Wc);function Wc(t,e){return Vc.call(this,t,Oc.ARRAY_CONTAINS,e)||this}var Kc,Qc=(i(Gc,Kc=Pc),Gc.prototype.matches=function(t){var e=this.value,n=t.field(this.field);return null!==n&&e.contains(n)},Gc);function Gc(t,e){var n=Kc.call(this,t,Oc.IN,e)||this;return n.value=e,n}var Hc,zc=(i(Yc,Hc=Pc),Yc.prototype.matches=function(t){var e=this,n=t.field(this.field);return n instanceof Rs&&n.internalValue.some((function(t){return e.value.contains(t)}))},Yc);function Yc(t,e){var n=Hc.call(this,t,Oc.ARRAY_CONTAINS_ANY,e)||this;return n.value=e,n}var Xc=(Jc.prototype.toString=function(){return this.name},Jc.ASCENDING=new Jc("asc"),Jc.DESCENDING=new Jc("desc"),Jc);function Jc(t){this.name=t}var $c=(Zc.prototype.canonicalId=function(){for(var t=this.before?"b:":"a:",e=0,n=this.position;e<n.length;e++)t+=n[e].toString();return t},Zc.prototype.sortsBeforeDocument=function(t,e){Kr(this.position.length<=t.length,"Bound has more components than query's orderBy");for(var n=0,r=0;r<this.position.length;r++){var i=t[r],o=this.position[r];if(i.field.isKeyField())Kr(o instanceof Es,"Bound has a non-key value where the key path is being used."),n=zi.comparator(o.key,e.key);else{var a=e.field(i.field);Kr(null!==a,"Field should exist since document matched the orderBy already."),n=o.compareTo(a)}if(i.dir===Xc.DESCENDING&&(n*=-1),0!==n)break}return this.before?n<=0:n<0},Zc.prototype.isEqual=function(t){if(null===t)return!1;if(this.before!==t.before||this.position.length!==t.position.length)return!1;for(var e=0;e<this.position.length;e++){var n=this.position[e],r=t.position[e];if(!n.isEqual(r))return!1}return!0},Zc);function Zc(t,e){this.position=t,this.before=e}var th=(eh.prototype.compare=function(t,e){var n=this.isKeyOrderBy?Fs.compareByKey(t,e):Fs.compareByField(this.field,t,e);switch(this.dir){case Xc.ASCENDING:return n;case Xc.DESCENDING:return-1*n;default:return Wr("Unknown direction: "+this.dir)}},eh.prototype.canonicalId=function(){return this.field.canonicalString()+this.dir.toString()},eh.prototype.toString=function(){return this.field.canonicalString()+" ("+this.dir+")"},eh.prototype.isEqual=function(t){return this.dir===t.dir&&this.field.isEqual(t.field)},eh);function eh(t,e){this.field=t,void 0===e&&(e=Xc.ASCENDING),this.dir=e,this.isKeyOrderBy=t.isKeyField()}var nh=new th(Gi.keyField(),Xc.ASCENDING),rh=new th(Gi.keyField(),Xc.DESCENDING),ih=(oh.prototype.setLocalDocumentsView=function(t){this.localDocumentsView=t},oh.prototype.getDocumentsMatchingQuery=function(t,e,n,r){var i=this;return Kr(void 0!==this.localDocumentsView,"setLocalDocumentsView() not called"),e.matchesAllDocuments()?this.executeFullCollectionScan(t,e):n.isEqual(co.MIN)?this.executeFullCollectionScan(t,e):this.localDocumentsView.getDocuments(t,r).next((function(o){var a=i.applyQuery(e,o);return(e.hasLimitToFirst()||e.hasLimitToLast())&&i.needsRefill(e.limitType,a,r,n)?i.executeFullCollectionScan(t,e):(jr()<=Dr.DEBUG&&qr("IndexFreeQueryEngine","Re-using previous result from %s to execute query: %s",n.toString(),e.toString()),i.localDocumentsView.getDocumentsMatchingQuery(t,e,n).next((function(t){return a.forEach((function(e){t=t.insert(e.key,e)})),t})))}))},oh.prototype.applyQuery=function(t,e){var n=new wo((function(e,n){return t.docComparator(e,n)}));return e.forEach((function(e,r){r instanceof Fs&&t.matches(r)&&(n=n.add(r))})),n},oh.prototype.needsRefill=function(t,e,n,r){if(n.size!==e.size)return!0;var i=t===Sc.First?e.last():e.first();return!!i&&(i.hasPendingWrites||0<i.version.compareTo(r))},oh.prototype.executeFullCollectionScan=function(t,e){return jr()<=Dr.DEBUG&&qr("IndexFreeQueryEngine","Using full collection scan to execute query: %s",e.toString()),this.localDocumentsView.getDocumentsMatchingQuery(t,e,co.MIN)},oh);function oh(){}var ah=(sh.prototype.getDocument=function(t,e){var n=this;return this.mutationQueue.getAllMutationBatchesAffectingDocumentKey(t,e).next((function(r){return n.getDocumentInternal(t,e,r)}))},sh.prototype.getDocumentInternal=function(t,e,n){return this.remoteDocumentCache.getEntry(t,e).next((function(t){for(var r=0,i=n;r<i.length;r++)t=i[r].applyToLocalView(e,t);return t}))},sh.prototype.applyLocalMutationsToDocuments=function(t,e,n){var r=Co();return e.forEach((function(t,e){for(var i=0,o=n;i<o.length;i++)e=o[i].applyToLocalView(t,e);r=r.insert(t,e)})),r},sh.prototype.getDocuments=function(t,e){var n=this;return this.remoteDocumentCache.getEntries(t,e).next((function(e){return n.getLocalViewOfDocuments(t,e)}))},sh.prototype.getLocalViewOfDocuments=function(t,e){var n=this;return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(t,e).next((function(r){var i=n.applyLocalMutationsToDocuments(t,e,r),o=Io();return i.forEach((function(t,e){e=e||new qs(t,co.forDeletedDoc()),o=o.insert(t,e)})),o}))},sh.prototype.getDocumentsMatchingQuery=function(t,e,n){return e.isDocumentQuery()?this.getDocumentsMatchingDocumentQuery(t,e.path):e.isCollectionGroupQuery()?this.getDocumentsMatchingCollectionGroupQuery(t,e,n):this.getDocumentsMatchingCollectionQuery(t,e,n)},sh.prototype.getDocumentsMatchingDocumentQuery=function(t,e){return this.getDocument(t,new zi(e)).next((function(t){var e=Do();return t instanceof Fs&&(e=e.insert(t.key,t)),e}))},sh.prototype.getDocumentsMatchingCollectionGroupQuery=function(t,e,n){var r=this;Kr(e.path.isEmpty(),"Currently we only support collection group queries at the root.");var i=e.collectionGroup,o=Do();return this.indexManager.getCollectionParents(t,i).next((function(a){return Uo.forEach(a,(function(a){var s=e.asCollectionQueryAtPath(a.child(i));return r.getDocumentsMatchingCollectionQuery(t,s,n).next((function(t){t.forEach((function(t,e){o=o.insert(t,e)}))}))})).next((function(){return o}))}))},sh.prototype.getDocumentsMatchingCollectionQuery=function(t,e,n){var r,i,o=this;return this.remoteDocumentCache.getDocumentsMatchingQuery(t,e,n).next((function(n){return r=n,o.mutationQueue.getAllMutationBatchesAffectingQuery(t,e)})).next((function(e){return i=e,o.addMissingBaseDocuments(t,i,r).next((function(t){r=t;for(var e=0,n=i;e<n.length;e++)for(var o=n[e],a=0,s=o.mutations;a<s.length;a++){var u=s[a],c=u.key,h=r.get(c),l=u.applyToLocalView(h,h,o.localWriteTime);r=l instanceof Fs?r.insert(c,l):r.remove(c)}}))})).next((function(){return r.forEach((function(t,n){e.matches(n)||(r=r.remove(t))})),r}))},sh.prototype.addMissingBaseDocuments=function(t,e,n){for(var r=Ro(),i=0,o=e;i<o.length;i++)for(var a=0,s=o[i].mutations;a<s.length;a++){var u=s[a];u instanceof Ra&&null===n.get(u.key)&&(r=r.add(u.key))}var c=n;return this.remoteDocumentCache.getEntries(t,r).next((function(t){return t.forEach((function(t,e){null!==e&&e instanceof Fs&&(c=c.insert(t,e))})),c}))},sh);function sh(t,e,n){this.remoteDocumentCache=t,this.mutationQueue=e,this.indexManager=n}var uh=(ch.prototype.isEmpty=function(){return this.refsByKey.isEmpty()},ch.prototype.addReference=function(t,e){var n=new hh(t,e);this.refsByKey=this.refsByKey.add(n),this.refsByTarget=this.refsByTarget.add(n)},ch.prototype.addReferences=function(t,e){var n=this;t.forEach((function(t){return n.addReference(t,e)}))},ch.prototype.removeReference=function(t,e){this.removeRef(new hh(t,e))},ch.prototype.removeReferences=function(t,e){var n=this;t.forEach((function(t){return n.removeReference(t,e)}))},ch.prototype.removeReferencesForId=function(t){var e=this,n=zi.EMPTY,r=new hh(n,t),i=new hh(n,t+1),o=[];return this.refsByTarget.forEachInRange([r,i],(function(t){e.removeRef(t),o.push(t.key)})),o},ch.prototype.removeAllReferences=function(){var t=this;this.refsByKey.forEach((function(e){return t.removeRef(e)}))},ch.prototype.removeRef=function(t){this.refsByKey=this.refsByKey.delete(t),this.refsByTarget=this.refsByTarget.delete(t)},ch.prototype.referencesForId=function(t){var e=zi.EMPTY,n=new hh(e,t),r=new hh(e,t+1),i=Ro();return this.refsByTarget.forEachInRange([n,r],(function(t){i=i.add(t.key)})),i},ch.prototype.containsKey=function(t){var e=new hh(t,0),n=this.refsByKey.firstAfterOrEqual(e);return null!==n&&t.isEqual(n.key)},ch);function ch(){this.refsByKey=new wo(hh.compareByKey),this.refsByTarget=new wo(hh.compareByTargetId)}var hh=(lh.compareByKey=function(t,e){return zi.comparator(t.key,e.key)||Si(t.targetOrBatchId,e.targetOrBatchId)},lh.compareByTargetId=function(t,e){return Si(t.targetOrBatchId,e.targetOrBatchId)||zi.comparator(t.key,e.key)},lh);function lh(t,e){this.key=t,this.targetOrBatchId=e}var fh=(ph.prototype.start=function(){return this.synchronizeLastDocumentChangeReadTime()},ph.prototype.handleUserChange=function(t){return u(this,void 0,void 0,(function(){var e,n,r,i=this;return c(this,(function(o){switch(o.label){case 0:return e=this.mutationQueue,n=this.localDocuments,[4,this.persistence.runTransaction("Handle user change","readonly-idempotent",(function(r){var o;return i.mutationQueue.getAllMutationBatches(r).next((function(a){return o=a,e=i.persistence.getMutationQueue(t),n=new ah(i.remoteDocuments,e,i.persistence.getIndexManager()),e.getAllMutationBatches(r)})).next((function(t){for(var e=[],i=[],a=Ro(),s=0,u=o;s<u.length;s++){var c=u[s];e.push(c.batchId);for(var h=0,l=c.mutations;h<l.length;h++){var f=l[h];a=a.add(f.key)}}for(var p=0,d=t;p<d.length;p++){c=d[p],i.push(c.batchId);for(var m=0,y=c.mutations;m<y.length;m++)f=y[m],a=a.add(f.key)}return n.getDocuments(r,a).next((function(t){return{affectedDocuments:t,removedBatchIds:e,addedBatchIds:i}}))}))}))];case 1:return r=o.sent(),this.mutationQueue=e,this.localDocuments=n,this.queryEngine.setLocalDocumentsView(this.localDocuments),[2,r]}}))}))},ph.prototype.localWrite=function(t){var e,n=this,r=so.now(),i=t.reduce((function(t,e){return t.add(e.key)}),Ro());return this.persistence.runTransaction("Locally write mutations","readwrite-idempotent",(function(o){return n.localDocuments.getDocuments(o,i).next((function(i){e=i;for(var a=[],s=0,u=t;s<u.length;s++){var c=u[s],h=c.extractBaseValue(e.get(c.key));null!=h&&a.push(new Ra(c.key,h,h.fieldMask(),Sa.exists(!0)))}return n.mutationQueue.addMutationBatch(o,r,a,t)}))})).then((function(t){var n=t.applyToLocalDocumentSet(e);return{batchId:t.batchId,changes:n}}))},ph.prototype.lookupMutationDocuments=function(t){var e=this;return this.persistence.runTransaction("Lookup mutation documents","readonly-idempotent",(function(n){return e.mutationQueue.lookupMutationKeys(n,t).next((function(t){return t?e.localDocuments.getDocuments(n,t):Uo.resolve(null)}))}))},ph.prototype.acknowledgeBatch=function(t){var e=this;return this.persistence.runTransaction("Acknowledge batch","readwrite-primary-idempotent",(function(n){var r=t.batch.keys(),i=e.remoteDocuments.newChangeBuffer({trackRemovals:!0});return e.mutationQueue.acknowledgeBatch(n,t.batch,t.streamToken).next((function(){return e.applyWriteToRemoteDocuments(n,t,i)})).next((function(){return i.apply(n)})).next((function(){return e.mutationQueue.performConsistencyCheck(n)})).next((function(){return e.localDocuments.getDocuments(n,r)}))}))},ph.prototype.rejectBatch=function(t){var e=this;return this.persistence.runTransaction("Reject batch","readwrite-primary-idempotent",(function(n){var r;return e.mutationQueue.lookupMutationBatch(n,t).next((function(t){return Kr(null!==t,"Attempt to reject nonexistent batch!"),r=t.keys(),e.mutationQueue.removeMutationBatch(n,t)})).next((function(){return e.mutationQueue.performConsistencyCheck(n)})).next((function(){return e.localDocuments.getDocuments(n,r)}))}))},ph.prototype.getHighestUnacknowledgedBatchId=function(){var t=this;return this.persistence.runTransaction("Get highest unacknowledged batch id","readonly-idempotent",(function(e){return t.mutationQueue.getHighestUnacknowledgedBatchId(e)}))},ph.prototype.getLastStreamToken=function(){var t=this;return this.persistence.runTransaction("Get last stream token","readonly-idempotent",(function(e){return t.mutationQueue.getLastStreamToken(e)}))},ph.prototype.setLastStreamToken=function(t){var e=this;return this.persistence.runTransaction("Set last stream token","readwrite-primary-idempotent",(function(n){return e.mutationQueue.setLastStreamToken(n,t)}))},ph.prototype.getLastRemoteSnapshotVersion=function(){var t=this;return this.persistence.runTransaction("Get last remote snapshot version","readonly-idempotent",(function(e){return t.targetCache.getLastRemoteSnapshotVersion(e)}))},ph.prototype.applyRemoteEvent=function(t){var e=this,n=t.snapshotVersion,r=this.targetDataByTarget;return this.persistence.runTransaction("Apply remote event","readwrite-primary-idempotent",(function(i){var o=e.remoteDocuments.newChangeBuffer({trackRemovals:!0});r=e.targetDataByTarget;var a=[];ei(t.targetChanges,(function(t,o){var s=r.get(t);if(s){a.push(e.targetCache.removeMatchingKeys(i,o.removedDocuments,t).next((function(){return e.targetCache.addMatchingKeys(i,o.addedDocuments,t)})));var u=o.resumeToken;if(0<u.length){var c=s.withResumeToken(u,n).withSequenceNumber(i.currentSequenceNumber);r=r.insert(t,c),ph.shouldPersistTargetData(s,c,o)&&a.push(e.targetCache.updateTargetData(i,c))}}}));var s=Io(),u=Ro();if(t.documentUpdates.forEach((function(t,e){u=u.add(t)})),a.push(o.getEntries(i,u).next((function(r){t.documentUpdates.forEach((function(u,c){var h=r.get(u);c instanceof qs&&c.version.isEqual(co.MIN)?(o.removeEntry(u,n),s=s.insert(u,c)):null==h||0<c.version.compareTo(h.version)||0===c.version.compareTo(h.version)&&h.hasPendingWrites?(Kr(!co.MIN.isEqual(n),"Cannot add a document when the remote version is zero"),o.addEntry(c,n),s=s.insert(u,c)):qr("LocalStore","Ignoring outdated watch update for ",u,". Current version:",h.version," Watch version:",c.version),t.resolvedLimboDocuments.has(u)&&a.push(e.persistence.referenceDelegate.updateLimboDocument(i,u))}))}))),!n.isEqual(co.MIN)){var c=e.targetCache.getLastRemoteSnapshotVersion(i).next((function(t){return Kr(0<=n.compareTo(t),"Watch stream reverted to previous snapshot?? "+n+" < "+t),e.targetCache.setTargetsMetadata(i,i.currentSequenceNumber,n)}));a.push(c)}return Uo.waitFor(a).next((function(){return o.apply(i)})).next((function(){return e.localDocuments.getLocalViewOfDocuments(i,s)}))})).then((function(t){return e.targetDataByTarget=r,t}))},ph.shouldPersistTargetData=function(t,e,n){return Kr(0<e.resumeToken.length,"Attempted to persist target data with no resume token"),0===t.resumeToken.length||e.snapshotVersion.toMicroseconds()-t.snapshotVersion.toMicroseconds()>=this.RESUME_TOKEN_MAX_AGE_MICROS||0<n.addedDocuments.size+n.modifiedDocuments.size+n.removedDocuments.size},ph.prototype.notifyLocalViewChanges=function(t){for(var e=this,n=0,r=t;n<r.length;n++){var i=r[n],o=i.targetId;if(this.localViewReferences.addReferences(i.addedKeys,o),this.localViewReferences.removeReferences(i.removedKeys,o),!i.fromCache){var a=this.targetDataByTarget.get(o);Kr(null!==a,"Can't set limbo-free snapshot version for unknown target: "+o);var s=a.snapshotVersion,u=a.withLastLimboFreeSnapshotVersion(s);this.targetDataByTarget=this.targetDataByTarget.insert(o,u)}}return this.persistence.runTransaction("notifyLocalViewChanges","readwrite-idempotent",(function(n){return Uo.forEach(t,(function(t){return Uo.forEach(t.removedKeys,(function(t){return e.persistence.referenceDelegate.removeReference(n,t)}))}))}))},ph.prototype.nextMutationBatch=function(t){var e=this;return this.persistence.runTransaction("Get next mutation batch","readonly-idempotent",(function(n){return void 0===t&&(t=-1),e.mutationQueue.getNextMutationBatchAfterBatchId(n,t)}))},ph.prototype.readDocument=function(t){var e=this;return this.persistence.runTransaction("read document","readonly-idempotent",(function(n){return e.localDocuments.getDocument(n,t)}))},ph.prototype.allocateTarget=function(t){var e=this;return this.persistence.runTransaction("Allocate target","readwrite-idempotent",(function(n){var r;return e.targetCache.getTargetData(n,t).next((function(i){return i?(r=i,Uo.resolve(r)):e.targetCache.allocateTargetId(n).next((function(i){return r=new Bu(t,i,xu.Listen,n.currentSequenceNumber),e.targetCache.addTargetData(n,r).next((function(){return r}))}))}))})).then((function(n){return null===e.targetDataByTarget.get(n.targetId)&&(e.targetDataByTarget=e.targetDataByTarget.insert(n.targetId,n),e.targetIdByTarget.set(t,n.targetId)),n}))},ph.prototype.getTargetData=function(t,e){var n=this.targetIdByTarget.get(e);return void 0!==n?Uo.resolve(this.targetDataByTarget.get(n)):this.targetCache.getTargetData(t,e)},ph.prototype.releaseTarget=function(t,e){var n=this,r=this.targetDataByTarget.get(t);Kr(null!==r,"Tried to release nonexistent target: "+t);var i=e?"readwrite-idempotent":"readwrite-primary-idempotent";return this.persistence.runTransaction("Release target",i,(function(i){var o=n.localViewReferences.removeReferencesForId(t);return e?Uo.resolve():Uo.forEach(o,(function(t){return n.persistence.referenceDelegate.removeReference(i,t)})).next((function(){n.persistence.referenceDelegate.removeTarget(i,r)}))})).then((function(){n.targetDataByTarget=n.targetDataByTarget.remove(t),n.targetIdByTarget.delete(r.target)}))},ph.prototype.executeQuery=function(t,e){var n=this,r=co.MIN,i=Ro();return this.persistence.runTransaction("Execute query","readonly-idempotent",(function(o){return n.getTargetData(o,t.toTarget()).next((function(t){if(t)return r=t.lastLimboFreeSnapshotVersion,n.targetCache.getMatchingKeysForTargetId(o,t.targetId).next((function(t){i=t}))})).next((function(){return n.queryEngine.getDocumentsMatchingQuery(o,t,e?r:co.MIN,e?i:Ro())})).next((function(t){return{documents:t,remoteKeys:i}}))}))},ph.prototype.remoteDocumentKeys=function(t){var e=this;return this.persistence.runTransaction("Remote document keys","readonly-idempotent",(function(n){return e.targetCache.getMatchingKeysForTargetId(n,t)}))},ph.prototype.getActiveClients=function(){return this.persistence.getActiveClients()},ph.prototype.removeCachedMutationBatchMetadata=function(t){this.mutationQueue.removeCachedMutationKeys(t)},ph.prototype.setNetworkEnabled=function(t){this.persistence.setNetworkEnabled(t)},ph.prototype.applyWriteToRemoteDocuments=function(t,e,n){var r=this,i=e.batch,o=i.keys(),a=Uo.resolve();return o.forEach((function(r){a=a.next((function(){return n.getEntry(t,r)})).next((function(t){var o=t,a=e.docVersions.get(r);Kr(null!==a,"ackVersions should contain every doc in the write."),(!o||o.version.compareTo(a)<0)&&((o=i.applyToRemoteDocument(r,o,e))?n.addEntry(o,e.commitVersion):Kr(!t,"Mutation batch "+i+" applied to document "+t+" resulted in null"))}))})),a.next((function(){return r.mutationQueue.removeMutationBatch(t,i)}))},ph.prototype.collectGarbage=function(t){var e=this;return this.persistence.runTransaction("Collect garbage","readwrite-primary-idempotent",(function(n){return t.collect(n,e.targetDataByTarget)}))},ph.prototype.getTarget=function(t){var e=this,n=this.targetDataByTarget.get(t);return n?Promise.resolve(n.target):this.persistence.runTransaction("Get target data","readonly-idempotent",(function(n){return e.targetCache.getTargetDataForTarget(n,t).next((function(t){return t?t.target:null}))}))},ph.prototype.getNewDocumentChanges=function(){var t=this;return this.persistence.runTransaction("Get new document changes","readonly-idempotent",(function(e){return t.remoteDocuments.getNewDocumentChanges(e,t.lastDocumentChangeReadTime)})).then((function(e){var n=e.changedDocs,r=e.readTime;return t.lastDocumentChangeReadTime=r,n}))},ph.prototype.synchronizeLastDocumentChangeReadTime=function(){return u(this,void 0,void 0,(function(){var t,e=this;return c(this,(function(n){return this.remoteDocuments instanceof Xs?(t=this.remoteDocuments,[2,this.persistence.runTransaction("Synchronize last document change read time","readonly-idempotent",(function(e){return t.getLastDocumentChange(e)})).then((function(t){var n=t.readTime;e.lastDocumentChangeReadTime=n}))]):[2]}))}))},ph.RESUME_TOKEN_MAX_AGE_MICROS=3e8,ph);function ph(t,e,n){this.persistence=t,this.queryEngine=e,this.localViewReferences=new uh,this.targetDataByTarget=new lo(Si),this.targetIdByTarget=new Qs((function(t){return t.canonicalId()})),this.lastDocumentChangeReadTime=co.MIN,Kr(t.started,"LocalStore was passed an unstarted persistence implementation"),this.persistence.referenceDelegate.setInMemoryPins(this.localViewReferences),this.mutationQueue=t.getMutationQueue(n),this.remoteDocuments=t.getRemoteDocumentCache(),this.targetCache=t.getTargetCache(),this.localDocuments=new ah(this.remoteDocuments,this.mutationQueue,this.persistence.getIndexManager()),this.queryEngine.setLocalDocumentsView(this.localDocuments)}var dh=(mh.prototype.checkEmpty=function(t){return Uo.resolve(0===this.mutationQueue.length)},mh.prototype.acknowledgeBatch=function(t,e,n){var r=e.batchId,i=this.indexOfExistingBatchId(r,"acknowledged");Kr(0===i,"Can only acknowledge the first batch in the mutation queue");var o=this.mutationQueue[i];return Kr(r===o.batchId,"Queue ordering failure: expected batch "+r+", got batch "+o.batchId),this.lastStreamToken=n,Uo.resolve()},mh.prototype.getLastStreamToken=function(t){return Uo.resolve(this.lastStreamToken)},mh.prototype.setLastStreamToken=function(t,e){return this.lastStreamToken=e,Uo.resolve()},mh.prototype.addMutationBatch=function(t,e,n,r){Kr(0!==r.length,"Mutation batches should not be empty");var i=this.nextBatchId;this.nextBatchId++,0<this.mutationQueue.length&&Kr(this.mutationQueue[this.mutationQueue.length-1].batchId<i,"Mutation batchIDs must be monotonically increasing order");var o=new Lo(i,e,n,r);this.mutationQueue.push(o);for(var a=0,s=r;a<s.length;a++){var u=s[a];this.batchesByDocumentKey=this.batchesByDocumentKey.add(new hh(u.key,i)),this.indexManager.addToCollectionParentIndex(t,u.key.path.popLast())}return Uo.resolve(o)},mh.prototype.lookupMutationBatch=function(t,e){return Uo.resolve(this.findMutationBatch(e))},mh.prototype.lookupMutationKeys=function(t,e){var n=this.findMutationBatch(e);return Kr(null!=n,"Failed to find local mutation batch."),Uo.resolve(n.keys())},mh.prototype.getNextMutationBatchAfterBatchId=function(t,e){var n=e+1,r=this.indexOfBatchId(n),i=r<0?0:r;return Uo.resolve(this.mutationQueue.length>i?this.mutationQueue[i]:null)},mh.prototype.getHighestUnacknowledgedBatchId=function(){return Uo.resolve(0===this.mutationQueue.length?-1:this.nextBatchId-1)},mh.prototype.getAllMutationBatches=function(t){return Uo.resolve(this.mutationQueue.slice())},mh.prototype.getAllMutationBatchesAffectingDocumentKey=function(t,e){var n=this,r=new hh(e,0),i=new hh(e,Number.POSITIVE_INFINITY),o=[];return this.batchesByDocumentKey.forEachInRange([r,i],(function(t){Kr(e.isEqual(t.key),"Should only iterate over a single key's batches");var r=n.findMutationBatch(t.targetOrBatchId);Kr(null!==r,"Batches in the index must exist in the main table"),o.push(r)})),Uo.resolve(o)},mh.prototype.getAllMutationBatchesAffectingDocumentKeys=function(t,e){var n=this,r=new wo(Si);return e.forEach((function(t){var e=new hh(t,0),i=new hh(t,Number.POSITIVE_INFINITY);n.batchesByDocumentKey.forEachInRange([e,i],(function(e){Kr(t.isEqual(e.key),"For each key, should only iterate over a single key's batches"),r=r.add(e.targetOrBatchId)}))})),Uo.resolve(this.findMutationBatches(r))},mh.prototype.getAllMutationBatchesAffectingQuery=function(t,e){Kr(!e.isCollectionGroupQuery(),"CollectionGroup queries should be handled in LocalDocumentsView");var n=e.path,r=n.length+1,i=n;zi.isDocumentKey(i)||(i=i.child(""));var o=new hh(new zi(i),0),a=new wo(Si);return this.batchesByDocumentKey.forEachWhile((function(t){var e=t.key.path;return!!n.isPrefixOf(e)&&(e.length===r&&(a=a.add(t.targetOrBatchId)),!0)}),o),Uo.resolve(this.findMutationBatches(a))},mh.prototype.findMutationBatches=function(t){var e=this,n=[];return t.forEach((function(t){var r=e.findMutationBatch(t);null!==r&&n.push(r)})),n},mh.prototype.removeMutationBatch=function(t,e){var n=this;Kr(0===this.indexOfExistingBatchId(e.batchId,"removed"),"Can only remove the first entry of the mutation queue"),this.mutationQueue.shift();var r=this.batchesByDocumentKey;return Uo.forEach(e.mutations,(function(i){var o=new hh(i.key,e.batchId);return r=r.delete(o),n.referenceDelegate.removeMutationReference(t,i.key)})).next((function(){n.batchesByDocumentKey=r}))},mh.prototype.removeCachedMutationKeys=function(t){},mh.prototype.containsKey=function(t,e){var n=new hh(e,0),r=this.batchesByDocumentKey.firstAfterOrEqual(n);return Uo.resolve(e.isEqual(r&&r.key))},mh.prototype.performConsistencyCheck=function(t){return 0===this.mutationQueue.length&&Kr(this.batchesByDocumentKey.isEmpty(),"Document leak -- detected dangling mutation references when queue is empty."),Uo.resolve()},mh.prototype.indexOfExistingBatchId=function(t,e){var n=this.indexOfBatchId(t);return Kr(0<=n&&n<this.mutationQueue.length,"Batches must exist to be "+e),n},mh.prototype.indexOfBatchId=function(t){return 0===this.mutationQueue.length?0:t-this.mutationQueue[0].batchId},mh.prototype.findMutationBatch=function(t){var e=this.indexOfBatchId(t);if(e<0||e>=this.mutationQueue.length)return null;var n=this.mutationQueue[e];return Kr(n.batchId===t,"If found batch must match"),n},mh);function mh(t,e){this.indexManager=t,this.referenceDelegate=e,this.mutationQueue=[],this.nextBatchId=1,this.lastStreamToken=Hr(),this.batchesByDocumentKey=new wo(hh.compareByKey)}var yh,gh=(vh.prototype.addEntry=function(t,e,n){Kr(!n.isEqual(co.MIN),"Cannot add a document with a read time of zero");var r=e.key,i=this.docs.get(r),o=i?i.size:0,a=this.sizer(e);return this.docs=this.docs.insert(r,{maybeDocument:e,size:a,readTime:n}),this.size+=a-o,this.indexManager.addToCollectionParentIndex(t,r.path.popLast())},vh.prototype.removeEntry=function(t){var e=this.docs.get(t);e&&(this.docs=this.docs.remove(t),this.size-=e.size)},vh.prototype.getEntry=function(t,e){var n=this.docs.get(e);return Uo.resolve(n?n.maybeDocument:null)},vh.prototype.getEntries=function(t,e){var n=this,r=Co();return e.forEach((function(t){var e=n.docs.get(t);r=r.insert(t,e?e.maybeDocument:null)})),Uo.resolve(r)},vh.prototype.getDocumentsMatchingQuery=function(t,e,n){Kr(!e.isCollectionGroupQuery(),"CollectionGroup queries should be handled in LocalDocumentsView");for(var r=Do(),i=new zi(e.path.child("")),o=this.docs.getIteratorFrom(i);o.hasNext();){var a=o.getNext(),s=a.key,u=a.value,c=u.maybeDocument,h=u.readTime;if(!e.path.isPrefixOf(s.path))break;h.compareTo(n)<=0||c instanceof Fs&&e.matches(c)&&(r=r.insert(c.key,c))}return Uo.resolve(r)},vh.prototype.forEachDocumentKey=function(t,e){return Uo.forEach(this.docs,(function(t){return e(t)}))},vh.prototype.getNewDocumentChanges=function(t,e){throw new Error("getNewDocumentChanges() is not supported with MemoryPersistence")},vh.prototype.newChangeBuffer=function(t){return new vh.RemoteDocumentChangeBuffer(this)},vh.prototype.getSize=function(t){return Uo.resolve(this.size)},vh.RemoteDocumentChangeBuffer=(i(bh,yh=Hs),bh.prototype.applyChanges=function(t){var e=this,n=[];return this.changes.forEach((function(r,i){i?n.push(e.documentCache.addEntry(t,i,e.readTime)):e.documentCache.removeEntry(r)})),Uo.waitFor(n)},bh.prototype.getFromCache=function(t,e){return this.documentCache.getEntry(t,e)},bh.prototype.getAllFromCache=function(t,e){return this.documentCache.getEntries(t,e)},bh),vh);function vh(t,e){this.indexManager=t,this.sizer=e,this.docs=new lo(zi.comparator),this.size=0}function bh(t){var e=yh.call(this)||this;return e.documentCache=t,e}var wh=(Th.prototype.forEachTarget=function(t,e){return this.targets.forEach((function(t,n){return e(n)})),Uo.resolve()},Th.prototype.getLastRemoteSnapshotVersion=function(t){return Uo.resolve(this.lastRemoteSnapshotVersion)},Th.prototype.getHighestSequenceNumber=function(t){return Uo.resolve(this.highestSequenceNumber)},Th.prototype.allocateTargetId=function(t){var e=this.targetIdGenerator.after(this.highestTargetId);return this.highestTargetId=e,Uo.resolve(e)},Th.prototype.setTargetsMetadata=function(t,e,n){return n&&(this.lastRemoteSnapshotVersion=n),e>this.highestSequenceNumber&&(this.highestSequenceNumber=e),Uo.resolve()},Th.prototype.saveTargetData=function(t){this.targets.set(t.target,t);var e=t.targetId;e>this.highestTargetId&&(this.highestTargetId=e),t.sequenceNumber>this.highestSequenceNumber&&(this.highestSequenceNumber=t.sequenceNumber)},Th.prototype.addTargetData=function(t,e){return Kr(!this.targets.has(e.target),"Adding a target that already exists"),this.saveTargetData(e),this.targetCount+=1,Uo.resolve()},Th.prototype.updateTargetData=function(t,e){return Kr(this.targets.has(e.target),"Updating a non-existent target"),this.saveTargetData(e),Uo.resolve()},Th.prototype.removeTargetData=function(t,e){return Kr(0<this.targetCount,"Removing a target from an empty cache"),Kr(this.targets.has(e.target),"Removing a non-existent target from the cache"),this.targets.delete(e.target),this.references.removeReferencesForId(e.targetId),this.targetCount-=1,Uo.resolve()},Th.prototype.removeTargets=function(t,e,n){var r=this,i=0,o=[];return this.targets.forEach((function(a,s){s.sequenceNumber<=e&&null===n.get(s.targetId)&&(r.targets.delete(a),o.push(r.removeMatchingKeysForTargetId(t,s.targetId)),i++)})),Uo.waitFor(o).next((function(){return i}))},Th.prototype.getTargetCount=function(t){return Uo.resolve(this.targetCount)},Th.prototype.getTargetData=function(t,e){var n=this.targets.get(e)||null;return Uo.resolve(n)},Th.prototype.getTargetDataForTarget=function(t,e){return Wr("Not yet implemented.")},Th.prototype.addMatchingKeys=function(t,e,n){this.references.addReferences(e,n);var r=this.persistence.referenceDelegate,i=[];return r&&e.forEach((function(e){i.push(r.addReference(t,e))})),Uo.waitFor(i)},Th.prototype.removeMatchingKeys=function(t,e,n){this.references.removeReferences(e,n);var r=this.persistence.referenceDelegate,i=[];return r&&e.forEach((function(e){i.push(r.removeReference(t,e))})),Uo.waitFor(i)},Th.prototype.removeMatchingKeysForTargetId=function(t,e){return this.references.removeReferencesForId(e),Uo.resolve()},Th.prototype.getMatchingKeysForTargetId=function(t,e){var n=this.references.referencesForId(e);return Uo.resolve(n)},Th.prototype.containsKey=function(t,e){return Uo.resolve(this.references.containsKey(e))},Th);function Th(t){this.persistence=t,this.targets=new Qs((function(t){return t.canonicalId()})),this.lastRemoteSnapshotVersion=co.MIN,this.highestTargetId=0,this.highestSequenceNumber=0,this.references=new uh,this.targetCount=0,this.targetIdGenerator=ca.forTargetCache()}var _h=(Eh.createLruPersistence=function(t,e,n){return new Eh(t,(function(t){return new Ah(t,new Ku(e),n)}))},Eh.createEagerPersistence=function(t){return new Eh(t,(function(t){return new Nh(t)}))},Eh.prototype.shutdown=function(){return this._started=!1,Promise.resolve()},Object.defineProperty(Eh.prototype,"started",{get:function(){return this._started},enumerable:!0,configurable:!0}),Eh.prototype.getActiveClients=function(){return u(this,void 0,void 0,(function(){return c(this,(function(t){return[2,[this.clientId]]}))}))},Eh.prototype.setPrimaryStateListener=function(t){return t(!0)},Eh.prototype.setDatabaseDeletedListener=function(){},Eh.prototype.setNetworkEnabled=function(t){},Eh.prototype.getIndexManager=function(){return this.indexManager},Eh.prototype.getMutationQueue=function(t){var e=this.mutationQueues[t.toKey()];return e||(e=new dh(this.indexManager,this.referenceDelegate),this.mutationQueues[t.toKey()]=e),e},Eh.prototype.getTargetCache=function(){return this.targetCache},Eh.prototype.getRemoteDocumentCache=function(){return this.remoteDocumentCache},Eh.prototype.runTransaction=function(t,e,n){var r=this;qr("MemoryPersistence","Starting transaction:",t);var i=new Ih(this.listenSequence.next());return this.referenceDelegate.onTransactionStarted(),n(i).next((function(t){return r.referenceDelegate.onTransactionCommitted(i).next((function(){return t}))})).toPromise().then((function(t){return i.raiseOnCommittedEvent(),t}))},Eh.prototype.mutationQueuesContainKey=function(t,e){return Uo.or(function(t){var e=[];return ni(t,(function(t,n){return e.push(n)})),e}(this.mutationQueues).map((function(n){return function(){return n.containsKey(t,e)}})))},Eh);function Eh(t,e){var n=this;this.clientId=t,this.mutationQueues={},this.listenSequence=new xi(0),this._started=!1,this._started=!0,this.referenceDelegate=e(this),this.targetCache=new wh(this),this.indexManager=new ru,this.remoteDocumentCache=new gh(this.indexManager,(function(t){return n.referenceDelegate.documentSize(t)}))}var Sh,Ih=(i(Ch,Sh=nc),Ch);function Ch(t){var e=Sh.call(this)||this;return e.currentSequenceNumber=t,e}var Nh=(Object.defineProperty(Dh.prototype,"orphanedDocuments",{get:function(){if(this._orphanedDocuments)return this._orphanedDocuments;throw Wr("orphanedDocuments is only valid during a transaction.")},enumerable:!0,configurable:!0}),Dh.prototype.setInMemoryPins=function(t){this.inMemoryPins=t},Dh.prototype.addReference=function(t,e){return this.orphanedDocuments.delete(e),Uo.resolve()},Dh.prototype.removeReference=function(t,e){return this.orphanedDocuments.add(e),Uo.resolve()},Dh.prototype.removeMutationReference=function(t,e){return this.orphanedDocuments.add(e),Uo.resolve()},Dh.prototype.removeTarget=function(t,e){var n=this,r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(t,e.targetId).next((function(t){t.forEach((function(t){return n.orphanedDocuments.add(t)}))})).next((function(){return r.removeTargetData(t,e)}))},Dh.prototype.onTransactionStarted=function(){this._orphanedDocuments=new Set},Dh.prototype.onTransactionCommitted=function(t){var e=this,n=this.persistence.getRemoteDocumentCache().newChangeBuffer();return Uo.forEach(this.orphanedDocuments,(function(r){return e.isReferenced(t,r).next((function(t){t||n.removeEntry(r)}))})).next((function(){return e._orphanedDocuments=null,n.apply(t)}))},Dh.prototype.updateLimboDocument=function(t,e){var n=this;return this.isReferenced(t,e).next((function(t){t?n.orphanedDocuments.delete(e):n.orphanedDocuments.add(e)}))},Dh.prototype.documentSize=function(t){return 0},Dh.prototype.isReferenced=function(t,e){var n=this;return Uo.or([function(){return n.persistence.getTargetCache().containsKey(t,e)},function(){return n.persistence.mutationQueuesContainKey(t,e)},function(){return Uo.resolve(n.inMemoryPins.containsKey(e))}])},Dh);function Dh(t){this.persistence=t,this.inMemoryPins=null,this._orphanedDocuments=null}var Ah=(Oh.prototype.onTransactionStarted=function(){},Oh.prototype.onTransactionCommitted=function(t){return Uo.resolve()},Oh.prototype.forEachTarget=function(t,e){return this.persistence.getTargetCache().forEachTarget(t,e)},Oh.prototype.getSequenceNumberCount=function(t){var e=this.orphanedDocumentCount(t);return this.persistence.getTargetCache().getTargetCount(t).next((function(t){return e.next((function(e){return t+e}))}))},Oh.prototype.orphanedDocumentCount=function(t){var e=0;return this.forEachOrphanedDocumentSequenceNumber(t,(function(t){e++})).next((function(){return e}))},Oh.prototype.forEachOrphanedDocumentSequenceNumber=function(t,e){var n=this;return Uo.forEach(this.orphanedSequenceNumbers,(function(r,i){return n.isPinned(t,r,i).next((function(t){return t?Uo.resolve():e(i)}))}))},Oh.prototype.setInMemoryPins=function(t){this.inMemoryPins=t},Oh.prototype.removeTargets=function(t,e,n){return this.persistence.getTargetCache().removeTargets(t,e,n)},Oh.prototype.removeOrphanedDocuments=function(t,e){var n=this,r=0,i=this.persistence.getRemoteDocumentCache(),o=i.newChangeBuffer();return i.forEachDocumentKey(t,(function(i){return n.isPinned(t,i,e).next((function(t){t||(r++,o.removeEntry(i))}))})).next((function(){return o.apply(t)})).next((function(){return r}))},Oh.prototype.removeMutationReference=function(t,e){return this.orphanedSequenceNumbers.set(e,t.currentSequenceNumber),Uo.resolve()},Oh.prototype.removeTarget=function(t,e){var n=e.withSequenceNumber(t.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(t,n)},Oh.prototype.addReference=function(t,e){return this.orphanedSequenceNumbers.set(e,t.currentSequenceNumber),Uo.resolve()},Oh.prototype.removeReference=function(t,e){return this.orphanedSequenceNumbers.set(e,t.currentSequenceNumber),Uo.resolve()},Oh.prototype.updateLimboDocument=function(t,e){return this.orphanedSequenceNumbers.set(e,t.currentSequenceNumber),Uo.resolve()},Oh.prototype.documentSize=function(t){var e,n=this.serializer.toDbRemoteDocument(t,t.version);if(n.document)e=n.document;else if(n.unknownDocument)e=n.unknownDocument;else{if(!n.noDocument)throw Wr("Unknown remote document type");e=n.noDocument}return JSON.stringify(e).length},Oh.prototype.isPinned=function(t,e,n){var r=this;return Uo.or([function(){return r.persistence.mutationQueuesContainKey(t,e)},function(){return Uo.resolve(r.inMemoryPins.containsKey(e))},function(){return r.persistence.getTargetCache().containsKey(t,e)},function(){var t=r.orphanedSequenceNumbers.get(e);return Uo.resolve(void 0!==t&&n<t)}])},Oh.prototype.getCacheSize=function(t){return this.persistence.getRemoteDocumentCache().getSize(t)},Oh);function Oh(t,e,n){this.persistence=t,this.serializer=e,this.inMemoryPins=null,this.orphanedSequenceNumbers=new Qs((function(t){return ro(t.path)})),this.garbageCollector=new tc(this,n)}var kh=(Rh.prototype.reset=function(){this.currentBaseMs=0},Rh.prototype.resetToMax=function(){this.currentBaseMs=this.maxDelayMs},Rh.prototype.backoffAndRun=function(t){var e=this;this.cancel();var n=Math.floor(this.currentBaseMs+this.jitterDelayMs()),r=Math.max(0,Date.now()-this.lastAttemptTime),i=Math.max(0,n-r);0<this.currentBaseMs&&qr("ExponentialBackoff","Backing off for "+i+" ms (base delay: "+this.currentBaseMs+" ms, delay with jitter: "+n+" ms, last attempt: "+r+" ms ago)"),this.timerPromise=this.queue.enqueueAfterDelay(this.timerId,i,(function(){return e.lastAttemptTime=Date.now(),t()})),this.currentBaseMs*=this.backoffFactor,this.currentBaseMs<this.initialDelayMs&&(this.currentBaseMs=this.initialDelayMs),this.currentBaseMs>this.maxDelayMs&&(this.currentBaseMs=this.maxDelayMs)},Rh.prototype.cancel=function(){null!==this.timerPromise&&(this.timerPromise.cancel(),this.timerPromise=null)},Rh.prototype.jitterDelayMs=function(){return(Math.random()-.5)*this.currentBaseMs},Rh);function Rh(t,e,n,r,i){void 0===n&&(n=1e3),void 0===r&&(r=1.5),void 0===i&&(i=6e4),this.queue=t,this.timerId=e,this.initialDelayMs=n,this.backoffFactor=r,this.maxDelayMs=i,this.currentBaseMs=0,this.timerPromise=null,this.lastAttemptTime=Date.now(),this.reset()}var Ph,Mh,Lh="PersistentStream";(Mh=Ph=Ph||{})[Mh.Initial=0]="Initial",Mh[Mh.Starting=1]="Starting",Mh[Mh.Open=2]="Open",Mh[Mh.Error=3]="Error",Mh[Mh.Backoff=4]="Backoff";var xh=(Fh.prototype.isStarted=function(){return this.state===Ph.Starting||this.state===Ph.Open||this.state===Ph.Backoff},Fh.prototype.isOpen=function(){return this.state===Ph.Open},Fh.prototype.start=function(){this.state!==Ph.Error?(Kr(this.state===Ph.Initial,"Already started"),this.auth()):this.performBackoff()},Fh.prototype.stop=function(){return u(this,void 0,void 0,(function(){return c(this,(function(t){switch(t.label){case 0:return this.isStarted()?[4,this.close(Ph.Initial)]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}}))}))},Fh.prototype.inhibitBackoff=function(){Kr(!this.isStarted(),"Can only inhibit backoff in a stopped state"),this.state=Ph.Initial,this.backoff.reset()},Fh.prototype.markIdle=function(){var t=this;this.isOpen()&&null===this.idleTimer&&(this.idleTimer=this.queue.enqueueAfterDelay(this.idleTimerId,6e4,(function(){return t.handleIdleCloseTimer()})))},Fh.prototype.sendRequest=function(t){this.cancelIdleCheck(),this.stream.send(t)},Fh.prototype.handleIdleCloseTimer=function(){return u(this,void 0,void 0,(function(){return c(this,(function(t){return this.isOpen()?[2,this.close(Ph.Initial)]:[2]}))}))},Fh.prototype.cancelIdleCheck=function(){this.idleTimer&&(this.idleTimer.cancel(),this.idleTimer=null)},Fh.prototype.close=function(t,e){return u(this,void 0,void 0,(function(){return c(this,(function(n){switch(n.label){case 0:return Kr(this.isStarted(),"Only started streams should be closed."),Kr(t===Ph.Error||_c(e),"Can't provide an error when not in an error state."),this.cancelIdleCheck(),this.backoff.cancel(),this.closeCount++,t!==Ph.Error?this.backoff.reset():e&&e.code===Yr.RESOURCE_EXHAUSTED?(Vr(e.toString()),Vr("Using maximum backoff delay to prevent overloading the backend."),this.backoff.resetToMax()):e&&e.code===Yr.UNAUTHENTICATED&&this.credentialsProvider.invalidateToken(),null!==this.stream&&(this.tearDown(),this.stream.close(),this.stream=null),this.state=t,[4,this.listener.onClose(e)];case 1:return n.sent(),[2]}}))}))},Fh.prototype.tearDown=function(){},Fh.prototype.auth=function(){var t=this;Kr(this.state===Ph.Initial,"Must be in initial state to auth"),this.state=Ph.Starting;var e=this.getCloseGuardedDispatcher(this.closeCount),n=this.closeCount;this.credentialsProvider.getToken().then((function(e){t.closeCount===n&&t.startStream(e)}),(function(n){e((function(){var e=new Xr(Yr.UNKNOWN,"Fetching auth token failed: "+n.message);return t.handleStreamClose(e)}))}))},Fh.prototype.startStream=function(t){var e=this;Kr(this.state===Ph.Starting,"Trying to start stream in a non-starting state");var n=this.getCloseGuardedDispatcher(this.closeCount);this.stream=this.startRpc(t),this.stream.onOpen((function(){n((function(){return Kr(e.state===Ph.Starting,"Expected stream to be in state Starting, but was "+e.state),e.state=Ph.Open,e.listener.onOpen()}))})),this.stream.onClose((function(t){n((function(){return e.handleStreamClose(t)}))})),this.stream.onMessage((function(t){n((function(){return e.onMessage(t)}))}))},Fh.prototype.performBackoff=function(){var t=this;Kr(this.state===Ph.Error,"Should only perform backoff when in Error state"),this.state=Ph.Backoff,this.backoff.backoffAndRun((function(){return u(t,void 0,void 0,(function(){return c(this,(function(t){return Kr(this.state===Ph.Backoff,"Backoff elapsed but state is now: "+this.state),this.state=Ph.Initial,this.start(),Kr(this.isStarted(),"PersistentStream should have started"),[2]}))}))}))},Fh.prototype.handleStreamClose=function(t){return Kr(this.isStarted(),"Can't handle server close on non-started stream"),qr(Lh,"close with error: "+t),this.stream=null,this.close(Ph.Error,t)},Fh.prototype.getCloseGuardedDispatcher=function(t){var e=this;return function(n){e.queue.enqueueAndForget((function(){return e.closeCount===t?n():(qr(Lh,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())}))}},Fh);function Fh(t,e,n,r,i,o){this.queue=t,this.idleTimerId=n,this.connection=r,this.credentialsProvider=i,this.listener=o,this.state=Ph.Initial,this.closeCount=0,this.idleTimer=null,this.stream=null,this.backoff=new kh(t,e)}var jh,Uh=(i(qh,jh=xh),qh.prototype.startRpc=function(t){return this.connection.openStream("Listen",t)},qh.prototype.onMessage=function(t){this.backoff.reset();var e=this.serializer.fromWatchChange(t),n=this.serializer.versionFromListenResponse(t);return this.listener.onWatchChange(e,n)},qh.prototype.watch=function(t){var e={};e.database=this.serializer.encodedDatabaseId,e.addTarget=this.serializer.toTarget(t);var n=this.serializer.toListenRequestLabels(t);n&&(e.labels=n),this.sendRequest(e)},qh.prototype.unwatch=function(t){var e={};e.database=this.serializer.encodedDatabaseId,e.removeTarget=t,this.sendRequest(e)},qh);function qh(t,e,n,r,i){var o=jh.call(this,t,Xi.ListenStreamConnectionBackoff,Xi.ListenStreamIdle,e,n,i)||this;return o.serializer=r,o}var Vh,Bh=(i(Wh,Vh=xh),Object.defineProperty(Wh.prototype,"handshakeComplete",{get:function(){return this.handshakeComplete_},enumerable:!0,configurable:!0}),Wh.prototype.start=function(){this.handshakeComplete_=!1,Vh.prototype.start.call(this)},Wh.prototype.tearDown=function(){this.handshakeComplete_&&this.writeMutations([])},Wh.prototype.startRpc=function(t){return this.connection.openStream("Write",t)},Wh.prototype.onMessage=function(t){if(Kr(!!t.streamToken,"Got a write response without a stream token"),this.lastStreamToken=t.streamToken,this.handshakeComplete_){this.backoff.reset();var e=this.serializer.fromWriteResults(t.writeResults,t.commitTime),n=this.serializer.fromVersion(t.commitTime);return this.listener.onMutationResult(n,e)}return Kr(!t.writeResults||0===t.writeResults.length,"Got mutation results for handshake"),this.handshakeComplete_=!0,this.listener.onHandshakeComplete()},Wh.prototype.writeHandshake=function(){Kr(this.isOpen(),"Writing handshake requires an opened stream"),Kr(!this.handshakeComplete_,"Handshake already completed");var t={};t.database=this.serializer.encodedDatabaseId,this.sendRequest(t)},Wh.prototype.writeMutations=function(t){var e=this;Kr(this.isOpen(),"Writing mutations requires an opened stream"),Kr(this.handshakeComplete_,"Handshake must be complete before writing mutations"),Kr(0<this.lastStreamToken.length,"Trying to write mutation without a token");var n={streamToken:this.lastStreamToken,writes:t.map((function(t){return e.serializer.toMutation(t)}))};this.sendRequest(n)},Wh);function Wh(t,e,n,r,i){var o=Vh.call(this,t,Xi.WriteStreamConnectionBackoff,Xi.WriteStreamIdle,e,n,i)||this;return o.serializer=r,o.handshakeComplete_=!1,o.lastStreamToken=Hr(),o}var Kh=(Qh.prototype.newPersistentWriteStream=function(t){return new Bh(this.queue,this.connection,this.credentials,this.serializer,t)},Qh.prototype.newPersistentWatchStream=function(t){return new Uh(this.queue,this.connection,this.credentials,this.serializer,t)},Qh.prototype.commit=function(t){var e=this,n={database:this.serializer.encodedDatabaseId,writes:t.map((function(t){return e.serializer.toMutation(t)}))};return this.invokeRPC("Commit",n).then((function(t){return e.serializer.fromWriteResults(t.writeResults,t.commitTime)}))},Qh.prototype.lookup=function(t){var e=this,n={database:this.serializer.encodedDatabaseId,documents:t.map((function(t){return e.serializer.toName(t)}))};return this.invokeStreamingRPC("BatchGetDocuments",n).then((function(n){var r=Io();n.forEach((function(t){var n=e.serializer.fromMaybeDocument(t);r=r.insert(n.key,n)}));var i=[];return t.forEach((function(t){var e=r.get(t);Kr(!!e,"Missing entity in write response for "+t),i.push(e)})),i}))},Qh.prototype.invokeRPC=function(t,e){var n=this;return this.credentials.getToken().then((function(r){return n.connection.invokeRPC(t,e,r)})).catch((function(t){throw t.code===Yr.UNAUTHENTICATED&&n.credentials.invalidateToken(),t}))},Qh.prototype.invokeStreamingRPC=function(t,e){var n=this;return this.credentials.getToken().then((function(r){return n.connection.invokeStreamingRPC(t,e,r)})).catch((function(t){throw t.code===Yr.UNAUTHENTICATED&&n.credentials.invalidateToken(),t}))},Qh);function Qh(t,e,n,r){this.queue=t,this.connection=e,this.credentials=n,this.serializer=r}var Gh,Hh,zh,Yh,Xh=(Jh.prototype.lookup=function(t){return u(this,void 0,void 0,(function(){var e,n=this;return c(this,(function(r){switch(r.label){case 0:if(this.ensureCommitNotCalled(),0<this.mutations.length)throw new Xr(Yr.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes.");return[4,this.datastore.lookup(t)];case 1:return(e=r.sent()).forEach((function(t){t instanceof qs||t instanceof Fs?n.recordVersion(t):Wr("Document in a transaction was a "+t.constructor.name)})),[2,e]}}))}))},Jh.prototype.set=function(t,e){this.write(e.toMutations(t,this.precondition(t))),this.writtenDocs.add(t)},Jh.prototype.update=function(t,e){try{this.write(e.toMutations(t,this.preconditionForUpdate(t)))}catch(t){this.lastWriteError=t}this.writtenDocs.add(t)},Jh.prototype.delete=function(t){this.write([new Ba(t,this.precondition(t))]),this.writtenDocs.add(t)},Jh.prototype.commit=function(){return u(this,void 0,void 0,(function(){var t;return c(this,(function(e){switch(e.label){case 0:if(this.ensureCommitNotCalled(),this.lastWriteError)throw this.lastWriteError;if(t=this.readVersions,this.mutations.forEach((function(e){t=t.remove(e.key)})),!t.isEmpty())throw new Xr(Yr.INVALID_ARGUMENT,"Every document read in a transaction must also be written.");return[4,this.datastore.commit(this.mutations)];case 1:return e.sent(),this.committed=!0,[2]}}))}))},Jh.prototype.recordVersion=function(t){var e;if(t instanceof Fs)e=t.version;else{if(!(t instanceof qs))throw Wr("Document in a transaction was a "+t.constructor.name);e=co.forDeletedDoc()}var n=this.readVersions.get(t.key);if(null!==n){if(!e.isEqual(n))throw new Xr(Yr.ABORTED,"Document version changed between two reads.")}else this.readVersions=this.readVersions.insert(t.key,e)},Jh.prototype.precondition=function(t){var e=this.readVersions.get(t);return!this.writtenDocs.has(t)&&e?Sa.updateTime(e):Sa.NONE},Jh.prototype.preconditionForUpdate=function(t){var e=this.readVersions.get(t);if(this.writtenDocs.has(t)||!e)return Sa.exists(!0);if(e.isEqual(co.forDeletedDoc()))throw new Xr(Yr.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return Sa.updateTime(e)},Jh.prototype.write=function(t){this.ensureCommitNotCalled(),this.mutations=this.mutations.concat(t)},Jh.prototype.ensureCommitNotCalled=function(){Kr(!this.committed,"A transaction object cannot be used after its update callback has been invoked.")},Jh);function Jh(t){this.datastore=t,this.readVersions=Oo(),this.mutations=[],this.committed=!1,this.lastWriteError=null,this.writtenDocs=new Set}(Hh=Gh=Gh||{})[Hh.Unknown=0]="Unknown",Hh[Hh.Online=1]="Online",Hh[Hh.Offline=2]="Offline",(Yh=zh=zh||{})[Yh.RemoteStore=0]="RemoteStore",Yh[Yh.SharedClientState=1]="SharedClientState";var $h,Zh,tl=(el.prototype.handleWatchStreamStart=function(){var t=this;0===this.watchStreamFailures&&(this.setAndBroadcast(Gh.Unknown),Kr(null===this.onlineStateTimer,"onlineStateTimer shouldn't be started yet"),this.onlineStateTimer=this.asyncQueue.enqueueAfterDelay(Xi.OnlineStateTimeout,1e4,(function(){return t.onlineStateTimer=null,Kr(t.state===Gh.Unknown,"Timer should be canceled if we transitioned to a different state."),t.logClientOfflineWarningIfNecessary("Backend didn't respond within 10 seconds."),t.setAndBroadcast(Gh.Offline),Promise.resolve()})))},el.prototype.handleWatchStreamFailure=function(t){this.state===Gh.Online?(this.setAndBroadcast(Gh.Unknown),Kr(0===this.watchStreamFailures,"watchStreamFailures must be 0"),Kr(null===this.onlineStateTimer,"onlineStateTimer must be null")):(this.watchStreamFailures++,1<=this.watchStreamFailures&&(this.clearOnlineStateTimer(),this.logClientOfflineWarningIfNecessary("Connection failed 1 times. Most recent error: "+t.toString()),this.setAndBroadcast(Gh.Offline)))},el.prototype.set=function(t){this.clearOnlineStateTimer(),this.watchStreamFailures=0,t===Gh.Online&&(this.shouldWarnClientIsOffline=!1),this.setAndBroadcast(t)},el.prototype.setAndBroadcast=function(t){t!==this.state&&(this.state=t,this.onlineStateHandler(t))},el.prototype.logClientOfflineWarningIfNecessary=function(t){var e="Could not reach Cloud Firestore backend. "+t+"\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.";this.shouldWarnClientIsOffline?(Vr(e),this.shouldWarnClientIsOffline=!1):qr("OnlineStateTracker",e)},el.prototype.clearOnlineStateTimer=function(){null!==this.onlineStateTimer&&(this.onlineStateTimer.cancel(),this.onlineStateTimer=null)},el);function el(t,e){this.asyncQueue=t,this.onlineStateHandler=e,this.state=Gh.Unknown,this.watchStreamFailures=0,this.onlineStateTimer=null,this.shouldWarnClientIsOffline=!0}function nl(t){switch(t){case Yr.OK:return Wr("Treated status OK as error");case Yr.CANCELLED:case Yr.UNKNOWN:case Yr.DEADLINE_EXCEEDED:case Yr.RESOURCE_EXHAUSTED:case Yr.INTERNAL:case Yr.UNAVAILABLE:case Yr.UNAUTHENTICATED:return!1;case Yr.INVALID_ARGUMENT:case Yr.NOT_FOUND:case Yr.ALREADY_EXISTS:case Yr.PERMISSION_DENIED:case Yr.FAILED_PRECONDITION:case Yr.ABORTED:case Yr.OUT_OF_RANGE:case Yr.UNIMPLEMENTED:case Yr.DATA_LOSS:return!0;default:return Wr("Unknown status code: "+t)}}function rl(t){if(void 0===t)return Vr("GRPC error has no .code"),Yr.UNKNOWN;switch(t){case $h.OK:return Yr.OK;case $h.CANCELLED:return Yr.CANCELLED;case $h.UNKNOWN:return Yr.UNKNOWN;case $h.DEADLINE_EXCEEDED:return Yr.DEADLINE_EXCEEDED;case $h.RESOURCE_EXHAUSTED:return Yr.RESOURCE_EXHAUSTED;case $h.INTERNAL:return Yr.INTERNAL;case $h.UNAVAILABLE:return Yr.UNAVAILABLE;case $h.UNAUTHENTICATED:return Yr.UNAUTHENTICATED;case $h.INVALID_ARGUMENT:return Yr.INVALID_ARGUMENT;case $h.NOT_FOUND:return Yr.NOT_FOUND;case $h.ALREADY_EXISTS:return Yr.ALREADY_EXISTS;case $h.PERMISSION_DENIED:return Yr.PERMISSION_DENIED;case $h.FAILED_PRECONDITION:return Yr.FAILED_PRECONDITION;case $h.ABORTED:return Yr.ABORTED;case $h.OUT_OF_RANGE:return Yr.OUT_OF_RANGE;case $h.UNIMPLEMENTED:return Yr.UNIMPLEMENTED;case $h.DATA_LOSS:return Yr.DATA_LOSS;default:return Wr("Unknown status code: "+t)}}(Zh=$h=$h||{})[Zh.OK=0]="OK",Zh[Zh.CANCELLED=1]="CANCELLED",Zh[Zh.UNKNOWN=2]="UNKNOWN",Zh[Zh.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",Zh[Zh.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",Zh[Zh.NOT_FOUND=5]="NOT_FOUND",Zh[Zh.ALREADY_EXISTS=6]="ALREADY_EXISTS",Zh[Zh.PERMISSION_DENIED=7]="PERMISSION_DENIED",Zh[Zh.UNAUTHENTICATED=16]="UNAUTHENTICATED",Zh[Zh.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",Zh[Zh.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",Zh[Zh.ABORTED=10]="ABORTED",Zh[Zh.OUT_OF_RANGE=11]="OUT_OF_RANGE",Zh[Zh.UNIMPLEMENTED=12]="UNIMPLEMENTED",Zh[Zh.INTERNAL=13]="INTERNAL",Zh[Zh.UNAVAILABLE=14]="UNAVAILABLE",Zh[Zh.DATA_LOSS=15]="DATA_LOSS";var il,ol,al,sl,ul=(cl.emptySet=function(t){return new cl(t.comparator)},cl.prototype.has=function(t){return null!=this.keyedMap.get(t)},cl.prototype.get=function(t){return this.keyedMap.get(t)},cl.prototype.first=function(){return this.sortedSet.minKey()},cl.prototype.last=function(){return this.sortedSet.maxKey()},cl.prototype.isEmpty=function(){return this.sortedSet.isEmpty()},cl.prototype.indexOf=function(t){var e=this.keyedMap.get(t);return e?this.sortedSet.indexOf(e):-1},Object.defineProperty(cl.prototype,"size",{get:function(){return this.sortedSet.size},enumerable:!0,configurable:!0}),cl.prototype.forEach=function(t){this.sortedSet.inorderTraversal((function(e,n){return t(e),!1}))},cl.prototype.add=function(t){var e=this.delete(t.key);return e.copy(e.keyedMap.insert(t.key,t),e.sortedSet.insert(t,null))},cl.prototype.delete=function(t){var e=this.get(t);return e?this.copy(this.keyedMap.remove(t),this.sortedSet.remove(e)):this},cl.prototype.isEqual=function(t){if(!(t instanceof cl))return!1;if(this.size!==t.size)return!1;for(var e=this.sortedSet.getIterator(),n=t.sortedSet.getIterator();e.hasNext();){var r=e.getNext().key,i=n.getNext().key;if(!r.isEqual(i))return!1}return!0},cl.prototype.toString=function(){var t=[];return this.forEach((function(e){t.push(e.toString())})),0===t.length?"DocumentSet ()":"DocumentSet (\n  "+t.join("  \n")+"\n)"},cl.prototype.copy=function(t,e){var n=new cl;return n.comparator=this.comparator,n.keyedMap=t,n.sortedSet=e,n},cl);function cl(t){this.comparator=t?function(e,n){return t(e,n)||zi.comparator(e.key,n.key)}:function(t,e){return zi.comparator(t.key,e.key)},this.keyedMap=Do(),this.sortedSet=new lo(this.comparator)}(ol=il=il||{})[ol.Added=0]="Added",ol[ol.Removed=1]="Removed",ol[ol.Modified=2]="Modified",ol[ol.Metadata=3]="Metadata",(sl=al=al||{})[sl.Local=0]="Local",sl[sl.Synced=1]="Synced";var hl=(ll.prototype.track=function(t){var e=t.doc.key,n=this.changeMap.get(e);n?t.type!==il.Added&&n.type===il.Metadata?this.changeMap=this.changeMap.insert(e,t):t.type===il.Metadata&&n.type!==il.Removed?this.changeMap=this.changeMap.insert(e,{type:n.type,doc:t.doc}):t.type===il.Modified&&n.type===il.Modified?this.changeMap=this.changeMap.insert(e,{type:il.Modified,doc:t.doc}):t.type===il.Modified&&n.type===il.Added?this.changeMap=this.changeMap.insert(e,{type:il.Added,doc:t.doc}):t.type===il.Removed&&n.type===il.Added?this.changeMap=this.changeMap.remove(e):t.type===il.Removed&&n.type===il.Modified?this.changeMap=this.changeMap.insert(e,{type:il.Removed,doc:n.doc}):t.type===il.Added&&n.type===il.Removed?this.changeMap=this.changeMap.insert(e,{type:il.Modified,doc:t.doc}):Wr("unsupported combination of changes: "+JSON.stringify(t)+" after "+JSON.stringify(n)):this.changeMap=this.changeMap.insert(e,t)},ll.prototype.getChanges=function(){var t=[];return this.changeMap.inorderTraversal((function(e,n){t.push(n)})),t},ll);function ll(){this.changeMap=new lo(zi.comparator)}var fl=(pl.fromInitialDocuments=function(t,e,n,r){var i=[];return e.forEach((function(t){i.push({type:il.Added,doc:t})})),new pl(t,e,ul.emptySet(e),i,n,r,!0,!1)},Object.defineProperty(pl.prototype,"hasPendingWrites",{get:function(){return!this.mutatedKeys.isEmpty()},enumerable:!0,configurable:!0}),pl.prototype.isEqual=function(t){if(!(this.fromCache===t.fromCache&&this.syncStateChanged===t.syncStateChanged&&this.mutatedKeys.isEqual(t.mutatedKeys)&&this.query.isEqual(t.query)&&this.docs.isEqual(t.docs)&&this.oldDocs.isEqual(t.oldDocs)))return!1;var e=this.docChanges,n=t.docChanges;if(e.length!==n.length)return!1;for(var r=0;r<e.length;r++)if(e[r].type!==n[r].type||!e[r].doc.isEqual(n[r].doc))return!1;return!0},pl);function pl(t,e,n,r,i,o,a,s){this.query=t,this.docs=e,this.oldDocs=n,this.docChanges=r,this.mutatedKeys=i,this.fromCache=o,this.syncStateChanged=a,this.excludesMetadataChanges=s}var dl=(ml.createSynthesizedRemoteEventForCurrentChange=function(t,e){var n,r=((n={})[t]=yl.createSynthesizedTargetChangeForCurrentChange(t,e),n);return new ml(co.MIN,r,Mo(),Io(),Ro())},ml);function ml(t,e,n,r,i){this.snapshotVersion=t,this.targetChanges=e,this.targetMismatches=n,this.documentUpdates=r,this.resolvedLimboDocuments=i}var yl=(gl.createSynthesizedTargetChangeForCurrentChange=function(t,e){return new gl(Hr(),e,Ro(),Ro(),Ro())},gl);function gl(t,e,n,r,i){this.resumeToken=t,this.current=e,this.addedDocuments=n,this.modifiedDocuments=r,this.removedDocuments=i}var vl,bl,wl=function(t,e,n,r){this.updatedTargetIds=t,this.removedTargetIds=e,this.key=n,this.newDoc=r},Tl=function(t,e){this.targetId=t,this.existenceFilter=e};(bl=vl=vl||{})[bl.NoChange=0]="NoChange",bl[bl.Added=1]="Added",bl[bl.Removed=2]="Removed",bl[bl.Current=3]="Current",bl[bl.Reset=4]="Reset";var _l=function(t,e,n,r){void 0===n&&(n=Hr()),void 0===r&&(r=null),this.state=t,this.targetIds=e,this.resumeToken=n,this.cause=r},El=(Object.defineProperty(Sl.prototype,"current",{get:function(){return this._current},enumerable:!0,configurable:!0}),Object.defineProperty(Sl.prototype,"resumeToken",{get:function(){return this._resumeToken},enumerable:!0,configurable:!0}),Object.defineProperty(Sl.prototype,"isPending",{get:function(){return 0!==this.pendingResponses},enumerable:!0,configurable:!0}),Object.defineProperty(Sl.prototype,"hasPendingChanges",{get:function(){return this._hasPendingChanges},enumerable:!0,configurable:!0}),Sl.prototype.updateResumeToken=function(t){0<t.length&&(this._hasPendingChanges=!0,this._resumeToken=t)},Sl.prototype.toTargetChange=function(){var t=Ro(),e=Ro(),n=Ro();return this.documentChanges.forEach((function(r,i){switch(i){case il.Added:t=t.add(r);break;case il.Modified:e=e.add(r);break;case il.Removed:n=n.add(r);break;default:Wr("Encountered invalid change type: "+i)}})),new yl(this._resumeToken,this._current,t,e,n)},Sl.prototype.clearPendingChanges=function(){this._hasPendingChanges=!1,this.documentChanges=Dl()},Sl.prototype.addDocumentChange=function(t,e){this._hasPendingChanges=!0,this.documentChanges=this.documentChanges.insert(t,e)},Sl.prototype.removeDocumentChange=function(t){this._hasPendingChanges=!0,this.documentChanges=this.documentChanges.remove(t)},Sl.prototype.recordPendingTargetRequest=function(){this.pendingResponses+=1},Sl.prototype.recordTargetResponse=function(){this.pendingResponses-=1},Sl.prototype.markCurrent=function(){this._hasPendingChanges=!0,this._current=!0},Sl);function Sl(){this.pendingResponses=0,this.documentChanges=Dl(),this._resumeToken=Hr(),this._current=!1,this._hasPendingChanges=!0}var Il=(Cl.prototype.handleDocumentChange=function(t){for(var e=0,n=t.updatedTargetIds;e<n.length;e++){var r=n[e];t.newDoc instanceof Fs?this.addDocumentToTarget(r,t.newDoc):t.newDoc instanceof qs&&this.removeDocumentFromTarget(r,t.key,t.newDoc)}for(var i=0,o=t.removedTargetIds;i<o.length;i++)r=o[i],this.removeDocumentFromTarget(r,t.key,t.newDoc)},Cl.prototype.handleTargetChange=function(t){var e=this;this.forEachTarget(t,(function(n){var r=e.ensureTargetState(n);switch(t.state){case vl.NoChange:e.isActiveTarget(n)&&r.updateResumeToken(t.resumeToken);break;case vl.Added:r.recordTargetResponse(),r.isPending||r.clearPendingChanges(),r.updateResumeToken(t.resumeToken);break;case vl.Removed:r.recordTargetResponse(),r.isPending||e.removeTarget(n),Kr(!t.cause,"WatchChangeAggregator does not handle errored targets");break;case vl.Current:e.isActiveTarget(n)&&(r.markCurrent(),r.updateResumeToken(t.resumeToken));break;case vl.Reset:e.isActiveTarget(n)&&(e.resetTarget(n),r.updateResumeToken(t.resumeToken));break;default:Wr("Unknown target watch change state: "+t.state)}}))},Cl.prototype.forEachTarget=function(t,e){0<t.targetIds.length?t.targetIds.forEach(e):ei(this.targetStates,e)},Cl.prototype.handleExistenceFilter=function(t){var e=t.targetId,n=t.existenceFilter.count,r=this.targetDataForActiveTarget(e);if(r){var i=r.target;if(i.isDocumentQuery())if(0===n){var o=new zi(i.path);this.removeDocumentFromTarget(e,o,new qs(o,co.forDeletedDoc()))}else Kr(1===n,"Single document existence filter with count: "+n);else this.getCurrentDocumentCountForTarget(e)!==n&&(this.resetTarget(e),this.pendingTargetResets=this.pendingTargetResets.add(e))}},Cl.prototype.createRemoteEvent=function(t){var e=this,n={};ei(this.targetStates,(function(r,i){var o=e.targetDataForActiveTarget(r);if(o){if(i.current&&o.target.isDocumentQuery()){var a=new zi(o.target.path);null!==e.pendingDocumentUpdates.get(a)||e.targetContainsDocument(r,a)||e.removeDocumentFromTarget(r,a,new qs(a,t))}i.hasPendingChanges&&(n[r]=i.toTargetChange(),i.clearPendingChanges())}}));var r=Ro();this.pendingDocumentTargetMapping.forEach((function(t,n){var i=!0;n.forEachWhile((function(t){var n=e.targetDataForActiveTarget(t);return!n||n.purpose===xu.LimboResolution||(i=!1)})),i&&(r=r.add(t))}));var i=new dl(t,n,this.pendingTargetResets,this.pendingDocumentUpdates,r);return this.pendingDocumentUpdates=Io(),this.pendingDocumentTargetMapping=Nl(),this.pendingTargetResets=new wo(Si),i},Cl.prototype.addDocumentToTarget=function(t,e){if(this.isActiveTarget(t)){var n=this.targetContainsDocument(t,e.key)?il.Modified:il.Added;this.ensureTargetState(t).addDocumentChange(e.key,n),this.pendingDocumentUpdates=this.pendingDocumentUpdates.insert(e.key,e),this.pendingDocumentTargetMapping=this.pendingDocumentTargetMapping.insert(e.key,this.ensureDocumentTargetMapping(e.key).add(t))}},Cl.prototype.removeDocumentFromTarget=function(t,e,n){if(this.isActiveTarget(t)){var r=this.ensureTargetState(t);this.targetContainsDocument(t,e)?r.addDocumentChange(e,il.Removed):r.removeDocumentChange(e),this.pendingDocumentTargetMapping=this.pendingDocumentTargetMapping.insert(e,this.ensureDocumentTargetMapping(e).delete(t)),n&&(this.pendingDocumentUpdates=this.pendingDocumentUpdates.insert(e,n))}},Cl.prototype.removeTarget=function(t){delete this.targetStates[t]},Cl.prototype.getCurrentDocumentCountForTarget=function(t){var e=this.ensureTargetState(t).toTargetChange();return this.metadataProvider.getRemoteKeysForTarget(t).size+e.addedDocuments.size-e.removedDocuments.size},Cl.prototype.recordPendingTargetRequest=function(t){this.ensureTargetState(t).recordPendingTargetRequest()},Cl.prototype.ensureTargetState=function(t){return this.targetStates[t]||(this.targetStates[t]=new El),this.targetStates[t]},Cl.prototype.ensureDocumentTargetMapping=function(t){var e=this.pendingDocumentTargetMapping.get(t);return e||(e=new wo(Si),this.pendingDocumentTargetMapping=this.pendingDocumentTargetMapping.insert(t,e)),e},Cl.prototype.isActiveTarget=function(t){var e=null!==this.targetDataForActiveTarget(t);return e||qr("WatchChangeAggregator","Detected inactive target",t),e},Cl.prototype.targetDataForActiveTarget=function(t){var e=this.targetStates[t];return e&&e.isPending?null:this.metadataProvider.getTargetDataForTarget(t)},Cl.prototype.resetTarget=function(t){var e=this;Kr(!this.targetStates[t].isPending,"Should only reset active targets"),this.targetStates[t]=new El,this.metadataProvider.getRemoteKeysForTarget(t).forEach((function(n){e.removeDocumentFromTarget(t,n,null)}))},Cl.prototype.targetContainsDocument=function(t,e){return this.metadataProvider.getRemoteKeysForTarget(t).has(e)},Cl);function Cl(t){this.metadataProvider=t,this.targetStates={},this.pendingDocumentUpdates=Io(),this.pendingDocumentTargetMapping=Nl(),this.pendingTargetResets=new wo(Si)}function Nl(){return new lo(zi.comparator)}function Dl(){return new lo(zi.comparator)}var Al="RemoteStore",Ol=(kl.prototype.start=function(){return this.enableNetwork()},kl.prototype.enableNetwork=function(){return u(this,void 0,void 0,(function(){var t;return c(this,(function(e){switch(e.label){case 0:return this.networkEnabled=!0,this.canUseNetwork()?(t=this.writeStream,[4,this.localStore.getLastStreamToken()]):[3,3];case 1:return t.lastStreamToken=e.sent(),this.shouldStartWatchStream()?this.startWatchStream():this.onlineStateTracker.set(Gh.Unknown),[4,this.fillWritePipeline()];case 2:e.sent(),e.label=3;case 3:return[2]}}))}))},kl.prototype.disableNetwork=function(){return u(this,void 0,void 0,(function(){return c(this,(function(t){switch(t.label){case 0:return this.networkEnabled=!1,[4,this.disableNetworkInternal()];case 1:return t.sent(),this.onlineStateTracker.set(Gh.Offline),[2]}}))}))},kl.prototype.disableNetworkInternal=function(){return u(this,void 0,void 0,(function(){return c(this,(function(t){switch(t.label){case 0:return[4,this.writeStream.stop()];case 1:return t.sent(),[4,this.watchStream.stop()];case 2:return t.sent(),0<this.writePipeline.length&&(qr(Al,"Stopping write stream with "+this.writePipeline.length+" pending writes"),this.writePipeline=[]),this.cleanUpWatchStreamState(),[2]}}))}))},kl.prototype.shutdown=function(){return u(this,void 0,void 0,(function(){return c(this,(function(t){switch(t.label){case 0:return qr(Al,"RemoteStore shutting down."),this.networkEnabled=!1,[4,this.disableNetworkInternal()];case 1:return t.sent(),this.connectivityMonitor.shutdown(),this.onlineStateTracker.set(Gh.Unknown),[2]}}))}))},kl.prototype.listen=function(t){Zr(this.listenTargets,t.targetId)||(this.listenTargets[t.targetId]=t,this.shouldStartWatchStream()?this.startWatchStream():this.watchStream.isOpen()&&this.sendWatchRequest(t))},kl.prototype.unlisten=function(t){Kr(Zr(this.listenTargets,t),"unlisten called on target no currently watched: "+t),delete this.listenTargets[t],this.watchStream.isOpen()&&this.sendUnwatchRequest(t),ri(this.listenTargets)&&(this.watchStream.isOpen()?this.watchStream.markIdle():this.canUseNetwork()&&this.onlineStateTracker.set(Gh.Unknown))},kl.prototype.getTargetDataForTarget=function(t){return this.listenTargets[t]||null},kl.prototype.getRemoteKeysForTarget=function(t){return this.syncEngine.getRemoteKeysForTarget(t)},kl.prototype.sendWatchRequest=function(t){this.watchChangeAggregator.recordPendingTargetRequest(t.targetId),this.watchStream.watch(t)},kl.prototype.sendUnwatchRequest=function(t){this.watchChangeAggregator.recordPendingTargetRequest(t),this.watchStream.unwatch(t)},kl.prototype.startWatchStream=function(){Kr(this.shouldStartWatchStream(),"startWatchStream() called when shouldStartWatchStream() is false."),this.watchChangeAggregator=new Il(this),this.watchStream.start(),this.onlineStateTracker.handleWatchStreamStart()},kl.prototype.shouldStartWatchStream=function(){return this.canUseNetwork()&&!this.watchStream.isStarted()&&!ri(this.listenTargets)},kl.prototype.canUseNetwork=function(){return this.isPrimary&&this.networkEnabled},kl.prototype.cleanUpWatchStreamState=function(){this.watchChangeAggregator=null},kl.prototype.onWatchStreamOpen=function(){return u(this,void 0,void 0,(function(){var t=this;return c(this,(function(e){return ei(this.listenTargets,(function(e,n){t.sendWatchRequest(n)})),[2]}))}))},kl.prototype.onWatchStreamClose=function(t){return u(this,void 0,void 0,(function(){return c(this,(function(e){return void 0===t&&Kr(!this.shouldStartWatchStream(),"Watch stream was stopped gracefully while still needed."),this.cleanUpWatchStreamState(),this.shouldStartWatchStream()?(this.onlineStateTracker.handleWatchStreamFailure(t),this.startWatchStream()):this.onlineStateTracker.set(Gh.Unknown),[2]}))}))},kl.prototype.onWatchStreamChange=function(t,e){return u(this,void 0,void 0,(function(){var n;return c(this,(function(r){switch(r.label){case 0:return this.onlineStateTracker.set(Gh.Online),t instanceof _l&&t.state===vl.Removed&&t.cause?[2,this.handleTargetError(t)]:(t instanceof wl?this.watchChangeAggregator.handleDocumentChange(t):t instanceof Tl?this.watchChangeAggregator.handleExistenceFilter(t):(Kr(t instanceof _l,"Expected watchChange to be an instance of WatchTargetChange"),this.watchChangeAggregator.handleTargetChange(t)),e.isEqual(co.MIN)?[3,3]:[4,this.localStore.getLastRemoteSnapshotVersion()]);case 1:return n=r.sent(),0<=e.compareTo(n)?[4,this.raiseWatchSnapshot(e)]:[3,3];case 2:r.sent(),r.label=3;case 3:return[2]}}))}))},kl.prototype.raiseWatchSnapshot=function(t){var e=this;Kr(!t.isEqual(co.MIN),"Can't raise event for unknown SnapshotVersion");var n=this.watchChangeAggregator.createRemoteEvent(t);return ei(n.targetChanges,(function(n,r){if(0<r.resumeToken.length){var i=e.listenTargets[n];i&&(e.listenTargets[n]=i.withResumeToken(r.resumeToken,t))}})),n.targetMismatches.forEach((function(t){var n=e.listenTargets[t];if(n){e.listenTargets[t]=n.withResumeToken(Hr(),n.snapshotVersion),e.sendUnwatchRequest(t);var r=new Bu(n.target,t,xu.ExistenceFilterMismatch,n.sequenceNumber);e.sendWatchRequest(r)}})),this.syncEngine.applyRemoteEvent(n)},kl.prototype.handleTargetError=function(t){var e=this;Kr(!!t.cause,"Handling target error without a cause");var n=t.cause,r=Promise.resolve();return t.targetIds.forEach((function(t){r=r.then((function(){return u(e,void 0,void 0,(function(){return c(this,(function(e){return Zr(this.listenTargets,t)?(delete this.listenTargets[t],this.watchChangeAggregator.removeTarget(t),[2,this.syncEngine.rejectListen(t,n)]):[2]}))}))}))})),r},kl.prototype.fillWritePipeline=function(){return u(this,void 0,void 0,(function(){var t,e;return c(this,(function(n){switch(n.label){case 0:return this.canAddToWritePipeline()?(t=0<this.writePipeline.length?this.writePipeline[this.writePipeline.length-1].batchId:-1,[4,this.localStore.nextMutationBatch(t)]):[3,4];case 1:return null!==(e=n.sent())?[3,2]:(0===this.writePipeline.length&&this.writeStream.markIdle(),[3,4]);case 2:return this.addToWritePipeline(e),[4,this.fillWritePipeline()];case 3:n.sent(),n.label=4;case 4:return this.shouldStartWriteStream()&&this.startWriteStream(),[2]}}))}))},kl.prototype.canAddToWritePipeline=function(){return this.canUseNetwork()&&this.writePipeline.length<10},kl.prototype.outstandingWrites=function(){return this.writePipeline.length},kl.prototype.addToWritePipeline=function(t){Kr(this.canAddToWritePipeline(),"addToWritePipeline called when pipeline is full"),this.writePipeline.push(t),this.writeStream.isOpen()&&this.writeStream.handshakeComplete&&this.writeStream.writeMutations(t.mutations)},kl.prototype.shouldStartWriteStream=function(){return this.canUseNetwork()&&!this.writeStream.isStarted()&&0<this.writePipeline.length},kl.prototype.startWriteStream=function(){Kr(this.shouldStartWriteStream(),"startWriteStream() called when shouldStartWriteStream() is false."),this.writeStream.start()},kl.prototype.onWriteStreamOpen=function(){return u(this,void 0,void 0,(function(){return c(this,(function(t){return this.writeStream.writeHandshake(),[2]}))}))},kl.prototype.onWriteHandshakeComplete=function(){var t=this;return this.localStore.setLastStreamToken(this.writeStream.lastStreamToken).then((function(){for(var e=0,n=t.writePipeline;e<n.length;e++){var r=n[e];t.writeStream.writeMutations(r.mutations)}})).catch(fc)},kl.prototype.onMutationResult=function(t,e){var n=this;Kr(0<this.writePipeline.length,"Got result for empty write pipeline");var r=this.writePipeline.shift(),i=Fo.from(r,t,e,this.writeStream.lastStreamToken);return this.syncEngine.applySuccessfulWrite(i).then((function(){return n.fillWritePipeline()}))},kl.prototype.onWriteStreamClose=function(t){return u(this,void 0,void 0,(function(){var e=this;return c(this,(function(n){return void 0===t&&Kr(!this.shouldStartWriteStream(),"Write stream was stopped gracefully while still needed."),t&&0<this.writePipeline.length?[2,(this.writeStream.handshakeComplete?this.handleWriteError(t):this.handleHandshakeError(t)).then((function(){e.shouldStartWriteStream()&&e.startWriteStream()}))]:[2]}))}))},kl.prototype.handleHandshakeError=function(t){return u(this,void 0,void 0,(function(){return c(this,(function(e){return nl(t.code)?(qr(Al,"RemoteStore error before completed handshake; resetting stream token: ",this.writeStream.lastStreamToken),this.writeStream.lastStreamToken=Hr(),[2,this.localStore.setLastStreamToken(Hr()).catch(fc)]):[2]}))}))},kl.prototype.handleWriteError=function(t){return u(this,void 0,void 0,(function(){var e,n=this;return c(this,(function(r){return function(t){return nl(t)&&t!==Yr.ABORTED}(t.code)?(e=this.writePipeline.shift(),this.writeStream.inhibitBackoff(),[2,this.syncEngine.rejectFailedWrite(e.batchId,t).then((function(){return n.fillWritePipeline()}))]):[2]}))}))},kl.prototype.createTransaction=function(){return new Xh(this.datastore)},kl.prototype.restartNetwork=function(){return u(this,void 0,void 0,(function(){return c(this,(function(t){switch(t.label){case 0:return this.networkEnabled=!1,[4,this.disableNetworkInternal()];case 1:return t.sent(),this.onlineStateTracker.set(Gh.Unknown),[4,this.enableNetwork()];case 2:return t.sent(),[2]}}))}))},kl.prototype.handleCredentialChange=function(){return u(this,void 0,void 0,(function(){return c(this,(function(t){switch(t.label){case 0:return this.canUseNetwork()?(qr(Al,"RemoteStore restarting streams for new credential"),[4,this.restartNetwork()]):[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}}))}))},kl.prototype.applyPrimaryState=function(t){return u(this,void 0,void 0,(function(){return c(this,(function(e){switch(e.label){case 0:return(this.isPrimary=t)&&this.networkEnabled?[4,this.enableNetwork()]:[3,2];case 1:return e.sent(),[3,4];case 2:return t?[3,4]:[4,this.disableNetworkInternal()];case 3:e.sent(),this.onlineStateTracker.set(Gh.Unknown),e.label=4;case 4:return[2]}}))}))},kl);function kl(t,e,n,r,i){var o=this;this.localStore=t,this.datastore=e,this.writePipeline=[],this.listenTargets={},this.watchChangeAggregator=null,this.networkEnabled=!1,this.isPrimary=!1,this.connectivityMonitor=i,this.connectivityMonitor.addCallback((function(t){n.enqueueAndForget((function(){return u(o,void 0,void 0,(function(){return c(this,(function(t){switch(t.label){case 0:return this.canUseNetwork()?(qr(Al,"Restarting streams for network reachability change."),[4,this.restartNetwork()]):[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}}))}))}))})),this.onlineStateTracker=new tl(n,r),this.watchStream=this.datastore.newPersistentWatchStream({onOpen:this.onWatchStreamOpen.bind(this),onClose:this.onWatchStreamClose.bind(this),onWatchChange:this.onWatchStreamChange.bind(this)}),this.writeStream=this.datastore.newPersistentWriteStream({onOpen:this.onWriteStreamOpen.bind(this),onClose:this.onWriteStreamClose.bind(this),onHandshakeComplete:this.onWriteHandshakeComplete.bind(this),onMutationResult:this.onMutationResult.bind(this)})}var Rl=(Object.defineProperty(Pl.prototype,"latitude",{get:function(){return this._lat},enumerable:!0,configurable:!0}),Object.defineProperty(Pl.prototype,"longitude",{get:function(){return this._long},enumerable:!0,configurable:!0}),Pl.prototype.isEqual=function(t){return this._lat===t._lat&&this._long===t._long},Pl.prototype._compareTo=function(t){return Si(this._lat,t._lat)||Si(this._long,t._long)},Pl);function Pl(t,e){if(oi("GeoPoint",arguments,2),ui("GeoPoint","number",1,t),ui("GeoPoint","number",2,e),!isFinite(t)||t<-90||90<t)throw new Xr(Yr.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+t);if(!isFinite(e)||e<-180||180<e)throw new Xr(Yr.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+e);this._lat=t,this._long=e}var Ml=(Ll.prototype.applyToLocalView=function(t,e){return new gs(e,t)},Ll.prototype.applyToRemoteDocument=function(t,e){return e},Ll.prototype.computeBaseValue=function(t){return null},Ll.prototype.isEqual=function(t){return t instanceof Ll},Ll.instance=new Ll,Ll);function Ll(){}var xl=(Fl.prototype.applyToLocalView=function(t,e){return this.apply(t)},Fl.prototype.applyToRemoteDocument=function(t,e){return this.apply(t)},Fl.prototype.apply=function(t){for(var e=Bl(t),n=function(t){e.find((function(e){return e.isEqual(t)}))||e.push(t)},r=0,i=this.elements;r<i.length;r++)n(i[r]);return new Rs(e)},Fl.prototype.computeBaseValue=function(t){return null},Fl.prototype.isEqual=function(t){return t instanceof Fl&&Ii(t.elements,this.elements)},Fl);function Fl(t){this.elements=t}var jl=(Ul.prototype.applyToLocalView=function(t,e){return this.apply(t)},Ul.prototype.applyToRemoteDocument=function(t,e){return this.apply(t)},Ul.prototype.apply=function(t){for(var e=Bl(t),n=function(t){e=e.filter((function(e){return!e.isEqual(t)}))},r=0,i=this.elements;r<i.length;r++)n(i[r]);return new Rs(e)},Ul.prototype.computeBaseValue=function(t){return null},Ul.prototype.isEqual=function(t){return t instanceof Ul&&Ii(t.elements,this.elements)},Ul);function Ul(t){this.elements=t}var ql=(Vl.prototype.applyToLocalView=function(t,e){var n=this.computeBaseValue(t);if(n instanceof os&&this.operand instanceof os){var r=n.internalValue+this.operand.internalValue;return new os(r)}return r=n.internalValue+this.operand.internalValue,new us(r)},Vl.prototype.applyToRemoteDocument=function(t,e){return Kr(null!==e,"Didn't receive transformResult for NUMERIC_ADD transform"),e},Vl.prototype.computeBaseValue=function(t){return t instanceof es?t:new os(0)},Vl.prototype.isEqual=function(t){return t instanceof Vl&&this.operand.isEqual(t.operand)},Vl);function Vl(t){this.operand=t}function Bl(t){return t instanceof Rs?t.internalValue.slice():[]}var Wl=(Kl.prototype.isEqual=function(t){return t&&t.count===this.count},Kl);function Kl(t){this.count=t}var Ql,Gl,Hl=((Ql={})[Xc.ASCENDING.name]="ASCENDING",Ql[Xc.DESCENDING.name]="DESCENDING",Ql),zl=((Gl={})[Oc.LESS_THAN.name]="LESS_THAN",Gl[Oc.LESS_THAN_OR_EQUAL.name]="LESS_THAN_OR_EQUAL",Gl[Oc.GREATER_THAN.name]="GREATER_THAN",Gl[Oc.GREATER_THAN_OR_EQUAL.name]="GREATER_THAN_OR_EQUAL",Gl[Oc.EQUAL.name]="EQUAL",Gl[Oc.ARRAY_CONTAINS.name]="ARRAY_CONTAINS",Gl[Oc.IN.name]="IN",Gl[Oc.ARRAY_CONTAINS_ANY.name]="ARRAY_CONTAINS_ANY",Gl),Yl=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Xl(t,e){Kr(!_c(t),e+" is missing")}function Jl(t){return"number"==typeof t?t:"string"==typeof t?Number(t):Wr("can't parse "+t)}var $l=(Zl.prototype.emptyByteString=function(){return this.options.useProto3Json?"":new Uint8Array(0)},Zl.prototype.unsafeCastProtoByteString=function(t){return t},Zl.prototype.fromRpcStatus=function(t){var e=void 0===t.code?Yr.UNKNOWN:rl(t.code);return new Xr(e,t.message||"")},Zl.prototype.toInt32Value=function(t){return this.options.useProto3Json||_c(t)?t:{value:t}},Zl.prototype.fromInt32Value=function(t){var e;return _c(e="object"==typeof t?t.value:t)?null:e},Zl.prototype.toTimestamp=function(t){return this.options.useProto3Json?new Date(1e3*t.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")+"."+("000000000"+t.nanoseconds).slice(-9)+"Z":{seconds:""+t.seconds,nanos:t.nanoseconds}},Zl.prototype.fromTimestamp=function(t){if("string"==typeof t)return this.fromIso8601String(t);Kr(!!t,"Cannot deserialize null or undefined timestamp.");var e=Jl(t.seconds||"0"),n=t.nanos||0;return new so(e,n)},Zl.prototype.fromIso8601String=function(t){var e=0,n=Yl.exec(t);if(Kr(!!n,"invalid timestamp: "+t),n[1]){var r=n[1];r=(r+"000000000").substr(0,9),e=Number(r)}var i=new Date(t),o=Math.floor(i.getTime()/1e3);return new so(o,e)},Zl.prototype.toBytes=function(t){return this.options.useProto3Json?t.toBase64():this.unsafeCastProtoByteString(t.toUint8Array())},Zl.prototype.fromBlob=function(t){return"string"==typeof t?(Kr(this.options.useProto3Json,"Expected bytes to be passed in as Uint8Array, but got a string instead."),Ai.fromBase64String(t)):(Kr(!this.options.useProto3Json,"Expected bytes to be passed in as Uint8Array, but got a string instead."),Ai.fromUint8Array(t))},Zl.prototype.toVersion=function(t){return this.toTimestamp(t.toTimestamp())},Zl.prototype.fromVersion=function(t){return Kr(!!t,"Trying to deserialize version that isn't set"),co.fromTimestamp(this.fromTimestamp(t))},Zl.prototype.toResourceName=function(t,e){return this.fullyQualifiedPrefixPath(t).child("documents").child(e).canonicalString()},Zl.prototype.fromResourceName=function(t){var e=Bi.fromString(t);return Kr(this.isValidResourceName(e),"Tried to deserialize invalid key "+e.toString()),e},Zl.prototype.toName=function(t){return this.toResourceName(this.databaseId,t.path)},Zl.prototype.fromName=function(t){var e=this.fromResourceName(t);return Kr(e.get(1)===this.databaseId.projectId,"Tried to deserialize key from different project: "+e.get(1)+" vs "+this.databaseId.projectId),Kr(!e.get(3)&&!this.databaseId.database||e.get(3)===this.databaseId.database,"Tried to deserialize key from different database: "+e.get(3)+" vs "+this.databaseId.database),new zi(this.extractLocalPathFromResourceName(e))},Zl.prototype.toQueryPath=function(t){return this.toResourceName(this.databaseId,t)},Zl.prototype.fromQueryPath=function(t){var e=this.fromResourceName(t);return 4===e.length?Bi.EMPTY_PATH:this.extractLocalPathFromResourceName(e)},Object.defineProperty(Zl.prototype,"encodedDatabaseId",{get:function(){return new Bi(["projects",this.databaseId.projectId,"databases",this.databaseId.database]).canonicalString()},enumerable:!0,configurable:!0}),Zl.prototype.fullyQualifiedPrefixPath=function(t){return new Bi(["projects",t.projectId,"databases",t.database])},Zl.prototype.extractLocalPathFromResourceName=function(t){return Kr(4<t.length&&"documents"===t.get(4),"tried to deserialize invalid key "+t.toString()),t.popFirst(5)},Zl.prototype.isValidResourceName=function(t){return 4<=t.length&&"projects"===t.get(0)&&"databases"===t.get(2)},Zl.prototype.toValue=function(t){if(t instanceof Ya)return{nullValue:"NULL_VALUE"};if(t instanceof $a)return{booleanValue:t.value()};if(t instanceof os)return{integerValue:""+t.value()};if(t instanceof us){var e=t.value();if(this.options.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:t.value()}}return t instanceof ls?{stringValue:t.value()}:t instanceof As?{mapValue:this.toMapValue(t)}:t instanceof Rs?{arrayValue:this.toArrayValue(t)}:t instanceof ds?{timestampValue:this.toTimestamp(t.internalValue)}:t instanceof Cs?{geoPointValue:{latitude:t.value().latitude,longitude:t.value().longitude}}:t instanceof ws?{bytesValue:this.toBytes(t.value())}:t instanceof Es?{referenceValue:this.toResourceName(t.databaseId,t.key.path)}:Wr("Unknown FieldValue "+JSON.stringify(t))},Zl.prototype.fromValue=function(t){var e=this;if("nullValue"in t)return Ya.INSTANCE;if("booleanValue"in t)return $a.of(t.booleanValue);if("integerValue"in t)return new os(Jl(t.integerValue));if("doubleValue"in t){if(this.options.useProto3Json){if("NaN"===t.doubleValue)return us.NAN;if("Infinity"===t.doubleValue)return us.POSITIVE_INFINITY;if("-Infinity"===t.doubleValue)return us.NEGATIVE_INFINITY}return new us(t.doubleValue)}if("stringValue"in t)return new ls(t.stringValue);if("mapValue"in t)return this.fromFields(t.mapValue.fields||{});if("arrayValue"in t){Xl(t.arrayValue,"arrayValue");var n=t.arrayValue.values||[];return new Rs(n.map((function(t){return e.fromValue(t)})))}if("timestampValue"in t)return Xl(t.timestampValue,"timestampValue"),new ds(this.fromTimestamp(t.timestampValue));if("geoPointValue"in t){Xl(t.geoPointValue,"geoPointValue");var r=t.geoPointValue.latitude||0,i=t.geoPointValue.longitude||0;return new Cs(new Rl(r,i))}if("bytesValue"in t){Xl(t.bytesValue,"bytesValue");var o=this.fromBlob(t.bytesValue);return new ws(o)}if("referenceValue"in t){Xl(t.referenceValue,"referenceValue");var a=this.fromResourceName(t.referenceValue),s=new Mi(a.get(1),a.get(3)),u=new zi(this.extractLocalPathFromResourceName(a));return new Es(s,u)}return Wr("Unknown Value proto "+JSON.stringify(t))},Zl.prototype.toMutationDocument=function(t,e){return{name:this.toName(t),fields:this.toFields(e)}},Zl.prototype.toDocument=function(t){return Kr(!t.hasLocalMutations,"Can't serialize documents with mutations."),{name:this.toName(t.key),fields:this.toFields(t.data()),updateTime:this.toTimestamp(t.version.toTimestamp())}},Zl.prototype.fromDocument=function(t,e){var n=this,r=this.fromName(t.name),i=this.fromVersion(t.updateTime);return new Fs(r,i,{hasCommittedMutations:!!e},void 0,t,(function(t){return n.fromValue(t)}))},Zl.prototype.toFields=function(t){var e=this,n={};return t.forEach((function(t,r){n[t]=e.toValue(r)})),n},Zl.prototype.fromFields=function(t){var e=this,n=t,r=As.EMPTY;return ni(n,(function(t,n){r=r.set(new Gi([t]),e.fromValue(n))})),r},Zl.prototype.toMapValue=function(t){return{fields:this.toFields(t)}},Zl.prototype.toArrayValue=function(t){var e=this,n=[];return t.forEach((function(t){n.push(e.toValue(t))})),{values:n}},Zl.prototype.fromFound=function(t){var e=this;Kr(!!t.found,"Tried to deserialize a found document from a missing document."),Xl(t.found.name,"doc.found.name"),Xl(t.found.updateTime,"doc.found.updateTime");var n=this.fromName(t.found.name),r=this.fromVersion(t.found.updateTime);return new Fs(n,r,{},void 0,t.found,(function(t){return e.fromValue(t)}))},Zl.prototype.fromMissing=function(t){Kr(!!t.missing,"Tried to deserialize a missing document from a found document."),Kr(!!t.readTime,"Tried to deserialize a missing document without a read time.");var e=this.fromName(t.missing),n=this.fromVersion(t.readTime);return new qs(e,n)},Zl.prototype.fromMaybeDocument=function(t){return"found"in t?this.fromFound(t):"missing"in t?this.fromMissing(t):Wr("invalid batch get response: "+JSON.stringify(t))},Zl.prototype.toWatchTargetChangeState=function(t){switch(t){case vl.Added:return"ADD";case vl.Current:return"CURRENT";case vl.NoChange:return"NO_CHANGE";case vl.Removed:return"REMOVE";case vl.Reset:return"RESET";default:return Wr("Unknown WatchTargetChangeState: "+t)}},Zl.prototype.toTestWatchChange=function(t){if(t instanceof Tl)return{filter:{count:t.existenceFilter.count,targetId:t.targetId}};if(t instanceof wl){if(t.newDoc instanceof Fs){var e=t.newDoc;return{documentChange:{document:{name:this.toName(e.key),fields:this.toFields(e.data()),updateTime:this.toVersion(e.version)},targetIds:t.updatedTargetIds,removedTargetIds:t.removedTargetIds}}}if(t.newDoc instanceof qs)return e=t.newDoc,{documentDelete:{document:this.toName(e.key),readTime:this.toVersion(e.version),removedTargetIds:t.removedTargetIds}};if(null===t.newDoc)return{documentRemove:{document:this.toName(t.key),removedTargetIds:t.removedTargetIds}}}if(t instanceof _l){var n=void 0;return t.cause&&(n={code:function(t){if(void 0===t)return $h.OK;switch(t){case Yr.OK:return $h.OK;case Yr.CANCELLED:return $h.CANCELLED;case Yr.UNKNOWN:return $h.UNKNOWN;case Yr.DEADLINE_EXCEEDED:return $h.DEADLINE_EXCEEDED;case Yr.RESOURCE_EXHAUSTED:return $h.RESOURCE_EXHAUSTED;case Yr.INTERNAL:return $h.INTERNAL;case Yr.UNAVAILABLE:return $h.UNAVAILABLE;case Yr.UNAUTHENTICATED:return $h.UNAUTHENTICATED;case Yr.INVALID_ARGUMENT:return $h.INVALID_ARGUMENT;case Yr.NOT_FOUND:return $h.NOT_FOUND;case Yr.ALREADY_EXISTS:return $h.ALREADY_EXISTS;case Yr.PERMISSION_DENIED:return $h.PERMISSION_DENIED;case Yr.FAILED_PRECONDITION:return $h.FAILED_PRECONDITION;case Yr.ABORTED:return $h.ABORTED;case Yr.OUT_OF_RANGE:return $h.OUT_OF_RANGE;case Yr.UNIMPLEMENTED:return $h.UNIMPLEMENTED;case Yr.DATA_LOSS:return $h.DATA_LOSS;default:return Wr("Unknown status code: "+t)}}(t.cause.code),message:t.cause.message}),{targetChange:{targetChangeType:this.toWatchTargetChangeState(t.state),targetIds:t.targetIds,resumeToken:this.unsafeCastProtoByteString(t.resumeToken),cause:n}}}return Wr("Unrecognized watch change: "+JSON.stringify(t))},Zl.prototype.fromWatchChange=function(t){var e,n=this;if("targetChange"in t){Xl(t.targetChange,"targetChange");var r=this.fromWatchTargetChangeState(t.targetChange.targetChangeType||"NO_CHANGE"),i=t.targetChange.targetIds||[],o=t.targetChange.resumeToken||this.emptyByteString(),a=t.targetChange.cause,s=a&&this.fromRpcStatus(a);e=new _l(r,i,o,s||null)}else if("documentChange"in t){Xl(t.documentChange,"documentChange");var u=t.documentChange;Xl(u.document,"documentChange.name"),Xl(u.document.name,"documentChange.document.name"),Xl(u.document.updateTime,"documentChange.document.updateTime");var c=this.fromName(u.document.name),h=this.fromVersion(u.document.updateTime),l=new Fs(c,h,{},void 0,u.document,(function(t){return n.fromValue(t)})),f=u.targetIds||[],p=u.removedTargetIds||[];e=new wl(f,p,l.key,l)}else if("documentDelete"in t){Xl(t.documentDelete,"documentDelete");var d=t.documentDelete;Xl(d.document,"documentDelete.document"),c=this.fromName(d.document),h=d.readTime?this.fromVersion(d.readTime):co.forDeletedDoc(),l=new qs(c,h),p=d.removedTargetIds||[],e=new wl([],p,l.key,l)}else if("documentRemove"in t){Xl(t.documentRemove,"documentRemove");var m=t.documentRemove;Xl(m.document,"documentRemove"),c=this.fromName(m.document),p=m.removedTargetIds||[],e=new wl([],p,c,null)}else{if(!("filter"in t))return Wr("Unknown change type "+JSON.stringify(t));Xl(t.filter,"filter");var y=t.filter;Xl(y.targetId,"filter.targetId");var g=y.count||0,v=new Wl(g),b=y.targetId;e=new Tl(b,v)}return e},Zl.prototype.fromWatchTargetChangeState=function(t){return"NO_CHANGE"===t?vl.NoChange:"ADD"===t?vl.Added:"REMOVE"===t?vl.Removed:"CURRENT"===t?vl.Current:"RESET"===t?vl.Reset:Wr("Got unexpected TargetChange.state: "+t)},Zl.prototype.versionFromListenResponse=function(t){if(!("targetChange"in t))return co.MIN;var e=t.targetChange;return e.targetIds&&e.targetIds.length?co.MIN:e.readTime?this.fromVersion(e.readTime):co.MIN},Zl.prototype.toMutation=function(t){var e,n=this;if(t instanceof Aa)e={update:this.toMutationDocument(t.key,t.value)};else if(t instanceof Ba)e={delete:this.toName(t.key)};else if(t instanceof Ra)e={update:this.toMutationDocument(t.key,t.data),updateMask:this.toDocumentMask(t.fieldMask)};else{if(!(t instanceof La))return Wr("Unknown mutation type "+t.type);e={transform:{document:this.toName(t.key),fieldTransforms:t.fieldTransforms.map((function(t){return n.toFieldTransform(t)}))}}}return t.precondition.isNone||(e.currentDocument=this.toPrecondition(t.precondition)),e},Zl.prototype.fromMutation=function(t){var e=this,n=t.currentDocument?this.fromPrecondition(t.currentDocument):Sa.NONE;if(t.update){Xl(t.update.name,"name");var r=this.fromName(t.update.name),i=this.fromFields(t.update.fields||{});if(t.updateMask){var o=this.fromDocumentMask(t.updateMask);return new Ra(r,i,o,n)}return new Aa(r,i,n)}if(t.delete)return r=this.fromName(t.delete),new Ba(r,n);if(t.transform){r=this.fromName(t.transform.document);var a=t.transform.fieldTransforms.map((function(t){return e.fromFieldTransform(t)}));return Kr(!0===n.exists,'Transforms only support precondition "exists == true"'),new La(r,a)}return Wr("unknown mutation proto: "+JSON.stringify(t))},Zl.prototype.toPrecondition=function(t){return Kr(!t.isNone,"Can't serialize an empty precondition"),void 0!==t.updateTime?{updateTime:this.toVersion(t.updateTime)}:void 0!==t.exists?{exists:t.exists}:Wr("Unknown precondition")},Zl.prototype.fromPrecondition=function(t){return void 0!==t.updateTime?Sa.updateTime(this.fromVersion(t.updateTime)):void 0!==t.exists?Sa.exists(t.exists):Sa.NONE},Zl.prototype.fromWriteResult=function(t,e){var n=this,r=t.updateTime?this.fromVersion(t.updateTime):this.fromVersion(e);r.isEqual(co.MIN)&&(r=this.fromVersion(e));var i=null;return t.transformResults&&0<t.transformResults.length&&(i=t.transformResults.map((function(t){return n.fromValue(t)}))),new Ea(r,i)},Zl.prototype.fromWriteResults=function(t,e){var n=this;return t&&0<t.length?(Kr(void 0!==e,"Received a write result without a commit time"),t.map((function(t){return n.fromWriteResult(t,e)}))):[]},Zl.prototype.toFieldTransform=function(t){var e=this,n=t.transform;if(n instanceof Ml)return{fieldPath:t.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(n instanceof xl)return{fieldPath:t.field.canonicalString(),appendMissingElements:{values:n.elements.map((function(t){return e.toValue(t)}))}};if(n instanceof jl)return{fieldPath:t.field.canonicalString(),removeAllFromArray:{values:n.elements.map((function(t){return e.toValue(t)}))}};if(n instanceof ql)return{fieldPath:t.field.canonicalString(),increment:this.toValue(n.operand)};throw Wr("Unknown transform: "+t.transform)},Zl.prototype.fromFieldTransform=function(t){var e=this,n=null;if("setToServerValue"in t)Kr("REQUEST_TIME"===t.setToServerValue,"Unknown server value transform proto: "+JSON.stringify(t)),n=Ml.instance;else if("appendMissingElements"in t){var r=t.appendMissingElements.values||[];n=new xl(r.map((function(t){return e.fromValue(t)})))}else if("removeAllFromArray"in t)r=t.removeAllFromArray.values||[],n=new jl(r.map((function(t){return e.fromValue(t)})));else if("increment"in t){var i=this.fromValue(t.increment);Kr(i instanceof es,"NUMERIC_ADD transform requires a NumberValue"),n=new ql(i)}else Wr("Unknown transform proto: "+JSON.stringify(t));var o=Gi.fromServerFormat(t.fieldPath);return new ba(o,n)},Zl.prototype.toDocumentsTarget=function(t){return{documents:[this.toQueryPath(t.path)]}},Zl.prototype.fromDocumentsTarget=function(t){var e=t.documents.length;Kr(1===e,"DocumentsTarget contained other than 1 document: "+e);var n=t.documents[0];return Dc.atPath(this.fromQueryPath(n)).toTarget()},Zl.prototype.toQueryTarget=function(t){var e={structuredQuery:{}},n=t.path;null!==t.collectionGroup?(Kr(n.length%2==0,"Collection Group queries should be within a document path or root."),e.parent=this.toQueryPath(n),e.structuredQuery.from=[{collectionId:t.collectionGroup,allDescendants:!0}]):(Kr(n.length%2!=0,"Document queries with filters are not supported."),e.parent=this.toQueryPath(n.popLast()),e.structuredQuery.from=[{collectionId:n.lastSegment()}]);var r=this.toFilter(t.filters);r&&(e.structuredQuery.where=r);var i=this.toOrder(t.orderBy);i&&(e.structuredQuery.orderBy=i);var o=this.toInt32Value(t.limit);return null!==o&&(e.structuredQuery.limit=o),t.startAt&&(e.structuredQuery.startAt=this.toCursor(t.startAt)),t.endAt&&(e.structuredQuery.endAt=this.toCursor(t.endAt)),e},Zl.prototype.fromQueryTarget=function(t){var e=this.fromQueryPath(t.parent),n=t.structuredQuery,r=n.from?n.from.length:0,i=null;if(0<r){Kr(1===r,"StructuredQuery.from with more than one collection is not supported.");var o=n.from[0];o.allDescendants?i=o.collectionId:e=e.child(o.collectionId)}var a=[];n.where&&(a=this.fromFilter(n.where));var s=[];n.orderBy&&(s=this.fromOrder(n.orderBy));var u=null;n.limit&&(u=this.fromInt32Value(n.limit));var c=null;n.startAt&&(c=this.fromCursor(n.startAt));var h=null;return n.endAt&&(h=this.fromCursor(n.endAt)),new Dc(e,i,s,a,u,Sc.First,c,h).toTarget()},Zl.prototype.toListenRequestLabels=function(t){var e=this.toLabel(t.purpose);return null==e?null:{"goog-listen-tags":e}},Zl.prototype.toLabel=function(t){switch(t){case xu.Listen:return null;case xu.ExistenceFilterMismatch:return"existence-filter-mismatch";case xu.LimboResolution:return"limbo-document";default:return Wr("Unrecognized query purpose: "+t)}},Zl.prototype.toTarget=function(t){var e,n=t.target;return(e=n.isDocumentQuery()?{documents:this.toDocumentsTarget(n)}:{query:this.toQueryTarget(n)}).targetId=t.targetId,0<t.resumeToken.length&&(e.resumeToken=this.unsafeCastProtoByteString(t.resumeToken)),e},Zl.prototype.toFilter=function(t){var e=this;if(0!==t.length){var n=t.map((function(t){return t instanceof Pc?e.toUnaryOrFieldFilter(t):Wr("Unrecognized filter: "+JSON.stringify(t))}));return 1===n.length?n[0]:{compositeFilter:{op:"AND",filters:n}}}},Zl.prototype.fromFilter=function(t){var e=this;return t?void 0!==t.unaryFilter?[this.fromUnaryFilter(t)]:void 0!==t.fieldFilter?[this.fromFieldFilter(t)]:void 0!==t.compositeFilter?t.compositeFilter.filters.map((function(t){return e.fromFilter(t)})).reduce((function(t,e){return t.concat(e)})):Wr("Unknown filter: "+JSON.stringify(t)):[]},Zl.prototype.toOrder=function(t){var e=this;if(0!==t.length)return t.map((function(t){return e.toPropertyOrder(t)}))},Zl.prototype.fromOrder=function(t){var e=this;return t.map((function(t){return e.fromPropertyOrder(t)}))},Zl.prototype.toCursor=function(t){var e=this;return{before:t.before,values:t.position.map((function(t){return e.toValue(t)}))}},Zl.prototype.fromCursor=function(t){var e=this,n=!!t.before,r=t.values.map((function(t){return e.fromValue(t)}));return new $c(r,n)},Zl.prototype.toDirection=function(t){return Hl[t.name]},Zl.prototype.fromDirection=function(t){switch(t){case"ASCENDING":return Xc.ASCENDING;case"DESCENDING":return Xc.DESCENDING;default:return}},Zl.prototype.toOperatorName=function(t){return zl[t.name]},Zl.prototype.fromOperatorName=function(t){switch(t){case"EQUAL":return Oc.EQUAL;case"GREATER_THAN":return Oc.GREATER_THAN;case"GREATER_THAN_OR_EQUAL":return Oc.GREATER_THAN_OR_EQUAL;case"LESS_THAN":return Oc.LESS_THAN;case"LESS_THAN_OR_EQUAL":return Oc.LESS_THAN_OR_EQUAL;case"ARRAY_CONTAINS":return Oc.ARRAY_CONTAINS;case"IN":return Oc.IN;case"ARRAY_CONTAINS_ANY":return Oc.ARRAY_CONTAINS_ANY;case"OPERATOR_UNSPECIFIED":return Wr("Unspecified operator");default:return Wr("Unknown operator")}},Zl.prototype.toFieldPathReference=function(t){return{fieldPath:t.canonicalString()}},Zl.prototype.fromFieldPathReference=function(t){return Gi.fromServerFormat(t.fieldPath)},Zl.prototype.toPropertyOrder=function(t){return{field:this.toFieldPathReference(t.field),direction:this.toDirection(t.dir)}},Zl.prototype.fromPropertyOrder=function(t){return new th(this.fromFieldPathReference(t.field),this.fromDirection(t.direction))},Zl.prototype.fromFieldFilter=function(t){return Pc.create(this.fromFieldPathReference(t.fieldFilter.field),this.fromOperatorName(t.fieldFilter.op),this.fromValue(t.fieldFilter.value))},Zl.prototype.toUnaryOrFieldFilter=function(t){if(t.op===Oc.EQUAL){if(t.value.isEqual(us.NAN))return{unaryFilter:{field:this.toFieldPathReference(t.field),op:"IS_NAN"}};if(t.value.isEqual(Ya.INSTANCE))return{unaryFilter:{field:this.toFieldPathReference(t.field),op:"IS_NULL"}}}return{fieldFilter:{field:this.toFieldPathReference(t.field),op:this.toOperatorName(t.op),value:this.toValue(t.value)}}},Zl.prototype.fromUnaryFilter=function(t){switch(t.unaryFilter.op){case"IS_NAN":var e=this.fromFieldPathReference(t.unaryFilter.field);return Pc.create(e,Oc.EQUAL,us.NAN);case"IS_NULL":var n=this.fromFieldPathReference(t.unaryFilter.field);return Pc.create(n,Oc.EQUAL,Ya.INSTANCE);case"OPERATOR_UNSPECIFIED":return Wr("Unspecified filter");default:return Wr("Unknown filter")}},Zl.prototype.toDocumentMask=function(t){var e=[];return t.fields.forEach((function(t){return e.push(t.canonicalString())})),{fieldPaths:e}},Zl.prototype.fromDocumentMask=function(t){var e=(t.fieldPaths||[]).map((function(t){return Gi.fromServerFormat(t)}));return ga.fromArray(e)},Zl);function Zl(t,e){this.databaseId=t,this.options=e}var tf=function(){this.viewSnap=null,this.targetId=0,this.listeners=[]},ef=(nf.prototype.listen=function(t){var e=t.query,n=!1,r=this.queries.get(e);return r||(n=!0,r=new tf,this.queries.set(e,r)),r.listeners.push(t),Kr(!t.applyOnlineStateChange(this.onlineState),"applyOnlineStateChange() shouldn't raise an event for brand-new listeners."),!r.viewSnap||t.onViewSnapshot(r.viewSnap)&&this.raiseSnapshotsInSyncEvent(),n?this.syncEngine.listen(e).then((function(t){return r.targetId=t})):Promise.resolve(r.targetId)},nf.prototype.unlisten=function(t){return u(this,void 0,void 0,(function(){var e,n,r,i;return c(this,(function(o){return e=t.query,n=!1,(r=this.queries.get(e))&&0<=(i=r.listeners.indexOf(t))&&(r.listeners.splice(i,1),n=0===r.listeners.length),n?(this.queries.delete(e),[2,this.syncEngine.unlisten(e)]):[2]}))}))},nf.prototype.onWatchChange=function(t){for(var e=!1,n=0,r=t;n<r.length;n++){var i=r[n],o=i.query,a=this.queries.get(o);if(a){for(var s=0,u=a.listeners;s<u.length;s++)u[s].onViewSnapshot(i)&&(e=!0);a.viewSnap=i}}e&&this.raiseSnapshotsInSyncEvent()},nf.prototype.onWatchError=function(t,e){var n=this.queries.get(t);if(n)for(var r=0,i=n.listeners;r<i.length;r++)i[r].onError(e);this.queries.delete(t)},nf.prototype.onOnlineStateChange=function(t){this.onlineState=t;var e=!1;this.queries.forEach((function(n,r){for(var i=0,o=r.listeners;i<o.length;i++)o[i].applyOnlineStateChange(t)&&(e=!0)})),e&&this.raiseSnapshotsInSyncEvent()},nf.prototype.addSnapshotsInSyncListener=function(t){this.snapshotsInSyncListeners.add(t),t.next()},nf.prototype.removeSnapshotsInSyncListener=function(t){this.snapshotsInSyncListeners.delete(t)},nf.prototype.raiseSnapshotsInSyncEvent=function(){this.snapshotsInSyncListeners.forEach((function(t){t.next()}))},nf);function nf(t){this.syncEngine=t,this.queries=new Qs((function(t){return t.canonicalId()})),this.onlineState=Gh.Unknown,this.snapshotsInSyncListeners=new Set,this.syncEngine.subscribe(this)}var rf=(of.prototype.onViewSnapshot=function(t){if(Kr(0<t.docChanges.length||t.syncStateChanged,"We got a new snapshot with no changes?"),!this.options.includeMetadataChanges){for(var e=[],n=0,r=t.docChanges;n<r.length;n++){var i=r[n];i.type!==il.Metadata&&e.push(i)}t=new fl(t.query,t.docs,t.oldDocs,e,t.mutatedKeys,t.fromCache,t.syncStateChanged,!0)}var o=!1;return this.raisedInitialEvent?this.shouldRaiseEvent(t)&&(this.queryObserver.next(t),o=!0):this.shouldRaiseInitialEvent(t,this.onlineState)&&(this.raiseInitialEvent(t),o=!0),this.snap=t,o},of.prototype.onError=function(t){this.queryObserver.error(t)},of.prototype.applyOnlineStateChange=function(t){this.onlineState=t;var e=!1;return this.snap&&!this.raisedInitialEvent&&this.shouldRaiseInitialEvent(this.snap,t)&&(this.raiseInitialEvent(this.snap),e=!0),e},of.prototype.shouldRaiseInitialEvent=function(t,e){if(Kr(!this.raisedInitialEvent,"Determining whether to raise first event but already had first event"),!t.fromCache)return!0;var n=e!==Gh.Offline;return this.options.waitForSyncWhenOnline&&n?(Kr(t.fromCache,"Waiting for sync, but snapshot is not from cache"),!1):!t.docs.isEmpty()||e===Gh.Offline},of.prototype.shouldRaiseEvent=function(t){if(0<t.docChanges.length)return!0;var e=this.snap&&this.snap.hasPendingWrites!==t.hasPendingWrites;return!(!t.syncStateChanged&&!e)&&!0===this.options.includeMetadataChanges},of.prototype.raiseInitialEvent=function(t){Kr(!this.raisedInitialEvent,"Trying to raise initial events for second time"),t=fl.fromInitialDocuments(t.query,t.docs,t.mutatedKeys,t.fromCache),this.raisedInitialEvent=!0,this.queryObserver.next(t)},of);function of(t,e,n){this.query=t,this.queryObserver=e,this.raisedInitialEvent=!1,this.snap=null,this.onlineState=Gh.Unknown,this.options=n||{}}var af=(sf.fromSnapshot=function(t,e){for(var n=Ro(),r=Ro(),i=0,o=e.docChanges;i<o.length;i++){var a=o[i];switch(a.type){case il.Added:n=n.add(a.doc.key);break;case il.Removed:r=r.add(a.doc.key)}}return new sf(t,e.fromCache,n,r)},sf);function sf(t,e,n,r){this.targetId=t,this.fromCache=e,this.addedKeys=n,this.removedKeys=r}var uf=function(t){this.key=t},cf=function(t){this.key=t},hf=(Object.defineProperty(lf.prototype,"syncedDocuments",{get:function(){return this._syncedDocuments},enumerable:!0,configurable:!0}),lf.prototype.computeDocChanges=function(t,e){var n=this,r=e?e.changeSet:new hl,i=e?e.documentSet:this.documentSet,o=e?e.mutatedKeys:this.mutatedKeys,a=i,s=!1,u=this.query.hasLimitToFirst()&&i.size===this.query.limit?i.last():null,c=this.query.hasLimitToLast()&&i.size===this.query.limit?i.first():null;if(t.inorderTraversal((function(t,e){var h=i.get(t),l=e instanceof Fs?e:null;l&&(Kr(t.isEqual(l.key),"Mismatching keys found in document changes: "+t+" != "+l.key),l=n.query.matches(l)?l:null);var f=!!h&&n.mutatedKeys.has(h.key),p=!!l&&(l.hasLocalMutations||n.mutatedKeys.has(l.key)&&l.hasCommittedMutations),d=!1;h&&l?h.data().isEqual(l.data())?f!==p&&(r.track({type:il.Metadata,doc:l}),d=!0):n.shouldWaitForSyncedDocument(h,l)||(r.track({type:il.Modified,doc:l}),d=!0,(u&&0<n.query.docComparator(l,u)||c&&n.query.docComparator(l,c)<0)&&(s=!0)):!h&&l?(r.track({type:il.Added,doc:l}),d=!0):h&&!l&&(r.track({type:il.Removed,doc:h}),d=!0,(u||c)&&(s=!0)),d&&(o=l?(a=a.add(l),p?o.add(t):o.delete(t)):(a=a.delete(t),o.delete(t)))})),this.query.hasLimitToFirst()||this.query.hasLimitToLast())for(;a.size>this.query.limit;){var h=this.query.hasLimitToFirst()?a.last():a.first();a=a.delete(h.key),o=o.delete(h.key),r.track({type:il.Removed,doc:h})}return Kr(!s||!e,"View was refilled using docs that themselves needed refilling."),{documentSet:a,changeSet:r,needsRefill:s,mutatedKeys:o}},lf.prototype.shouldWaitForSyncedDocument=function(t,e){return t.hasLocalMutations&&e.hasCommittedMutations&&!e.hasLocalMutations},lf.prototype.applyChanges=function(t,e,n){var r=this;Kr(!t.needsRefill,"Cannot apply changes that need a refill");var i=this.documentSet;this.documentSet=t.documentSet,this.mutatedKeys=t.mutatedKeys;var o=t.changeSet.getChanges();o.sort((function(t,e){return function(t,e){function n(t){switch(t){case il.Added:return 1;case il.Modified:case il.Metadata:return 2;case il.Removed:return 0;default:return Wr("Unknown ChangeType: "+t)}}return n(t)-n(e)}(t.type,e.type)||r.query.docComparator(t.doc,e.doc)})),this.applyTargetChange(n);var a=e?this.updateLimboDocuments():[],s=0===this.limboDocuments.size&&this.current?al.Synced:al.Local,u=s!==this.syncState;return this.syncState=s,0!==o.length||u?{snapshot:new fl(this.query,t.documentSet,i,o,t.mutatedKeys,s===al.Local,u,!1),limboChanges:a}:{limboChanges:a}},lf.prototype.applyOnlineStateChange=function(t){return this.current&&t===Gh.Offline?(this.current=!1,this.applyChanges({documentSet:this.documentSet,changeSet:new hl,mutatedKeys:this.mutatedKeys,needsRefill:!1},!1)):{limboChanges:[]}},lf.prototype.shouldBeInLimbo=function(t){return!this._syncedDocuments.has(t)&&!!this.documentSet.has(t)&&!this.documentSet.get(t).hasLocalMutations},lf.prototype.applyTargetChange=function(t){var e=this;t&&(t.addedDocuments.forEach((function(t){return e._syncedDocuments=e._syncedDocuments.add(t)})),t.modifiedDocuments.forEach((function(t){return Kr(e._syncedDocuments.has(t),"Modified document "+t+" not found in view.")})),t.removedDocuments.forEach((function(t){return e._syncedDocuments=e._syncedDocuments.delete(t)})),this.current=t.current)},lf.prototype.updateLimboDocuments=function(){var t=this;if(!this.current)return[];var e=this.limboDocuments;this.limboDocuments=Ro(),this.documentSet.forEach((function(e){t.shouldBeInLimbo(e.key)&&(t.limboDocuments=t.limboDocuments.add(e.key))}));var n=[];return e.forEach((function(e){t.limboDocuments.has(e)||n.push(new cf(e))})),this.limboDocuments.forEach((function(t){e.has(t)||n.push(new uf(t))})),n},lf.prototype.synchronizeWithPersistedState=function(t){this._syncedDocuments=t.remoteKeys,this.limboDocuments=Ro();var e=this.computeDocChanges(t.documents);return this.applyChanges(e,!0)},lf.prototype.computeInitialSnapshot=function(){return fl.fromInitialDocuments(this.query,this.documentSet,this.mutatedKeys,this.syncState===al.Local)},lf);function lf(t,e){this.query=t,this._syncedDocuments=e,this.syncState=null,this.current=!1,this.limboDocuments=Ro(),this.mutatedKeys=Ro(),this.documentSet=new ul(t.docComparator.bind(t))}var ff=(pf.prototype.run=function(){this.runWithBackOff()},pf.prototype.runWithBackOff=function(){var t=this;this.backoff.backoffAndRun((function(){return u(t,void 0,void 0,(function(){var t,e,n=this;return c(this,(function(r){return t=this.remoteStore.createTransaction(),(e=this.tryRunUpdateFunction(t))&&e.then((function(e){n.asyncQueue.enqueueAndForget((function(){return t.commit().then((function(){n.deferred.resolve(e)})).catch((function(t){n.handleTransactionError(t)}))}))})).catch((function(t){n.handleTransactionError(t)})),[2]}))}))}))},pf.prototype.tryRunUpdateFunction=function(t){try{var e=this.updateFunction(t);return!_c(e)&&e.catch&&e.then?e:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(t){return this.deferred.reject(t),null}},pf.prototype.handleTransactionError=function(t){var e=this;0<this.retries&&this.isRetryableTransactionError(t)?(this.retries-=1,this.asyncQueue.enqueueAndForget((function(){return e.runWithBackOff(),Promise.resolve()}))):this.deferred.reject(t)},pf.prototype.isRetryableTransactionError=function(t){if("FirebaseError"!==t.name)return!1;var e=t.code;return"aborted"===e||"failed-precondition"===e||!nl(e)},pf);function pf(t,e,n,r){this.asyncQueue=t,this.remoteStore=e,this.updateFunction=n,this.deferred=r,this.retries=5,this.backoff=new kh(this.asyncQueue,Xi.RetryTransaction)}var df="SyncEngine",mf=function(t,e,n){this.query=t,this.targetId=e,this.view=n},yf=function(t){this.key=t,this.receivedDocument=!1},gf=(Object.defineProperty(vf.prototype,"isPrimaryClient",{get:function(){return!0===this.isPrimary},enumerable:!0,configurable:!0}),vf.prototype.subscribe=function(t){Kr(null!==t,"SyncEngine listener cannot be null"),Kr(null===this.syncEngineListener,"SyncEngine already has a subscriber."),this.syncEngineListener=t},vf.prototype.listen=function(t){return u(this,void 0,void 0,(function(){var e,n,r,i,o;return c(this,(function(a){switch(a.label){case 0:return this.assertSubscribed("listen()"),(r=this.queryViewsByQuery.get(t))?(e=r.targetId,this.sharedClientState.addLocalQueryTarget(e),n=r.view.computeInitialSnapshot(),[3,4]):[3,1];case 1:return[4,this.localStore.allocateTarget(t.toTarget())];case 2:return i=a.sent(),o=this.sharedClientState.addLocalQueryTarget(i.targetId),e=i.targetId,[4,this.initializeViewAndComputeSnapshot(t,e,"current"===o)];case 3:n=a.sent(),this.isPrimary&&this.remoteStore.listen(i),a.label=4;case 4:return this.syncEngineListener.onWatchChange([n]),[2,e]}}))}))},vf.prototype.initializeViewAndComputeSnapshot=function(t,e,n){return u(this,void 0,void 0,(function(){var r,i,o,a,s,u;return c(this,(function(c){switch(c.label){case 0:return[4,this.localStore.executeQuery(t,!0)];case 1:return r=c.sent(),i=new hf(t,r.remoteKeys),o=i.computeDocChanges(r.documents),a=yl.createSynthesizedTargetChangeForCurrentChange(e,n&&this.onlineState!==Gh.Offline),Kr(0===(s=i.applyChanges(o,!0===this.isPrimary,a)).limboChanges.length,"View returned limbo docs before target ack from the server."),Kr(!!s.snapshot,"applyChanges for new view should always return a snapshot"),u=new mf(t,e,i),this.queryViewsByQuery.set(t,u),this.queriesByTarget[e]||(this.queriesByTarget[e]=[]),this.queriesByTarget[e].push(t),[2,s.snapshot]}}))}))},vf.prototype.synchronizeViewAndComputeSnapshot=function(t){return u(this,void 0,void 0,(function(){var e,n;return c(this,(function(r){switch(r.label){case 0:return[4,this.localStore.executeQuery(t.query,!0)];case 1:return e=r.sent(),n=t.view.synchronizeWithPersistedState(e),this.isPrimary&&this.updateTrackedLimbos(t.targetId,n.limboChanges),[2,n]}}))}))},vf.prototype.unlisten=function(t){return u(this,void 0,void 0,(function(){var e,n,r=this;return c(this,(function(i){switch(i.label){case 0:return this.assertSubscribed("unlisten()"),Kr(!!(e=this.queryViewsByQuery.get(t)),"Trying to unlisten on query not found:"+t),1<(n=this.queriesByTarget[e.targetId]).length?(this.queriesByTarget[e.targetId]=n.filter((function(e){return!e.isEqual(t)})),this.queryViewsByQuery.delete(t),[2]):this.isPrimary?(this.sharedClientState.removeLocalQueryTarget(e.targetId),this.sharedClientState.isActiveQueryTarget(e.targetId)?[3,2]:[4,this.localStore.releaseTarget(e.targetId,!1).then((function(){r.sharedClientState.clearQueryState(e.targetId),r.remoteStore.unlisten(e.targetId),r.removeAndCleanupTarget(e.targetId)})).catch(fc)]):[3,3];case 1:i.sent(),i.label=2;case 2:return[3,5];case 3:return this.removeAndCleanupTarget(e.targetId),[4,this.localStore.releaseTarget(e.targetId,!0)];case 4:i.sent(),i.label=5;case 5:return[2]}}))}))},vf.prototype.write=function(t,e){return u(this,void 0,void 0,(function(){var n;return c(this,(function(r){switch(r.label){case 0:return this.assertSubscribed("write()"),[4,this.localStore.localWrite(t)];case 1:return n=r.sent(),this.sharedClientState.addPendingMutation(n.batchId),this.addMutationCallback(n.batchId,e),[4,this.emitNewSnapsAndNotifyLocalStore(n.changes)];case 2:return r.sent(),[4,this.remoteStore.fillWritePipeline()];case 3:return r.sent(),[2]}}))}))},vf.prototype.runTransaction=function(t,e,n){new ff(t,this.remoteStore,e,n).run()},vf.prototype.applyRemoteEvent=function(t){return u(this,void 0,void 0,(function(){var e,n=this;return c(this,(function(r){switch(r.label){case 0:this.assertSubscribed("applyRemoteEvent()"),r.label=1;case 1:return r.trys.push([1,4,,6]),[4,this.localStore.applyRemoteEvent(t)];case 2:return e=r.sent(),ni(t.targetChanges,(function(t,e){var r=n.limboResolutionsByTarget[Number(t)];r&&(Kr(e.addedDocuments.size+e.modifiedDocuments.size+e.removedDocuments.size<=1,"Limbo resolution for single document contains multiple changes."),0<e.addedDocuments.size?r.receivedDocument=!0:0<e.modifiedDocuments.size?Kr(r.receivedDocument,"Received change for limbo target document without add."):0<e.removedDocuments.size&&(Kr(r.receivedDocument,"Received remove for limbo target document without add."),r.receivedDocument=!1))})),[4,this.emitNewSnapsAndNotifyLocalStore(e,t)];case 3:return r.sent(),[3,6];case 4:return[4,fc(r.sent())];case 5:return r.sent(),[3,6];case 6:return[2]}}))}))},vf.prototype.applyOnlineStateChange=function(t,e){if(this.isPrimary&&e===zh.RemoteStore||!this.isPrimary&&e===zh.SharedClientState){this.assertSubscribed("applyOnlineStateChange()");var n=[];this.queryViewsByQuery.forEach((function(e,r){var i=r.view.applyOnlineStateChange(t);Kr(0===i.limboChanges.length,"OnlineState should not affect limbo documents."),i.snapshot&&n.push(i.snapshot)})),this.syncEngineListener.onOnlineStateChange(t),this.syncEngineListener.onWatchChange(n),this.onlineState=t,this.isPrimary&&this.sharedClientState.setOnlineState(t)}},vf.prototype.rejectListen=function(t,e){return u(this,void 0,void 0,(function(){var n,r,i,o,a,s=this;return c(this,(function(u){switch(u.label){case 0:return this.assertSubscribed("rejectListens()"),this.sharedClientState.updateQueryState(t,"rejected",e),n=this.limboResolutionsByTarget[t],(r=n&&n.key)?(this.limboTargetsByKey=this.limboTargetsByKey.remove(r),delete this.limboResolutionsByTarget[t],i=(i=new lo(zi.comparator)).insert(r,new qs(r,co.forDeletedDoc())),o=Ro().add(r),a=new dl(co.MIN,{},new wo(Si),i,o),[2,this.applyRemoteEvent(a)]):[3,1];case 1:return[4,this.localStore.releaseTarget(t,!1).then((function(){return s.removeAndCleanupTarget(t,e)})).catch(fc)];case 2:u.sent(),u.label=3;case 3:return[2]}}))}))},vf.prototype.applyBatchState=function(t,e,n){return u(this,void 0,void 0,(function(){var r;return c(this,(function(i){switch(i.label){case 0:return this.assertSubscribed("applyBatchState()"),[4,this.localStore.lookupMutationDocuments(t)];case 1:return null===(r=i.sent())?(qr(df,"Cannot apply mutation batch with id: "+t),[2]):"pending"!==e?[3,3]:[4,this.remoteStore.fillWritePipeline()];case 2:return i.sent(),[3,4];case 3:"acknowledged"===e||"rejected"===e?(this.processUserCallback(t,n||null),this.localStore.removeCachedMutationBatchMetadata(t)):Wr("Unknown batchState: "+e),i.label=4;case 4:return[4,this.emitNewSnapsAndNotifyLocalStore(r)];case 5:return i.sent(),[2]}}))}))},vf.prototype.applySuccessfulWrite=function(t){return u(this,void 0,void 0,(function(){var e,n;return c(this,(function(r){switch(r.label){case 0:this.assertSubscribed("applySuccessfulWrite()"),e=t.batch.batchId,this.processUserCallback(e,null),this.triggerPendingWritesCallbacks(e),r.label=1;case 1:return r.trys.push([1,4,,6]),[4,this.localStore.acknowledgeBatch(t)];case 2:return n=r.sent(),this.sharedClientState.updateMutationState(e,"acknowledged"),[4,this.emitNewSnapsAndNotifyLocalStore(n)];case 3:return r.sent(),[3,6];case 4:return[4,fc(r.sent())];case 5:return r.sent(),[3,6];case 6:return[2]}}))}))},vf.prototype.rejectFailedWrite=function(t,e){return u(this,void 0,void 0,(function(){var n;return c(this,(function(r){switch(r.label){case 0:this.assertSubscribed("rejectFailedWrite()"),this.processUserCallback(t,e),this.triggerPendingWritesCallbacks(t),r.label=1;case 1:return r.trys.push([1,4,,6]),[4,this.localStore.rejectBatch(t)];case 2:return n=r.sent(),this.sharedClientState.updateMutationState(t,"rejected",e),[4,this.emitNewSnapsAndNotifyLocalStore(n)];case 3:return r.sent(),[3,6];case 4:return[4,fc(r.sent())];case 5:return r.sent(),[3,6];case 6:return[2]}}))}))},vf.prototype.registerPendingWritesCallback=function(t){return u(this,void 0,void 0,(function(){var e,n;return c(this,(function(r){switch(r.label){case 0:return this.remoteStore.canUseNetwork()||qr(df,"The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled."),[4,this.localStore.getHighestUnacknowledgedBatchId()];case 1:return-1===(e=r.sent())?t.resolve():((n=this.pendingWritesCallbacks.get(e)||[]).push(t),this.pendingWritesCallbacks.set(e,n)),[2]}}))}))},vf.prototype.triggerPendingWritesCallbacks=function(t){(this.pendingWritesCallbacks.get(t)||[]).forEach((function(t){t.resolve()})),this.pendingWritesCallbacks.delete(t)},vf.prototype.rejectOutstandingPendingWritesCallbacks=function(t){this.pendingWritesCallbacks.forEach((function(e){e.forEach((function(e){e.reject(new Xr(Yr.CANCELLED,t))}))})),this.pendingWritesCallbacks.clear()},vf.prototype.addMutationCallback=function(t,e){var n=this.mutationUserCallbacks[this.currentUser.toKey()];n=(n=n||new lo(Si)).insert(t,e),this.mutationUserCallbacks[this.currentUser.toKey()]=n},vf.prototype.processUserCallback=function(t,e){var n=this.mutationUserCallbacks[this.currentUser.toKey()];if(n){var r=n.get(t);r&&(Kr(t===n.minKey(),"Mutation callbacks processed out-of-order?"),e?r.reject(e):r.resolve(),n=n.remove(t)),this.mutationUserCallbacks[this.currentUser.toKey()]=n}},vf.prototype.removeAndCleanupTarget=function(t,e){var n=this;void 0===e&&(e=null),this.sharedClientState.removeLocalQueryTarget(t),Kr(this.queriesByTarget[t]&&0!==this.queriesByTarget[t].length,"There are no queries mapped to target id "+t);for(var r=0,i=this.queriesByTarget[t];r<i.length;r++){var o=i[r];this.queryViewsByQuery.delete(o),e&&this.syncEngineListener.onWatchError(o,e)}if(delete this.queriesByTarget[t],this.isPrimary){var a=this.limboDocumentRefs.referencesForId(t);this.limboDocumentRefs.removeReferencesForId(t),a.forEach((function(t){n.limboDocumentRefs.containsKey(t)||n.removeLimboTarget(t)}))}},vf.prototype.removeLimboTarget=function(t){var e=this.limboTargetsByKey.get(t);null!==e&&(this.remoteStore.unlisten(e),this.limboTargetsByKey=this.limboTargetsByKey.remove(t),delete this.limboResolutionsByTarget[e])},vf.prototype.updateTrackedLimbos=function(t,e){for(var n=0,r=e;n<r.length;n++){var i=r[n];i instanceof uf?(this.limboDocumentRefs.addReference(i.key,t),this.trackLimboChange(i)):i instanceof cf?(qr(df,"Document no longer in limbo: "+i.key),this.limboDocumentRefs.removeReference(i.key,t),this.limboDocumentRefs.containsKey(i.key)||this.removeLimboTarget(i.key)):Wr("Unknown limbo change: "+JSON.stringify(i))}},vf.prototype.trackLimboChange=function(t){var e=t.key;if(!this.limboTargetsByKey.get(e)){qr(df,"New document in limbo: "+e);var n=this.limboTargetIdGenerator.next(),r=Dc.atPath(e.path);this.limboResolutionsByTarget[n]=new yf(e),this.remoteStore.listen(new Bu(r.toTarget(),n,xu.LimboResolution,xi.INVALID)),this.limboTargetsByKey=this.limboTargetsByKey.insert(e,n)}},vf.prototype.currentLimboDocs=function(){return this.limboTargetsByKey},vf.prototype.emitNewSnapsAndNotifyLocalStore=function(t,e){return u(this,void 0,void 0,(function(){var n,r,i,o=this;return c(this,(function(a){switch(a.label){case 0:return n=[],r=[],i=[],this.queryViewsByQuery.forEach((function(a,s){i.push(Promise.resolve().then((function(){var e=s.view.computeDocChanges(t);return e.needsRefill?o.localStore.executeQuery(s.query,!1).then((function(t){var n=t.documents;return s.view.computeDocChanges(n,e)})):e})).then((function(t){var i=e&&e.targetChanges[s.targetId],a=s.view.applyChanges(t,!0===o.isPrimary,i);if(o.updateTrackedLimbos(s.targetId,a.limboChanges),a.snapshot){o.isPrimary&&o.sharedClientState.updateQueryState(s.targetId,a.snapshot.fromCache?"not-current":"current"),n.push(a.snapshot);var u=af.fromSnapshot(s.targetId,a.snapshot);r.push(u)}})))})),[4,Promise.all(i)];case 1:return a.sent(),this.syncEngineListener.onWatchChange(n),[4,this.localStore.notifyLocalViewChanges(r)];case 2:return a.sent(),[2]}}))}))},vf.prototype.assertSubscribed=function(t){Kr(null!==this.syncEngineListener,"Trying to call "+t+" before calling subscribe().")},vf.prototype.handleCredentialChange=function(t){return u(this,void 0,void 0,(function(){var e,n;return c(this,(function(r){switch(r.label){case 0:return e=!this.currentUser.isEqual(t),this.currentUser=t,e?(this.rejectOutstandingPendingWritesCallbacks("'waitForPendingWrites' promise is rejected due to a user change."),[4,this.localStore.handleUserChange(t)]):[3,3];case 1:return n=r.sent(),this.sharedClientState.handleUserChange(t,n.removedBatchIds,n.addedBatchIds),[4,this.emitNewSnapsAndNotifyLocalStore(n.affectedDocuments)];case 2:r.sent(),r.label=3;case 3:return[4,this.remoteStore.handleCredentialChange()];case 4:return r.sent(),[2]}}))}))},vf.prototype.applyPrimaryState=function(t){return u(this,void 0,void 0,(function(){var e,n,r,i,o,a,s,u=this;return c(this,(function(c){switch(c.label){case 0:return!0!==t||!0===this.isPrimary?[3,3]:(this.isPrimary=!0,[4,this.remoteStore.applyPrimaryState(!0)]);case 1:return c.sent(),e=this.sharedClientState.getAllActiveQueryTargets(),[4,this.synchronizeQueryViewsAndRaiseSnapshots(e.toArray())];case 2:for(n=c.sent(),r=0,i=n;r<i.length;r++)o=i[r],this.remoteStore.listen(o);return[3,7];case 3:return!1!==t||!1===this.isPrimary?[3,7]:(this.isPrimary=!1,a=[],s=Promise.resolve(),ei(this.queriesByTarget,(function(t,e){u.sharedClientState.isLocalQueryTarget(t)?a.push(t):s=s.then((function(){return u.removeAndCleanupTarget(t),u.localStore.releaseTarget(t,!0)})),u.remoteStore.unlisten(t)})),[4,s]);case 4:return c.sent(),[4,this.synchronizeQueryViewsAndRaiseSnapshots(a)];case 5:return c.sent(),this.resetLimboDocuments(),[4,this.remoteStore.applyPrimaryState(!1)];case 6:c.sent(),c.label=7;case 7:return[2]}}))}))},vf.prototype.resetLimboDocuments=function(){var t=this;ei(this.limboResolutionsByTarget,(function(e){t.remoteStore.unlisten(e)})),this.limboDocumentRefs.removeAllReferences(),this.limboResolutionsByTarget=[],this.limboTargetsByKey=new lo(zi.comparator)},vf.prototype.synchronizeQueryViewsAndRaiseSnapshots=function(t){return u(this,void 0,void 0,(function(){var e,n,r,i,o,a,s,u,h,l,f,p,d;return c(this,(function(c){switch(c.label){case 0:e=[],n=[],r=0,i=t,c.label=1;case 1:return r<i.length?(o=i[r],a=void 0,(s=this.queriesByTarget[o])&&0!==s.length?[4,this.localStore.releaseTarget(o,!0)]:[3,8]):[3,14];case 2:return c.sent(),[4,this.localStore.allocateTarget(s[0].toTarget())];case 3:a=c.sent(),u=0,h=s,c.label=4;case 4:return u<h.length?(l=h[u],Kr(!!(f=this.queryViewsByQuery.get(l)),"No query view found for "+l),[4,this.synchronizeViewAndComputeSnapshot(f)]):[3,7];case 5:(p=c.sent()).snapshot&&n.push(p.snapshot),c.label=6;case 6:return u++,[3,4];case 7:return[3,12];case 8:return Kr(!0===this.isPrimary,"A secondary tab should never have an active target without an active query."),[4,this.localStore.getTarget(o)];case 9:return Kr(!!(d=c.sent()),"Target for id "+o+" not found"),[4,this.localStore.allocateTarget(d)];case 10:return a=c.sent(),[4,this.initializeViewAndComputeSnapshot(this.synthesizeTargetToQuery(d),o,!1)];case 11:c.sent(),c.label=12;case 12:e.push(a),c.label=13;case 13:return r++,[3,1];case 14:return this.syncEngineListener.onWatchChange(n),[2,e]}}))}))},vf.prototype.synthesizeTargetToQuery=function(t){return new Dc(t.path,t.collectionGroup,t.orderBy,t.filters,t.limit,Sc.First,t.startAt,t.endAt)},vf.prototype.getActiveClients=function(){return this.localStore.getActiveClients()},vf.prototype.applyTargetState=function(t,e,n){return u(this,void 0,void 0,(function(){var r,i;return c(this,(function(o){switch(o.label){case 0:if(this.isPrimary)return qr(df,"Ignoring unexpected query state notification."),[2];if(!this.queriesByTarget[t])return[3,7];switch(e){case"current":case"not-current":return[3,1];case"rejected":return[3,4]}return[3,6];case 1:return[4,this.localStore.getNewDocumentChanges()];case 2:return r=o.sent(),i=dl.createSynthesizedRemoteEventForCurrentChange(t,"current"===e),[4,this.emitNewSnapsAndNotifyLocalStore(r,i)];case 3:return o.sent(),[3,7];case 4:return[4,this.localStore.releaseTarget(t,!0)];case 5:return o.sent(),this.removeAndCleanupTarget(t,n),[3,7];case 6:Wr("Unexpected target state: "+e),o.label=7;case 7:return[2]}}))}))},vf.prototype.applyActiveTargetsChange=function(t,e){return u(this,void 0,void 0,(function(){var n,r,i,o,a,s,u,h,l,f=this;return c(this,(function(p){switch(p.label){case 0:if(!this.isPrimary)return[2];n=0,r=t,p.label=1;case 1:return n<r.length?(l=r[n],Kr(!this.queriesByTarget[l],"Trying to add an already active target"),[4,this.localStore.getTarget(l)]):[3,6];case 2:return Kr(!!(i=p.sent()),"Query data for active target "+l+" not found"),[4,this.localStore.allocateTarget(i)];case 3:return o=p.sent(),[4,this.initializeViewAndComputeSnapshot(this.synthesizeTargetToQuery(i),o.targetId,!1)];case 4:p.sent(),this.remoteStore.listen(o),p.label=5;case 5:return n++,[3,1];case 6:a=function(t){return c(this,(function(e){switch(e.label){case 0:return s.queriesByTarget[t]?[4,s.localStore.releaseTarget(t,!1).then((function(){f.remoteStore.unlisten(t),f.removeAndCleanupTarget(t)})).catch(fc)]:[2,"continue"];case 1:return e.sent(),[2]}}))},s=this,u=0,h=e,p.label=7;case 7:return u<h.length?(l=h[u],[5,a(l)]):[3,10];case 8:p.sent(),p.label=9;case 9:return u++,[3,7];case 10:return[2]}}))}))},vf.prototype.enableNetwork=function(){return this.localStore.setNetworkEnabled(!0),this.remoteStore.enableNetwork()},vf.prototype.disableNetwork=function(){return this.localStore.setNetworkEnabled(!1),this.remoteStore.disableNetwork()},vf.prototype.getRemoteKeysForTarget=function(t){var e=this.limboResolutionsByTarget[t];if(e&&e.receivedDocument)return Ro().add(e.key);var n=Ro(),r=this.queriesByTarget[t];if(!r)return n;for(var i=0,o=r;i<o.length;i++){var a=o[i],s=this.queryViewsByQuery.get(a);Kr(!!s,"No query view found for "+a),n=n.unionWith(s.view.syncedDocuments)}return n},vf);function vf(t,e,n,r){this.localStore=t,this.remoteStore=e,this.sharedClientState=n,this.currentUser=r,this.syncEngineListener=null,this.queryViewsByQuery=new Qs((function(t){return t.canonicalId()})),this.queriesByTarget={},this.limboTargetsByKey=new lo(zi.comparator),this.limboResolutionsByTarget={},this.limboDocumentRefs=new uh,this.mutationUserCallbacks={},this.pendingWritesCallbacks=new Map,this.limboTargetIdGenerator=ca.forSyncEngine(),this.isPrimary=void 0,this.onlineState=Gh.Unknown}var bf=(wf.prototype.isAuthenticated=function(){return null!=this.uid},wf.prototype.toKey=function(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"},wf.prototype.isEqual=function(t){return t.uid===this.uid},wf.UNAUTHENTICATED=new wf(null),wf.GOOGLE_CREDENTIALS=new wf("google-credentials-uid"),wf.FIRST_PARTY=new wf("first-party-uid"),wf);function wf(t){this.uid=t}var Tf="firestore_clients";function _f(t,e){return Kr(-1===e.indexOf("_"),"Client key cannot contain '_', but was '"+e+"'"),Tf+"_"+t+"_"+e}var Ef="firestore_mutations";function Sf(t,e,n){var r=Ef+"_"+t+"_"+n;return e.isAuthenticated()&&(r+="_"+e.uid),r}var If="firestore_targets";function Cf(t,e){return If+"_"+t+"_"+e}var Nf="SharedClientState",Df=(Af.fromWebStorageEntry=function(t,e,n){var r=JSON.parse(n),i="object"==typeof r&&-1!==["pending","acknowledged","rejected"].indexOf(r.state)&&(void 0===r.error||"object"==typeof r.error),o=void 0;return i&&r.error&&(i="string"==typeof r.error.message&&"string"==typeof r.error.code)&&(o=new Xr(r.error.code,r.error.message)),i?new Af(t,e,r.state,o):(Vr(Nf,"Failed to parse mutation state for ID '"+e+"': "+n),null)},Af.prototype.toWebStorageJSON=function(){var t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)},Af);function Af(t,e,n,r){this.user=t,this.batchId=e,this.state=n,Kr(void 0!==(this.error=r)==("rejected"===n),"MutationMetadata must contain an error iff state is 'rejected'")}var Of=(kf.fromWebStorageEntry=function(t,e){var n=JSON.parse(e),r="object"==typeof n&&-1!==["not-current","current","rejected"].indexOf(n.state)&&(void 0===n.error||"object"==typeof n.error),i=void 0;return r&&n.error&&(r="string"==typeof n.error.message&&"string"==typeof n.error.code)&&(i=new Xr(n.error.code,n.error.message)),r?new kf(t,n.state,i):(Vr(Nf,"Failed to parse target state for ID '"+t+"': "+e),null)},kf.prototype.toWebStorageJSON=function(){var t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)},kf);function kf(t,e,n){this.targetId=t,this.state=e,Kr(void 0!==(this.error=n)==("rejected"===e),"QueryTargetMetadata must contain an error iff state is 'rejected'")}var Rf=(Pf.fromWebStorageEntry=function(t,e){for(var n=JSON.parse(e),r="object"==typeof n&&n.activeTargetIds instanceof Array,i=Mo(),o=0;r&&o<n.activeTargetIds.length;++o)r=Ec(n.activeTargetIds[o]),i=i.add(n.activeTargetIds[o]);return r?new Pf(t,i):(Vr(Nf,"Failed to parse client data for instance '"+t+"': "+e),null)},Pf);function Pf(t,e){this.clientId=t,this.activeTargetIds=e}var Mf=(Lf.fromWebStorageEntry=function(t){var e=JSON.parse(t);return"object"==typeof e&&e.onlineState in Gh&&"string"==typeof e.clientId?new Lf(e.clientId,Gh[e.onlineState]):(Vr(Nf,"Failed to parse online state: "+t),null)},Lf);function Lf(t,e){this.clientId=t,this.onlineState=e}var xf=(Ff.prototype.addQueryTarget=function(t){this.activeTargetIds=this.activeTargetIds.add(t)},Ff.prototype.removeQueryTarget=function(t){this.activeTargetIds=this.activeTargetIds.delete(t)},Ff.prototype.toWebStorageJSON=function(){var t={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(t)},Ff);function Ff(){this.activeTargetIds=Mo()}var jf=(Uf.isAvailable=function(t){return!(!t.window||null==t.window.localStorage)},Uf.prototype.start=function(){return u(this,void 0,void 0,(function(){var t,e,n,r,i,o,a,s,u,h,l,f=this;return c(this,(function(c){switch(c.label){case 0:return Kr(!this.started,"WebStorageSharedClientState already started"),Kr(null!==this.syncEngine,"syncEngine property must be set before calling start()"),Kr(null!==this.onlineStateHandler,"onlineStateHandler property must be set before calling start()"),[4,this.syncEngine.getActiveClients()];case 1:for(t=c.sent(),e=0,n=t;e<n.length;e++)(r=n[e])!==this.localClientId&&(i=this.getItem(_f(this.persistenceKey,r)))&&(o=Rf.fromWebStorageEntry(r,i))&&(this.activeClients[o.clientId]=o);for(this.persistClientState(),(a=this.storage.getItem(this.onlineStateKey))&&(s=this.fromWebStorageOnlineState(a))&&this.handleOnlineStateEvent(s),u=0,h=this.earlyEvents;u<h.length;u++)l=h[u],this.handleWebStorageEvent(l);return this.earlyEvents=[],this.platform.window.addEventListener("unload",(function(){return f.shutdown()})),this.started=!0,[2]}}))}))},Uf.prototype.writeSequenceNumber=function(t){this.setItem(this.sequenceNumberKey,JSON.stringify(t))},Uf.prototype.getAllActiveQueryTargets=function(){var t=Mo();return ni(this.activeClients,(function(e,n){t=t.unionWith(n.activeTargetIds)})),t},Uf.prototype.isActiveQueryTarget=function(t){for(var e in this.activeClients)if(this.activeClients.hasOwnProperty(e)&&this.activeClients[e].activeTargetIds.has(t))return!0;return!1},Uf.prototype.addPendingMutation=function(t){this.persistMutationState(t,"pending")},Uf.prototype.updateMutationState=function(t,e,n){this.persistMutationState(t,e,n),this.removeMutationState(t)},Uf.prototype.addLocalQueryTarget=function(t){var e="not-current";if(this.isActiveQueryTarget(t)){var n=this.storage.getItem(Cf(this.persistenceKey,t));if(n){var r=Of.fromWebStorageEntry(t,n);r&&(e=r.state)}}return this.localClientState.addQueryTarget(t),this.persistClientState(),e},Uf.prototype.removeLocalQueryTarget=function(t){this.localClientState.removeQueryTarget(t),this.persistClientState()},Uf.prototype.isLocalQueryTarget=function(t){return this.localClientState.activeTargetIds.has(t)},Uf.prototype.clearQueryState=function(t){this.removeItem(Cf(this.persistenceKey,t))},Uf.prototype.updateQueryState=function(t,e,n){this.persistQueryTargetState(t,e,n)},Uf.prototype.handleUserChange=function(t,e,n){var r=this;e.forEach((function(t){r.removeMutationState(t)})),this.currentUser=t,n.forEach((function(t){r.addPendingMutation(t)}))},Uf.prototype.setOnlineState=function(t){this.persistOnlineState(t)},Uf.prototype.shutdown=function(){this.started&&(this.platform.window.removeEventListener("storage",this.storageListener),this.removeItem(this.localClientStorageKey),this.started=!1)},Uf.prototype.getItem=function(t){var e=this.storage.getItem(t);return qr(Nf,"READ",t,e),e},Uf.prototype.setItem=function(t,e){qr(Nf,"SET",t,e),this.storage.setItem(t,e)},Uf.prototype.removeItem=function(t){qr(Nf,"REMOVE",t),this.storage.removeItem(t)},Uf.prototype.handleWebStorageEvent=function(t){var e=this;if(t.storageArea===this.storage){if(qr(Nf,"EVENT",t.key,t.newValue),t.key===this.localClientStorageKey)return void Vr("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.queue.enqueueAndForget((function(){return u(e,void 0,void 0,(function(){var e,n,r,i,o,a;return c(this,(function(s){if(!this.started)return this.earlyEvents.push(t),[2];if(null===t.key)return[2];if(this.clientStateKeyRe.test(t.key)){if(null==t.newValue)return n=this.fromWebStorageClientStateKey(t.key),[2,this.handleClientStateEvent(n,null)];if(e=this.fromWebStorageClientState(t.key,t.newValue))return[2,this.handleClientStateEvent(e.clientId,e)]}else if(this.mutationBatchKeyRe.test(t.key)){if(null!==t.newValue&&(r=this.fromWebStorageMutationMetadata(t.key,t.newValue)))return[2,this.handleMutationBatchEvent(r)]}else if(this.queryTargetKeyRe.test(t.key)){if(null!==t.newValue&&(i=this.fromWebStorageQueryTargetMetadata(t.key,t.newValue)))return[2,this.handleQueryTargetEvent(i)]}else if(t.key===this.onlineStateKey){if(null!==t.newValue&&(o=this.fromWebStorageOnlineState(t.newValue)))return[2,this.handleOnlineStateEvent(o)]}else t.key===this.sequenceNumberKey&&(Kr(!!this.sequenceNumberHandler,"Missing sequenceNumberHandler"),(a=function(t){var e=xi.INVALID;if(null!=t)try{var n=JSON.parse(t);Kr("number"==typeof n,"Found non-numeric sequence number"),e=n}catch(t){Vr(Nf,"Failed to read sequence number from WebStorage",t)}return e}(t.newValue))!==xi.INVALID&&this.sequenceNumberHandler(a));return[2]}))}))}))}},Object.defineProperty(Uf.prototype,"localClientState",{get:function(){return this.activeClients[this.localClientId]},enumerable:!0,configurable:!0}),Uf.prototype.persistClientState=function(){this.setItem(this.localClientStorageKey,this.localClientState.toWebStorageJSON())},Uf.prototype.persistMutationState=function(t,e,n){var r=new Df(this.currentUser,t,e,n),i=Sf(this.persistenceKey,this.currentUser,t);this.setItem(i,r.toWebStorageJSON())},Uf.prototype.removeMutationState=function(t){var e=Sf(this.persistenceKey,this.currentUser,t);this.removeItem(e)},Uf.prototype.persistOnlineState=function(t){var e={clientId:this.localClientId,onlineState:Gh[t]};this.storage.setItem(this.onlineStateKey,JSON.stringify(e))},Uf.prototype.persistQueryTargetState=function(t,e,n){var r=Cf(this.persistenceKey,t),i=new Of(t,e,n);this.setItem(r,i.toWebStorageJSON())},Uf.prototype.fromWebStorageClientStateKey=function(t){var e=this.clientStateKeyRe.exec(t);return e?e[1]:null},Uf.prototype.fromWebStorageClientState=function(t,e){var n=this.fromWebStorageClientStateKey(t);return Kr(null!==n,"Cannot parse client state key '"+t+"'"),Rf.fromWebStorageEntry(n,e)},Uf.prototype.fromWebStorageMutationMetadata=function(t,e){var n=this.mutationBatchKeyRe.exec(t);Kr(null!==n,"Cannot parse mutation batch key '"+t+"'");var r=Number(n[1]),i=void 0!==n[2]?n[2]:null;return Df.fromWebStorageEntry(new bf(i),r,e)},Uf.prototype.fromWebStorageQueryTargetMetadata=function(t,e){var n=this.queryTargetKeyRe.exec(t);Kr(null!==n,"Cannot parse query target key '"+t+"'");var r=Number(n[1]);return Of.fromWebStorageEntry(r,e)},Uf.prototype.fromWebStorageOnlineState=function(t){return Mf.fromWebStorageEntry(t)},Uf.prototype.handleMutationBatchEvent=function(t){return u(this,void 0,void 0,(function(){return c(this,(function(e){return t.user.uid!==this.currentUser.uid?(qr(Nf,"Ignoring mutation for non-active user "+t.user.uid),[2]):[2,this.syncEngine.applyBatchState(t.batchId,t.state,t.error)]}))}))},Uf.prototype.handleQueryTargetEvent=function(t){return this.syncEngine.applyTargetState(t.targetId,t.state,t.error)},Uf.prototype.handleClientStateEvent=function(t,e){var n=this,r=this.getAllActiveQueryTargets();e?this.activeClients[t]=e:delete this.activeClients[t];var i=this.getAllActiveQueryTargets(),o=[],a=[];return i.forEach((function(t){return u(n,void 0,void 0,(function(){return c(this,(function(e){return r.has(t)||o.push(t),[2]}))}))})),r.forEach((function(t){return u(n,void 0,void 0,(function(){return c(this,(function(e){return i.has(t)||a.push(t),[2]}))}))})),this.syncEngine.applyActiveTargetsChange(o,a)},Uf.prototype.handleOnlineStateEvent=function(t){this.activeClients[t.clientId]&&this.onlineStateHandler(t.onlineState)},Uf);function Uf(t,e,n,r,i){if(this.queue=t,this.platform=e,this.persistenceKey=n,this.localClientId=r,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.activeClients={},this.storageListener=this.handleWebStorageEvent.bind(this),this.started=!1,this.earlyEvents=[],!Uf.isAvailable(this.platform))throw new Xr(Yr.UNIMPLEMENTED,"LocalStorage is not available on this platform.");var o=n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.platform.window.localStorage,this.currentUser=i,this.localClientStorageKey=_f(this.persistenceKey,this.localClientId),this.sequenceNumberKey=function(t){return"firestore_sequence_number_"+t}(this.persistenceKey),this.activeClients[this.localClientId]=new xf,this.clientStateKeyRe=new RegExp("^"+Tf+"_"+o+"_([^_]*)$"),this.mutationBatchKeyRe=new RegExp("^"+Ef+"_"+o+"_(\\d+)(?:_(.*))?$"),this.queryTargetKeyRe=new RegExp("^"+If+"_"+o+"_(\\d+)$"),this.onlineStateKey=function(t){return"firestore_online_state_"+t}(this.persistenceKey),this.platform.window.addEventListener("storage",this.storageListener)}var qf=(Vf.prototype.addPendingMutation=function(t){},Vf.prototype.updateMutationState=function(t,e,n){},Vf.prototype.addLocalQueryTarget=function(t){return this.localState.addQueryTarget(t),this.queryState[t]||"not-current"},Vf.prototype.updateQueryState=function(t,e,n){this.queryState[t]=e},Vf.prototype.removeLocalQueryTarget=function(t){this.localState.removeQueryTarget(t)},Vf.prototype.isLocalQueryTarget=function(t){return this.localState.activeTargetIds.has(t)},Vf.prototype.clearQueryState=function(t){delete this.queryState[t]},Vf.prototype.getAllActiveQueryTargets=function(){return this.localState.activeTargetIds},Vf.prototype.isActiveQueryTarget=function(t){return this.localState.activeTargetIds.has(t)},Vf.prototype.start=function(){return this.localState=new xf,Promise.resolve()},Vf.prototype.handleUserChange=function(t,e,n){},Vf.prototype.setOnlineState=function(t){},Vf.prototype.shutdown=function(){},Vf.prototype.writeSequenceNumber=function(t){},Vf);function Vf(){this.localState=new xf,this.queryState={},this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null}var Bf="FirestoreClient",Wf=(Kf.prototype.lruParams=function(){return Xu.withCacheSize(this.cacheSizeBytes)},Kf);function Kf(t,e){this.cacheSizeBytes=t,this.synchronizeTabs=e}var Qf=function(){},Gf=(Hf.prototype.start=function(t){var e=this;this.verifyNotTerminated();var n=new $i,r=new $i,i=!1;return this.credentials.setChangeListener((function(o){i?e.asyncQueue.enqueueAndForget((function(){return e.handleCredentialChange(o)})):(i=!0,e.initializePersistence(t,r,o).then((function(t){return e.initializeRest(o,t)})).then(n.resolve,n.reject))})),this.asyncQueue.enqueueAndForget((function(){return n.promise})),r.promise},Hf.prototype.enableNetwork=function(){var t=this;return this.verifyNotTerminated(),this.asyncQueue.enqueue((function(){return t.syncEngine.enableNetwork()}))},Hf.prototype.initializePersistence=function(t,e,n){var r=this;return t instanceof Wf?this.startIndexedDbPersistence(n,t).then((function(t){return e.resolve(),t})).catch((function(t){if(e.reject(t),!r.canFallback(t))throw t;return console.warn("Error enabling offline persistence. Falling back to persistence disabled: "+t),r.startMemoryPersistence()})):(e.resolve(),this.startMemoryPersistence())},Hf.prototype.canFallback=function(t){return t instanceof Xr?t.code===Yr.FAILED_PRECONDITION||t.code===Yr.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&t instanceof DOMException)||22===t.code||20===t.code||11===t.code},Hf.prototype.verifyNotTerminated=function(){if(this.asyncQueue.isShuttingDown)throw new Xr(Yr.FAILED_PRECONDITION,"The client has already been terminated.")},Hf.prototype.startIndexedDbPersistence=function(t,e){var n=this,r=hc.buildStoragePrefix(this.databaseInfo),i=new $l(this.databaseInfo.databaseId,{useProto3Json:!0});return Promise.resolve().then((function(){return u(n,void 0,void 0,(function(){var n,o;return c(this,(function(a){switch(a.label){case 0:if(e.synchronizeTabs&&!jf.isAvailable(this.platform))throw new Xr(Yr.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");return n=e.lruParams(),this.sharedClientState=e.synchronizeTabs?new jf(this.asyncQueue,this.platform,r,this.clientId,t):new qf,[4,hc.createIndexedDbPersistence({allowTabSynchronization:e.synchronizeTabs,persistenceKey:r,clientId:this.clientId,platform:this.platform,queue:this.asyncQueue,serializer:i,lruParams:n,sequenceNumberSyncer:this.sharedClientState})];case 1:return o=a.sent(),[2,(this.persistence=o).referenceDelegate.garbageCollector]}}))}))}))},Hf.prototype.startMemoryPersistence=function(){return this.persistence=_h.createEagerPersistence(this.clientId),this.sharedClientState=new qf,Promise.resolve(null)},Hf.prototype.initializeRest=function(t,e){var n=this;return qr(Bf,"Initializing. user=",t.uid),this.platform.loadConnection(this.databaseInfo).then((function(r){return u(n,void 0,void 0,(function(){var n,i,o,a,s,h,l=this;return c(this,(function(f){switch(f.label){case 0:return n=new ih,this.localStore=new fh(this.persistence,n,t),[4,this.localStore.start()];case 1:return f.sent(),e&&(this.lruScheduler=new $u(e,this.asyncQueue,this.localStore)),i=this.platform.newConnectivityMonitor(),o=this.platform.newSerializer(this.databaseInfo.databaseId),a=new Kh(this.asyncQueue,r,this.credentials,o),s=function(t){return l.syncEngine.applyOnlineStateChange(t,zh.RemoteStore)},h=function(t){return l.syncEngine.applyOnlineStateChange(t,zh.SharedClientState)},this.remoteStore=new Ol(this.localStore,a,this.asyncQueue,s,i),this.syncEngine=new gf(this.localStore,this.remoteStore,this.sharedClientState,t),this.sharedClientState.onlineStateHandler=h,this.remoteStore.syncEngine=this.syncEngine,this.sharedClientState.syncEngine=this.syncEngine,this.eventMgr=new ef(this.syncEngine),[4,this.sharedClientState.start()];case 2:return f.sent(),[4,this.remoteStore.start()];case 3:return f.sent(),[4,this.persistence.setPrimaryStateListener((function(t){return u(l,void 0,void 0,(function(){return c(this,(function(e){switch(e.label){case 0:return[4,this.syncEngine.applyPrimaryState(t)];case 1:return e.sent(),this.lruScheduler&&(t&&!this.lruScheduler.started?this.lruScheduler.start():t||this.lruScheduler.stop()),[2]}}))}))}))];case 4:return f.sent(),[4,this.persistence.setDatabaseDeletedListener((function(){return u(l,void 0,void 0,(function(){return c(this,(function(t){switch(t.label){case 0:return[4,this.terminate()];case 1:return t.sent(),[2]}}))}))}))];case 5:return f.sent(),[2]}}))}))}))},Hf.prototype.handleCredentialChange=function(t){return this.asyncQueue.verifyOperationInProgress(),qr(Bf,"Credential Changed. Current user: "+t.uid),this.syncEngine.handleCredentialChange(t)},Hf.prototype.disableNetwork=function(){var t=this;return this.verifyNotTerminated(),this.asyncQueue.enqueue((function(){return t.syncEngine.disableNetwork()}))},Hf.prototype.terminate=function(){var t=this;return this.asyncQueue.enqueueAndInitiateShutdown((function(){return u(t,void 0,void 0,(function(){return c(this,(function(t){switch(t.label){case 0:return this.lruScheduler&&this.lruScheduler.stop(),[4,this.remoteStore.shutdown()];case 1:return t.sent(),[4,this.sharedClientState.shutdown()];case 2:return t.sent(),[4,this.persistence.shutdown()];case 3:return t.sent(),this.credentials.removeChangeListener(),[2]}}))}))}))},Hf.prototype.waitForPendingWrites=function(){var t=this;this.verifyNotTerminated();var e=new $i;return this.asyncQueue.enqueueAndForget((function(){return t.syncEngine.registerPendingWritesCallback(e)})),e.promise},Hf.prototype.listen=function(t,e,n){var r=this;this.verifyNotTerminated();var i=new rf(t,e,n);return this.asyncQueue.enqueueAndForget((function(){return r.eventMgr.listen(i)})),i},Hf.prototype.unlisten=function(t){var e=this;this.clientTerminated||this.asyncQueue.enqueueAndForget((function(){return e.eventMgr.unlisten(t)}))},Hf.prototype.getDocumentFromLocalCache=function(t){var e=this;return this.verifyNotTerminated(),this.asyncQueue.enqueue((function(){return e.localStore.readDocument(t)})).then((function(t){if(t instanceof Fs)return t;if(t instanceof qs)return null;throw new Xr(Yr.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)")}))},Hf.prototype.getDocumentsFromLocalCache=function(t){var e=this;return this.verifyNotTerminated(),this.asyncQueue.enqueue((function(){return u(e,void 0,void 0,(function(){var e,n,r;return c(this,(function(i){switch(i.label){case 0:return[4,this.localStore.executeQuery(t,!0)];case 1:return e=i.sent(),n=new hf(t,e.remoteKeys),r=n.computeDocChanges(e.documents),[2,n.applyChanges(r,!1).snapshot]}}))}))}))},Hf.prototype.write=function(t){var e=this;this.verifyNotTerminated();var n=new $i;return this.asyncQueue.enqueueAndForget((function(){return e.syncEngine.write(t,n)})),n.promise},Hf.prototype.databaseId=function(){return this.databaseInfo.databaseId},Hf.prototype.addSnapshotsInSyncListener=function(t){var e=this;this.verifyNotTerminated(),this.asyncQueue.enqueueAndForget((function(){return e.eventMgr.addSnapshotsInSyncListener(t),Promise.resolve()}))},Hf.prototype.removeSnapshotsInSyncListener=function(t){this.clientTerminated||this.eventMgr.removeSnapshotsInSyncListener(t)},Object.defineProperty(Hf.prototype,"clientTerminated",{get:function(){return this.asyncQueue.isShuttingDown},enumerable:!0,configurable:!0}),Hf.prototype.transaction=function(t){var e=this;this.verifyNotTerminated();var n=new $i;return this.asyncQueue.enqueueAndForget((function(){return e.syncEngine.runTransaction(e.asyncQueue,t,n),Promise.resolve()})),n.promise},Hf);function Hf(t,e,n,r){this.platform=t,this.databaseInfo=e,this.credentials=n,this.asyncQueue=r,this.clientId=_i.newId()}var zf=(Yf.prototype.next=function(t){this.scheduleEvent(this.observer.next,t)},Yf.prototype.error=function(t){this.scheduleEvent(this.observer.error,t)},Yf.prototype.mute=function(){this.muted=!0},Yf.prototype.scheduleEvent=function(t,e){var n=this;this.muted||setTimeout((function(){n.muted||t(e)}),0)},Yf);function Yf(t){this.observer=t,this.muted=!1}var Xf=(Jf.documentId=function(){return Jf._DOCUMENT_ID},Jf.prototype.isEqual=function(t){if(!(t instanceof Jf))throw vi("isEqual","FieldPath",1,t);return this._internalPath.isEqual(t._internalPath)},Jf._DOCUMENT_ID=new Jf(Gi.keyField().canonicalString()),Jf);function Jf(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];!function(t,e,n,r){if(!(e instanceof Array)||e.length<1)throw new Xr(Yr.INVALID_ARGUMENT,"Function FieldPath() requires its fieldNames argument to be an array with at least "+Ti(1,"element")+".")}(0,t);for(var n=0;n<t.length;++n)if(ui("FieldPath","string",n,t[n]),0===t[n].length)throw new Xr(Yr.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new Gi(t)}var $f=new RegExp("[~\\*/\\[\\]]"),Zf=function(t,e){this.user=e,this.type="OAuth",this.authHeaders={},this.authHeaders.Authorization="Bearer "+t},tp=(ep.prototype.getToken=function(){return Promise.resolve(null)},ep.prototype.invalidateToken=function(){},ep.prototype.setChangeListener=function(t){Kr(!this.changeListener,"Can only call setChangeListener() once."),(this.changeListener=t)(bf.UNAUTHENTICATED)},ep.prototype.removeChangeListener=function(){Kr(null!==this.changeListener,"removeChangeListener() when no listener registered"),this.changeListener=null},ep);function ep(){this.changeListener=null}var np=(rp.prototype.getToken=function(){var t=this;Kr(null!=this.tokenListener,"getToken cannot be called after listener removed.");var e=this.tokenCounter,n=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(n).then((function(n){if(t.tokenCounter!==e)throw new Xr(Yr.ABORTED,"getToken aborted due to token change.");return n?(Kr("string"==typeof n.accessToken,"Invalid tokenData returned from getToken():"+n),new Zf(n.accessToken,t.currentUser)):null})):Promise.resolve(null)},rp.prototype.invalidateToken=function(){this.forceRefresh=!0},rp.prototype.setChangeListener=function(t){Kr(!this.changeListener,"Can only call setChangeListener() once."),this.changeListener=t,this.receivedInitialUser&&t(this.currentUser)},rp.prototype.removeChangeListener=function(){Kr(null!=this.tokenListener,"removeChangeListener() called twice"),Kr(null!==this.changeListener,"removeChangeListener() called when no listener registered"),this.auth&&this.auth.removeAuthTokenListener(this.tokenListener),this.tokenListener=null,this.changeListener=null},rp.prototype.getUser=function(){var t=this.auth&&this.auth.getUid();return Kr(null===t||"string"==typeof t,"Received invalid UID: "+t),new bf(t)},rp);function rp(t){var e=this;this.tokenListener=null,this.currentUser=bf.UNAUTHENTICATED,this.receivedInitialUser=!1,this.tokenCounter=0,this.changeListener=null,this.forceRefresh=!1,this.tokenListener=function(){e.tokenCounter++,e.currentUser=e.getUser(),e.receivedInitialUser=!0,e.changeListener&&e.changeListener(e.currentUser)},this.tokenCounter=0,this.auth=t.getImmediate({optional:!0}),this.auth?this.auth.addAuthTokenListener(this.tokenListener):(this.tokenListener(null),t.get().then((function(t){e.auth=t,e.tokenListener&&e.auth.addAuthTokenListener(e.tokenListener)}),(function(){})))}var ip=(Object.defineProperty(op.prototype,"authHeaders",{get:function(){var t={"X-Goog-AuthUser":this.sessionIndex},e=this.gapi.auth.getAuthHeaderValueForFirstParty([]);return e&&(t.Authorization=e),t},enumerable:!0,configurable:!0}),op);function op(t,e){this.gapi=t,this.sessionIndex=e,this.type="FirstParty",this.user=bf.FIRST_PARTY}var ap=(sp.prototype.getToken=function(){return Promise.resolve(new ip(this.gapi,this.sessionIndex))},sp.prototype.setChangeListener=function(t){t(bf.FIRST_PARTY)},sp.prototype.removeChangeListener=function(){},sp.prototype.invalidateToken=function(){},sp);function sp(t,e){this.gapi=t,this.sessionIndex=e}function up(t){return function(t,e){if("object"!=typeof t||null===t)return!1;for(var n=t,r=0,i=["next","error","complete"];r<i.length;r++){var o=i[r];if(o in n&&"function"==typeof n[o])return!0}return!1}(t)}var cp=(hp.delete=function(){return ii("FieldValue.delete",arguments),fp.instance},hp.serverTimestamp=function(){return ii("FieldValue.serverTimestamp",arguments),mp.instance},hp.arrayUnion=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return ai("FieldValue.arrayUnion",arguments,1),new vp(t)},hp.arrayRemove=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return ai("FieldValue.arrayRemove",arguments,1),new Tp(t)},hp.increment=function(t){return ui("FieldValue.increment","number",1,t),oi("FieldValue.increment",arguments,1),new Sp(t)},hp.prototype.isEqual=function(t){return this===t},hp);function hp(t){this._methodName=t}var lp,fp=(i(pp,lp=cp),pp.instance=new pp,pp);function pp(){return lp.call(this,"FieldValue.delete")||this}var dp,mp=(i(yp,dp=cp),yp.instance=new yp,yp);function yp(){return dp.call(this,"FieldValue.serverTimestamp")||this}var gp,vp=(i(bp,gp=cp),bp);function bp(t){var e=gp.call(this,"FieldValue.arrayUnion")||this;return e._elements=t,e}var wp,Tp=(i(_p,wp=cp),_p);function _p(t){var e=wp.call(this,"FieldValue.arrayRemove")||this;return e._elements=t,e}var Ep,Sp=(i(Ip,Ep=cp),Ip);function Ip(t){var e=Ep.call(this,"FieldValue.increment")||this;return e._operand=t,e}var Cp=$r(cp,"Use FieldValue.<field>() instead."),Np=/^__.*__$/,Dp=(Ap.prototype.toMutations=function(t,e){var n=[];return null!==this.fieldMask?n.push(new Ra(t,this.data,this.fieldMask,e)):n.push(new Aa(t,this.data,e)),0<this.fieldTransforms.length&&n.push(new La(t,this.fieldTransforms)),n},Ap);function Ap(t,e,n){this.data=t,this.fieldMask=e,this.fieldTransforms=n}var Op,kp,Rp=(Pp.prototype.toMutations=function(t,e){var n=[new Ra(t,this.data,this.fieldMask,e)];return 0<this.fieldTransforms.length&&n.push(new La(t,this.fieldTransforms)),n},Pp);function Pp(t,e,n){this.data=t,this.fieldMask=e,this.fieldTransforms=n}function Mp(t){switch(t){case Op.Set:case Op.MergeSet:case Op.Update:return!0;case Op.Argument:case Op.ArrayArgument:return!1;default:throw Wr("Unexpected case for UserDataSource: "+t)}}(kp=Op=Op||{})[kp.Set=0]="Set",kp[kp.Update=1]="Update",kp[kp.MergeSet=2]="MergeSet",kp[kp.Argument=3]="Argument",kp[kp.ArrayArgument=4]="ArrayArgument";var Lp=(xp.prototype.childContextForField=function(t){var e=null==this.path?null:this.path.child(t),n=new xp(this.dataSource,this.methodName,e,!1,this.fieldTransforms,this.fieldMask);return n.validatePathSegment(t),n},xp.prototype.childContextForFieldPath=function(t){var e=null==this.path?null:this.path.child(t),n=new xp(this.dataSource,this.methodName,e,!1,this.fieldTransforms,this.fieldMask);return n.validatePath(),n},xp.prototype.childContextForArray=function(t){return new xp(this.dataSource,this.methodName,null,!0,this.fieldTransforms,this.fieldMask)},xp.prototype.createError=function(t){var e=null===this.path||this.path.isEmpty()?"":" (found in field "+this.path.toString()+")";return new Xr(Yr.INVALID_ARGUMENT,"Function "+this.methodName+"() called with invalid data. "+t+e)},xp.prototype.contains=function(t){return void 0!==this.fieldMask.find((function(e){return t.isPrefixOf(e)}))||void 0!==this.fieldTransforms.find((function(e){return t.isPrefixOf(e.field)}))},xp.prototype.validatePath=function(){if(null!==this.path)for(var t=0;t<this.path.length;t++)this.validatePathSegment(this.path.get(t))},xp.prototype.validatePathSegment=function(t){if(0===t.length)throw this.createError("Document fields must not be empty");if(Mp(this.dataSource)&&Np.test(t))throw this.createError('Document fields cannot begin and end with "__"')},xp);function xp(t,e,n,r,i,o){this.dataSource=t,this.methodName=e,this.path=n,this.arrayElement=r,void 0===i&&this.validatePath(),this.arrayElement=void 0!==r&&r,this.fieldTransforms=i||[],this.fieldMask=o||[]}var Fp=function(t,e){this.databaseId=t,this.key=e},jp=(Up.prototype.parseSetData=function(t,e){var n=new Lp(Op.Set,t,Gi.EMPTY_PATH);Vp("Data must be an object, but it was:",n,e);var r=this.parseData(e,n);return new Dp(r,null,n.fieldTransforms)},Up.prototype.parseMergeData=function(t,e,n){var r=new Lp(Op.MergeSet,t,Gi.EMPTY_PATH);Vp("Data must be an object, but it was:",r,e);var i,o,a=this.parseData(e,r);if(n){for(var s=new wo(Gi.comparator),u=0,c=n;u<c.length;u++){var h=c[u],l=void 0;if(h instanceof Xf)l=h._internalPath;else{if("string"!=typeof h)throw Wr("Expected stringOrFieldPath to be a string or a FieldPath");l=Wp(t,h)}if(!r.contains(l))throw new Xr(Yr.INVALID_ARGUMENT,"Field '"+l+"' is specified in your field mask but missing from your input data.");s=s.add(l)}i=ga.fromSet(s),o=r.fieldTransforms.filter((function(t){return i.covers(t.field)}))}else i=ga.fromArray(r.fieldMask),o=r.fieldTransforms;return new Dp(a,i,o)},Up.prototype.parseUpdateData=function(t,e){var n=this,r=new Lp(Op.Update,t,Gi.EMPTY_PATH);Vp("Data must be an object, but it was:",r,e);var i=new wo(Gi.comparator),o=As.EMPTY;ni(e,(function(e,a){var s=Wp(t,e),u=r.childContextForFieldPath(s);if((a=n.runPreConverter(a,u))instanceof fp)i=i.add(s);else{var c=n.parseData(a,u);null!=c&&(i=i.add(s),o=o.set(s,c))}}));var a=ga.fromSet(i);return new Rp(o,a,r.fieldTransforms)},Up.prototype.parseUpdateVarargs=function(t,e,n,r){var i=new Lp(Op.Update,t,Gi.EMPTY_PATH),o=[Bp(t,e)],a=[n];if(r.length%2!=0)throw new Xr(Yr.INVALID_ARGUMENT,"Function "+t+"() needs to be called with an even number of arguments that alternate between field names and values.");for(var s=0;s<r.length;s+=2)o.push(Bp(t,r[s])),a.push(r[s+1]);var u=new wo(Gi.comparator),c=As.EMPTY;for(s=0;s<o.length;++s){var h=o[s],l=i.childContextForFieldPath(h),f=this.runPreConverter(a[s],l);if(f instanceof fp)u=u.add(h);else{var p=this.parseData(f,l);null!=p&&(u=u.add(h),c=c.set(h,p))}}var d=ga.fromSet(u);return new Rp(c,d,i.fieldTransforms)},Up.prototype.parseQueryValue=function(t,e,n){void 0===n&&(n=!1);var r=new Lp(n?Op.ArrayArgument:Op.Argument,t,Gi.EMPTY_PATH),i=this.parseData(e,r);return Kr(null!=i,"Parsed data should not be null."),Kr(0===r.fieldTransforms.length,"Field transforms should have been disallowed."),i},Up.prototype.runPreConverter=function(t,e){try{return this.preConverter(t)}catch(t){var n=Kp(t);throw e.createError(n)}},Up.prototype.parseData=function(t,e){if(qp(t=this.runPreConverter(t,e)))return Vp("Unsupported field value:",e,t),this.parseObject(t,e);if(t instanceof cp)return this.parseSentinelFieldValue(t,e),null;if(e.path&&e.fieldMask.push(e.path),t instanceof Array){if(e.arrayElement&&e.dataSource!==Op.ArrayArgument)throw e.createError("Nested arrays are not supported");return this.parseArray(t,e)}return this.parseScalarValue(t,e)},Up.prototype.parseObject=function(t,e){var n=this,r=new lo(Si);return ri(t)?e.path&&0<e.path.length&&e.fieldMask.push(e.path):ni(t,(function(t,i){var o=n.parseData(i,e.childContextForField(t));null!=o&&(r=r.insert(t,o))})),new As(r)},Up.prototype.parseArray=function(t,e){for(var n=[],r=0,i=0,o=t;i<o.length;i++){var a=o[i],s=this.parseData(a,e.childContextForArray(r));null==s&&(s=Ya.INSTANCE),n.push(s),r++}return new Rs(n)},Up.prototype.parseSentinelFieldValue=function(t,e){if(!Mp(e.dataSource))throw e.createError(t._methodName+"() can only be used with update() and set()");if(null===e.path)throw e.createError(t._methodName+"() is not currently supported inside arrays");if(t instanceof fp){if(e.dataSource!==Op.MergeSet)throw e.dataSource===Op.Update?(Kr(0<e.path.length,"FieldValue.delete() at the top level should have already been handled."),e.createError("FieldValue.delete() can only appear at the top level of your update data")):e.createError("FieldValue.delete() cannot be used with set() unless you pass {merge:true}");e.fieldMask.push(e.path)}else if(t instanceof mp)e.fieldTransforms.push(new ba(e.path,Ml.instance));else if(t instanceof vp){var n=this.parseArrayTransformElements(t._methodName,t._elements),r=new xl(n);e.fieldTransforms.push(new ba(e.path,r))}else if(t instanceof Tp){n=this.parseArrayTransformElements(t._methodName,t._elements);var i=new jl(n);e.fieldTransforms.push(new ba(e.path,i))}else if(t instanceof Sp){var o=this.parseQueryValue("FieldValue.increment",t._operand),a=new ql(o);e.fieldTransforms.push(new ba(e.path,a))}else Wr("Unknown FieldValue type: "+t)},Up.prototype.parseScalarValue=function(t,e){if(null===t)return Ya.INSTANCE;if("number"==typeof t)return Ec(t)?new os(t):new us(t);if("boolean"==typeof t)return $a.of(t);if("string"==typeof t)return new ls(t);if(t instanceof Date)return new ds(so.fromDate(t));if(t instanceof so)return new ds(new so(t.seconds,1e3*Math.floor(t.nanoseconds/1e3)));if(t instanceof Rl)return new Cs(t);if(t instanceof Ai)return new ws(t);if(t instanceof Fp)return new Es(t.databaseId,t.key);throw e.createError("Unsupported field value: "+mi(t))},Up.prototype.parseArrayTransformElements=function(t,e){var n=this;return e.map((function(e,r){var i=new Lp(Op.Argument,t,Gi.EMPTY_PATH);return n.parseData(e,i.childContextForArray(r))}))},Up);function Up(t){this.preConverter=t}function qp(t){return!("object"!=typeof t||null===t||t instanceof Array||t instanceof Date||t instanceof so||t instanceof Rl||t instanceof Ai||t instanceof Fp||t instanceof cp)}function Vp(t,e,n){if(!qp(n)||!di(n)){var r=mi(n);throw"an object"===r?e.createError(t+" a custom object"):e.createError(t+" "+r)}}function Bp(t,e){if(e instanceof Xf)return e._internalPath;if("string"==typeof e)return Wp(t,e);throw new Xr(Yr.INVALID_ARGUMENT,"Function "+t+"() called with invalid data. Field path arguments must be of type string or FieldPath.")}function Wp(t,e){try{return function(t){if(0<=t.search($f))throw new Xr(Yr.INVALID_ARGUMENT,"Invalid field path ("+t+"). Paths must not contain '~', '*', '/', '[', or ']'");try{return new(Xf.bind.apply(Xf,h([void 0],t.split("."))))}catch(e){throw new Xr(Yr.INVALID_ARGUMENT,"Invalid field path ("+t+"). Paths must not be empty, begin with '.', end with '.', or contain '..'")}}(e)._internalPath}catch(e){var n=Kp(e);throw new Xr(Yr.INVALID_ARGUMENT,"Function "+t+"() called with invalid data. "+n)}}function Kp(t){return t instanceof Error?t.message:t.toString()}var Qp=Xu.COLLECTION_DISABLED,Gp=(Hp.prototype.isEqual=function(t){return this.host===t.host&&this.ssl===t.ssl&&this.timestampsInSnapshots===t.timestampsInSnapshots&&this.credentials===t.credentials&&this.cacheSizeBytes===t.cacheSizeBytes&&this.forceLongPolling===t.forceLongPolling},Hp);function Hp(t){if(void 0===t.host){if(void 0!==t.ssl)throw new Xr(Yr.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else hi("settings","non-empty string","host",t.host),this.host=t.host,li("settings","boolean","ssl",t.ssl),this.ssl=ti(t.ssl,!0);if(gi("settings",t,["host","ssl","credentials","timestampsInSnapshots","cacheSizeBytes","experimentalForceLongPolling"]),li("settings","object","credentials",t.credentials),this.credentials=t.credentials,li("settings","boolean","timestampsInSnapshots",t.timestampsInSnapshots),!0===t.timestampsInSnapshots?Vr("\n  The timestampsInSnapshots setting now defaults to true and you no\n  longer need to explicitly set it. In a future release, the setting\n  will be removed entirely and so it is recommended that you remove it\n  from your firestore.settings() call now."):!1===t.timestampsInSnapshots&&Vr("\n  The timestampsInSnapshots setting will soon be removed. YOU MUST UPDATE\n  YOUR CODE.\n\n  To hide this warning, stop using the timestampsInSnapshots setting in your\n  firestore.settings({ ... }) call.\n\n  Once you remove the setting, Timestamps stored in Cloud Firestore will be\n  read back as Firebase Timestamp objects instead of as system Date objects.\n  So you will also need to update code expecting a Date to instead expect a\n  Timestamp. For example:\n\n  // Old:\n  const date = snapshot.get('created_at');\n  // New:\n  const timestamp = snapshot.get('created_at'); const date =\n  timestamp.toDate();\n\n  Please audit all existing usages of Date when you enable the new\n  behavior."),this.timestampsInSnapshots=ti(t.timestampsInSnapshots,!0),li("settings","number","cacheSizeBytes",t.cacheSizeBytes),void 0===t.cacheSizeBytes)this.cacheSizeBytes=Xu.DEFAULT_CACHE_SIZE_BYTES;else{if(t.cacheSizeBytes!==Qp&&t.cacheSizeBytes<Xu.MINIMUM_CACHE_SIZE_BYTES)throw new Xr(Yr.INVALID_ARGUMENT,"cacheSizeBytes must be at least "+Xu.MINIMUM_CACHE_SIZE_BYTES);this.cacheSizeBytes=t.cacheSizeBytes}li("settings","boolean","experimentalForceLongPolling",t.experimentalForceLongPolling),this.forceLongPolling=void 0!==t.experimentalForceLongPolling&&t.experimentalForceLongPolling}var zp=(Yp.prototype.settings=function(t){if(oi("Firestore.settings",arguments,1),ui("Firestore.settings","object",1,t),Zr(t,"persistence"))throw new Xr(Yr.INVALID_ARGUMENT,'"persistence" is now specified with a separate call to firestore.enablePersistence().');var e=new Gp(t);if(this._firestoreClient&&!this._settings.isEqual(e))throw new Xr(Yr.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only call settings() before calling any other methods on a Firestore object.");void 0!==(this._settings=e).credentials&&(this._credentials=function(t){if(!t)return new tp;switch(t.type){case"gapi":var e=t.client;return Kr(!("object"!=typeof e||null===e||!e.auth||!e.auth.getAuthHeaderValueForFirstParty),"unexpected gapi interface"),new ap(e,t.sessionIndex||"0");case"provider":return t.client;default:throw new Xr(Yr.INVALID_ARGUMENT,"makeCredentialsProvider failed due to invalid credential type")}}(e.credentials))},Yp.prototype.enableNetwork=function(){return this.ensureClientConfigured(),this._firestoreClient.enableNetwork()},Yp.prototype.disableNetwork=function(){return this.ensureClientConfigured(),this._firestoreClient.disableNetwork()},Yp.prototype.enablePersistence=function(t){if(this._firestoreClient)throw new Xr(Yr.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only call enablePersistence() before calling any other methods on a Firestore object.");var e=!1;return t&&(void 0!==t.experimentalTabSynchronization&&Vr("The 'experimentalTabSynchronization' setting has been renamed to 'synchronizeTabs'. In a future release, the setting will be removed and it is recommended that you update your firestore.enablePersistence() call to use 'synchronizeTabs'."),e=ti(void 0!==t.synchronizeTabs?t.synchronizeTabs:t.experimentalTabSynchronization,!1)),this.configureClient(new Wf(this._settings.cacheSizeBytes,e))},Yp.prototype.clearPersistence=function(){var t=this,e=hc.buildStoragePrefix(this.makeDatabaseInfo()),n=new $i;return this._queue.enqueueAndForgetEvenAfterShutdown((function(){return u(t,void 0,void 0,(function(){var t;return c(this,(function(r){switch(r.label){case 0:if(r.trys.push([0,2,,3]),void 0!==this._firestoreClient&&!this._firestoreClient.clientTerminated)throw new Xr(Yr.FAILED_PRECONDITION,"Persistence cannot be cleared after this Firestore instance is initialized.");return[4,hc.clearPersistence(e)];case 1:return r.sent(),n.resolve(),[3,3];case 2:return t=r.sent(),n.reject(t),[3,3];case 3:return[2]}}))}))})),n.promise},Yp.prototype.terminate=function(){return this.app._removeServiceInstance("firestore"),this.INTERNAL.delete()},Object.defineProperty(Yp.prototype,"_isTerminated",{get:function(){return this.ensureClientConfigured(),this._firestoreClient.clientTerminated},enumerable:!0,configurable:!0}),Yp.prototype.waitForPendingWrites=function(){return this.ensureClientConfigured(),this._firestoreClient.waitForPendingWrites()},Yp.prototype.onSnapshotsInSync=function(t){if(this.ensureClientConfigured(),up(t))return this.onSnapshotsInSyncInternal(t);ui("Firestore.onSnapshotsInSync","function",1,t);var e={next:t};return this.onSnapshotsInSyncInternal(e)},Yp.prototype.onSnapshotsInSyncInternal=function(t){var e=this,n=new zf({next:function(){t.next&&t.next()},error:function(t){throw Wr("Uncaught Error in onSnapshotsInSync")}});return this._firestoreClient.addSnapshotsInSyncListener(n),function(){n.mute(),e._firestoreClient.removeSnapshotsInSyncListener(n)}},Yp.prototype.ensureClientConfigured=function(){return this._firestoreClient||this.configureClient(new Qf),this._firestoreClient},Yp.prototype.makeDatabaseInfo=function(){return new Ri(this._databaseId,this._persistenceKey,this._settings.host,this._settings.ssl,this._settings.forceLongPolling)},Yp.prototype.configureClient=function(t){Kr(!!this._settings.host,"FirestoreSettings.host is not set"),Kr(!this._firestoreClient,"configureClient() called multiple times");var e=this.makeDatabaseInfo();return this._firestoreClient=new Gf(Qr.getPlatform(),e,this._credentials,this._queue),this._firestoreClient.start(t)},Yp.prototype.createDataConverter=function(t){return new jp((function(e){if(e instanceof td){var n=t,r=e.firestore._databaseId;if(!r.isEqual(n))throw new Xr(Yr.INVALID_ARGUMENT,"Document reference is for database "+r.projectId+"/"+r.database+" but should be for database "+n.projectId+"/"+n.database);return new Fp(t,e._key)}return e}))},Yp.databaseIdFromApp=function(t){var e=t.options;if(!Zr(e,"projectId"))throw new Xr(Yr.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');var n=e.projectId;if(!n||"string"!=typeof n)throw new Xr(Yr.INVALID_ARGUMENT,"projectId must be a string in FirebaseApp.options");return new Mi(n)},Object.defineProperty(Yp.prototype,"app",{get:function(){if(!this._firebaseApp)throw new Xr(Yr.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._firebaseApp},enumerable:!0,configurable:!0}),Yp.prototype.collection=function(t){return oi("Firestore.collection",arguments,1),ui("Firestore.collection","non-empty string",1,t),this.ensureClientConfigured(),new dd(Bi.fromString(t),this)},Yp.prototype.doc=function(t){return oi("Firestore.doc",arguments,1),ui("Firestore.doc","non-empty string",1,t),this.ensureClientConfigured(),td.forPath(Bi.fromString(t),this)},Yp.prototype.collectionGroup=function(t){if(oi("Firestore.collectionGroup",arguments,1),ui("Firestore.collectionGroup","non-empty string",1,t),0<=t.indexOf("/"))throw new Xr(Yr.INVALID_ARGUMENT,"Invalid collection ID '"+t+"' passed to function Firestore.collectionGroup(). Collection IDs must not contain '/'.");return this.ensureClientConfigured(),new cd(new Dc(Bi.EMPTY_PATH,t),this)},Yp.prototype.runTransaction=function(t){var e=this;return oi("Firestore.runTransaction",arguments,1),ui("Firestore.runTransaction","function",1,t),this.ensureClientConfigured().transaction((function(n){return t(new Xp(e,n))}))},Yp.prototype.batch=function(){return this.ensureClientConfigured(),new $p(this)},Object.defineProperty(Yp,"logLevel",{get:function(){switch(jr()){case Dr.DEBUG:return"debug";case Dr.ERROR:return"error";case Dr.SILENT:return"silent";default:return Wr("Unknown log level: "+jr())}},enumerable:!0,configurable:!0}),Yp.setLogLevel=function(t){switch(oi("Firestore.setLogLevel",arguments,1),ui("Firestore.setLogLevel","non-empty string",1,t),t){case"debug":Ur(Dr.DEBUG);break;case"error":Ur(Dr.ERROR);break;case"silent":Ur(Dr.SILENT);break;default:throw new Xr(Yr.INVALID_ARGUMENT,"Invalid log level: "+t)}},Yp.prototype._areTimestampsInSnapshotsEnabled=function(){return this._settings.timestampsInSnapshots},Yp);function Yp(t,e){var n=this;if(this._firebaseApp=null,this._queue=new eo,this.INTERNAL={delete:function(){return u(n,void 0,void 0,(function(){return c(this,(function(t){switch(t.label){case 0:return this.ensureClientConfigured(),[4,this._firestoreClient.terminate()];case 1:return t.sent(),[2]}}))}))}},"object"==typeof t.options){var r=t;this._firebaseApp=r,this._databaseId=Yp.databaseIdFromApp(r),this._persistenceKey=r.name,this._credentials=new np(e)}else{var i=t;if(!i.projectId)throw new Xr(Yr.INVALID_ARGUMENT,"Must provide projectId");this._databaseId=new Mi(i.projectId,i.database),this._persistenceKey="[DEFAULT]",this._credentials=new tp}this._settings=new Gp({}),this._dataConverter=this.createDataConverter(this._databaseId)}var Xp=(Jp.prototype.get=function(t){var e=this;oi("Transaction.get",arguments,1);var n=bd("Transaction.get",t,this._firestore);return this._transaction.lookup([n._key]).then((function(t){if(!t||1!==t.length)return Wr("Mismatch in docs returned from document lookup.");var r=t[0];if(r instanceof qs)return new id(e._firestore,n._key,null,!1,!1,n._converter);if(r instanceof Fs)return new id(e._firestore,n._key,r,!1,!1,n._converter);throw Wr("BatchGetDocumentsRequest returned unexpected document type: "+r.constructor.name)}))},Jp.prototype.set=function(t,e,n){si("Transaction.set",arguments,2,3);var r=bd("Transaction.set",t,this._firestore);n=yd("Transaction.set",n);var i=wd(r._converter,e,"Transaction.set"),o=i[0],a=i[1],s=n.merge||n.mergeFields?this._firestore._dataConverter.parseMergeData(a,o,n.mergeFields):this._firestore._dataConverter.parseSetData(a,o);return this._transaction.set(r._key,s),this},Jp.prototype.update=function(t,e,n){for(var r,i,o=[],a=3;a<arguments.length;a++)o[a-3]=arguments[a];return i="string"==typeof e||e instanceof Xf?(ai("Transaction.update",arguments,3),r=bd("Transaction.update",t,this._firestore),this._firestore._dataConverter.parseUpdateVarargs("Transaction.update",e,n,o)):(oi("Transaction.update",arguments,2),r=bd("Transaction.update",t,this._firestore),this._firestore._dataConverter.parseUpdateData("Transaction.update",e)),this._transaction.update(r._key,i),this},Jp.prototype.delete=function(t){oi("Transaction.delete",arguments,1);var e=bd("Transaction.delete",t,this._firestore);return this._transaction.delete(e._key),this},Jp);function Jp(t,e){this._firestore=t,this._transaction=e}var $p=(Zp.prototype.set=function(t,e,n){si("WriteBatch.set",arguments,2,3),this.verifyNotCommitted();var r=bd("WriteBatch.set",t,this._firestore);n=yd("WriteBatch.set",n);var i=wd(r._converter,e,"WriteBatch.set"),o=i[0],a=i[1],s=n.merge||n.mergeFields?this._firestore._dataConverter.parseMergeData(a,o,n.mergeFields):this._firestore._dataConverter.parseSetData(a,o);return this._mutations=this._mutations.concat(s.toMutations(r._key,Sa.NONE)),this},Zp.prototype.update=function(t,e,n){for(var r,i,o=[],a=3;a<arguments.length;a++)o[a-3]=arguments[a];return this.verifyNotCommitted(),i="string"==typeof e||e instanceof Xf?(ai("WriteBatch.update",arguments,3),r=bd("WriteBatch.update",t,this._firestore),this._firestore._dataConverter.parseUpdateVarargs("WriteBatch.update",e,n,o)):(oi("WriteBatch.update",arguments,2),r=bd("WriteBatch.update",t,this._firestore),this._firestore._dataConverter.parseUpdateData("WriteBatch.update",e)),this._mutations=this._mutations.concat(i.toMutations(r._key,Sa.exists(!0))),this},Zp.prototype.delete=function(t){oi("WriteBatch.delete",arguments,1),this.verifyNotCommitted();var e=bd("WriteBatch.delete",t,this._firestore);return this._mutations=this._mutations.concat(new Ba(e._key,Sa.NONE)),this},Zp.prototype.commit=function(){return u(this,void 0,void 0,(function(){return c(this,(function(t){return this.verifyNotCommitted(),this._committed=!0,0<this._mutations.length?[2,this._firestore.ensureClientConfigured().write(this._mutations)]:[2]}))}))},Zp.prototype.verifyNotCommitted=function(){if(this._committed)throw new Xr(Yr.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")},Zp);function Zp(t){this._firestore=t,this._mutations=[],this._committed=!1}var td=(ed.forPath=function(t,e,n){if(t.length%2!=0)throw new Xr(Yr.INVALID_ARGUMENT,"Invalid document reference. Document references must have an even number of segments, but "+t.canonicalString()+" has "+t.length);return new ed(new zi(t),e,n)},Object.defineProperty(ed.prototype,"id",{get:function(){return this._key.path.lastSegment()},enumerable:!0,configurable:!0}),Object.defineProperty(ed.prototype,"parent",{get:function(){return new dd(this._key.path.popLast(),this.firestore,this._converter)},enumerable:!0,configurable:!0}),Object.defineProperty(ed.prototype,"path",{get:function(){return this._key.path.canonicalString()},enumerable:!0,configurable:!0}),ed.prototype.collection=function(t){if(oi("DocumentReference.collection",arguments,1),ui("DocumentReference.collection","non-empty string",1,t),!t)throw new Xr(Yr.INVALID_ARGUMENT,"Must provide a non-empty collection name to collection()");var e=Bi.fromString(t);return new dd(this._key.path.child(e),this.firestore)},ed.prototype.isEqual=function(t){if(!(t instanceof ed))throw vi("isEqual","DocumentReference",1,t);return this.firestore===t.firestore&&this._key.isEqual(t._key)&&this._converter===t._converter},ed.prototype.set=function(t,e){si("DocumentReference.set",arguments,1,2),e=yd("DocumentReference.set",e);var n=wd(this._converter,t,"DocumentReference.set"),r=n[0],i=n[1],o=e.merge||e.mergeFields?this.firestore._dataConverter.parseMergeData(i,r,e.mergeFields):this.firestore._dataConverter.parseSetData(i,r);return this._firestoreClient.write(o.toMutations(this._key,Sa.NONE))},ed.prototype.update=function(t,e){for(var n,r=[],i=2;i<arguments.length;i++)r[i-2]=arguments[i];return n="string"==typeof t||t instanceof Xf?(ai("DocumentReference.update",arguments,2),this.firestore._dataConverter.parseUpdateVarargs("DocumentReference.update",t,e,r)):(oi("DocumentReference.update",arguments,1),this.firestore._dataConverter.parseUpdateData("DocumentReference.update",t)),this._firestoreClient.write(n.toMutations(this._key,Sa.exists(!0)))},ed.prototype.delete=function(){return oi("DocumentReference.delete",arguments,0),this._firestoreClient.write([new Ba(this._key,Sa.NONE)])},ed.prototype.onSnapshot=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];si("DocumentReference.onSnapshot",arguments,1,4);var n,r={includeMetadataChanges:!1},i=0;"object"!=typeof t[i]||up(t[i])||(gi("DocumentReference.onSnapshot",r=t[i],["includeMetadataChanges"]),li("DocumentReference.onSnapshot","boolean","includeMetadataChanges",r.includeMetadataChanges),i++);var o={includeMetadataChanges:r.includeMetadataChanges};return n=up(t[i])?t[i]:(ui("DocumentReference.onSnapshot","function",i,t[i]),ci("DocumentReference.onSnapshot","function",i+1,t[i+1]),ci("DocumentReference.onSnapshot","function",i+2,t[i+2]),{next:t[i],error:t[i+1],complete:t[i+2]}),this.onSnapshotInternal(o,n)},ed.prototype.onSnapshotInternal=function(t,e){var n=this,r=function(t){console.error("Uncaught Error in onSnapshot:",t)};e.error&&(r=e.error.bind(e));var i=new zf({next:function(t){if(e.next){Kr(t.docs.size<=1,"Too many documents returned on a document query");var r=t.docs.get(n._key);e.next(new id(n.firestore,n._key,r,t.fromCache,t.hasPendingWrites,n._converter))}},error:r}),o=this._firestoreClient.listen(Dc.atPath(this._key.path),i,t);return function(){i.mute(),n._firestoreClient.unlisten(o)}},ed.prototype.get=function(t){var e=this;return si("DocumentReference.get",arguments,0,1),vd("DocumentReference.get",t),new Promise((function(n,r){t&&"cache"===t.source?e.firestore.ensureClientConfigured().getDocumentFromLocalCache(e._key).then((function(t){n(new id(e.firestore,e._key,t,!0,t instanceof Fs&&t.hasLocalMutations,e._converter))}),r):e.getViaSnapshotListener(n,r,t)}))},ed.prototype.getViaSnapshotListener=function(t,e,n){var r=this.onSnapshotInternal({includeMetadataChanges:!0,waitForSyncWhenOnline:!0},{next:function(i){r(),!i.exists&&i.metadata.fromCache?e(new Xr(Yr.UNAVAILABLE,"Failed to get document because the client is offline.")):i.exists&&i.metadata.fromCache&&n&&"server"===n.source?e(new Xr(Yr.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):t(i)},error:e})},ed.prototype.withConverter=function(t){return new ed(this._key,this.firestore,t)},ed);function ed(t,e,n){this._key=t,this.firestore=e,this._converter=n,this._firestoreClient=this.firestore.ensureClientConfigured()}var nd=(rd.prototype.isEqual=function(t){return this.hasPendingWrites===t.hasPendingWrites&&this.fromCache===t.fromCache},rd);function rd(t,e){this.hasPendingWrites=t,this.fromCache=e}var id=(od.prototype.data=function(t){if(si("DocumentSnapshot.data",arguments,0,1),t=gd("DocumentSnapshot.data",t),this._document){if(this._converter){var e=new sd(this._firestore,this._key,this._document,this._fromCache,this._hasPendingWrites);return this._converter.fromFirestore(e,t)}return this.toJSObject(this._document.data(),Ka.fromSnapshotOptions(t,this._firestore._areTimestampsInSnapshotsEnabled()))}},od.prototype.get=function(t,e){if(si("DocumentSnapshot.get",arguments,1,2),e=gd("DocumentSnapshot.get",e),this._document){var n=this._document.data().field(Bp("DocumentSnapshot.get",t));if(null!==n)return this.toJSValue(n,Ka.fromSnapshotOptions(e,this._firestore._areTimestampsInSnapshotsEnabled()))}},Object.defineProperty(od.prototype,"id",{get:function(){return this._key.path.lastSegment()},enumerable:!0,configurable:!0}),Object.defineProperty(od.prototype,"ref",{get:function(){return new td(this._key,this._firestore,this._converter)},enumerable:!0,configurable:!0}),Object.defineProperty(od.prototype,"exists",{get:function(){return null!==this._document},enumerable:!0,configurable:!0}),Object.defineProperty(od.prototype,"metadata",{get:function(){return new nd(this._hasPendingWrites,this._fromCache)},enumerable:!0,configurable:!0}),od.prototype.isEqual=function(t){if(!(t instanceof od))throw vi("isEqual","DocumentSnapshot",1,t);return this._firestore===t._firestore&&this._fromCache===t._fromCache&&this._key.isEqual(t._key)&&(null===this._document?null===t._document:this._document.isEqual(t._document))&&this._converter===t._converter},od.prototype.toJSObject=function(t,e){var n=this,r={};return t.forEach((function(t,i){r[t]=n.toJSValue(i,e)})),r},od.prototype.toJSValue=function(t,e){if(t instanceof As)return this.toJSObject(t,e);if(t instanceof Rs)return this.toJSArray(t,e);if(t instanceof Es){var n=t.value(e),r=this._firestore.ensureClientConfigured().databaseId();return t.databaseId.isEqual(r)||Vr("Document "+this._key.path+" contains a document reference within a different database ("+t.databaseId.projectId+"/"+t.databaseId.database+") which is not supported. It will be treated as a reference in the current database ("+r.projectId+"/"+r.database+") instead."),new td(n,this._firestore,this._converter)}return t.value(e)},od.prototype.toJSArray=function(t,e){var n=this;return t.internalValue.map((function(t){return n.toJSValue(t,e)}))},od);function od(t,e,n,r,i,o){this._firestore=t,this._key=e,this._document=n,this._fromCache=r,this._hasPendingWrites=i,this._converter=o}var ad,sd=(i(ud,ad=id),ud.prototype.data=function(t){var e=ad.prototype.data.call(this,t);return Kr(void 0!==e,"Document in a QueryDocumentSnapshot should exist"),e},ud);function ud(){return null!==ad&&ad.apply(this,arguments)||this}var cd=(hd.prototype.where=function(t,e,n){var r;oi("Query.where",arguments,3),yi("Query.where",3,n),function(t,e,n,r){if(!e.some((function(t){return t===r})))throw new Xr(Yr.INVALID_ARGUMENT,"Invalid value "+mi(r)+" provided to function Query.where() for its "+wi(2)+" argument. Acceptable values: "+e.join(", "))}(0,["<","<=","==",">=",">","array-contains","in","array-contains-any"],0,e);var i=Bp("Query.where",t),o=Oc.fromString(e);if(i.isKeyField()){if(o===Oc.ARRAY_CONTAINS||o===Oc.ARRAY_CONTAINS_ANY)throw new Xr(Yr.INVALID_ARGUMENT,"Invalid Query. You can't perform '"+o.toString()+"' queries on FieldPath.documentId().");if(o===Oc.IN){this.validateDisjunctiveFilterElements(n,o);for(var a=[],s=0,u=n;s<u.length;s++){var c=u[s];a.push(this.parseDocumentIdValue(c))}r=new Rs(a)}else r=this.parseDocumentIdValue(n)}else o!==Oc.IN&&o!==Oc.ARRAY_CONTAINS_ANY||this.validateDisjunctiveFilterElements(n,o),r=this.firestore._dataConverter.parseQueryValue("Query.where",n,o===Oc.IN);var h=Pc.create(i,o,r);return this.validateNewFilter(h),new hd(this._query.addFilter(h),this.firestore,this._converter)},hd.prototype.orderBy=function(t,e){var n;if(si("Query.orderBy",arguments,1,2),ci("Query.orderBy","non-empty string",2,e),void 0===e||"asc"===e)n=Xc.ASCENDING;else{if("desc"!==e)throw new Xr(Yr.INVALID_ARGUMENT,"Function Query.orderBy() has unknown direction '"+e+"', expected 'asc' or 'desc'.");n=Xc.DESCENDING}if(null!==this._query.startAt)throw new Xr(Yr.INVALID_ARGUMENT,"Invalid query. You must not call Query.startAt() or Query.startAfter() before calling Query.orderBy().");if(null!==this._query.endAt)throw new Xr(Yr.INVALID_ARGUMENT,"Invalid query. You must not call Query.endAt() or Query.endBefore() before calling Query.orderBy().");var r=Bp("Query.orderBy",t),i=new th(r,n);return this.validateNewOrderBy(i),new hd(this._query.addOrderBy(i),this.firestore,this._converter)},hd.prototype.limit=function(t){return oi("Query.limit",arguments,1),ui("Query.limit","number",1,t),bi("Query.limit",1,t),new hd(this._query.withLimitToFirst(t),this.firestore,this._converter)},hd.prototype.limitToLast=function(t){return oi("Query.limitToLast",arguments,1),ui("Query.limitToLast","number",1,t),bi("Query.limitToLast",1,t),new hd(this._query.withLimitToLast(t),this.firestore,this._converter)},hd.prototype.startAt=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];ai("Query.startAt",arguments,1);var r=this.boundFromDocOrFields("Query.startAt",t,e,!0);return new hd(this._query.withStartAt(r),this.firestore,this._converter)},hd.prototype.startAfter=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];ai("Query.startAfter",arguments,1);var r=this.boundFromDocOrFields("Query.startAfter",t,e,!1);return new hd(this._query.withStartAt(r),this.firestore,this._converter)},hd.prototype.endBefore=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];ai("Query.endBefore",arguments,1);var r=this.boundFromDocOrFields("Query.endBefore",t,e,!0);return new hd(this._query.withEndAt(r),this.firestore,this._converter)},hd.prototype.endAt=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];ai("Query.endAt",arguments,1);var r=this.boundFromDocOrFields("Query.endAt",t,e,!1);return new hd(this._query.withEndAt(r),this.firestore,this._converter)},hd.prototype.isEqual=function(t){if(!(t instanceof hd))throw vi("isEqual","Query",1,t);return this.firestore===t.firestore&&this._query.isEqual(t._query)},hd.prototype.withConverter=function(t){return new hd(this._query,this.firestore,t)},hd.prototype.boundFromDocOrFields=function(t,e,n,r){if(yi(t,1,e),e instanceof id){if(0<n.length)throw new Xr(Yr.INVALID_ARGUMENT,"Too many arguments provided to "+t+"().");var i=e;if(!i.exists)throw new Xr(Yr.NOT_FOUND,"Can't use a DocumentSnapshot that doesn't exist for "+t+"().");return this.boundFromDocument(t,i._document,r)}var o=[e].concat(n);return this.boundFromFields(t,o,r)},hd.prototype.boundFromDocument=function(t,e,n){for(var r=[],i=0,o=this._query.orderBy;i<o.length;i++){var a=o[i];if(a.field.isKeyField())r.push(new Es(this.firestore._databaseId,e.key));else{var s=e.field(a.field);if(s instanceof gs)throw new Xr(Yr.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+a.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null===s){var u=a.field.canonicalString();throw new Xr(Yr.INVALID_ARGUMENT,"Invalid query. You are trying to start or end a query using a document for which the field '"+u+"' (used as the orderBy) does not exist.")}r.push(s)}}return new $c(r,n)},hd.prototype.boundFromFields=function(t,e,n){var r=this._query.explicitOrderBy;if(e.length>r.length)throw new Xr(Yr.INVALID_ARGUMENT,"Too many arguments provided to "+t+"(). The number of arguments must be less than or equal to the number of Query.orderBy() clauses");for(var i=[],o=0;o<e.length;o++){var a=e[o];if(r[o].field.isKeyField()){if("string"!=typeof a)throw new Xr(Yr.INVALID_ARGUMENT,"Invalid query. Expected a string for document ID in "+t+"(), but got a "+typeof a);if(!this._query.isCollectionGroupQuery()&&-1!==a.indexOf("/"))throw new Xr(Yr.INVALID_ARGUMENT,"Invalid query. When querying a collection and ordering by FieldPath.documentId(), the value passed to "+t+"() must be a plain document ID, but '"+a+"' contains a slash.");var s=this._query.path.child(Bi.fromString(a));if(!zi.isDocumentKey(s))throw new Xr(Yr.INVALID_ARGUMENT,"Invalid query. When querying a collection group and ordering by FieldPath.documentId(), the value passed to "+t+"() must result in a valid document path, but '"+s+"' is not because it contains an odd number of segments.");var u=new zi(s);i.push(new Es(this.firestore._databaseId,u))}else{var c=this.firestore._dataConverter.parseQueryValue(t,a);i.push(c)}}return new $c(i,n)},hd.prototype.onSnapshot=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];si("Query.onSnapshot",arguments,1,4);var n,r={},i=0;return"object"!=typeof t[i]||up(t[i])||(gi("Query.onSnapshot",r=t[i],["includeMetadataChanges"]),li("Query.onSnapshot","boolean","includeMetadataChanges",r.includeMetadataChanges),i++),n=up(t[i])?t[i]:(ui("Query.onSnapshot","function",i,t[i]),ci("Query.onSnapshot","function",i+1,t[i+1]),ci("Query.onSnapshot","function",i+2,t[i+2]),{next:t[i],error:t[i+1],complete:t[i+2]}),this.validateHasExplicitOrderByForLimitToLast(this._query),this.onSnapshotInternal(r,n)},hd.prototype.onSnapshotInternal=function(t,e){var n=this,r=function(t){console.error("Uncaught Error in onSnapshot:",t)};e.error&&(r=e.error.bind(e));var i=new zf({next:function(t){e.next&&e.next(new ld(n.firestore,n._query,t,n._converter))},error:r}),o=this.firestore.ensureClientConfigured(),a=o.listen(this._query,i,t);return function(){i.mute(),o.unlisten(a)}},hd.prototype.validateHasExplicitOrderByForLimitToLast=function(t){if(t.hasLimitToLast()&&0===t.explicitOrderBy.length)throw new Xr(Yr.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")},hd.prototype.get=function(t){var e=this;return si("Query.get",arguments,0,1),vd("Query.get",t),this.validateHasExplicitOrderByForLimitToLast(this._query),new Promise((function(n,r){t&&"cache"===t.source?e.firestore.ensureClientConfigured().getDocumentsFromLocalCache(e._query).then((function(t){n(new ld(e.firestore,e._query,t,e._converter))}),r):e.getViaSnapshotListener(n,r,t)}))},hd.prototype.getViaSnapshotListener=function(t,e,n){var r=this.onSnapshotInternal({includeMetadataChanges:!0,waitForSyncWhenOnline:!0},{next:function(i){r(),i.metadata.fromCache&&n&&"server"===n.source?e(new Xr(Yr.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):t(i)},error:e})},hd.prototype.parseDocumentIdValue=function(t){if("string"==typeof t){if(""===t)throw new Xr(Yr.INVALID_ARGUMENT,"Invalid query. When querying with FieldPath.documentId(), you must provide a valid document ID, but it was an empty string.");if(!this._query.isCollectionGroupQuery()&&-1!==t.indexOf("/"))throw new Xr(Yr.INVALID_ARGUMENT,"Invalid query. When querying a collection by FieldPath.documentId(), you must provide a plain document ID, but '"+t+"' contains a '/' character.");var e=this._query.path.child(Bi.fromString(t));if(!zi.isDocumentKey(e))throw new Xr(Yr.INVALID_ARGUMENT,"Invalid query. When querying a collection group by FieldPath.documentId(), the value provided must result in a valid document path, but '"+e+"' is not because it has an odd number of segments ("+e.length+").");return new Es(this.firestore._databaseId,new zi(e))}if(t instanceof td){var n=t;return new Es(this.firestore._databaseId,n._key)}throw new Xr(Yr.INVALID_ARGUMENT,"Invalid query. When querying with FieldPath.documentId(), you must provide a valid string or a DocumentReference, but it was: "+mi(t)+".")},hd.prototype.validateDisjunctiveFilterElements=function(t,e){if(!Array.isArray(t)||0===t.length)throw new Xr(Yr.INVALID_ARGUMENT,"Invalid Query. A non-empty array is required for '"+e.toString()+"' filters.");if(10<t.length)throw new Xr(Yr.INVALID_ARGUMENT,"Invalid Query. '"+e.toString()+"' filters support a maximum of 10 elements in the value array.");if(0<=t.indexOf(null))throw new Xr(Yr.INVALID_ARGUMENT,"Invalid Query. '"+e.toString()+"' filters cannot contain 'null' in the value array.");if(0<t.filter((function(t){return Number.isNaN(t)})).length)throw new Xr(Yr.INVALID_ARGUMENT,"Invalid Query. '"+e.toString()+"' filters cannot contain 'NaN' in the value array.")},hd.prototype.validateNewFilter=function(t){if(t instanceof Pc){var e=[Oc.ARRAY_CONTAINS,Oc.ARRAY_CONTAINS_ANY],n=[Oc.IN,Oc.ARRAY_CONTAINS_ANY],r=0<=e.indexOf(t.op),i=0<=n.indexOf(t.op);if(t.isInequality()){var o=this._query.getInequalityFilterField();if(null!==o&&!o.isEqual(t.field))throw new Xr(Yr.INVALID_ARGUMENT,"Invalid query. All where filters with an inequality (<, <=, >, or >=) must be on the same field. But you have inequality filters on '"+o.toString()+"' and '"+t.field.toString()+"'");var a=this._query.getFirstOrderByField();null!==a&&this.validateOrderByAndInequalityMatch(t.field,a)}else if(i||r){var s=null;if(i&&(s=this._query.findFilterOperator(n)),null===s&&r&&(s=this._query.findFilterOperator(e)),null!=s)throw s===t.op?new Xr(Yr.INVALID_ARGUMENT,"Invalid query. You cannot use more than one '"+t.op.toString()+"' filter."):new Xr(Yr.INVALID_ARGUMENT,"Invalid query. You cannot use '"+t.op.toString()+"' filters with '"+s.toString()+"' filters.")}}},hd.prototype.validateNewOrderBy=function(t){if(null===this._query.getFirstOrderByField()){var e=this._query.getInequalityFilterField();null!==e&&this.validateOrderByAndInequalityMatch(e,t.field)}},hd.prototype.validateOrderByAndInequalityMatch=function(t,e){if(!e.isEqual(t))throw new Xr(Yr.INVALID_ARGUMENT,"Invalid query. You have a where filter with an inequality (<, <=, >, or >=) on field '"+t.toString()+"' and so you must also use '"+t.toString()+"' as your first Query.orderBy(), but your first Query.orderBy() is on field '"+e.toString()+"' instead.")},hd);function hd(t,e,n){this._query=t,this.firestore=e,this._converter=n}var ld=(Object.defineProperty(fd.prototype,"docs",{get:function(){var t=[];return this.forEach((function(e){return t.push(e)})),t},enumerable:!0,configurable:!0}),Object.defineProperty(fd.prototype,"empty",{get:function(){return this._snapshot.docs.isEmpty()},enumerable:!0,configurable:!0}),Object.defineProperty(fd.prototype,"size",{get:function(){return this._snapshot.docs.size},enumerable:!0,configurable:!0}),fd.prototype.forEach=function(t,e){var n=this;si("QuerySnapshot.forEach",arguments,1,2),ui("QuerySnapshot.forEach","function",1,t),this._snapshot.docs.forEach((function(r){t.call(e,n.convertToDocumentImpl(r))}))},Object.defineProperty(fd.prototype,"query",{get:function(){return new cd(this._originalQuery,this._firestore,this._converter)},enumerable:!0,configurable:!0}),fd.prototype.docChanges=function(t){t&&(gi("QuerySnapshot.docChanges",t,["includeMetadataChanges"]),li("QuerySnapshot.docChanges","boolean","includeMetadataChanges",t.includeMetadataChanges));var e=!(!t||!t.includeMetadataChanges);if(e&&this._snapshot.excludesMetadataChanges)throw new Xr(Yr.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===e||(this._cachedChanges=function(t,e,n,r){if(n.oldDocs.isEmpty()){var i,o=0;return n.docChanges.map((function(e){var a=new sd(t,e.doc.key,e.doc,n.fromCache,n.mutatedKeys.has(e.doc.key),r);return Kr(e.type===il.Added,"Invalid event type for first snapshot"),Kr(!i||n.query.docComparator(i,e.doc)<0,"Got added events in wrong order"),i=e.doc,{type:"added",doc:a,oldIndex:-1,newIndex:o++}}))}var a=n.oldDocs;return n.docChanges.filter((function(t){return e||t.type!==il.Metadata})).map((function(e){var i=new sd(t,e.doc.key,e.doc,n.fromCache,n.mutatedKeys.has(e.doc.key),r),o=-1,s=-1;return e.type!==il.Added&&(Kr(0<=(o=a.indexOf(e.doc.key)),"Index for document not found"),a=a.delete(e.doc.key)),e.type!==il.Removed&&(s=(a=a.add(e.doc)).indexOf(e.doc.key)),{type:function(t){switch(t){case il.Added:return"added";case il.Modified:case il.Metadata:return"modified";case il.Removed:return"removed";default:return Wr("Unknown change type: "+t)}}(e.type),doc:i,oldIndex:o,newIndex:s}}))}(this._firestore,e,this._snapshot,this._converter),this._cachedChangesIncludeMetadataChanges=e),this._cachedChanges},fd.prototype.isEqual=function(t){if(!(t instanceof fd))throw vi("isEqual","QuerySnapshot",1,t);return this._firestore===t._firestore&&this._originalQuery.isEqual(t._originalQuery)&&this._snapshot.isEqual(t._snapshot)&&this._converter===t._converter},fd.prototype.convertToDocumentImpl=function(t){return new sd(this._firestore,t.key,t,this.metadata.fromCache,this._snapshot.mutatedKeys.has(t.key),this._converter)},fd);function fd(t,e,n,r){this._firestore=t,this._originalQuery=e,this._snapshot=n,this._converter=r,this._cachedChanges=null,this._cachedChangesIncludeMetadataChanges=null,this.metadata=new nd(n.hasPendingWrites,n.fromCache)}h(["length","forEach","map"],"undefined"!=typeof Symbol?[Symbol.iterator]:[]).forEach((function(t){try{Object.defineProperty(ld.prototype.docChanges,t,{get:function(){return function(){throw new Xr(Yr.INVALID_ARGUMENT,'QuerySnapshot.docChanges has been changed from a property into a method, so usages like "querySnapshot.docChanges" should become "querySnapshot.docChanges()"')}()}})}catch(t){}}));var pd,dd=(i(md,pd=cd),Object.defineProperty(md.prototype,"id",{get:function(){return this._query.path.lastSegment()},enumerable:!0,configurable:!0}),Object.defineProperty(md.prototype,"parent",{get:function(){var t=this._query.path.popLast();return t.isEmpty()?null:new td(new zi(t),this.firestore)},enumerable:!0,configurable:!0}),Object.defineProperty(md.prototype,"path",{get:function(){return this._query.path.canonicalString()},enumerable:!0,configurable:!0}),md.prototype.doc=function(t){if(si("CollectionReference.doc",arguments,0,1),0===arguments.length&&(t=_i.newId()),ui("CollectionReference.doc","non-empty string",1,t),""===t)throw new Xr(Yr.INVALID_ARGUMENT,"Document path must be a non-empty string");var e=Bi.fromString(t);return td.forPath(this._query.path.child(e),this.firestore,this._converter)},md.prototype.add=function(t){oi("CollectionReference.add",arguments,1),ui("CollectionReference.add","object",1,t);var e=this.doc();return e.set(t).then((function(){return e}))},md.prototype.withConverter=function(t){return new md(this._path,this.firestore,t)},md);function md(t,e,n){var r=pd.call(this,Dc.atPath(t),e,n)||this;if((r._path=t).length%2!=1)throw new Xr(Yr.INVALID_ARGUMENT,"Invalid collection reference. Collection references must have an odd number of segments, but "+t.canonicalString()+" has "+t.length);return r}function yd(t,e){if(void 0===e)return{merge:!1};if(gi(t,e,["merge","mergeFields"]),li(t,"boolean","merge",e.merge),function(t,e,n,r,i){void 0!==r&&function(t,e,n,r,i){if(!(r instanceof Array))throw new Xr(Yr.INVALID_ARGUMENT,"Function "+t+"() requires its "+e+" option to be an array, but it was: "+mi(r));for(var o=0;o<r.length;++o)if(!i(r[o]))throw new Xr(Yr.INVALID_ARGUMENT,"Function "+t+"() requires all "+e+" elements to be "+n+", but the value at index "+o+" was: "+mi(r[o]))}(t,e,n,r,i)}(t,"mergeFields","a string or a FieldPath",e.mergeFields,(function(t){return"string"==typeof t||t instanceof Xf})),void 0!==e.mergeFields&&void 0!==e.merge)throw new Xr(Yr.INVALID_ARGUMENT,"Invalid options passed to function "+t+'(): You cannot specify both "merge" and "mergeFields".');return e}function gd(t,e){return void 0===e?{}:(gi(t,e,["serverTimestamps"]),fi(t,0,"serverTimestamps",e.serverTimestamps,["estimate","previous","none"]),e)}function vd(t,e){ci(t,"object",1,e),e&&(gi(t,e,["source"]),fi(t,0,"source",e.source,["default","server","cache"]))}function bd(t,e,n){if(e instanceof td){if(e.firestore!==n)throw new Xr(Yr.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return e}throw vi(t,"DocumentReference",1,e)}function wd(t,e,n){var r;return t?(r=t.toFirestore(e),n="toFirestore() in "+n):r=e,[r,n]}var Td=$r(zp,"Use firebase.firestore() instead."),_d=$r(Xp,"Use firebase.firestore().runTransaction() instead."),Ed=$r($p,"Use firebase.firestore().batch() instead."),Sd=$r(td,"Use firebase.firestore().doc() instead."),Id=$r(id),Cd=$r(sd),Nd=$r(cd),Dd=$r(ld),Ad=$r(dd,"Use firebase.firestore().collection() instead."),Od={Firestore:Td,GeoPoint:Rl,Timestamp:so,Blob:ki,Transaction:_d,WriteBatch:Ed,DocumentReference:Sd,DocumentSnapshot:Id,Query:Nd,QueryDocumentSnapshot:Cd,QuerySnapshot:Dd,CollectionReference:Ad,FieldPath:Xf,FieldValue:Cp,setLogLevel:zp.setLogLevel,CACHE_SIZE_UNLIMITED:Qp},kd=(Rd.prototype.addCallback=function(t){},Rd.prototype.shutdown=function(){},Rd);function Rd(){}var Pd="ConnectivityMonitor",Md=(Ld.prototype.addCallback=function(t){this.callbacks.push(t)},Ld.prototype.shutdown=function(){window.removeEventListener("online",this.networkAvailableListener),window.removeEventListener("offline",this.networkUnavailableListener)},Ld.prototype.configureNetworkMonitoring=function(){window.addEventListener("online",this.networkAvailableListener),window.addEventListener("offline",this.networkUnavailableListener)},Ld.prototype.onNetworkAvailable=function(){qr(Pd,"Network connectivity changed: AVAILABLE");for(var t=0,e=this.callbacks;t<e.length;t++)(0,e[t])(0)},Ld.prototype.onNetworkUnavailable=function(){qr(Pd,"Network connectivity changed: UNAVAILABLE");for(var t=0,e=this.callbacks;t<e.length;t++)(0,e[t])(1)},Ld.isAvailable=function(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener},Ld);function Ld(){var t=this;this.networkAvailableListener=function(){return t.onNetworkAvailable()},this.networkUnavailableListener=function(){return t.onNetworkUnavailable()},this.callbacks=[],this.configureNetworkMonitoring()}var xd=(Fd.prototype.onOpen=function(t){Kr(!this.wrappedOnOpen,"Called onOpen on stream twice!"),this.wrappedOnOpen=t},Fd.prototype.onClose=function(t){Kr(!this.wrappedOnClose,"Called onClose on stream twice!"),this.wrappedOnClose=t},Fd.prototype.onMessage=function(t){Kr(!this.wrappedOnMessage,"Called onMessage on stream twice!"),this.wrappedOnMessage=t},Fd.prototype.close=function(){this.closeFn()},Fd.prototype.send=function(t){this.sendFn(t)},Fd.prototype.callOnOpen=function(){Kr(void 0!==this.wrappedOnOpen,"Cannot call onOpen because no callback was set"),this.wrappedOnOpen()},Fd.prototype.callOnClose=function(t){Kr(void 0!==this.wrappedOnClose,"Cannot call onClose because no callback was set"),this.wrappedOnClose(t)},Fd.prototype.callOnMessage=function(t){Kr(void 0!==this.wrappedOnMessage,"Cannot call onMessage because no callback was set"),this.wrappedOnMessage(t)},Fd);function Fd(t){this.sendFn=t.sendFn,this.closeFn=t.closeFn}var jd="Connection",Ud={BatchGetDocuments:"batchGet",Commit:"commit"},qd="gl-js/ fire/"+xr,Vd=(Bd.prototype.modifyHeadersForRequest=function(t,e){if(e)for(var n in e.authHeaders)e.authHeaders.hasOwnProperty(n)&&(t[n]=e.authHeaders[n]);t["X-Goog-Api-Client"]=qd},Bd.prototype.invokeRPC=function(t,e,n){var r=this,i=this.makeUrl(t);return new Promise((function(o,a){var u=new Lr;u.listenOnce(Pr.COMPLETE,(function(){try{switch(u.getLastErrorCode()){case Rr.NO_ERROR:var e=u.getResponseJson();qr(jd,"XHR received:",JSON.stringify(e)),o(e);break;case Rr.TIMEOUT:qr(jd,'RPC "'+t+'" timed out'),a(new Xr(Yr.DEADLINE_EXCEEDED,"Request time out"));break;case Rr.HTTP_ERROR:var n=u.getStatus();if(qr(jd,'RPC "'+t+'" failed with status:',n,"response text:",u.getResponseText()),0<n){var r=u.getResponseJson().error;if(r&&r.status&&r.message){var i=function(t){var e=t.toLowerCase().replace("_","-");return 0<=Object.values(Yr).indexOf(e)?e:Yr.UNKNOWN}(r.status);a(new Xr(i,r.message))}else a(new Xr(Yr.UNKNOWN,"Server responded with status "+u.getStatus()))}else qr(jd,'RPC "'+t+'" failed'),a(new Xr(Yr.UNAVAILABLE,"Connection failed."));break;default:Wr('RPC "'+t+'" failed with unanticipated webchannel error '+u.getLastErrorCode()+": "+u.getLastError()+", giving up.")}}finally{qr(jd,'RPC "'+t+'" completed.')}}));var c=s({},e);delete c.database;var h=JSON.stringify(c);qr(jd,"XHR sending: ",i+" "+h);var l={"Content-Type":"text/plain"};r.modifyHeadersForRequest(l,n),u.send(i,"POST",h,l,15)}))},Bd.prototype.invokeStreamingRPC=function(t,e,n){return this.invokeRPC(t,e,n)},Bd.prototype.openStream=function(t,e){var n=[this.baseUrl,"/","google.firestore.v1.Firestore","/",t,"/channel"],r=kr(),i={backgroundChannelTest:!0,httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:"projects/"+this.databaseId.projectId+"/databases/"+this.databaseId.database},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling};this.modifyHeadersForRequest(i.initMessageHeaders,e),"object"==typeof navigator&&"ReactNative"===navigator.product||0<=y().indexOf("Electron/")||function(){var t=y();return 0<=t.indexOf("MSIE ")||0<=t.indexOf("Trident/")}()||0<=y().indexOf("MSAppHost/")||(i.httpHeadersOverwriteParam="$httpHeaders");var o=n.join("");function a(t,e){s.listen(t,(function(t){try{e(t)}catch(t){setTimeout((function(){throw t}),0)}}))}qr(jd,"Creating WebChannel: "+o+" "+i);var s=r.createWebChannel(o,i),u=!1,c=!1,h=new xd({sendFn:function(t){c?qr(jd,"Not sending because WebChannel is closed:",t):(u||(qr(jd,"Opening WebChannel transport."),s.open(),u=!0),qr(jd,"WebChannel sending:",t),s.send(t))},closeFn:function(){return s.close()}});return a(Mr.EventType.OPEN,(function(){c||qr(jd,"WebChannel transport opened.")})),a(Mr.EventType.CLOSE,(function(){c||(c=!0,qr(jd,"WebChannel transport closed"),h.callOnClose())})),a(Mr.EventType.ERROR,(function(t){c||(c=!0,qr(jd,"WebChannel transport errored:",t),h.callOnClose(new Xr(Yr.UNAVAILABLE,"The operation could not be completed")))})),a(Mr.EventType.MESSAGE,(function(t){var e;if(!c){var n=t.data[0];Kr(!!n,"Got a webchannel message without data.");var r=n,i=r.error||(null===(e=r[0])||void 0===e?void 0:e.error);if(i){qr(jd,"WebChannel received error:",i);var o=i.status,a=function(t){var e=$h[t];if(void 0!==e)return rl(e)}(o),u=i.message;void 0===a&&(a=Yr.INTERNAL,u="Unknown error status: "+o+" with message "+i.message),c=!0,h.callOnClose(new Xr(a,u)),s.close()}else qr(jd,"WebChannel received:",n),h.callOnMessage(n)}})),setTimeout((function(){h.callOnOpen()}),0),h},Bd.prototype.makeUrl=function(t){var e=Ud[t];return Kr(void 0!==e,"Unknown REST mapping for: "+t),this.baseUrl+"/v1/projects/"+this.databaseId.projectId+"/databases/"+this.databaseId.database+"/documents:"+e},Bd);function Bd(t){this.databaseId=t.databaseId;var e=t.ssl?"https":"http";this.baseUrl=e+"://"+t.host,this.forceLongPolling=t.forceLongPolling}var Wd,Kd=(Object.defineProperty(Qd.prototype,"document",{get:function(){return"undefined"!=typeof document?document:null},enumerable:!0,configurable:!0}),Object.defineProperty(Qd.prototype,"window",{get:function(){return"undefined"!=typeof window?window:null},enumerable:!0,configurable:!0}),Qd.prototype.loadConnection=function(t){return Promise.resolve(new Vd(t))},Qd.prototype.newConnectivityMonitor=function(){return Md.isAvailable()?new Md:new kd},Qd.prototype.newSerializer=function(t){return new $l(t,{useProto3Json:!0})},Qd.prototype.formatJSON=function(t){return JSON.stringify(t)},Qd.prototype.atob=function(t){return atob(t)},Qd.prototype.btoa=function(t){return btoa(t)},Qd);function Qd(){this.emptyByteString="",this.base64Available="undefined"!=typeof atob}Qr.setPlatform(new Kd),function(t){t.INTERNAL.registerComponent(new E("firestore",(function(t){var e=t.getProvider("app").getImmediate();return new zp(e,t.getProvider("auth-internal"))}),"PUBLIC").setServiceProps(function(t){Kr(t&&"object"==typeof t,"shallowCopy() expects object parameter.");var e={};for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e}(Od)))}(Wd=n),Wd.registerVersion("@firebase/firestore","1.9.2")}).apply(this,arguments)}catch(t){throw console.error(t),new Error("Cannot instantiate firebase-firestore - be sure to load firebase-app.js first.")}}(n(11))}).call(this,n(3),n(4))},,function(t,e,n){"use strict";var r=n(11),i=(n(20),n(21),n(23),n(12)),o=n(13),a={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},s=function(t){function e(n,r,i){var o=t.call(this,r)||this;return Object.setPrototypeOf(o,e.prototype),o.code=n,o.details=i,o}return Object(i.c)(e,t),e}(Error);var u=function(){function t(t,e){var n=this;this.auth=null,this.messaging=null,this.auth=t.getImmediate({optional:!0}),this.messaging=e.getImmediate({optional:!0}),this.auth||t.get().then((function(t){return n.auth=t}),(function(){})),this.messaging||e.get().then((function(t){return n.messaging=t}),(function(){}))}return t.prototype.getAuthToken=function(){return Object(i.b)(this,void 0,void 0,(function(){var t;return Object(i.d)(this,(function(e){switch(e.label){case 0:if(!this.auth)return[2,void 0];e.label=1;case 1:return e.trys.push([1,3,,4]),[4,this.auth.getToken()];case 2:return(t=e.sent())?[2,t.accessToken]:[2,void 0];case 3:return e.sent(),[2,void 0];case 4:return[2]}}))}))},t.prototype.getInstanceIdToken=function(){return Object(i.b)(this,void 0,void 0,(function(){return Object(i.d)(this,(function(t){if(!(this.messaging&&"Notification"in self&&"granted"===Notification.permission))return[2,void 0];try{return[2,this.messaging.getToken()]}catch(t){return[2,void 0]}return[2]}))}))},t.prototype.getContext=function(){return Object(i.b)(this,void 0,void 0,(function(){var t,e;return Object(i.d)(this,(function(n){switch(n.label){case 0:return[4,this.getAuthToken()];case 1:return t=n.sent(),[4,this.getInstanceIdToken()];case 2:return e=n.sent(),[2,{authToken:t,instanceIdToken:e}]}}))}))},t}();
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function c(t,e){var n={};for(var r in t)t.hasOwnProperty(r)&&(n[r]=e(t[r]));return n}var h=function(){function t(){}return t.prototype.encode=function(t){var e=this;if(null==t)return null;if(t instanceof Number&&(t=t.valueOf()),"number"==typeof t&&isFinite(t))return t;if(!0===t||!1===t)return t;if("[object String]"===Object.prototype.toString.call(t))return t;if(Array.isArray(t))return t.map((function(t){return e.encode(t)}));if("function"==typeof t||"object"==typeof t)return c(t,(function(t){return e.encode(t)}));throw new Error("Data cannot be encoded in JSON: "+t)},t.prototype.decode=function(t){var e=this;if(null==t)return t;if(t["@type"])switch(t["@type"]){case"type.googleapis.com/google.protobuf.Int64Value":case"type.googleapis.com/google.protobuf.UInt64Value":var n=Number(t.value);if(isNaN(n))throw new Error("Data cannot be decoded from JSON: "+t);return n;default:throw new Error("Data cannot be decoded from JSON: "+t)}return Array.isArray(t)?t.map((function(t){return e.decode(t)})):"function"==typeof t||"object"==typeof t?c(t,(function(t){return e.decode(t)})):t},t}();
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var l=function(){function t(t,e,n,r){var i=this;void 0===r&&(r="us-central1"),this.app_=t,this.region_=r,this.serializer=new h,this.emulatorOrigin=null,this.INTERNAL={delete:function(){return i.deleteService()}},this.contextProvider=new u(e,n),this.cancelAllRequests=new Promise((function(t){i.deleteService=function(){return t()}}))}return Object.defineProperty(t.prototype,"app",{get:function(){return this.app_},enumerable:!0,configurable:!0}),t.prototype._url=function(t){var e=this.app_.options.projectId,n=this.region_;return null!==this.emulatorOrigin?this.emulatorOrigin+"/"+e+"/"+n+"/"+t:"https://"+n+"-"+e+".cloudfunctions.net/"+t},t.prototype.useFunctionsEmulator=function(t){this.emulatorOrigin=t},t.prototype.httpsCallable=function(t,e){var n=this;return function(r){return n.call(t,r,e||{})}},t.prototype.postJSON=function(t,e,n){return Object(i.b)(this,void 0,void 0,(function(){var r,o;return Object(i.d)(this,(function(i){switch(i.label){case 0:n.append("Content-Type","application/json"),i.label=1;case 1:return i.trys.push([1,3,,4]),[4,fetch(t,{method:"POST",body:JSON.stringify(e),headers:n})];case 2:return r=i.sent(),[3,4];case 3:return i.sent(),[2,{status:0,json:null}];case 4:o=null,i.label=5;case 5:return i.trys.push([5,7,,8]),[4,r.json()];case 6:return o=i.sent(),[3,8];case 7:return i.sent(),[3,8];case 8:return[2,{status:r.status,json:o}]}}))}))},t.prototype.call=function(t,e,n){return Object(i.b)(this,void 0,void 0,(function(){var r,o,u,c,h,l,f,p;return Object(i.d)(this,(function(i){switch(i.label){case 0:return r=this._url(t),e=this.serializer.encode(e),o={data:e},u=new Headers,[4,this.contextProvider.getContext()];case 1:return(c=i.sent()).authToken&&u.append("Authorization","Bearer "+c.authToken),c.instanceIdToken&&u.append("Firebase-Instance-ID-Token",c.instanceIdToken),h=n.timeout||7e4,[4,Promise.race([this.postJSON(r,o,u),(d=h,new Promise((function(t,e){setTimeout((function(){e(new s("deadline-exceeded","deadline-exceeded"))}),d)}))),this.cancelAllRequests])];case 2:if(!(l=i.sent()))throw new s("cancelled","Firebase Functions instance was deleted.");if(f=function(t,e,n){var r=function(t){if(t>=200&&t<300)return"ok";switch(t){case 0:return"internal";case 400:return"invalid-argument";case 401:return"unauthenticated";case 403:return"permission-denied";case 404:return"not-found";case 409:return"aborted";case 429:return"resource-exhausted";case 499:return"cancelled";case 500:return"internal";case 501:return"unimplemented";case 503:return"unavailable";case 504:return"deadline-exceeded"}return"unknown"}(t),i=r,o=void 0;try{var u=e&&e.error;if(u){var c=u.status;if("string"==typeof c){if(!a[c])return new s("internal","internal");r=a[c],i=c}var h=u.message;"string"==typeof h&&(i=h),void 0!==(o=u.details)&&(o=n.decode(o))}}catch(t){}return"ok"===r?null:new s(r,i,o)}(l.status,l.json,this.serializer))throw f;if(!l.json)throw new s("internal","Response is not valid JSON object.");if(void 0===(p=l.json.data)&&(p=l.json.result),void 0===p)throw new s("internal","Response is missing data field.");return[2,{data:this.serializer.decode(p)}]}var d}))}))},t}();
/**
 * @license
 * Copyright 2019 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function f(t,e){var n=t.getProvider("app").getImmediate(),r=t.getProvider("auth-internal"),i=t.getProvider("messaging");return new l(n,r,i,e)}var p,d;
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
p=r.default,d={Functions:l},p.INTERNAL.registerComponent(new o.a("functions",f,"PUBLIC").setServiceProps(d).setMultipleInstances(!0)),r.default.registerVersion("@firebase/functions","0.4.29");var m=n(14);function y(t){return Array.prototype.slice.call(t)}function g(t){return new Promise((function(e,n){t.onsuccess=function(){e(t.result)},t.onerror=function(){n(t.error)}}))}function v(t,e,n){var r,i=new Promise((function(i,o){g(r=t[e].apply(t,n)).then(i,o)}));return i.request=r,i}function b(t,e,n){var r=v(t,e,n);return r.then((function(t){if(t)return new I(t,r.request)}))}function w(t,e,n){n.forEach((function(n){Object.defineProperty(t.prototype,n,{get:function(){return this[e][n]},set:function(t){this[e][n]=t}})}))}function T(t,e,n,r){r.forEach((function(r){r in n.prototype&&(t.prototype[r]=function(){return v(this[e],r,arguments)})}))}function _(t,e,n,r){r.forEach((function(r){r in n.prototype&&(t.prototype[r]=function(){return this[e][r].apply(this[e],arguments)})}))}function E(t,e,n,r){r.forEach((function(r){r in n.prototype&&(t.prototype[r]=function(){return b(this[e],r,arguments)})}))}function S(t){this._index=t}function I(t,e){this._cursor=t,this._request=e}function C(t){this._store=t}function N(t){this._tx=t,this.complete=new Promise((function(e,n){t.oncomplete=function(){e()},t.onerror=function(){n(t.error)},t.onabort=function(){n(t.error)}}))}function D(t,e,n){this._db=t,this.oldVersion=e,this.transaction=new N(n)}function A(t){this._db=t}w(S,"_index",["name","keyPath","multiEntry","unique"]),T(S,"_index",IDBIndex,["get","getKey","getAll","getAllKeys","count"]),E(S,"_index",IDBIndex,["openCursor","openKeyCursor"]),w(I,"_cursor",["direction","key","primaryKey","value"]),T(I,"_cursor",IDBCursor,["update","delete"]),["advance","continue","continuePrimaryKey"].forEach((function(t){t in IDBCursor.prototype&&(I.prototype[t]=function(){var e=this,n=arguments;return Promise.resolve().then((function(){return e._cursor[t].apply(e._cursor,n),g(e._request).then((function(t){if(t)return new I(t,e._request)}))}))})})),C.prototype.createIndex=function(){return new S(this._store.createIndex.apply(this._store,arguments))},C.prototype.index=function(){return new S(this._store.index.apply(this._store,arguments))},w(C,"_store",["name","keyPath","indexNames","autoIncrement"]),T(C,"_store",IDBObjectStore,["put","add","delete","clear","get","getAll","getKey","getAllKeys","count"]),E(C,"_store",IDBObjectStore,["openCursor","openKeyCursor"]),_(C,"_store",IDBObjectStore,["deleteIndex"]),N.prototype.objectStore=function(){return new C(this._tx.objectStore.apply(this._tx,arguments))},w(N,"_tx",["objectStoreNames","mode"]),_(N,"_tx",IDBTransaction,["abort"]),D.prototype.createObjectStore=function(){return new C(this._db.createObjectStore.apply(this._db,arguments))},w(D,"_db",["name","version","objectStoreNames"]),_(D,"_db",IDBDatabase,["deleteObjectStore","close"]),A.prototype.transaction=function(){return new N(this._db.transaction.apply(this._db,arguments))},w(A,"_db",["name","version","objectStoreNames"]),_(A,"_db",IDBDatabase,["close"]),["openCursor","openKeyCursor"].forEach((function(t){[C,S].forEach((function(e){t in e.prototype&&(e.prototype[t.replace("open","iterate")]=function(){var e=y(arguments),n=e[e.length-1],r=this._store||this._index,i=r[t].apply(r,e.slice(0,-1));i.onsuccess=function(){n(i.result)}})}))})),[S,C].forEach((function(t){t.prototype.getAll||(t.prototype.getAll=function(t,e){var n=this,r=[];return new Promise((function(i){n.iterateCursor(t,(function(t){t?(r.push(t.value),void 0===e||r.length!=e?t.continue():i(r)):i(r)}))}))})}));var O,k=((O={})["missing-app-config-values"]='Missing App configuration value: "{$valueName}"',O["not-registered"]="Firebase Installation is not registered.",O["installation-not-found"]="Firebase Installation not found.",O["request-failed"]='{$requestName} request failed with error "{$serverCode} {$serverStatus}: {$serverMessage}"',O["app-offline"]="Could not process request. Application offline.",O["delete-pending-registration"]="Can't delete installation while there is a pending registration request.",O),R=new m.c("installations","Installations",k);function P(t){return t instanceof m.d&&t.code.includes("request-failed")}
/**
 * @license
 * Copyright 2019 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function M(t){return"https://firebaseinstallations.googleapis.com/v1/projects/"+t.projectId+"/installations"}function L(t){return{token:t.token,requestStatus:2,expiresIn:(e=t.expiresIn,Number(e.replace("s","000"))),creationTime:Date.now()};var e}function x(t,e){return Object(i.b)(this,void 0,void 0,(function(){var n,r;return Object(i.d)(this,(function(i){switch(i.label){case 0:return[4,e.json()];case 1:return n=i.sent(),r=n.error,[2,R.create("request-failed",{requestName:t,serverCode:r.code,serverMessage:r.message,serverStatus:r.status})]}}))}))}function F(t){var e=t.apiKey;return new Headers({"Content-Type":"application/json",Accept:"application/json","x-goog-api-key":e})}function j(t,e){var n=e.refreshToken,r=F(t);return r.append("Authorization",function(t){return"FIS_v2 "+t}
/**
 * @license
 * Copyright 2019 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */(n)),r}function U(t){return Object(i.b)(this,void 0,void 0,(function(){var e;return Object(i.d)(this,(function(n){switch(n.label){case 0:return[4,t()];case 1:return(e=n.sent()).status>=500&&e.status<600?[2,t()]:[2,e]}}))}))}function q(t,e){var n=e.fid;return Object(i.b)(this,void 0,void 0,(function(){var e,r,o,a,s,u;return Object(i.d)(this,(function(i){switch(i.label){case 0:return e=M(t),r=F(t),o={fid:n,authVersion:"FIS_v2",appId:t.appId,sdkVersion:"w:0.3.9"},a={method:"POST",headers:r,body:JSON.stringify(o)},[4,U((function(){return fetch(e,a)}))];case 1:return(s=i.sent()).ok?[4,s.json()]:[3,3];case 2:return u=i.sent(),[2,{fid:u.fid||n,registrationStatus:2,refreshToken:u.refreshToken,authToken:L(u.authToken)}];case 3:return[4,x("Create Installation",s)];case 4:throw i.sent()}}))}))}
/**
 * @license
 * Copyright 2019 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function V(t){return new Promise((function(e){setTimeout(e,t)}))}
/**
 * @license
 * Copyright 2019 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
/**
 * @license
 * Copyright 2019 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var B=/^[cdef][\w-]{21}$/;function W(){try{var t=new Uint8Array(17);(self.crypto||self.msCrypto).getRandomValues(t),t[0]=112+t[0]%16;var e=function(t){return(e=t,btoa(String.fromCharCode.apply(String,Object(i.f)(e))).replace(/\+/g,"-").replace(/\//g,"_")).substr(0,22);var e}
/**
 * @license
 * Copyright 2019 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */(t);return B.test(e)?e:""}catch(t){return""}}var K,Q="firebase-installations-store",G=null;function H(){var t,e,n;return G||(t=function(t){switch(t.oldVersion){case 0:t.createObjectStore(Q)}},e=v(indexedDB,"open",["firebase-installations-database",1]),(n=e.request)&&(n.onupgradeneeded=function(e){t&&t(new D(n.result,e.oldVersion,n.transaction))}),G=e.then((function(t){return new A(t)}))),G}function z(t,e){return Object(i.b)(this,void 0,void 0,(function(){var n,r,o;return Object(i.d)(this,(function(i){switch(i.label){case 0:return n=J(t),[4,H()];case 1:return r=i.sent(),[4,(o=r.transaction(Q,"readwrite")).objectStore(Q).put(e,n)];case 2:return i.sent(),[4,o.complete];case 3:return i.sent(),[2,e]}}))}))}function Y(t){return Object(i.b)(this,void 0,void 0,(function(){var e,n,r;return Object(i.d)(this,(function(i){switch(i.label){case 0:return e=J(t),[4,H()];case 1:return n=i.sent(),[4,(r=n.transaction(Q,"readwrite")).objectStore(Q).delete(e)];case 2:return i.sent(),[4,r.complete];case 3:return i.sent(),[2]}}))}))}function X(t,e){return Object(i.b)(this,void 0,void 0,(function(){var n,r,o,a,s,u;return Object(i.d)(this,(function(i){switch(i.label){case 0:return n=J(t),[4,H()];case 1:return r=i.sent(),o=r.transaction(Q,"readwrite"),[4,(a=o.objectStore(Q)).get(n)];case 2:return s=i.sent(),void 0!==(u=e(s))?[3,4]:[4,a.delete(n)];case 3:return i.sent(),[3,6];case 4:return[4,a.put(u,n)];case 5:i.sent(),i.label=6;case 6:return[4,o.complete];case 7:return i.sent(),[2,u]}}))}))}function J(t){return t.appName+"!"+t.appId}
/**
 * @license
 * Copyright 2019 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function $(t){return Object(i.b)(this,void 0,void 0,(function(){var e,n,r;return Object(i.d)(this,(function(o){switch(o.label){case 0:return[4,X(t,(function(n){var r=function(t){return et(t||{fid:W(),registrationStatus:0})}(n),o=function(t,e){if(0===e.registrationStatus){if(!navigator.onLine){var n=Promise.reject(R.create("app-offline"));return{installationEntry:e,registrationPromise:n}}var r={fid:e.fid,registrationStatus:1,registrationTime:Date.now()},o=function(t,e){return Object(i.b)(this,void 0,void 0,(function(){var n,r;return Object(i.d)(this,(function(i){switch(i.label){case 0:return i.trys.push([0,2,,7]),[4,q(t,e)];case 1:return n=i.sent(),[2,z(t,n)];case 2:return P(r=i.sent())&&409===r.serverCode?[4,Y(t)]:[3,4];case 3:return i.sent(),[3,6];case 4:return[4,z(t,{fid:e.fid,registrationStatus:0})];case 5:i.sent(),i.label=6;case 6:throw r;case 7:return[2]}}))}))}(t,r);return{installationEntry:r,registrationPromise:o}}return 1===e.registrationStatus?{installationEntry:e,registrationPromise:Z(t)}:{installationEntry:e}}(t,r);return e=o.registrationPromise,o.installationEntry}))];case 1:return""!==(n=o.sent()).fid?[3,3]:(r={},[4,e]);case 2:return[2,(r.installationEntry=o.sent(),r)];case 3:return[2,{installationEntry:n,registrationPromise:e}]}}))}))}function Z(t){return Object(i.b)(this,void 0,void 0,(function(){var e,n,r,o;return Object(i.d)(this,(function(i){switch(i.label){case 0:return[4,tt(t)];case 1:e=i.sent(),i.label=2;case 2:return 1!==e.registrationStatus?[3,5]:[4,V(100)];case 3:return i.sent(),[4,tt(t)];case 4:return e=i.sent(),[3,2];case 5:return 0!==e.registrationStatus?[3,7]:[4,$(t)];case 6:return n=i.sent(),r=n.installationEntry,(o=n.registrationPromise)?[2,o]:[2,r];case 7:return[2,e]}}))}))}function tt(t){return X(t,(function(t){if(!t)throw R.create("installation-not-found");return et(t)}))}function et(t){return 1===(e=t).registrationStatus&&e.registrationTime+1e4<Date.now()?{fid:t.fid,registrationStatus:0}:t;var e;
/**
 * @license
 * Copyright 2019 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */}function nt(t,e){var n=t.appConfig,r=t.platformLoggerProvider;return Object(i.b)(this,void 0,void 0,(function(){var t,o,a,s,u,c,h;return Object(i.d)(this,(function(i){switch(i.label){case 0:return t=function(t,e){var n=e.fid;return M(t)+"/"+n+"/authTokens:generate"}
/**
 * @license
 * Copyright 2019 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */(n,e),o=j(n,e),(a=r.getImmediate({optional:!0}))&&o.append("x-firebase-client",a.getPlatformInfoString()),s={installation:{sdkVersion:"w:0.3.9"}},u={method:"POST",headers:o,body:JSON.stringify(s)},[4,U((function(){return fetch(t,u)}))];case 1:return(c=i.sent()).ok?[4,c.json()]:[3,3];case 2:return h=i.sent(),[2,L(h)];case 3:return[4,x("Generate Auth Token",c)];case 4:throw i.sent()}}))}))}function rt(t,e){return void 0===e&&(e=!1),Object(i.b)(this,void 0,void 0,(function(){var n,r,o;return Object(i.d)(this,(function(a){switch(a.label){case 0:return[4,X(t.appConfig,(function(r){if(!ot(r))throw R.create("not-registered");var o=r.authToken;if(!e&&function(t){return 2===t.requestStatus&&!function(t){var e=Date.now();return e<t.creationTime||t.creationTime+t.expiresIn<e+36e5}(t)}(o))return r;if(1===o.requestStatus)return n=function(t,e){return Object(i.b)(this,void 0,void 0,(function(){var n,r;return Object(i.d)(this,(function(i){switch(i.label){case 0:return[4,it(t.appConfig)];case 1:n=i.sent(),i.label=2;case 2:return 1!==n.authToken.requestStatus?[3,5]:[4,V(100)];case 3:return i.sent(),[4,it(t.appConfig)];case 4:return n=i.sent(),[3,2];case 5:return 0===(r=n.authToken).requestStatus?[2,rt(t,e)]:[2,r]}}))}))}(t,e),r;if(!navigator.onLine)throw R.create("app-offline");var a=function(t){var e={requestStatus:1,requestTime:Date.now()};return Object(i.a)(Object(i.a)({},t),{authToken:e})}(r);return n=function(t,e){return Object(i.b)(this,void 0,void 0,(function(){var n,r,o;return Object(i.d)(this,(function(a){switch(a.label){case 0:return a.trys.push([0,3,,8]),[4,nt(t,e)];case 1:return n=a.sent(),o=Object(i.a)(Object(i.a)({},e),{authToken:n}),[4,z(t.appConfig,o)];case 2:return a.sent(),[2,n];case 3:return!P(r=a.sent())||401!==r.serverCode&&404!==r.serverCode?[3,5]:[4,Y(t.appConfig)];case 4:return a.sent(),[3,7];case 5:return o=Object(i.a)(Object(i.a)({},e),{authToken:{requestStatus:0}}),[4,z(t.appConfig,o)];case 6:a.sent(),a.label=7;case 7:throw r;case 8:return[2]}}))}))}(t,a),a}))];case 1:return r=a.sent(),n?[4,n]:[3,3];case 2:return o=a.sent(),[3,4];case 3:o=r.authToken,a.label=4;case 4:return[2,o]}}))}))}function it(t){return X(t,(function(t){if(!ot(t))throw R.create("not-registered");var e,n=t.authToken;return 1===(e=n).requestStatus&&e.requestTime+1e4<Date.now()?Object(i.a)(Object(i.a)({},t),{authToken:{requestStatus:0}}):t}))}function ot(t){return void 0!==t&&2===t.registrationStatus}function at(t){return Object(i.b)(this,void 0,void 0,(function(){var e;return Object(i.d)(this,(function(n){switch(n.label){case 0:return[4,$(t)];case 1:return(e=n.sent().registrationPromise)?[4,e]:[3,3];case 2:n.sent(),n.label=3;case 3:return[2]}}))}))}
/**
 * @license
 * Copyright 2019 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function st(t,e){return Object(i.b)(this,void 0,void 0,(function(){var n,r,o,a;return Object(i.d)(this,(function(i){switch(i.label){case 0:return n=function(t,e){var n=e.fid;return M(t)+"/"+n}
/**
 * @license
 * Copyright 2019 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */(t,e),r=j(t,e),o={method:"DELETE",headers:r},[4,U((function(){return fetch(n,o)}))];case 1:return(a=i.sent()).ok?[3,3]:[4,x("Delete Installation",a)];case 2:throw i.sent();case 3:return[2]}}))}))}function ut(t){return R.create("missing-app-config-values",{valueName:t})}
/**
 * @license
 * Copyright 2019 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */!function(t){t.INTERNAL.registerComponent(new o.a("installations",(function(t){var e=t.getProvider("app").getImmediate(),n={appConfig:
/**
 * @license
 * Copyright 2019 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function(t){var e,n;if(!t||!t.options)throw ut("App Configuration");if(!t.name)throw ut("App Name");try{for(var r=Object(i.h)(["projectId","apiKey","appId"]),o=r.next();!o.done;o=r.next()){var a=o.value;if(!t.options[a])throw ut(a)}}catch(t){e={error:t}}finally{try{o&&!o.done&&(n=r.return)&&n.call(r)}finally{if(e)throw e.error}}return{appName:t.name,projectId:t.options.projectId,apiKey:t.options.apiKey,appId:t.options.appId}}(e),platformLoggerProvider:t.getProvider("platform-logger")};return{app:e,getId:function(){
/**
 * @license
 * Copyright 2019 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */return function(t){return Object(i.b)(this,void 0,void 0,(function(){var e,n,r;return Object(i.d)(this,(function(i){switch(i.label){case 0:return[4,$(t.appConfig)];case 1:return e=i.sent(),n=e.installationEntry,(r=e.registrationPromise)?r.catch(console.error):rt(t).catch(console.error),[2,n.fid]}}))}))}
/**
 * @license
 * Copyright 2019 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */(n)},getToken:function(t){return function(t,e){return void 0===e&&(e=!1),Object(i.b)(this,void 0,void 0,(function(){return Object(i.d)(this,(function(n){switch(n.label){case 0:return[4,at(t.appConfig)];case 1:return n.sent(),[4,rt(t,e)];case 2:return[2,n.sent().token]}}))}))}(n,t)},delete:function(){return function(t){return Object(i.b)(this,void 0,void 0,(function(){var e,n;return Object(i.d)(this,(function(r){switch(r.label){case 0:return[4,X(e=t.appConfig,(function(t){if(!t||0!==t.registrationStatus)return t}))];case 1:if(!(n=r.sent()))return[3,6];if(1!==n.registrationStatus)return[3,2];throw R.create("delete-pending-registration");case 2:if(2!==n.registrationStatus)return[3,6];if(navigator.onLine)return[3,3];throw R.create("app-offline");case 3:return[4,st(e,n)];case 4:return r.sent(),[4,Y(e)];case 5:r.sent(),r.label=6;case 6:return[2]}}))}))}(n)}}}),"PUBLIC")),t.registerVersion("@firebase/installations","0.3.9")}(r.default);var ct,ht=((K={})["only-available-in-window"]="This method is available in a Window context.",K["only-available-in-sw"]="This method is available in a service worker context.",K["should-be-overriden"]="This method should be overriden by extended classes.",K["bad-sender-id"]="Please ensure that 'messagingSenderId' is set correctly in the options passed into firebase.initializeApp().",K["permission-default"]="The required permissions were not granted and dismissed instead.",K["permission-blocked"]="The required permissions were not granted and blocked instead.",K["unsupported-browser"]="This browser doesn't support the API's required to use the firebase SDK.",K["notifications-blocked"]="Notifications have been blocked.",K["failed-serviceworker-registration"]="We are unable to register the default service worker. {$browserErrorMessage}",K["sw-registration-expected"]="A service worker registration was the expected input.",K["get-subscription-failed"]="There was an error when trying to get any existing Push Subscriptions.",K["invalid-saved-token"]="Unable to access details of the saved token.",K["sw-reg-redundant"]="The service worker being used for push was made redundant.",K["token-subscribe-failed"]="A problem occured while subscribing the user to FCM: {$errorInfo}",K["token-subscribe-no-token"]="FCM returned no token when subscribing the user to push.",K["token-unsubscribe-failed"]="A problem occured while unsubscribing the user from FCM: {$errorInfo}",K["token-update-failed"]="A problem occured while updating the user from FCM: {$errorInfo}",K["token-update-no-token"]="FCM returned no token when updating the user to push.",K["use-sw-before-get-token"]="The useServiceWorker() method may only be called once and must be called before calling getToken() to ensure your service worker is used.",K["invalid-delete-token"]="You must pass a valid token into deleteToken(), i.e. the token from getToken().",K["delete-token-not-found"]="The deletion attempt for token could not be performed as the token was not found.",K["delete-scope-not-found"]="The deletion attempt for service worker scope could not be performed as the scope was not found.",K["bg-handler-function-expected"]="The input to setBackgroundMessageHandler() must be a function.",K["no-window-client-to-msg"]="An attempt was made to message a non-existant window client.",K["unable-to-resubscribe"]="There was an error while re-subscribing the FCM token for push messaging. Will have to resubscribe the user on next visit. {$errorInfo}",K["no-fcm-token-for-resubscribe"]="Could not find an FCM token and as a result, unable to resubscribe. Will have to resubscribe the user on next visit.",K["failed-to-delete-token"]="Unable to delete the currently saved token.",K["no-sw-in-reg"]="Even though the service worker registration was successful, there was a problem accessing the service worker itself.",K["bad-scope"]="The service worker scope must be a string with at least one character.",K["bad-vapid-key"]="The public VAPID key is not a Uint8Array with 65 bytes.",K["bad-subscription"]="The subscription must be a valid PushSubscription.",K["bad-token"]="The FCM Token used for storage / lookup was not a valid token string.",K["failed-delete-vapid-key"]="The VAPID key could not be deleted.",K["invalid-public-vapid-key"]="The public VAPID key must be a string.",K["use-public-key-before-get-token"]="The usePublicVapidKey() method may only be called once and must be called before calling getToken() to ensure your VAPID key is used.",K["public-vapid-key-decryption-failed"]="The public VAPID key did not equal 65 bytes when decrypted.",K),lt=new m.c("messaging","Messaging",ht),ft=new Uint8Array([4,51,148,247,223,161,235,177,220,3,162,94,21,113,219,72,211,46,237,237,178,52,219,183,71,58,12,143,196,204,225,111,60,140,132,223,171,182,102,62,242,12,212,139,254,227,249,118,47,20,28,99,8,106,111,45,177,26,149,176,206,55,192,156,110]);
/**
 * @license
 * Copyright 2018 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function pt(t,e){if(null==t||null==e)return!1;if(t===e)return!0;if(t.byteLength!==e.byteLength)return!1;for(var n=new DataView(t),r=new DataView(e),i=0;i<t.byteLength;i++)if(n.getUint8(i)!==r.getUint8(i))return!1;return!0}
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function dt(t){return function(t){var e=new Uint8Array(t);return btoa(String.fromCharCode.apply(String,Object(i.f)(e)))}(t).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */!function(t){t.PUSH_MSG_RECEIVED="push-msg-received",t.NOTIFICATION_CLICKED="notification-clicked"}(ct||(ct={}));var mt=function(){function t(){}return t.prototype.getToken=function(t,e,n){return Object(i.b)(this,void 0,void 0,(function(){var r,o,a,s,u,c;return Object(i.d)(this,(function(i){switch(i.label){case 0:return[4,gt(t)];case 1:r=i.sent(),o=vt(e,n),a={method:"POST",headers:r,body:JSON.stringify(o)},i.label=2;case 2:return i.trys.push([2,5,,6]),[4,fetch(yt(t.app),a)];case 3:return[4,i.sent().json()];case 4:return s=i.sent(),[3,6];case 5:throw u=i.sent(),lt.create("token-subscribe-failed",{errorInfo:u});case 6:if(s.error)throw c=s.error.message,lt.create("token-subscribe-failed",{errorInfo:c});if(!s.token)throw lt.create("token-subscribe-no-token");return[2,s.token]}}))}))},t.prototype.updateToken=function(t,e,n,r){return Object(i.b)(this,void 0,void 0,(function(){var o,a,s,u,c,h;return Object(i.d)(this,(function(i){switch(i.label){case 0:return[4,gt(e)];case 1:o=i.sent(),a=vt(n,r),s={method:"PATCH",headers:o,body:JSON.stringify(a)},i.label=2;case 2:return i.trys.push([2,5,,6]),[4,fetch(yt(e.app)+"/"+t.fcmToken,s)];case 3:return[4,i.sent().json()];case 4:return u=i.sent(),[3,6];case 5:throw c=i.sent(),lt.create("token-update-failed",{errorInfo:c});case 6:if(u.error)throw h=u.error.message,lt.create("token-update-failed",{errorInfo:h});if(!u.token)throw lt.create("token-update-no-token");return[2,u.token]}}))}))},t.prototype.deleteToken=function(t,e){return Object(i.b)(this,void 0,void 0,(function(){var n,r,o,a,s;return Object(i.d)(this,(function(i){switch(i.label){case 0:return[4,gt(t)];case 1:n=i.sent(),r={method:"DELETE",headers:n},i.label=2;case 2:return i.trys.push([2,5,,6]),[4,fetch(yt(t.app)+"/"+e.fcmToken,r)];case 3:return[4,i.sent().json()];case 4:if((o=i.sent()).error)throw a=o.error.message,lt.create("token-unsubscribe-failed",{errorInfo:a});return[3,6];case 5:throw s=i.sent(),lt.create("token-unsubscribe-failed",{errorInfo:s});case 6:return[2]}}))}))},t}();function yt(t){return"https://fcmregistrations.googleapis.com/v1/projects/"+t.options.projectId+"/registrations"}function gt(t){var e=t.app,n=t.installations;return Object(i.b)(this,void 0,void 0,(function(){var t;return Object(i.d)(this,(function(r){switch(r.label){case 0:return[4,n.getToken()];case 1:return t=r.sent(),[2,new Headers({"Content-Type":"application/json",Accept:"application/json","x-goog-api-key":e.options.apiKey,"x-goog-firebase-installations-auth":"FIS "+t})]}}))}))}function vt(t,e){var n=dt(t.getKey("p256dh")),r=dt(t.getKey("auth")),i={web:{endpoint:t.endpoint,p256dh:n,auth:r}};return pt(e.buffer,ft.buffer)||(i.web.applicationPubKey=dt(e)),i}
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function bt(t){for(var e=(t+"=".repeat((4-t.length%4)%4)).replace(/\-/g,"+").replace(/_/g,"/"),n=atob(e),r=new Uint8Array(n.length),i=0;i<n.length;++i)r[i]=n.charCodeAt(i);return r}
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function wt(t){var e=indexedDB.open("undefined");e.onerror=function(t){},e.onsuccess=function(n){!function(t,e){if(t.objectStoreNames.contains("fcm_token_object_Store")){var n=t.transaction("fcm_token_object_Store").objectStore("fcm_token_object_Store"),r=new mt,i=n.openCursor();i.onerror=function(t){console.warn("Unable to cleanup old IDB.",t)},i.onsuccess=function(){var n=i.result;if(n){var o=n.value;r.deleteToken(e,o),n.continue()}else t.close(),indexedDB.deleteDatabase("undefined")}}}(e.result,t)}}
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Tt=function(){function t(){this.dbPromise=null}return t.prototype.get=function(t){return this.createTransaction((function(e){return e.get(t)}))},t.prototype.getIndex=function(t,e){return this.createTransaction((function(n){return n.index(t).get(e)}))},t.prototype.put=function(t){return this.createTransaction((function(e){return e.put(t)}),"readwrite")},t.prototype.delete=function(t){return this.createTransaction((function(e){return e.delete(t)}),"readwrite")},t.prototype.closeDatabase=function(){return Object(i.b)(this,void 0,void 0,(function(){return Object(i.d)(this,(function(t){switch(t.label){case 0:return this.dbPromise?[4,this.dbPromise]:[3,2];case 1:t.sent().close(),this.dbPromise=null,t.label=2;case 2:return[2]}}))}))},t.prototype.createTransaction=function(t,e){return void 0===e&&(e="readonly"),Object(i.b)(this,void 0,void 0,(function(){var n,r,o,a;return Object(i.d)(this,(function(i){switch(i.label){case 0:return[4,this.getDb()];case 1:return n=i.sent(),r=n.transaction(this.objectStoreName,e),o=r.objectStore(this.objectStoreName),[4,_t(t(o))];case 2:return a=i.sent(),[2,new Promise((function(t,e){r.oncomplete=function(){t(a)},r.onerror=function(){e(r.error)}}))]}}))}))},t.prototype.getDb=function(){var t=this;return this.dbPromise||(this.dbPromise=new Promise((function(e,n){var r=indexedDB.open(t.dbName,t.dbVersion);r.onsuccess=function(){e(r.result)},r.onerror=function(){t.dbPromise=null,n(r.error)},r.onupgradeneeded=function(e){return t.onDbUpgrade(r,e)}}))),this.dbPromise},t}();function _t(t){return new Promise((function(e,n){t.onsuccess=function(){e(t.result)},t.onerror=function(){n(t.error)}}))}
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Et=function(t){function e(e){var n=t.call(this)||this;return n.services=e,n.dbName="fcm_token_details_db",n.dbVersion=4,n.objectStoreName="fcm_token_object_Store",n}return Object(i.c)(e,t),e.prototype.onDbUpgrade=function(t,e){var n=t.result;switch(e.oldVersion){case 0:(o=n.createObjectStore(this.objectStoreName,{keyPath:"swScope"})).createIndex("fcmSenderId","fcmSenderId",{unique:!1}),o.createIndex("fcmToken","fcmToken",{unique:!0});case 1:wt(this.services);case 2:var r=(o=t.transaction.objectStore(this.objectStoreName)).openCursor();r.onsuccess=function(){var t=r.result;if(t){var e=t.value,n=Object(i.a)({},e);e.createTime||(n.createTime=Date.now()),"string"==typeof e.vapidKey&&(n.vapidKey=bt(e.vapidKey)),"string"==typeof e.auth&&(n.auth=bt(e.auth).buffer),"string"==typeof e.auth&&(n.p256dh=bt(e.p256dh).buffer),"string"==typeof e.fcmPushSet&&delete n.fcmPushSet,t.update(n),t.continue()}};break;case 3:var o,a=(o=t.transaction.objectStore(this.objectStoreName)).openCursor();a.onsuccess=function(){var t=a.result;if(t){var e=t.value,n=Object(i.a)({},e);"string"==typeof e.fcmPushSet&&delete n.fcmPushSet,t.update(n),t.continue()}}}},e.prototype.getTokenDetailsFromToken=function(t){return Object(i.b)(this,void 0,void 0,(function(){return Object(i.d)(this,(function(e){if(!t)throw lt.create("bad-token");return St({fcmToken:t}),[2,this.getIndex("fcmToken",t)]}))}))},e.prototype.getTokenDetailsFromSWScope=function(t){return Object(i.b)(this,void 0,void 0,(function(){return Object(i.d)(this,(function(e){if(!t)throw lt.create("bad-scope");return St({swScope:t}),[2,this.get(t)]}))}))},e.prototype.saveTokenDetails=function(t){return Object(i.b)(this,void 0,void 0,(function(){return Object(i.d)(this,(function(e){if(!t.swScope)throw lt.create("bad-scope");if(!t.vapidKey)throw lt.create("bad-vapid-key");if(!t.endpoint||!t.auth||!t.p256dh)throw lt.create("bad-subscription");if(!t.fcmSenderId)throw lt.create("bad-sender-id");if(!t.fcmToken)throw lt.create("bad-token");return St(t),[2,this.put(t)]}))}))},e.prototype.deleteToken=function(t){return Object(i.b)(this,void 0,void 0,(function(){var e;return Object(i.d)(this,(function(n){switch(n.label){case 0:return"string"!=typeof t||0===t.length?[2,Promise.reject(lt.create("invalid-delete-token"))]:[4,this.getTokenDetailsFromToken(t)];case 1:if(!(e=n.sent()))throw lt.create("delete-token-not-found");return[4,this.delete(e.swScope)];case 2:return n.sent(),[2,e]}}))}))},e}(Tt);function St(t){if(t.fcmToken&&("string"!=typeof t.fcmToken||0===t.fcmToken.length))throw lt.create("bad-token");if(t.swScope&&("string"!=typeof t.swScope||0===t.swScope.length))throw lt.create("bad-scope");if(t.vapidKey&&(!(t.vapidKey instanceof Uint8Array)||65!==t.vapidKey.length))throw lt.create("bad-vapid-key");if(t.endpoint&&("string"!=typeof t.endpoint||0===t.endpoint.length))throw lt.create("bad-subscription");if(t.auth&&!(t.auth instanceof ArrayBuffer))throw lt.create("bad-subscription");if(t.p256dh&&!(t.p256dh instanceof ArrayBuffer))throw lt.create("bad-subscription");if(t.fcmSenderId&&("string"!=typeof t.fcmSenderId||0===t.fcmSenderId.length))throw lt.create("bad-sender-id")}
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var It=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.dbName="fcm_vapid_details_db",e.dbVersion=1,e.objectStoreName="fcm_vapid_object_Store",e}return Object(i.c)(e,t),e.prototype.onDbUpgrade=function(t){t.result.createObjectStore(this.objectStoreName,{keyPath:"swScope"})},e.prototype.getVapidFromSWScope=function(t){return Object(i.b)(this,void 0,void 0,(function(){var e;return Object(i.d)(this,(function(n){switch(n.label){case 0:if("string"!=typeof t||0===t.length)throw lt.create("bad-scope");return[4,this.get(t)];case 1:return[2,(e=n.sent())?e.vapidKey:void 0]}}))}))},e.prototype.saveVapidDetails=function(t,e){return Object(i.b)(this,void 0,void 0,(function(){var n;return Object(i.d)(this,(function(r){if("string"!=typeof t||0===t.length)throw lt.create("bad-scope");if(null===e||65!==e.length)throw lt.create("bad-vapid-key");return n={swScope:t,vapidKey:e},[2,this.put(n)]}))}))},e.prototype.deleteVapidDetails=function(t){return Object(i.b)(this,void 0,void 0,(function(){var e;return Object(i.d)(this,(function(n){switch(n.label){case 0:return[4,this.getVapidFromSWScope(t)];case 1:if(!(e=n.sent()))throw lt.create("delete-scope-not-found");return[4,this.delete(t)];case 2:return n.sent(),[2,e]}}))}))},e}(Tt),Ct=function(){function t(t){var e=this;this.services=t,this.vapidDetailsModel=new It,this.subscriptionManager=new mt;var n=t.app;if(this.app=n,!n.options.messagingSenderId||"string"!=typeof n.options.messagingSenderId)throw lt.create("bad-sender-id");this.INTERNAL={delete:function(){return e.delete()}},this.tokenDetailsModel=new Et(t)}return t.prototype.getToken=function(){return Object(i.b)(this,void 0,void 0,(function(){var t,e,n,r,o;return Object(i.d)(this,(function(i){switch(i.label){case 0:return"default"!==(t=this.getNotificationPermission())?[3,2]:[4,this.requestNotificationPermission()];case 1:t=i.sent(),i.label=2;case 2:if("granted"!==t)throw lt.create("notifications-blocked");return[4,this.getSWRegistration_()];case 3:return e=i.sent(),[4,this.getPublicVapidKey_()];case 4:return n=i.sent(),[4,this.getPushSubscription(e,n)];case 5:return r=i.sent(),[4,this.tokenDetailsModel.getTokenDetailsFromSWScope(e.scope)];case 6:return(o=i.sent())?[2,this.manageExistingToken(e,r,n,o)]:[2,this.getNewToken(e,r,n)]}}))}))},t.prototype.manageExistingToken=function(t,e,n,r){return Object(i.b)(this,void 0,void 0,(function(){return Object(i.d)(this,(function(i){switch(i.label){case 0:return function(t,e,n){if(!n.vapidKey||!pt(e.buffer,n.vapidKey.buffer))return!1;var r=t.endpoint===n.endpoint,i=pt(t.getKey("auth"),n.auth),o=pt(t.getKey("p256dh"),n.p256dh);return r&&i&&o}
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */(e,n,r)?Date.now()<r.createTime+6048e5?[2,r.fcmToken]:[2,this.updateToken(t,e,n,r)]:[3,1];case 1:return[4,this.deleteTokenFromDB(r.fcmToken)];case 2:return i.sent(),[2,this.getNewToken(t,e,n)];case 3:return[2]}}))}))},t.prototype.updateToken=function(t,e,n,r){return Object(i.b)(this,void 0,void 0,(function(){var o,a,s;return Object(i.d)(this,(function(i){switch(i.label){case 0:return i.trys.push([0,4,,6]),[4,this.subscriptionManager.updateToken(r,this.services,e,n)];case 1:return o=i.sent(),a={swScope:t.scope,vapidKey:n,fcmSenderId:this.services.app.options.messagingSenderId,fcmToken:o,createTime:Date.now(),endpoint:e.endpoint,auth:e.getKey("auth"),p256dh:e.getKey("p256dh")},[4,this.tokenDetailsModel.saveTokenDetails(a)];case 2:return i.sent(),[4,this.vapidDetailsModel.saveVapidDetails(t.scope,n)];case 3:return i.sent(),[2,o];case 4:return s=i.sent(),[4,this.deleteToken(r.fcmToken)];case 5:throw i.sent(),s;case 6:return[2]}}))}))},t.prototype.getNewToken=function(t,e,n){return Object(i.b)(this,void 0,void 0,(function(){var r,o;return Object(i.d)(this,(function(i){switch(i.label){case 0:return[4,this.subscriptionManager.getToken(this.services,e,n)];case 1:return r=i.sent(),o={swScope:t.scope,vapidKey:n,fcmSenderId:this.app.options.messagingSenderId,fcmToken:r,createTime:Date.now(),endpoint:e.endpoint,auth:e.getKey("auth"),p256dh:e.getKey("p256dh")},[4,this.tokenDetailsModel.saveTokenDetails(o)];case 2:return i.sent(),[4,this.vapidDetailsModel.saveVapidDetails(t.scope,n)];case 3:return i.sent(),[2,r]}}))}))},t.prototype.deleteToken=function(t){return Object(i.b)(this,void 0,void 0,(function(){var e,n;return Object(i.d)(this,(function(r){switch(r.label){case 0:return[4,this.deleteTokenFromDB(t)];case 1:return r.sent(),[4,this.getSWRegistration_()];case 2:return(e=r.sent())?[4,e.pushManager.getSubscription()]:[3,4];case 3:if(n=r.sent())return[2,n.unsubscribe()];r.label=4;case 4:return[2,!0]}}))}))},t.prototype.deleteTokenFromDB=function(t){return Object(i.b)(this,void 0,void 0,(function(){var e,n;return Object(i.d)(this,(function(r){switch(r.label){case 0:return[4,this.tokenDetailsModel.deleteToken(t)];case 1:e=r.sent(),r.label=2;case 2:return r.trys.push([2,4,,5]),[4,this.subscriptionManager.deleteToken(this.services,e)];case 3:return r.sent(),[3,5];case 4:return n=r.sent(),console.error(n),[3,5];case 5:return[2]}}))}))},t.prototype.getPushSubscription=function(t,e){return Object(i.b)(this,void 0,void 0,(function(){var n;return Object(i.d)(this,(function(r){switch(r.label){case 0:return[4,t.pushManager.getSubscription()];case 1:return(n=r.sent())?[2,n]:[2,t.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:e})]}}))}))},t.prototype.requestPermission=function(){throw lt.create("only-available-in-window")},t.prototype.useServiceWorker=function(t){throw lt.create("only-available-in-window")},t.prototype.usePublicVapidKey=function(t){throw lt.create("only-available-in-window")},t.prototype.onMessage=function(t,e,n){throw lt.create("only-available-in-window")},t.prototype.onTokenRefresh=function(t,e,n){throw lt.create("only-available-in-window")},t.prototype.setBackgroundMessageHandler=function(t){throw lt.create("only-available-in-sw")},t.prototype.delete=function(){return Object(i.b)(this,void 0,void 0,(function(){return Object(i.d)(this,(function(t){switch(t.label){case 0:return[4,Promise.all([this.tokenDetailsModel.closeDatabase(),this.vapidDetailsModel.closeDatabase()])];case 1:return t.sent(),[2]}}))}))},t.prototype.getNotificationPermission=function(){return Notification.permission},t.prototype.requestNotificationPermission=function(){return Object(i.b)(this,void 0,void 0,(function(){return Object(i.d)(this,(function(t){return Notification.requestPermission?[2,Notification.requestPermission()]:[2,Notification.permission]}))}))},t.prototype.getTokenDetailsModel=function(){return this.tokenDetailsModel},t.prototype.getVapidDetailsModel=function(){return this.vapidDetailsModel},t.prototype.getSubscriptionManager=function(){return this.subscriptionManager},t}();var Nt=function(t){function e(e){var n=t.call(this,e)||this;return n.bgMessageHandler=null,self.addEventListener("push",(function(t){n.onPush(t)})),self.addEventListener("pushsubscriptionchange",(function(t){n.onSubChange(t)})),self.addEventListener("notificationclick",(function(t){n.onNotificationClick(t)})),n}return Object(i.c)(e,t),e.prototype.onPush=function(t){t.waitUntil(this.onPush_(t))},e.prototype.onSubChange=function(t){t.waitUntil(this.onSubChange_(t))},e.prototype.onNotificationClick=function(t){t.waitUntil(this.onNotificationClick_(t))},e.prototype.onPush_=function(t){return Object(i.b)(this,void 0,void 0,(function(){var e,n,r,o,a,s;return Object(i.d)(this,(function(i){switch(i.label){case 0:if(!t.data)return[2];try{e=t.data.json()}catch(t){return[2]}return[4,this.hasVisibleClients_()];case 1:return i.sent()?[2,this.sendMessageToWindowClients_(e)]:(n=this.getNotificationData_(e))?(r=n.title||"",[4,this.getSWRegistration_()]):[3,3];case 2:return o=i.sent(),a=n.actions,s=Notification.maxActions,a&&s&&a.length>s&&console.warn("This browser only supports "+s+" actions.The remaining actions will not be displayed."),[2,o.showNotification(r,n)];case 3:return this.bgMessageHandler?[4,this.bgMessageHandler(e)]:[3,5];case 4:return i.sent(),[2];case 5:return[2]}}))}))},e.prototype.onSubChange_=function(t){return Object(i.b)(this,void 0,void 0,(function(){var t,e,n,r;return Object(i.d)(this,(function(i){switch(i.label){case 0:return i.trys.push([0,2,,3]),[4,this.getSWRegistration_()];case 1:return t=i.sent(),[3,3];case 2:throw e=i.sent(),lt.create("unable-to-resubscribe",{errorInfo:e});case 3:return i.trys.push([3,5,,8]),[4,t.pushManager.getSubscription()];case 4:return i.sent(),[3,8];case 5:return n=i.sent(),[4,this.getTokenDetailsModel().getTokenDetailsFromSWScope(t.scope)];case 6:if(!(r=i.sent()))throw n;return[4,this.deleteToken(r.fcmToken)];case 7:throw i.sent(),n;case 8:return[2]}}))}))},e.prototype.onNotificationClick_=function(t){return Object(i.b)(this,void 0,void 0,(function(){var e,n,r,o;return Object(i.d)(this,(function(i){switch(i.label){case 0:if(!(t.notification&&t.notification.data&&t.notification.data.FCM_MSG))return[2];if(t.action)return[2];if(t.stopImmediatePropagation(),t.notification.close(),!(e=t.notification.data.FCM_MSG).notification)return[2];if(!(n=e.fcmOptions&&e.fcmOptions.link||e.notification.click_action)){if(!(e.data&&"google.c.a.c_id"in e.data))return[2];n=self.location.origin}return[4,this.getWindowClient_(n)];case 1:return(r=i.sent())?[3,4]:[4,self.clients.openWindow(n)];case 2:return r=i.sent(),[4,(a=3e3,new Promise((function(t){setTimeout(t,a)})))];case 3:return i.sent(),[3,6];case 4:return[4,r.focus()];case 5:r=i.sent(),i.label=6;case 6:return r?(delete e.notification,delete e.fcmOptions,o=At(ct.NOTIFICATION_CLICKED,e),[2,this.attemptToMessageClient_(r,o)]):[2]}var a;
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */}))}))},e.prototype.getNotificationData_=function(t){var e;if(t&&"object"==typeof t.notification){var n=Object(i.a)({},t.notification);return n.data=Object(i.a)(Object(i.a)({},t.notification.data),((e={}).FCM_MSG=t,e)),n}},e.prototype.setBackgroundMessageHandler=function(t){if(!t||"function"!=typeof t)throw lt.create("bg-handler-function-expected");this.bgMessageHandler=t},e.prototype.getWindowClient_=function(t){return Object(i.b)(this,void 0,void 0,(function(){var e,n,r,o;return Object(i.d)(this,(function(i){switch(i.label){case 0:return e=new URL(t,self.location.href).href,[4,Dt()];case 1:for(n=i.sent(),r=null,o=0;o<n.length;o++)if(new URL(n[o].url,self.location.href).href===e){r=n[o];break}return[2,r]}}))}))},e.prototype.attemptToMessageClient_=function(t,e){return Object(i.b)(this,void 0,void 0,(function(){return Object(i.d)(this,(function(n){if(!t)throw lt.create("no-window-client-to-msg");return t.postMessage(e),[2]}))}))},e.prototype.hasVisibleClients_=function(){return Object(i.b)(this,void 0,void 0,(function(){return Object(i.d)(this,(function(t){switch(t.label){case 0:return[4,Dt()];case 1:return[2,t.sent().some((function(t){return"visible"===t.visibilityState&&!t.url.startsWith("chrome-extension://")}))]}}))}))},e.prototype.sendMessageToWindowClients_=function(t){return Object(i.b)(this,void 0,void 0,(function(){var e,n,r=this;return Object(i.d)(this,(function(i){switch(i.label){case 0:return[4,Dt()];case 1:return e=i.sent(),n=At(ct.PUSH_MSG_RECEIVED,t),[4,Promise.all(e.map((function(t){return r.attemptToMessageClient_(t,n)})))];case 2:return i.sent(),[2]}}))}))},e.prototype.getSWRegistration_=function(){return Object(i.b)(this,void 0,void 0,(function(){return Object(i.d)(this,(function(t){return[2,self.registration]}))}))},e.prototype.getPublicVapidKey_=function(){return Object(i.b)(this,void 0,void 0,(function(){var t,e;return Object(i.d)(this,(function(n){switch(n.label){case 0:return[4,this.getSWRegistration_()];case 1:if(!(t=n.sent()))throw lt.create("sw-registration-expected");return[4,this.getVapidDetailsModel().getVapidFromSWScope(t.scope)];case 2:return null==(e=n.sent())?[2,ft]:[2,e]}}))}))},e}(Ct);function Dt(){return self.clients.matchAll({type:"window",includeUncontrolled:!0})}function At(t,e){return{firebaseMessagingType:t,firebaseMessagingData:e}}var Ot=function(t){function e(e){var n=t.call(this,e)||this;return n.registrationToUse=null,n.publicVapidKeyToUse=null,n.messageObserver=null,n.tokenRefreshObserver=null,n.onMessageInternal=Object(m.k)((function(t){n.messageObserver=t})),n.onTokenRefreshInternal=Object(m.k)((function(t){n.tokenRefreshObserver=t})),n.setupSWMessageListener_(),n}return Object(i.c)(e,t),e.prototype.requestPermission=function(){return Object(i.b)(this,void 0,void 0,(function(){var t;return Object(i.d)(this,(function(e){switch(e.label){case 0:return"granted"===Notification.permission?[2]:[4,Notification.requestPermission()];case 1:if("granted"===(t=e.sent()))return[2];throw"denied"===t?lt.create("permission-blocked"):lt.create("permission-default")}}))}))},e.prototype.useServiceWorker=function(t){if(!(t instanceof ServiceWorkerRegistration))throw lt.create("sw-registration-expected");if(null!=this.registrationToUse)throw lt.create("use-sw-before-get-token");this.registrationToUse=t},e.prototype.usePublicVapidKey=function(t){if("string"!=typeof t)throw lt.create("invalid-public-vapid-key");if(null!=this.publicVapidKeyToUse)throw lt.create("use-public-key-before-get-token");var e=bt(t);if(65!==e.length)throw lt.create("public-vapid-key-decryption-failed");this.publicVapidKeyToUse=e},e.prototype.onMessage=function(t,e,n){return"function"==typeof t?this.onMessageInternal(t,e,n):this.onMessageInternal(t)},e.prototype.onTokenRefresh=function(t,e,n){return"function"==typeof t?this.onTokenRefreshInternal(t,e,n):this.onTokenRefreshInternal(t)},e.prototype.waitForRegistrationToActivate_=function(t){var e=t.installing||t.waiting||t.active;return new Promise((function(n,r){if(e)if("activated"!==e.state)if("redundant"!==e.state){var i=function(){if("activated"===e.state)n(t);else{if("redundant"!==e.state)return;r(lt.create("sw-reg-redundant"))}e.removeEventListener("statechange",i)};e.addEventListener("statechange",i)}else r(lt.create("sw-reg-redundant"));else n(t);else r(lt.create("no-sw-in-reg"))}))},e.prototype.getSWRegistration_=function(){var t=this;return this.registrationToUse?this.waitForRegistrationToActivate_(this.registrationToUse):(this.registrationToUse=null,navigator.serviceWorker.register("/firebase-messaging-sw.js",{scope:"/firebase-cloud-messaging-push-scope"}).catch((function(t){throw lt.create("failed-serviceworker-registration",{browserErrorMessage:t.message})})).then((function(e){return t.waitForRegistrationToActivate_(e).then((function(){return t.registrationToUse=e,e.update(),e}))})))},e.prototype.getPublicVapidKey_=function(){return Object(i.b)(this,void 0,void 0,(function(){return Object(i.d)(this,(function(t){return this.publicVapidKeyToUse?[2,this.publicVapidKeyToUse]:[2,ft]}))}))},e.prototype.setupSWMessageListener_=function(){var t=this;navigator.serviceWorker.addEventListener("message",(function(e){return Object(i.b)(t,void 0,void 0,(function(){var t,n,r,o,a;return Object(i.d)(this,(function(i){switch(i.label){case 0:return e.data&&e.data.firebaseMessagingType&&e.data.firebaseMessagingData?(t=e.data,n=t.firebaseMessagingType,r=t.firebaseMessagingData,this.messageObserver&&this.messageObserver.next(r),(o=r.data)&&"google.c.a.c_id"in o&&"1"===o["google.c.a.e"]?(a=function(t){switch(t){case ct.NOTIFICATION_CLICKED:return"notification_open";case ct.PUSH_MSG_RECEIVED:return"notification_foreground";default:throw new Error}}(n),[4,this.services.analyticsProvider.get()]):[3,2]):[2];case 1:i.sent().logEvent(a,{message_name:o["google.c.a.c_l"],message_id:o["google.c.a.c_id"],message_time:o["google.c.a.ts"],message_device_time:Math.floor(Date.now()/1e3)}),i.label=2;case 2:return[2]}}))}))}),!1)},e}(Ct);function kt(){return self&&"ServiceWorkerGlobalScope"in self?"PushManager"in self&&"Notification"in self&&ServiceWorkerRegistration.prototype.hasOwnProperty("showNotification")&&PushSubscription.prototype.hasOwnProperty("getKey"):navigator.cookieEnabled&&"serviceWorker"in navigator&&"PushManager"in window&&"Notification"in window&&"fetch"in window&&ServiceWorkerRegistration.prototype.hasOwnProperty("showNotification")&&PushSubscription.prototype.hasOwnProperty("getKey")}!
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function(t){var e={isSupported:kt};t.INTERNAL.registerComponent(new o.a("messaging",(function(t){var e={app:t.getProvider("app").getImmediate(),installations:t.getProvider("installations").getImmediate(),analyticsProvider:t.getProvider("analytics-internal")};if(!kt())throw lt.create("unsupported-browser");return self&&"ServiceWorkerGlobalScope"in self?new Nt(e):new Ot(e)}),"PUBLIC").setServiceProps(e)),t.registerVersion("@firebase/messaging","0.6.1")}(r.default);
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var Rt=function(){function t(t,e){this.code_=$t(t),this.message_="Firebase Storage: "+e,this.serverResponse_=null,this.name_="FirebaseError"}return t.prototype.codeProp=function(){return this.code},t.prototype.codeEquals=function(t){return $t(t)===this.codeProp()},t.prototype.serverResponseProp=function(){return this.serverResponse_},t.prototype.setServerResponseProp=function(t){this.serverResponse_=t},Object.defineProperty(t.prototype,"name",{get:function(){return this.name_},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"code",{get:function(){return this.code_},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"message",{get:function(){return this.message_},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"serverResponse",{get:function(){return this.serverResponse_},enumerable:!0,configurable:!0}),t}(),Pt="unknown",Mt="object-not-found",Lt="quota-exceeded",xt="unauthenticated",Ft="unauthorized",jt="retry-limit-exceeded",Ut="canceled",qt="invalid-url",Vt="invalid-default-bucket",Bt="no-default-bucket",Wt="cannot-slice-blob",Kt="server-file-wrong-size",Qt="no-download-url",Gt="invalid-argument",Ht="invalid-argument-count",zt="app-deleted",Yt="invalid-root-operation",Xt="invalid-format",Jt="internal-error";function $t(t){return"storage/"+t}function Zt(){return new Rt(Pt,"An unknown error occurred, please check the error payload for server response.")}function te(){return new Rt(Ut,"User canceled the upload/download.")}function ee(){return new Rt(Wt,"Cannot slice blob for upload. Please retry the upload.")}function ne(){return new Rt(Qt,"The given file does not have any download URLs.")}function re(t,e,n){return new Rt(Gt,"Invalid argument in `"+e+"` at index "+t+": "+n)}function ie(){return new Rt(zt,"The Firebase app was deleted.")}function oe(t,e){return new Rt(Xt,"String does not match format '"+t+"': "+e)}function ae(t){throw new Rt(Jt,"Internal error: "+t)}
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var se={RAW:"raw",BASE64:"base64",BASE64URL:"base64url",DATA_URL:"data_url"};function ue(t){switch(t){case se.RAW:case se.BASE64:case se.BASE64URL:case se.DATA_URL:return;default:throw"Expected one of the event types: ["+se.RAW+", "+se.BASE64+", "+se.BASE64URL+", "+se.DATA_URL+"]."}}var ce=function(t,e){this.data=t,this.contentType=e||null};function he(t,e){switch(t){case se.RAW:return new ce(le(e));case se.BASE64:case se.BASE64URL:return new ce(fe(t,e));case se.DATA_URL:return new ce((n=new pe(e)).base64?fe(se.BASE64,n.rest):function(t){var e;try{e=decodeURIComponent(t)}catch(t){throw oe(se.DATA_URL,"Malformed data URL.")}return le(e)}(n.rest),function(t){return new pe(t).contentType}(e))}var n;throw Zt()}function le(t){for(var e=[],n=0;n<t.length;n++){var r=t.charCodeAt(n);if(r<=127)e.push(r);else if(r<=2047)e.push(192|r>>6,128|63&r);else if(55296==(64512&r))if(n<t.length-1&&56320==(64512&t.charCodeAt(n+1)))r=65536|(1023&r)<<10|1023&t.charCodeAt(++n),e.push(240|r>>18,128|r>>12&63,128|r>>6&63,128|63&r);else e.push(239,191,189);else 56320==(64512&r)?e.push(239,191,189):e.push(224|r>>12,128|r>>6&63,128|63&r)}return new Uint8Array(e)}function fe(t,e){switch(t){case se.BASE64:var n=-1!==e.indexOf("-"),r=-1!==e.indexOf("_");if(n||r)throw oe(t,"Invalid character '"+(n?"-":"_")+"' found: is it base64url encoded?");break;case se.BASE64URL:var i=-1!==e.indexOf("+"),o=-1!==e.indexOf("/");if(i||o)throw oe(t,"Invalid character '"+(i?"+":"/")+"' found: is it base64 encoded?");e=e.replace(/-/g,"+").replace(/_/g,"/")}var a;try{a=atob(e)}catch(e){throw oe(t,"Invalid character found")}for(var s=new Uint8Array(a.length),u=0;u<a.length;u++)s[u]=a.charCodeAt(u);return s}var pe=function(t){this.base64=!1,this.contentType=null;var e=t.match(/^data:([^,]+)?,/);if(null===e)throw oe(se.DATA_URL,"Must be formatted 'data:[<mediatype>][;base64],<data>");var n=e[1]||null;null!=n&&(this.base64=(r=n,i=";base64",r.length>=i.length&&r.substring(r.length-i.length)===i),this.contentType=this.base64?n.substring(0,n.length-";base64".length):n),this.rest=t.substring(t.indexOf(",")+1);var r,i;
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */};var de,me={STATE_CHANGED:"state_changed"},ye="running",ge="pausing",ve="paused",be="success",we="canceling",Te="canceled",_e="error",Ee={RUNNING:"running",PAUSED:"paused",SUCCESS:"success",CANCELED:"canceled",ERROR:"error"};function Se(t){switch(t){case ye:case ge:case we:return Ee.RUNNING;case ve:return Ee.PAUSED;case be:return Ee.SUCCESS;case Te:return Ee.CANCELED;case _e:default:return Ee.ERROR}}
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ie(t){return null!=t}function Ce(t){return void 0!==t}function Ne(t){return"function"==typeof t}function De(t){return"object"==typeof t}function Ae(t){return De(t)&&null!==t}function Oe(t){return"string"==typeof t||t instanceof String}function ke(t){return Re(t)&&Number.isInteger(t)}function Re(t){return"number"==typeof t||t instanceof Number}function Pe(t){return Me()&&t instanceof Blob}function Me(){return"undefined"!=typeof Blob}
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */!function(t){t[t.NO_ERROR=0]="NO_ERROR",t[t.NETWORK_ERROR=1]="NETWORK_ERROR",t[t.ABORT=2]="ABORT"}(de||(de={}));
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var Le=function(){function t(){var t=this;this.sent_=!1,this.xhr_=new XMLHttpRequest,this.errorCode_=de.NO_ERROR,this.sendPromise_=new Promise((function(e){t.xhr_.addEventListener("abort",(function(){t.errorCode_=de.ABORT,e(t)})),t.xhr_.addEventListener("error",(function(){t.errorCode_=de.NETWORK_ERROR,e(t)})),t.xhr_.addEventListener("load",(function(){e(t)}))}))}return t.prototype.send=function(t,e,n,r){if(this.sent_)throw ae("cannot .send() more than once");if(this.sent_=!0,this.xhr_.open(e,t,!0),Ie(r))for(var i in r)r.hasOwnProperty(i)&&this.xhr_.setRequestHeader(i,r[i].toString());return Ie(n)?this.xhr_.send(n):this.xhr_.send(),this.sendPromise_},t.prototype.getErrorCode=function(){if(!this.sent_)throw ae("cannot .getErrorCode() before sending");return this.errorCode_},t.prototype.getStatus=function(){if(!this.sent_)throw ae("cannot .getStatus() before sending");try{return this.xhr_.status}catch(t){return-1}},t.prototype.getResponseText=function(){if(!this.sent_)throw ae("cannot .getResponseText() before sending");return this.xhr_.responseText},t.prototype.abort=function(){this.xhr_.abort()},t.prototype.getResponseHeader=function(t){return this.xhr_.getResponseHeader(t)},t.prototype.addUploadProgressListener=function(t){Ie(this.xhr_.upload)&&this.xhr_.upload.addEventListener("progress",t)},t.prototype.removeUploadProgressListener=function(t){Ie(this.xhr_.upload)&&this.xhr_.upload.removeEventListener("progress",t)},t}(),xe=function(){function t(){}return t.prototype.createXhrIo=function(){return new Le},t}();
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function Fe(){return"undefined"!=typeof BlobBuilder?BlobBuilder:"undefined"!=typeof WebKitBlobBuilder?WebKitBlobBuilder:void 0}function je(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=Fe();if(void 0!==n){for(var r=new n,i=0;i<t.length;i++)r.append(t[i]);return r.getBlob()}if(Me())return new Blob(t);throw Error("This browser doesn't seem to support creating Blobs")}
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var Ue=function(){function t(t,e){var n=0,r="";Pe(t)?(this.data_=t,n=t.size,r=t.type):t instanceof ArrayBuffer?(e?this.data_=new Uint8Array(t):(this.data_=new Uint8Array(t.byteLength),this.data_.set(new Uint8Array(t))),n=this.data_.length):t instanceof Uint8Array&&(e?this.data_=t:(this.data_=new Uint8Array(t.length),this.data_.set(t)),n=t.length),this.size_=n,this.type_=r}return t.prototype.size=function(){return this.size_},t.prototype.type=function(){return this.type_},t.prototype.slice=function(e,n){if(Pe(this.data_)){var r=function(t,e,n){return t.webkitSlice?t.webkitSlice(e,n):t.mozSlice?t.mozSlice(e,n):t.slice?t.slice(e,n):null}(this.data_,e,n);return null===r?null:new t(r)}return new t(new Uint8Array(this.data_.buffer,e,n-e),!0)},t.getBlob=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];if(Me()){var r=e.map((function(e){return e instanceof t?e.data_:e}));return new t(je.apply(null,r))}var i=e.map((function(t){return Oe(t)?he(se.RAW,t).data:t.data_})),o=0;i.forEach((function(t){o+=t.byteLength}));var a=new Uint8Array(o),s=0;return i.forEach((function(t){for(var e=0;e<t.length;e++)a[s++]=t[e]})),new t(a,!0)},t.prototype.uploadData=function(){return this.data_},t}(),qe=function(){function t(t,e){this.bucket=t,this.path_=e}return Object.defineProperty(t.prototype,"path",{get:function(){return this.path_},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isRoot",{get:function(){return 0===this.path.length},enumerable:!0,configurable:!0}),t.prototype.fullServerUrl=function(){var t=encodeURIComponent;return"/b/"+t(this.bucket)+"/o/"+t(this.path)},t.prototype.bucketOnlyServerUrl=function(){return"/b/"+encodeURIComponent(this.bucket)+"/o"},t.makeFromBucketSpec=function(e){var n;try{n=t.makeFromUrl(e)}catch(n){return new t(e,"")}if(""===n.path)return n;throw new Rt(Vt,"Invalid default bucket '"+e+"'.")},t.makeFromUrl=function(e){var n=null;var r=new RegExp("^gs://([A-Za-z0-9.\\-_]+)(/(.*))?$","i");for(var i="firebasestorage.googleapis.com".replace(/[.]/g,"\\."),o=[{regex:r,indices:{bucket:1,path:3},postModify:function(t){"/"===t.path.charAt(t.path.length-1)&&(t.path_=t.path_.slice(0,-1))}},{regex:new RegExp("^https?://"+i+"/v[A-Za-z0-9_]+/b/([A-Za-z0-9.\\-_]+)/o(/([^?#]*).*)?$","i"),indices:{bucket:1,path:3},postModify:function(t){t.path_=decodeURIComponent(t.path)}}],a=0;a<o.length;a++){var s=o[a],u=s.regex.exec(e);if(u){var c=u[s.indices.bucket],h=u[s.indices.path];h||(h=""),n=new t(c,h),s.postModify(n);break}}if(null==n)throw function(t){return new Rt(qt,"Invalid URL '"+t+"'.")}(e);return n},t}();
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function Ve(t){var e,n;try{e=JSON.parse(t)}catch(t){return null}return De(n=e)&&!Array.isArray(n)?e:null}
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Be(t,e){var n=e.split("/").filter((function(t){return t.length>0})).join("/");return 0===t.length?n:t+"/"+n}function We(t){var e=t.lastIndexOf("/",t.length-2);return-1===e?t:t.slice(e+1)}
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ke(t){return"https://firebasestorage.googleapis.com/v0"+t}function Qe(t){var e=encodeURIComponent,n="?";for(var r in t){if(t.hasOwnProperty(r))n=n+(e(r)+"="+e(t[r]))+"&"}return n=n.slice(0,-1)}
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ge(t,e){return e}var He=function(t,e,n,r){this.server=t,this.local=e||t,this.writable=!!n,this.xform=r||Ge},ze=null;function Ye(){if(ze)return ze;var t=[];t.push(new He("bucket")),t.push(new He("generation")),t.push(new He("metageneration")),t.push(new He("name","fullPath",!0));var e=new He("name");e.xform=function(t,e){return function(t){return!Oe(t)||t.length<2?t:We(t)}(e)},t.push(e);var n=new He("size");return n.xform=function(t,e){return Ie(e)?Number(e):e},t.push(n),t.push(new He("timeCreated")),t.push(new He("updated")),t.push(new He("md5Hash",null,!0)),t.push(new He("cacheControl",null,!0)),t.push(new He("contentDisposition",null,!0)),t.push(new He("contentEncoding",null,!0)),t.push(new He("contentLanguage",null,!0)),t.push(new He("contentType",null,!0)),t.push(new He("metadata","customMetadata",!0)),ze=t}function Xe(t,e,n){for(var r={type:"file"},i=n.length,o=0;o<i;o++){var a=n[o];r[a.local]=a.xform(r,e[a.server])}return function(t,e){Object.defineProperty(t,"ref",{get:function(){var n=t.bucket,r=t.fullPath,i=new qe(n,r);return e.makeStorageReference(i)}})}(r,t),r}function Je(t,e,n){var r=Ve(e);return null===r?null:Xe(t,r,n)}function $e(t,e){for(var n={},r=e.length,i=0;i<r;i++){var o=e[i];o.writable&&(n[o.server]=t[o.local])}return JSON.stringify(n)}function Ze(t){if(!De(t)||!t)throw"Expected Metadata object.";for(var e in t)if(t.hasOwnProperty(e)){var n=t[e];if("customMetadata"===e){if(!De(n))throw"Expected object for 'customMetadata' mapping."}else if(Ae(n))throw"Mapping for '"+e+"' cannot be an object."}}
/**
 * @license
 * Copyright 2019 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function tn(t,e){var n={prefixes:[],items:[],nextPageToken:e.nextPageToken},r=t.bucket();if(null===r)throw new Rt(Bt,"No default bucket found. Did you set the 'storageBucket' property when initializing the app?");if(e.prefixes)for(var i=0,o=e.prefixes;i<o.length;i++){var a=o[i].replace(/\/$/,""),s=t.makeStorageReference(new qe(r,a));n.prefixes.push(s)}if(e.items)for(var u=0,c=e.items;u<c.length;u++){var h=c[u];s=t.makeStorageReference(new qe(r,h.name));n.items.push(s)}return n}function en(t){if(!De(t)||!t)throw"Expected ListOptions object.";for(var e in t)if("maxResults"===e){if(!ke(t.maxResults)||t.maxResults<=0)throw"Expected maxResults to be a positive number.";if(t.maxResults>1e3)throw"Expected maxResults to be less than or equal to 1000."}else{if("pageToken"!==e)throw"Unknown option: "+e;if(t.pageToken&&!Oe(t.pageToken))throw"Expected pageToken to be string."}}var nn=function(t,e,n,r){this.url=t,this.method=e,this.handler=n,this.timeout=r,this.urlParams={},this.headers={},this.body=null,this.errorHandler=null,this.progressCallback=null,this.successCodes=[200],this.additionalRetryCodes=[]};
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function rn(t){if(!t)throw Zt()}function on(t,e){return function(n,r){var i=Je(t,r,e);return rn(null!==i),i}}function an(t){return function(e,n){var r=function(t,e){var n=Ve(e);return null===n?null:tn(t,n)}(t,n);return rn(null!==r),r}}function sn(t,e){return function(n,r){var i=Je(t,r,e);return rn(null!==i),function(t,e){var n=Ve(e);if(null===n)return null;if(!Oe(n.downloadTokens))return null;var r=n.downloadTokens;if(0===r.length)return null;var i=encodeURIComponent;return r.split(",").map((function(e){var n=t.bucket,r=t.fullPath;return Ke("/b/"+i(n)+"/o/"+i(r))+Qe({alt:"media",token:e})}))[0]}(i,r)}}function un(t){return function(e,n){var r,i,o;return 401===e.getStatus()?r=new Rt(xt,"User is not authenticated, please authenticate using Firebase Authentication and try again."):402===e.getStatus()?(o=t.bucket,r=new Rt(Lt,"Quota for bucket '"+o+"' exceeded, please view quota on https://firebase.google.com/pricing/.")):403===e.getStatus()?(i=t.path,r=new Rt(Ft,"User does not have permission to access '"+i+"'.")):r=n,r.setServerResponseProp(n.serverResponseProp()),r}}function cn(t){var e=un(t);return function(n,r){var i,o=e(n,r);return 404===n.getStatus()&&(i=t.path,o=new Rt(Mt,"Object '"+i+"' does not exist.")),o.setServerResponseProp(r.serverResponseProp()),o}}function hn(t,e,n){var r=Ke(e.fullServerUrl()),i=t.maxOperationRetryTime(),o=new nn(r,"GET",on(t,n),i);return o.errorHandler=cn(e),o}function ln(t,e,n,r,i){var o={};e.isRoot?o.prefix="":o.prefix=e.path+"/",n&&n.length>0&&(o.delimiter=n),r&&(o.pageToken=r),i&&(o.maxResults=i);var a=Ke(e.bucketOnlyServerUrl()),s=t.maxOperationRetryTime(),u=new nn(a,"GET",an(t),s);return u.urlParams=o,u.errorHandler=un(e),u}function fn(t,e,n){var r=Ke(e.fullServerUrl()),i=t.maxOperationRetryTime(),o=new nn(r,"GET",sn(t,n),i);return o.errorHandler=cn(e),o}function pn(t,e,n,r){var i=Ke(e.fullServerUrl()),o=$e(n,r),a=t.maxOperationRetryTime(),s=new nn(i,"PATCH",on(t,r),a);return s.headers={"Content-Type":"application/json; charset=utf-8"},s.body=o,s.errorHandler=cn(e),s}function dn(t,e){var n=Ke(e.fullServerUrl()),r=t.maxOperationRetryTime();var i=new nn(n,"DELETE",(function(t,e){}),r);return i.successCodes=[200,204],i.errorHandler=cn(e),i}function mn(t,e,n){var r=Object.assign({},n);return r.fullPath=t.path,r.size=e.size(),r.contentType||(r.contentType=function(t,e){return t&&t.contentType||e&&e.type()||"application/octet-stream"}(null,e)),r}var yn=function(t,e,n,r){this.current=t,this.total=e,this.finalized=!!n,this.metadata=r||null};function gn(t,e){var n=null;try{n=t.getResponseHeader("X-Goog-Upload-Status")}catch(t){rn(!1)}return rn(!!n&&-1!==(e||["active"]).indexOf(n)),n}function vn(t,e,n,r,i,o,a,s){var u=new yn(0,0);if(a?(u.current=a.current,u.total=a.total):(u.current=0,u.total=r.size()),r.size()!==u.total)throw new Rt(Kt,"Server recorded incorrect upload file size, please retry the upload.");var c=u.total-u.current,h=c;i>0&&(h=Math.min(h,i));var l=u.current,f=l+h,p={"X-Goog-Upload-Command":h===c?"upload, finalize":"upload","X-Goog-Upload-Offset":u.current},d=r.slice(l,f);if(null===d)throw ee();var m=e.maxUploadRetryTime(),y=new nn(n,"POST",(function(t,n){var i,a=gn(t,["active","final"]),s=u.current+h,c=r.size();return i="final"===a?on(e,o)(t,n):null,new yn(s,c,"final"===a,i)}),m);return y.headers=p,y.body=d.uploadData(),y.progressCallback=s||null,y.errorHandler=un(t),y}
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var bn=function(t,e,n){if(Ne(t)||Ie(e)||Ie(n))this.next=t,this.error=e||null,this.complete=n||null;else{var r=t;this.next=r.next||null,this.error=r.error||null,this.complete=r.complete||null}},wn=function(t,e,n,r,i,o){this.bytesTransferred=t,this.totalBytes=e,this.state=n,this.metadata=r,this.task=i,this.ref=o};
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function Tn(t,e,n){for(var r=e.length,i=e.length,o=0;o<e.length;o++)if(e[o].optional){r=o;break}var a,s,u,c,h,l;if(!(r<=n.length&&n.length<=i))throw a=r,s=i,u=t,c=n.length,a===s?(h=a,l=1===a?"argument":"arguments"):(h="between "+a+" and "+s,l="arguments"),new Rt(Ht,"Invalid argument count in `"+u+"`: Expected "+h+" "+l+", received "+c+".");for(o=0;o<n.length;o++)try{e[o].validator(n[o])}catch(e){throw e instanceof Error?re(o,t,e.message):re(o,t,e)}}var _n=function(t,e){var n=this;this.validator=function(e){n.optional&&!Ce(e)||t(e)},this.optional=!!e};function En(t,e){function n(t){if(!Oe(t))throw"Expected string."}var r,i,o;return t?(i=n,o=t,r=function(t){i(t),o(t)}):r=n,new _n(r,e)}function Sn(){return new _n((function(t){if(!(t instanceof Uint8Array||t instanceof ArrayBuffer||Me()&&t instanceof Blob))throw"Expected Blob or File."}))}function In(t){return new _n(Ze,t)}function Cn(t){return new _n(en,t)}function Nn(){return new _n((function(t){if(!(Re(t)&&t>=0))throw"Expected a number 0 or greater."}))}function Dn(t,e){return new _n((function(e){if(!(null===e||Ie(e)&&e instanceof Object))throw"Expected an Object.";null!=t&&t(e)}),e)}function An(t){return new _n((function(t){if(!(null===t||Ne(t)))throw"Expected a Function."}),t)}
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function On(t){return function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];Promise.resolve().then((function(){return t.apply(void 0,e)}))}}
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var kn=function(){function t(t,e,n,r,i,o){var a=this;void 0===o&&(o=null),this.transferred_=0,this.needToFetchStatus_=!1,this.needToFetchMetadata_=!1,this.observers_=[],this.error_=null,this.uploadUrl_=null,this.request_=null,this.chunkMultiplier_=1,this.resolve_=null,this.reject_=null,this.ref_=t,this.authWrapper_=e,this.location_=n,this.blob_=i,this.metadata_=o,this.mappings_=r,this.resumable_=this.shouldDoResumable_(this.blob_),this.state_=ye,this.errorHandler_=function(t){a.request_=null,a.chunkMultiplier_=1,t.codeEquals(Ut)?(a.needToFetchStatus_=!0,a.completeTransitions_()):(a.error_=t,a.transition_(_e))},this.metadataErrorHandler_=function(t){a.request_=null,t.codeEquals(Ut)?a.completeTransitions_():(a.error_=t,a.transition_(_e))},this.promise_=new Promise((function(t,e){a.resolve_=t,a.reject_=e,a.start_()})),this.promise_.then(null,(function(){}))}return t.prototype.makeProgressCallback_=function(){var t=this,e=this.transferred_;return function(n){return t.updateProgress_(e+n)}},t.prototype.shouldDoResumable_=function(t){return t.size()>262144},t.prototype.start_=function(){this.state_===ye&&null===this.request_&&(this.resumable_?null===this.uploadUrl_?this.createResumable_():this.needToFetchStatus_?this.fetchStatus_():this.needToFetchMetadata_?this.fetchMetadata_():this.continueUpload_():this.oneShotUpload_())},t.prototype.resolveToken_=function(t){var e=this;this.authWrapper_.getAuthToken().then((function(n){switch(e.state_){case ye:t(n);break;case we:e.transition_(Te);break;case ge:e.transition_(ve)}}))},t.prototype.createResumable_=function(){var t=this;this.resolveToken_((function(e){var n=function(t,e,n,r,i){var o=e.bucketOnlyServerUrl(),a=mn(e,r,i),s={name:a.fullPath},u=Ke(o),c={"X-Goog-Upload-Protocol":"resumable","X-Goog-Upload-Command":"start","X-Goog-Upload-Header-Content-Length":r.size(),"X-Goog-Upload-Header-Content-Type":a.contentType,"Content-Type":"application/json; charset=utf-8"},h=$e(a,n),l=t.maxUploadRetryTime(),f=new nn(u,"POST",(function(t){var e;gn(t);try{e=t.getResponseHeader("X-Goog-Upload-URL")}catch(t){rn(!1)}return rn(Oe(e)),e}),l);return f.urlParams=s,f.headers=c,f.body=h,f.errorHandler=un(e),f}(t.authWrapper_,t.location_,t.mappings_,t.blob_,t.metadata_),r=t.authWrapper_.makeRequest(n,e);t.request_=r,r.getPromise().then((function(e){t.request_=null,t.uploadUrl_=e,t.needToFetchStatus_=!1,t.completeTransitions_()}),t.errorHandler_)}))},t.prototype.fetchStatus_=function(){var t=this,e=this.uploadUrl_;this.resolveToken_((function(n){var r=function(t,e,n,r){var i=t.maxUploadRetryTime(),o=new nn(n,"POST",(function(t){var e=gn(t,["active","final"]),n=null;try{n=t.getResponseHeader("X-Goog-Upload-Size-Received")}catch(t){rn(!1)}n||rn(!1);var i=Number(n);return rn(!isNaN(i)),new yn(i,r.size(),"final"===e)}),i);return o.headers={"X-Goog-Upload-Command":"query"},o.errorHandler=un(e),o}(t.authWrapper_,t.location_,e,t.blob_),i=t.authWrapper_.makeRequest(r,n);t.request_=i,i.getPromise().then((function(e){e=e,t.request_=null,t.updateProgress_(e.current),t.needToFetchStatus_=!1,e.finalized&&(t.needToFetchMetadata_=!0),t.completeTransitions_()}),t.errorHandler_)}))},t.prototype.continueUpload_=function(){var t=this,e=262144*this.chunkMultiplier_,n=new yn(this.transferred_,this.blob_.size()),r=this.uploadUrl_;this.resolveToken_((function(i){var o;try{o=vn(t.location_,t.authWrapper_,r,t.blob_,e,t.mappings_,n,t.makeProgressCallback_())}catch(e){return t.error_=e,void t.transition_(_e)}var a=t.authWrapper_.makeRequest(o,i);t.request_=a,a.getPromise().then((function(e){t.increaseMultiplier_(),t.request_=null,t.updateProgress_(e.current),e.finalized?(t.metadata_=e.metadata,t.transition_(be)):t.completeTransitions_()}),t.errorHandler_)}))},t.prototype.increaseMultiplier_=function(){262144*this.chunkMultiplier_<33554432&&(this.chunkMultiplier_*=2)},t.prototype.fetchMetadata_=function(){var t=this;this.resolveToken_((function(e){var n=hn(t.authWrapper_,t.location_,t.mappings_),r=t.authWrapper_.makeRequest(n,e);t.request_=r,r.getPromise().then((function(e){t.request_=null,t.metadata_=e,t.transition_(be)}),t.metadataErrorHandler_)}))},t.prototype.oneShotUpload_=function(){var t=this;this.resolveToken_((function(e){var n=function(t,e,n,r,i){var o=e.bucketOnlyServerUrl(),a={"X-Goog-Upload-Protocol":"multipart"},s=function(){for(var t="",e=0;e<2;e++)t+=Math.random().toString().slice(2);return t}();a["Content-Type"]="multipart/related; boundary="+s;var u=mn(e,r,i),c="--"+s+"\r\nContent-Type: application/json; charset=utf-8\r\n\r\n"+$e(u,n)+"\r\n--"+s+"\r\nContent-Type: "+u.contentType+"\r\n\r\n",h="\r\n--"+s+"--",l=Ue.getBlob(c,r,h);if(null===l)throw ee();var f={name:u.fullPath},p=Ke(o),d=t.maxUploadRetryTime(),m=new nn(p,"POST",on(t,n),d);return m.urlParams=f,m.headers=a,m.body=l.uploadData(),m.errorHandler=un(e),m}(t.authWrapper_,t.location_,t.mappings_,t.blob_,t.metadata_),r=t.authWrapper_.makeRequest(n,e);t.request_=r,r.getPromise().then((function(e){t.request_=null,t.metadata_=e,t.updateProgress_(t.blob_.size()),t.transition_(be)}),t.errorHandler_)}))},t.prototype.updateProgress_=function(t){var e=this.transferred_;this.transferred_=t,this.transferred_!==e&&this.notifyObservers_()},t.prototype.transition_=function(t){if(this.state_!==t)switch(t){case we:case ge:this.state_=t,null!==this.request_&&this.request_.cancel();break;case ye:var e=this.state_===ve;this.state_=t,e&&(this.notifyObservers_(),this.start_());break;case ve:this.state_=t,this.notifyObservers_();break;case Te:this.error_=te(),this.state_=t,this.notifyObservers_();break;case _e:case be:this.state_=t,this.notifyObservers_()}},t.prototype.completeTransitions_=function(){switch(this.state_){case ge:this.transition_(ve);break;case we:this.transition_(Te);break;case ye:this.start_()}},Object.defineProperty(t.prototype,"snapshot",{get:function(){var t=Se(this.state_);return new wn(this.transferred_,this.blob_.size(),t,this.metadata_,this,this.ref_)},enumerable:!0,configurable:!0}),t.prototype.on=function(t,e,n,r){function i(){if(t!==me.STATE_CHANGED)throw"Expected one of the event types: ["+me.STATE_CHANGED+"]."}var o="Expected a function or an Object with one of `next`, `error`, `complete` properties.",a=An(!0).validator,s=Dn(null,!0).validator;function u(t){try{return void a(t)}catch(t){}try{if(s(t),!(Ce(t.next)||Ce(t.error)||Ce(t.complete)))throw"";return}catch(t){throw o}}var c=[En(i),Dn(u,!0),An(!0),An(!0)];Tn("on",c,arguments);var h=this;function l(t){return function(e,n,i){null!==t&&Tn("on",t,arguments);var o=new bn(e,n,r);return h.addObserver_(o),function(){h.removeObserver_(o)}}}function f(t){if(null===t)throw o;u(t)}var p=[Dn(f),An(!0),An(!0)],d=!(Ce(e)||Ce(n)||Ce(r));return d?l(p):l(null)(e,n,r)},t.prototype.then=function(t,e){return this.promise_.then(t,e)},t.prototype.catch=function(t){return this.then(null,t)},t.prototype.addObserver_=function(t){this.observers_.push(t),this.notifyObserver_(t)},t.prototype.removeObserver_=function(t){var e=this.observers_.indexOf(t);-1!==e&&this.observers_.splice(e,1)},t.prototype.notifyObservers_=function(){var t=this;this.finishPromise_(),this.observers_.slice().forEach((function(e){t.notifyObserver_(e)}))},t.prototype.finishPromise_=function(){if(null!==this.resolve_){var t=!0;switch(Se(this.state_)){case Ee.SUCCESS:On(this.resolve_.bind(null,this.snapshot))();break;case Ee.CANCELED:case Ee.ERROR:On(this.reject_.bind(null,this.error_))();break;default:t=!1}t&&(this.resolve_=null,this.reject_=null)}},t.prototype.notifyObserver_=function(t){switch(Se(this.state_)){case Ee.RUNNING:case Ee.PAUSED:t.next&&On(t.next.bind(t,this.snapshot))();break;case Ee.SUCCESS:t.complete&&On(t.complete.bind(t))();break;case Ee.CANCELED:case Ee.ERROR:t.error&&On(t.error.bind(t,this.error_))();break;default:t.error&&On(t.error.bind(t,this.error_))()}},t.prototype.resume=function(){Tn("resume",[],arguments);var t=this.state_===ve||this.state_===ge;return t&&this.transition_(ye),t},t.prototype.pause=function(){Tn("pause",[],arguments);var t=this.state_===ye;return t&&this.transition_(ge),t},t.prototype.cancel=function(){Tn("cancel",[],arguments);var t=this.state_===ye||this.state_===ge;return t&&this.transition_(we),t},t}(),Rn=function(){function t(t,e){this.authWrapper=t,this.location=e instanceof qe?e:qe.makeFromUrl(e)}return t.prototype.toString=function(){return Tn("toString",[],arguments),"gs://"+this.location.bucket+"/"+this.location.path},t.prototype.newRef=function(e,n){return new t(e,n)},t.prototype.mappings=function(){return Ye()},t.prototype.child=function(t){Tn("child",[En()],arguments);var e=Be(this.location.path,t),n=new qe(this.location.bucket,e);return this.newRef(this.authWrapper,n)},Object.defineProperty(t.prototype,"parent",{get:function(){var t=function(t){if(0===t.length)return null;var e=t.lastIndexOf("/");return-1===e?"":t.slice(0,e)}(this.location.path);if(null===t)return null;var e=new qe(this.location.bucket,t);return this.newRef(this.authWrapper,e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"root",{get:function(){var t=new qe(this.location.bucket,"");return this.newRef(this.authWrapper,t)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"bucket",{get:function(){return this.location.bucket},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"fullPath",{get:function(){return this.location.path},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"name",{get:function(){return We(this.location.path)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"storage",{get:function(){return this.authWrapper.service()},enumerable:!0,configurable:!0}),t.prototype.put=function(t,e){return void 0===e&&(e=null),Tn("put",[Sn(),In(!0)],arguments),this.throwIfRoot_("put"),new kn(this,this.authWrapper,this.location,this.mappings(),new Ue(t),e)},t.prototype.putString=function(t,e,n){void 0===e&&(e=se.RAW),Tn("putString",[En(),En(ue,!0),In(!0)],arguments),this.throwIfRoot_("putString");var r=he(e,t),i=Object.assign({},n);return!Ie(i.contentType)&&Ie(r.contentType)&&(i.contentType=r.contentType),new kn(this,this.authWrapper,this.location,this.mappings(),new Ue(r.data,!0),i)},t.prototype.delete=function(){var t=this;return Tn("delete",[],arguments),this.throwIfRoot_("delete"),this.authWrapper.getAuthToken().then((function(e){var n=dn(t.authWrapper,t.location);return t.authWrapper.makeRequest(n,e).getPromise()}))},t.prototype.listAll=function(){Tn("listAll",[],arguments);var t={prefixes:[],items:[]};return this.listAllHelper(t).then((function(){return t}))},t.prototype.listAllHelper=function(t,e){return Object(i.b)(this,void 0,void 0,(function(){var n,r,o,a;return Object(i.d)(this,(function(i){switch(i.label){case 0:return n={pageToken:e},[4,this.list(n)];case 1:return r=i.sent(),(o=t.prefixes).push.apply(o,r.prefixes),(a=t.items).push.apply(a,r.items),null==r.nextPageToken?[3,3]:[4,this.listAllHelper(t,r.nextPageToken)];case 2:i.sent(),i.label=3;case 3:return[2]}}))}))},t.prototype.list=function(t){Tn("list",[Cn(!0)],arguments);var e=this;return this.authWrapper.getAuthToken().then((function(n){var r=t||{},i=ln(e.authWrapper,e.location,"/",r.pageToken,r.maxResults);return e.authWrapper.makeRequest(i,n).getPromise()}))},t.prototype.getMetadata=function(){var t=this;return Tn("getMetadata",[],arguments),this.throwIfRoot_("getMetadata"),this.authWrapper.getAuthToken().then((function(e){var n=hn(t.authWrapper,t.location,t.mappings());return t.authWrapper.makeRequest(n,e).getPromise()}))},t.prototype.updateMetadata=function(t){var e=this;return Tn("updateMetadata",[In()],arguments),this.throwIfRoot_("updateMetadata"),this.authWrapper.getAuthToken().then((function(n){var r=pn(e.authWrapper,e.location,t,e.mappings());return e.authWrapper.makeRequest(r,n).getPromise()}))},t.prototype.getDownloadURL=function(){var t=this;return Tn("getDownloadURL",[],arguments),this.throwIfRoot_("getDownloadURL"),this.authWrapper.getAuthToken().then((function(e){var n=fn(t.authWrapper,t.location,t.mappings());return t.authWrapper.makeRequest(n,e).getPromise().then((function(t){if(null===t)throw ne();return t}))}))},t.prototype.throwIfRoot_=function(t){if(""===this.location.path)throw function(t){return new Rt(Yt,"The operation '"+t+"' cannot be performed on a root reference, create a non-root reference using child, such as .child('file.png').")}(t)},t}(),Pn=function(){function t(t){this.promise_=Promise.reject(t)}return t.prototype.getPromise=function(){return this.promise_},t.prototype.cancel=function(t){},t}(),Mn=function(){function t(){this.map=new Map,this.id=-9007199254740991}return t.prototype.addRequest=function(t){var e=this,n=this.id;this.id++,this.map.set(n,t),t.getPromise().then((function(){return e.map.delete(n)}),(function(){return e.map.delete(n)}))},t.prototype.clear=function(){this.map.forEach((function(t){t&&t.cancel(!0)})),this.map.clear()},t}(),Ln=function(){function t(e,n,r,i,o,a){if(this.bucket_=null,this.deleted_=!1,this.app_=e,null!==this.app_){var s=this.app_.options;Ie(s)&&(this.bucket_=t.extractBucket_(s))}this.authProvider_=n,this.storageRefMaker_=r,this.requestMaker_=i,this.pool_=a,this.service_=o,this.maxOperationRetryTime_=12e4,this.maxUploadRetryTime_=6e5,this.requestMap_=new Mn}return t.extractBucket_=function(t){var e=t.storageBucket||null;return null==e?null:qe.makeFromBucketSpec(e).bucket},t.prototype.getAuthToken=function(){var t=this.authProvider_.getImmediate({optional:!0});return t?t.getToken().then((function(t){return null!==t?t.accessToken:null}),(function(){return null})):Promise.resolve(null)},t.prototype.bucket=function(){if(this.deleted_)throw ie();return this.bucket_},t.prototype.service=function(){return this.service_},t.prototype.makeStorageReference=function(t){return this.storageRefMaker_(this,t)},t.prototype.makeRequest=function(t,e){if(this.deleted_)return new Pn(ie());var n=this.requestMaker_(t,e,this.pool_);return this.requestMap_.addRequest(n),n},t.prototype.deleteApp=function(){this.deleted_=!0,this.app_=null,this.requestMap_.clear()},t.prototype.maxUploadRetryTime=function(){return this.maxUploadRetryTime_},t.prototype.setMaxUploadRetryTime=function(t){this.maxUploadRetryTime_=t},t.prototype.maxOperationRetryTime=function(){return this.maxOperationRetryTime_},t.prototype.setMaxOperationRetryTime=function(t){this.maxOperationRetryTime_=t},t}();
/**
 * @license
 * Copyright 2019 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var xn=function(){function t(t,e,n,r,i,o,a,s,u,c,h){var l=this;this.pendingXhr_=null,this.backoffId_=null,this.resolve_=null,this.reject_=null,this.canceled_=!1,this.appDelete_=!1,this.url_=t,this.method_=e,this.headers_=n,this.body_=r,this.successCodes_=i.slice(),this.additionalRetryCodes_=o.slice(),this.callback_=a,this.errorCallback_=s,this.progressCallback_=c,this.timeout_=u,this.pool_=h,this.promise_=new Promise((function(t,e){l.resolve_=t,l.reject_=e,l.start_()}))}return t.prototype.start_=function(){var t=this;function e(e,n){var r,i=t.resolve_,o=t.reject_,a=n.xhr;if(n.wasSuccessCode)try{var s=t.callback_(a,a.getResponseText());Ce(s)?i(s):i()}catch(t){o(t)}else null!==a?((r=Zt()).setServerResponseProp(a.getResponseText()),t.errorCallback_?o(t.errorCallback_(a,r)):o(r)):n.canceled?o(r=t.appDelete_?ie():te()):o(r=new Rt(jt,"Max retry time for operation exceeded, please try again."))}this.canceled_?e(0,new Fn(!1,null,!0)):this.backoffId_=
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function(t,e,n){var r=1,o=null,a=!1,s=0;function u(){return 2===s}var c=!1;function h(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];c||(c=!0,e.apply(null,t))}function l(e){o=setTimeout((function(){o=null,t(f,u())}),e)}function f(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];if(!c)if(t)h.call.apply(h,Object(i.g)([null,t],e));else{var o,f=u()||a;if(f)h.call.apply(h,Object(i.g)([null,t],e));else r<64&&(r*=2),1===s?(s=2,o=0):o=1e3*(r+Math.random()),l(o)}}var p=!1;function d(t){p||(p=!0,c||(null!==o?(t||(s=2),clearTimeout(o),l(0)):t||(s=1)))}return l(0),setTimeout((function(){a=!0,d(!0)}),n),d}((function(e,n){if(n)e(!1,new Fn(!1,null,!0));else{var r=t.pool_.createXhrIo();t.pendingXhr_=r,null!==t.progressCallback_&&r.addUploadProgressListener(i),r.send(t.url_,t.method_,t.body_,t.headers_).then((function(n){null!==t.progressCallback_&&n.removeUploadProgressListener(i),t.pendingXhr_=null;var r=(n=n).getErrorCode()===de.NO_ERROR,o=n.getStatus();if(r&&!t.isRetryStatusCode_(o)){var a=-1!==t.successCodes_.indexOf(o);e(!0,new Fn(a,n))}else{var s=n.getErrorCode()===de.ABORT;e(!1,new Fn(!1,null,s))}}))}function i(e){var n=e.loaded,r=e.lengthComputable?e.total:-1;null!==t.progressCallback_&&t.progressCallback_(n,r)}}),e,this.timeout_)},t.prototype.getPromise=function(){return this.promise_},t.prototype.cancel=function(t){this.canceled_=!0,this.appDelete_=t||!1,null!==this.backoffId_&&(0,this.backoffId_)(!1),null!==this.pendingXhr_&&this.pendingXhr_.abort()},t.prototype.isRetryStatusCode_=function(t){var e=t>=500&&t<600,n=-1!==[408,429].indexOf(t),r=-1!==this.additionalRetryCodes_.indexOf(t);return e||n||r},t}(),Fn=function(t,e,n){this.wasSuccessCode=t,this.xhr=e,this.canceled=!!n};function jn(t,e,n){var i=Qe(t.urlParams),o=t.url+i,a=Object.assign({},t.headers);return function(t,e){null!==e&&e.length>0&&(t.Authorization="Firebase "+e)}(a,e),function(t){var e=void 0!==r.default?r.default.SDK_VERSION:"AppManager";t["X-Firebase-Storage-Version"]="webjs/"+e}(a),new xn(o,t.method,a,t.body,t.successCodes,t.additionalRetryCodes,t.handler,t.errorHandler,t.timeout,t.progressCallback,n)}
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Un=function(){function t(t,e,n,r){if(this.bucket_=null,this.authWrapper_=new Ln(t,e,(function(t,e){return new Rn(t,e)}),jn,this,n),this.app_=t,null!=r)this.bucket_=qe.makeFromBucketSpec(r);else{var i=this.authWrapper_.bucket();null!=i&&(this.bucket_=new qe(i,""))}this.internals_=new qn(this)}return t.prototype.ref=function(t){function e(t){if("string"!=typeof t)throw"Path is not a string.";if(/^[A-Za-z]+:\/\//.test(t))throw"Expected child path but got a URL, use refFromURL instead."}if(Tn("ref",[En(e,!0)],arguments),null==this.bucket_)throw new Error("No Storage Bucket defined in Firebase Options.");var n=new Rn(this.authWrapper_,this.bucket_);return null!=t?n.child(t):n},t.prototype.refFromURL=function(t){function e(t){if("string"!=typeof t)throw"Path is not a string.";if(!/^[A-Za-z]+:\/\//.test(t))throw"Expected full URL but got a child path, use ref instead.";try{qe.makeFromUrl(t)}catch(t){throw"Expected valid full URL but got an invalid one."}}return Tn("refFromURL",[En(e,!1)],arguments),new Rn(this.authWrapper_,t)},Object.defineProperty(t.prototype,"maxUploadRetryTime",{get:function(){return this.authWrapper_.maxUploadRetryTime()},enumerable:!0,configurable:!0}),t.prototype.setMaxUploadRetryTime=function(t){Tn("setMaxUploadRetryTime",[Nn()],arguments),this.authWrapper_.setMaxUploadRetryTime(t)},t.prototype.setMaxOperationRetryTime=function(t){Tn("setMaxOperationRetryTime",[Nn()],arguments),this.authWrapper_.setMaxOperationRetryTime(t)},Object.defineProperty(t.prototype,"app",{get:function(){return this.app_},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"INTERNAL",{get:function(){return this.internals_},enumerable:!0,configurable:!0}),t}(),qn=function(){function t(t){this.service_=t}return t.prototype.delete=function(){return this.service_.authWrapper_.deleteApp(),Promise.resolve()},t}();function Vn(t,e){var n=t.getProvider("app").getImmediate(),r=t.getProvider("auth-internal");return new Un(n,r,new xe,e)}!function(t){var e={TaskState:Ee,TaskEvent:me,StringFormat:se,Storage:Un,Reference:Rn};t.INTERNAL.registerComponent(new o.a("storage",Vn,"PUBLIC").setServiceProps(e).setMultipleInstances(!0)),t.registerVersion("@firebase/storage","0.3.23")}(r.default);var Bn,Wn,Kn,Qn,Gn=n(16),Hn=((Bn={})["trace started"]="Trace {$traceName} was started before.",Bn["trace stopped"]="Trace {$traceName} is not running.",Bn["no window"]="Window is not available.",Bn["no app id"]="App id is not available.",Bn["no project id"]="Project id is not available.",Bn["no api key"]="Api key is not available.",Bn["invalid cc log"]="Attempted to queue invalid cc event",Bn["FB not default"]="Performance can only start when Firebase app instance is the default one.",Bn["RC response not ok"]="RC response is not ok",Bn["invalid attribute name"]="Attribute name {$attributeName} is invalid.",Bn["invalid attribute value"]="Attribute value {$attributeValue} is invalid.",Bn["invalide custom metric name"]="Custom metric name {$customMetricName} is invalid",Bn),zn=new m.c("performance","Performance",Hn),Yn=function(){function t(t){if(this.window=t,!t)throw zn.create("no window");this.performance=t.performance,this.PerformanceObserver=t.PerformanceObserver,this.windowLocation=t.location,this.navigator=t.navigator,this.document=t.document,this.navigator&&this.navigator.cookieEnabled&&(this.localStorage=t.localStorage),t.perfMetrics&&t.perfMetrics.onFirstInputDelay&&(this.onFirstInputDelay=t.perfMetrics.onFirstInputDelay)}return t.prototype.getUrl=function(){return this.windowLocation.href.split("?")[0]},t.prototype.mark=function(t){this.performance&&this.performance.mark&&this.performance.mark(t)},t.prototype.measure=function(t,e,n){this.performance&&this.performance.measure&&this.performance.measure(t,e,n)},t.prototype.getEntriesByType=function(t){return this.performance&&this.performance.getEntriesByType?this.performance.getEntriesByType(t):[]},t.prototype.getEntriesByName=function(t){return this.performance&&this.performance.getEntriesByName?this.performance.getEntriesByName(t):[]},t.prototype.getTimeOrigin=function(){return this.performance&&(this.performance.timeOrigin||this.performance.timing.navigationStart)},t.prototype.requiredApisAvailable=function(){return!!(fetch&&Promise&&this.navigator&&this.navigator.cookieEnabled)},t.prototype.setupObserver=function(t,e){this.PerformanceObserver&&new this.PerformanceObserver((function(t){for(var n=0,r=t.getEntries();n<r.length;n++){var i=r[n];e(i)}})).observe({entryTypes:[t]})},t.getInstance=function(){return void 0===Wn&&(Wn=new t(Kn)),Wn},t}();var Xn,Jn,$n=function(){function t(){this.instrumentationEnabled=!0,this.dataCollectionEnabled=!0,this.loggingEnabled=!1,this.tracesSamplingRate=1,this.networkRequestsSamplingRate=1,this.logEndPointUrl="https://firebaselogging.googleapis.com/v0cc/log?format=json_proto",this.logSource=462,this.logTraceAfterSampling=!1,this.logNetworkAfterSampling=!1,this.configTimeToLive=12}return t.prototype.getAppId=function(){var t=this.firebaseAppInstance&&this.firebaseAppInstance.options&&this.firebaseAppInstance.options.appId;if(!t)throw zn.create("no app id");return t},t.prototype.getProjectId=function(){var t=this.firebaseAppInstance&&this.firebaseAppInstance.options&&this.firebaseAppInstance.options.projectId;if(!t)throw zn.create("no project id");return t},t.prototype.getApiKey=function(){var t=this.firebaseAppInstance&&this.firebaseAppInstance.options&&this.firebaseAppInstance.options.apiKey;if(!t)throw zn.create("no api key");return t},t.getInstance=function(){return void 0===Qn&&(Qn=new t),Qn},t}();
/**
 * @license
 * Copyright 2019 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Zn(){return Xn}!function(t){t[t.UNKNOWN=0]="UNKNOWN",t[t.VISIBLE=1]="VISIBLE",t[t.HIDDEN=2]="HIDDEN"}(Jn||(Jn={}));var tr=["firebase_","google_","ga_"],er=new RegExp("^[a-zA-Z]\\w*$");function nr(){var t=Yn.getInstance().navigator;return"serviceWorker"in t?t.serviceWorker.controller?2:3:1}function rr(){switch(Yn.getInstance().document.visibilityState){case"visible":return Jn.VISIBLE;case"hidden":return Jn.HIDDEN;default:return Jn.UNKNOWN}}function ir(){var t=Yn.getInstance().navigator.connection;switch(t&&t.effectiveType){case"slow-2g":return 1;case"2g":return 2;case"3g":return 3;case"4g":return 4;default:return 0}}
/**
 * @license
 * Copyright 2019 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var or=new Gn.b("Performance");or.logLevel=Gn.a.INFO;
/**
 * @license
 * Copyright 2019 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var ar=!0;function sr(t){var e=function(){var t=Yn.getInstance().localStorage;if(!t)return;var e=t.getItem("@firebase/performance/configexpire");if(!(e&&(n=e,Number(n)>Date.now())))return;var n;var r=t.getItem("@firebase/performance/config");if(!r)return;try{return JSON.parse(r)}catch(t){return}}();return e?(ur(e),Promise.resolve()):function(t){return(e=$n.getInstance().installationsService.getToken(),e.then((function(t){})),e).then((function(e){var n="https://firebaseremoteconfig.googleapis.com/v1/projects/"+$n.getInstance().getProjectId()+"/namespaces/fireperf:fetch?key="+$n.getInstance().getApiKey(),r=new Request(n,{method:"POST",headers:{Authorization:"FIREBASE_INSTALLATIONS_AUTH "+e},body:JSON.stringify({app_instance_id:t,app_instance_id_token:e,app_id:$n.getInstance().getAppId(),app_version:"0.2.29",sdk_version:"0.0.1"})});return fetch(r).then((function(t){if(t.ok)return t.json();throw zn.create("RC response not ok")}))})).catch((function(){or.info("Could not fetch config, will use default configs")}));var e;
/**
 * @license
 * Copyright 2019 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */}(t).then((function(t){return ur(t)})).then((function(t){return function(t){var e=Yn.getInstance().localStorage;if(!t||!e)return;e.setItem("@firebase/performance/config",JSON.stringify(t)),e.setItem("@firebase/performance/configexpire",String(Date.now()+60*$n.getInstance().configTimeToLive*60*1e3))}(t)}),(function(){}))}function ur(t){if(!t)return t;var e=$n.getInstance(),n=t.entries||{};return void 0!==n.fpr_enabled?e.loggingEnabled="true"===String(n.fpr_enabled):e.loggingEnabled=ar,n.fpr_log_source&&(e.logSource=Number(n.fpr_log_source)),n.fpr_log_endpoint_url&&(e.logEndPointUrl=n.fpr_log_endpoint_url),void 0!==n.fpr_vc_network_request_sampling_rate&&(e.networkRequestsSamplingRate=Number(n.fpr_vc_network_request_sampling_rate)),void 0!==n.fpr_vc_trace_sampling_rate&&(e.tracesSamplingRate=Number(n.fpr_vc_trace_sampling_rate)),e.logTraceAfterSampling=cr(e.tracesSamplingRate),e.logNetworkAfterSampling=cr(e.networkRequestsSamplingRate),t}function cr(t){return Math.random()<=t}
/**
 * @license
 * Copyright 2019 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var hr,lr=1;function fr(){return lr=2,hr=hr||function(){var t=Yn.getInstance().document;return new Promise((function(e){if(t&&"complete"!==t.readyState){var n=function(){"complete"===t.readyState&&(t.removeEventListener("readystatechange",n),e())};t.addEventListener("readystatechange",n)}else e()}))}().then((function(){return(t=$n.getInstance().installationsService.getId()).then((function(t){Xn=t})),t;var t})).then((function(t){return sr(t)})).then((function(){return pr()}),(function(){return pr()}))}function pr(){lr=3}
/**
 * @license
 * Copyright 2019 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var dr,mr=3,yr=[];function gr(t){if(!t.eventTime||!t.message)throw zn.create("invalid cc log");yr=Object(i.g)(yr,[t])}function vr(t,e){dr||(dr=function(t){return function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];var r=t.apply(void 0,e);gr({message:r,eventTime:Date.now()})}}
/**
 * @license
 * Copyright 2019 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */(Tr)),dr(t,e)}function br(t){var e=$n.getInstance();!e.instrumentationEnabled&&t.isAuto||(e.dataCollectionEnabled||t.isAuto)&&Yn.getInstance().requiredApisAvailable()&&(t.isAuto&&rr()!==Jn.VISIBLE||e.loggingEnabled&&e.logTraceAfterSampling&&(3===lr?wr(t):fr().then((function(){return wr(t)}),(function(){return wr(t)}))))}function wr(t){Zn()&&setTimeout((function(){return vr(t,1)}),0)}function Tr(t,e){return 0===e?(r={url:(n=t).url,http_method:n.httpMethod||0,http_response_code:200,response_payload_bytes:n.responsePayloadBytes,client_start_time_us:n.startTimeUs,time_to_response_initiated_us:n.timeToResponseInitiatedUs,time_to_response_completed_us:n.timeToResponseCompletedUs},i={application_info:_r(),network_request_metric:r},JSON.stringify(i)):function(t){var e={name:t.name,is_auto:t.isAuto,client_start_time_us:t.startTimeUs,duration_us:t.durationUs};0!==Object.keys(t.counters).length&&(e.counters=Er(t.counters));var n=t.getAttributes();0!==Object.keys(n).length&&(e.custom_attributes=Er(n));var r={application_info:_r(),trace_metric:e};return JSON.stringify(r)}(t);var n,r,i}function _r(){return{google_app_id:$n.getInstance().getAppId(),app_instance_id:Zn(),web_app_info:{sdk_version:"0.2.29",page_url:Yn.getInstance().getUrl(),service_worker_status:nr(),visibility_state:rr(),effective_connection_type:ir()},application_process_state:0}}function Er(t){return Object.keys(t).map((function(e){return{key:e,value:t[e]}}))}
/**
 * @license
 * Copyright 2019 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */!function t(e){setTimeout((function(){if(0!==mr){if(!yr.length)return t(1e4);var e=Object(i.g)(yr);yr=[];var n=e.map((function(t){return{source_extension_json:t.message,event_time_ms:String(t.eventTime)}})),r={request_time_ms:String(Date.now()),client_info:{client_type:1,js_client_info:{}},log_source:$n.getInstance().logSource,log_event:n};fetch($n.getInstance().logEndPointUrl,{method:"POST",body:JSON.stringify(r)}).then((function(t){return t.ok||or.info("Call to Firebase backend failed."),t.json()})).then((function(e){var n=Number(e.next_request_wait_millis),r=isNaN(n)?1e4:Math.max(1e4,n);mr=3,t(r)})).catch((function(){yr=Object(i.g)(e,yr),mr--,or.info("Tries left: "+mr+"."),t(1e4)}))}}),e)}(5500);var Sr=["_fp","_fcp","_fid"];
/**
 * @license
 * Copyright 2019 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var Ir=function(){function t(t,e,n){void 0===e&&(e=!1),this.name=t,this.isAuto=e,this.state=1,this.customAttributes={},this.counters={},this.api=Yn.getInstance(),this.randomId=Math.floor(1e6*Math.random()),this.isAuto||(this.traceStartMark="FB-PERF-TRACE-START-"+this.randomId+"-"+this.name,this.traceStopMark="FB-PERF-TRACE-STOP-"+this.randomId+"-"+this.name,this.traceMeasure=n||"FB-PERF-TRACE-MEASURE-"+this.randomId+"-"+this.name,n&&this.calculateTraceMetrics())}return t.prototype.start=function(){if(1!==this.state)throw zn.create("trace started",{traceName:this.name});this.api.mark(this.traceStartMark),this.state=2},t.prototype.stop=function(){if(2!==this.state)throw zn.create("trace stopped",{traceName:this.name});this.state=3,this.api.mark(this.traceStopMark),this.api.measure(this.traceMeasure,this.traceStartMark,this.traceStopMark),this.calculateTraceMetrics(),br(this)},t.prototype.record=function(t,e,n){if(this.durationUs=Math.floor(1e3*e),this.startTimeUs=Math.floor(1e3*t),n&&n.attributes&&(this.customAttributes=Object(i.a)({},n.attributes)),n&&n.metrics)for(var r=0,o=Object.keys(n.metrics);r<o.length;r++){var a=o[r];isNaN(Number(n.metrics[a]))||(this.counters[a]=Number(Math.floor(n.metrics[a])))}br(this)},t.prototype.incrementMetric=function(t,e){void 0===e&&(e=1),void 0===this.counters[t]&&this.putMetric(t,0),this.counters[t]+=e},t.prototype.putMetric=function(t,e){if(n=t,r=this.name,0===n.length||n.length>100||!(r&&r.startsWith("_wt_")&&Sr.indexOf(n)>-1)&&n.startsWith("_"))throw zn.create("invalide custom metric name",{customMetricName:t});var n,r;this.counters[t]=e},t.prototype.getMetric=function(t){return this.counters[t]||0},t.prototype.putAttribute=function(t,e){var n,r=!(0===(n=t).length||n.length>40||tr.some((function(t){return n.startsWith(t)}))||!n.match(er)),i=function(t){return 0!==t.length&&t.length<=100}(e);if(r&&i)this.customAttributes[t]=e;else{if(!r)throw zn.create("invalid attribute name",{attributeName:t});if(!i)throw zn.create("invalid attribute value",{attributeValue:e})}},t.prototype.getAttribute=function(t){return this.customAttributes[t]},t.prototype.removeAttribute=function(t){void 0!==this.customAttributes[t]&&delete this.customAttributes[t]},t.prototype.getAttributes=function(){return Object(i.a)({},this.customAttributes)},t.prototype.setStartTime=function(t){this.startTimeUs=t},t.prototype.setDuration=function(t){this.durationUs=t},t.prototype.calculateTraceMetrics=function(){var t=this.api.getEntriesByName(this.traceMeasure),e=t&&t[0];e&&(this.durationUs=Math.floor(1e3*e.duration),this.startTimeUs=Math.floor(1e3*(e.startTime+this.api.getTimeOrigin())))},t.createOobTrace=function(e,n,r){var i=Yn.getInstance().getUrl();if(i){var o=new t("_wt_"+i,!0),a=Math.floor(1e3*Yn.getInstance().getTimeOrigin());o.setStartTime(a),e&&e[0]&&(o.setDuration(Math.floor(1e3*e[0].duration)),o.putMetric("domInteractive",Math.floor(1e3*e[0].domInteractive)),o.putMetric("domContentLoadedEventEnd",Math.floor(1e3*e[0].domContentLoadedEventEnd)),o.putMetric("loadEventEnd",Math.floor(1e3*e[0].loadEventEnd)));if(n){var s=n.find((function(t){return"first-paint"===t.name}));s&&s.startTime&&o.putMetric("_fp",Math.floor(1e3*s.startTime));var u=n.find((function(t){return"first-contentful-paint"===t.name}));u&&u.startTime&&o.putMetric("_fcp",Math.floor(1e3*u.startTime)),r&&o.putMetric("_fid",Math.floor(1e3*r))}br(o)}},t.createUserTimingTrace=function(e){br(new t(e,!1,e))},t}();
/**
 * @license
 * Copyright 2019 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Cr(t){var e=t;if(e&&void 0!==e.responseStart){var n=Yn.getInstance().getTimeOrigin(),r=Math.floor(1e3*(e.startTime+n)),i=e.responseStart?Math.floor(1e3*(e.responseStart-e.startTime)):void 0,o=Math.floor(1e3*(e.responseEnd-e.startTime));!function(t){var e=$n.getInstance();e.instrumentationEnabled&&t.url!==e.logEndPointUrl.split("?")[0]&&e.loggingEnabled&&e.logNetworkAfterSampling&&setTimeout((function(){return vr(t,0)}),0)}({url:e.name&&e.name.split("?")[0],responsePayloadBytes:e.transferSize,startTimeUs:r,timeToResponseInitiatedUs:i,timeToResponseCompletedUs:o})}}
/**
 * @license
 * Copyright 2019 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Nr(){Zn()&&(setTimeout((function(){return function(){var t=Yn.getInstance(),e=t.getEntriesByType("navigation"),n=t.getEntriesByType("paint");if(t.onFirstInputDelay){var r=setTimeout((function(){Ir.createOobTrace(e,n),r=void 0}),5e3);t.onFirstInputDelay((function(t){r&&(clearTimeout(r),Ir.createOobTrace(e,n,t))}))}else Ir.createOobTrace(e,n)}()}),0),setTimeout((function(){return function(){for(var t=Yn.getInstance(),e=t.getEntriesByType("resource"),n=0,r=e;n<r.length;n++){Cr(r[n])}t.setupObserver("resource",Cr)}()}),0),setTimeout((function(){return function(){for(var t=Yn.getInstance(),e=t.getEntriesByType("measure"),n=0,r=e;n<r.length;n++){Dr(r[n])}t.setupObserver("measure",Dr)}()}),0))}function Dr(t){var e=t.name;"FB-PERF-TRACE-MEASURE"!==e.substring(0,"FB-PERF-TRACE-MEASURE".length)&&Ir.createUserTimingTrace(e)}
/**
 * @license
 * Copyright 2019 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Ar=function(){function t(t){this.app=t,Yn.getInstance().requiredApisAvailable()?fr().then(Nr,Nr):or.info("Firebase Performance cannot start if browser does not support fetch and Promise or cookie is disabled.")}return t.prototype.trace=function(t){return new Ir(t)},Object.defineProperty(t.prototype,"instrumentationEnabled",{get:function(){return $n.getInstance().instrumentationEnabled},set:function(t){$n.getInstance().instrumentationEnabled=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"dataCollectionEnabled",{get:function(){return $n.getInstance().dataCollectionEnabled},set:function(t){$n.getInstance().dataCollectionEnabled=t},enumerable:!0,configurable:!0}),t}();
/**
 * @license
 * Copyright 2019 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */!function(t){var e=function(t,e){if("[DEFAULT]"!==t.name)throw zn.create("FB not default");if("undefined"==typeof window)throw zn.create("no window");return function(t){Kn=t}
/**
 * @license
 * Copyright 2019 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */(window),$n.getInstance().firebaseAppInstance=t,$n.getInstance().installationsService=e,new Ar(t)};t.INTERNAL.registerComponent(new o.a("performance",(function(t){var n=t.getProvider("app").getImmediate(),r=t.getProvider("installations").getImmediate();return e(n,r)}),"PUBLIC")),t.registerVersion("@firebase/performance","0.2.29")}(r.default);
/**
 * @license
 * Copyright 2019 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var Or,kr,Rr,Pr="https://www.googletagmanager.com/gtag/js";function Mr(t,e,n){var r=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];window[e].push(arguments)};return window[n]&&"function"==typeof window[n]&&(r=window[n]),window[n]=function(t,e){return function(n,r,i){if(n===Or.EVENT){var o=[];if(i&&i.send_to){var a=i.send_to;Array.isArray(a)||(a=[a]);for(var s=0,u=a;s<u.length;s++){var c=u[s],h=e[c];if(!h){o=[];break}o.push(h)}}if(0===o.length)for(var l=0,f=Object.values(e);l<f.length;l++){var p=f[l];o.push(p)}Promise.all(o).then((function(){return t(Or.EVENT,r,i||{})})).catch((function(t){return console.error(t)}))}else if(n===Or.CONFIG){(e[r]||Promise.resolve()).then((function(){t(Or.CONFIG,r,i)})).catch((function(t){return console.error(t)}))}else t(Or.SET,r)}}(r,t),{gtagCore:r,wrappedGtag:window[n]}}!function(t){t.EVENT="event",t.SET="set",t.CONFIG="config"}(Or||(Or={})),function(t){t.ADD_PAYMENT_INFO="add_payment_info",t.ADD_TO_CART="add_to_cart",t.ADD_TO_WISHLIST="add_to_wishlist",t.BEGIN_CHECKOUT="begin_checkout",t.CHECKOUT_PROGRESS="checkout_progress",t.EXCEPTION="exception",t.GENERATE_LEAD="generate_lead",t.LOGIN="login",t.PAGE_VIEW="page_view",t.PURCHASE="purchase",t.REFUND="refund",t.REMOVE_FROM_CART="remove_from_cart",t.SCREEN_VIEW="screen_view",t.SEARCH="search",t.SELECT_CONTENT="select_content",t.SET_CHECKOUT_OPTION="set_checkout_option",t.SHARE="share",t.SIGN_UP="sign_up",t.TIMING_COMPLETE="timing_complete",t.VIEW_ITEM="view_item",t.VIEW_ITEM_LIST="view_item_list",t.VIEW_PROMOTION="view_promotion",t.VIEW_SEARCH_RESULTS="view_search_results"}(kr||(kr={}));var Lr,xr,Fr=((Rr={})["no-ga-id"]='"measurementId" field is empty in Firebase config. Firebase Analytics requires this field to contain a valid measurement ID.',Rr["already-exists"]="A Firebase Analytics instance with the measurement ID ${id}  already exists. Only one Firebase Analytics instance can be created for each measurement ID.",Rr["already-initialized"]="Firebase Analytics has already been initialized.settings() must be called before initializing any Analytics instanceor it will have no effect.",Rr["interop-component-reg-failed"]="Firebase Analytics Interop Component failed to instantiate",Rr),jr=new m.c("analytics","Analytics",Fr),Ur={},qr="dataLayer",Vr="gtag",Br=!1;function Wr(t){if(Br)throw jr.create("already-initialized");t.dataLayerName&&(qr=t.dataLayerName),t.gtagName&&(Vr=t.gtagName)}function Kr(t,e){var n=t.options.measurementId;if(!n)throw jr.create("no-ga-id");if(null!=Ur[n])throw jr.create("already-exists",{id:n});if(!Br){(function(){for(var t=window.document.getElementsByTagName("script"),e=0,n=Object.values(t);e<n.length;e++){var r=n[e];if(r.src&&r.src.includes(Pr))return r}return null}
/**
 * @license
 * Copyright 2019 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */)()||function(t){var e=document.createElement("script");e.src=Pr+"?l="+t,e.async=!0,document.head.appendChild(e)}(qr),function(t){var e=[];Array.isArray(window[t])?e=window[t]:window[t]=e}(qr);var r=Mr(Ur,qr,Vr),o=r.wrappedGtag,a=r.gtagCore;xr=o,Lr=a,Br=!0}return Ur[n]=
/**
 * @license
 * Copyright 2019 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function(t,e,n){return Object(i.b)(this,void 0,void 0,(function(){var r,o;return Object(i.d)(this,(function(i){switch(i.label){case 0:return[4,e.getId()];case 1:return r=i.sent(),n("js",new Date),n(Or.CONFIG,t.options.measurementId,((o={}).firebase_id=r,o.origin="firebase",o.update=!0,o)),[2]}}))}))}(t,e,Lr),{app:t,logEvent:function(t,e,r){
/**
 * @license
 * Copyright 2019 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
return function(t,e,n,r,o){var a=r||{};o&&o.global||(a=Object(i.a)(Object(i.a)({},r),{send_to:e})),t(Or.EVENT,n,a||{})}(xr,n,t,e,r)},setCurrentScreen:function(t,e){return function(t,e,n,r){r&&r.global?t(Or.SET,{screen_name:n}):t(Or.CONFIG,e,{update:!0,screen_name:n})}(xr,n,t,e)},setUserId:function(t,e){return function(t,e,n,r){r&&r.global?t(Or.SET,{user_id:n}):t(Or.CONFIG,e,{update:!0,user_id:n})}(xr,n,t,e)},setUserProperties:function(t,e){return function(t,e,n,r){if(r&&r.global){for(var i={},o=0,a=Object.keys(n);o<a.length;o++){var s=a[o];i["user_properties."+s]=n[s]}t(Or.SET,i)}else t(Or.CONFIG,e,{update:!0,user_properties:n})}(xr,n,t,e)},setAnalyticsCollectionEnabled:function(t){return function(t,e){window["ga-disable-"+t]=!e}(n,t)}}}!function(t){t.INTERNAL.registerComponent(new o.a("analytics",(function(t){return Kr(t.getProvider("app").getImmediate(),t.getProvider("installations").getImmediate())}),"PUBLIC").setServiceProps({settings:Wr,EventName:kr})),t.INTERNAL.registerComponent(new o.a("analytics-internal",(function(t){try{return{logEvent:t.getProvider("analytics").getImmediate().logEvent}}catch(t){throw jr.create("interop-component-reg-failed",{reason:t})}}),"PRIVATE")),t.registerVersion("@firebase/analytics","0.2.10")}(r.default);
/**
 * @license
 * Copyright 2019 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var Qr,Gr=function(){function t(t,e,n,r){this.client=t,this.storage=e,this.storageCache=n,this.logger=r}return t.prototype.isCachedDataFresh=function(t,e){if(!e)return this.logger.debug("Config fetch cache check. Cache unpopulated."),!1;var n=Date.now()-e,r=n<=t;return this.logger.debug("Config fetch cache check. Cache age millis: "+n+". Cache max age millis (minimumFetchIntervalMillis setting): "+t+". Is cache hit: "+r+"."),r},t.prototype.fetch=function(t){return Object(i.b)(this,void 0,void 0,(function(){var e,n,r,o,a;return Object(i.d)(this,(function(i){switch(i.label){case 0:return[4,Promise.all([this.storage.getLastSuccessfulFetchTimestampMillis(),this.storage.getLastSuccessfulFetchResponse()])];case 1:return e=i.sent(),n=e[0],(r=e[1])&&this.isCachedDataFresh(t.cacheMaxAgeMillis,n)?[2,r]:(t.eTag=r&&r.eTag,[4,this.client.fetch(t)]);case 2:return o=i.sent(),a=[this.storageCache.setLastSuccessfulFetchTimestampMillis(Date.now())],200===o.status&&a.push(this.storage.setLastSuccessfulFetchResponse(o)),[4,Promise.all(a)];case 3:return i.sent(),[2,o]}}))}))},t}(),Hr=((Qr={})["registration-window"]="Undefined window object. This SDK only supports usage in a browser environment.",Qr["registration-project-id"]="Undefined project identifier. Check Firebase app initialization.",Qr["registration-api-key"]="Undefined API key. Check Firebase app initialization.",Qr["registration-app-id"]="Undefined app identifier. Check Firebase app initialization.",Qr["storage-open"]="Error thrown when opening storage. Original error: {$originalErrorMessage}.",Qr["storage-get"]="Error thrown when reading from storage. Original error: {$originalErrorMessage}.",Qr["storage-set"]="Error thrown when writing to storage. Original error: {$originalErrorMessage}.",Qr["storage-delete"]="Error thrown when deleting from storage. Original error: {$originalErrorMessage}.",Qr["fetch-client-network"]="Fetch client failed to connect to a network. Check Internet connection. Original error: {$originalErrorMessage}.",Qr["fetch-timeout"]='The config fetch request timed out.  Configure timeout using "fetchTimeoutMillis" SDK setting.',Qr["fetch-throttle"]='The config fetch request timed out while in an exponential backoff state. Configure timeout using "fetchTimeoutMillis" SDK setting. Unix timestamp in milliseconds when fetch request throttling ends: {$throttleEndTimeMillis}.',Qr["fetch-client-parse"]="Fetch client could not parse response. Original error: {$originalErrorMessage}.",Qr["fetch-status"]="Fetch server returned an HTTP error status. HTTP status: {$httpStatus}.",Qr),zr=new m.c("remoteconfig","Remote Config",Hr);
/**
 * @license
 * Copyright 2019 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
/**
 * @license
 * Copyright 2019 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var Yr=function(){function t(t,e,n,r,i,o){this.firebaseInstallations=t,this.sdkVersion=e,this.namespace=n,this.projectId=r,this.apiKey=i,this.appId=o}return t.prototype.fetch=function(t){return Object(i.b)(this,void 0,void 0,(function(){var e,n,r,o,a,s,u,c,h,l,f,p,d,m,y,g,v,b,w;return Object(i.d)(this,(function(i){switch(i.label){case 0:return[4,Promise.all([this.firebaseInstallations.getId(),this.firebaseInstallations.getToken()])];case 1:e=i.sent(),n=e[0],r=e[1],o=window.FIREBASE_REMOTE_CONFIG_URL_BASE||"https://firebaseremoteconfig.googleapis.com",a=o+"/v1/projects/"+this.projectId+"/namespaces/"+this.namespace+":fetch?key="+this.apiKey,s={"Content-Type":"application/json","Content-Encoding":"gzip","If-None-Match":t.eTag||"*"},u={sdk_version:this.sdkVersion,app_instance_id:n,app_instance_id_token:r,app_id:this.appId,language_code:(void 0===T&&(T=navigator),T.languages&&T.languages[0]||T.language)},c={method:"POST",headers:s,body:JSON.stringify(u)},h=fetch(a,c),l=new Promise((function(e,n){t.signal.addEventListener((function(){var t=new Error("The operation was aborted.");t.name="AbortError",n(t)}))})),i.label=2;case 2:return i.trys.push([2,5,,6]),[4,Promise.race([h,l])];case 3:return i.sent(),[4,h];case 4:return f=i.sent(),[3,6];case 5:throw p=i.sent(),d="fetch-client-network","AbortError"===p.name&&(d="fetch-timeout"),zr.create(d,{originalErrorMessage:p.message});case 6:if(m=f.status,y=f.headers.get("ETag")||void 0,200!==f.status)return[3,11];b=void 0,i.label=7;case 7:return i.trys.push([7,9,,10]),[4,f.json()];case 8:return b=i.sent(),[3,10];case 9:throw w=i.sent(),zr.create("fetch-client-parse",{originalErrorMessage:w.message});case 10:g=b.entries,v=b.state,i.label=11;case 11:if("INSTANCE_STATE_UNSPECIFIED"===v?m=500:"NO_CHANGE"===v?m=304:"NO_TEMPLATE"!==v&&"EMPTY_CONFIG"!==v||(g={}),304!==m&&200!==m)throw zr.create("fetch-status",{httpStatus:m});return[2,{status:m,eTag:y,config:g}]}
/**
 * @license
 * Copyright 2019 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var T}))}))},t}(),Xr=function(){function t(){this.listeners=[]}return t.prototype.addEventListener=function(t){this.listeners.push(t)},t.prototype.abort=function(){this.listeners.forEach((function(t){return t()}))},t}(),Jr=["1","true","t","yes","y","on"],$r=function(){function t(t,e){void 0===e&&(e=""),this._source=t,this._value=e}return t.prototype.asString=function(){return this._value},t.prototype.asBoolean=function(){return"static"!==this._source&&Jr.indexOf(this._value.toLowerCase())>=0},t.prototype.asNumber=function(){if("static"===this._source)return 0;var t=Number(this._value);return isNaN(t)&&(t=0),t},t.prototype.getSource=function(){return this._source},t}(),Zr=function(){function t(t,e,n,r,i){this.app=t,this._client=e,this._storageCache=n,this._storage=r,this._logger=i,this._isInitializationComplete=!1,this.settings={fetchTimeoutMillis:6e4,minimumFetchIntervalMillis:432e5},this.defaultConfig={}}return t.prototype.setLogLevel=function(t){switch(t){case"debug":this._logger.logLevel=Gn.a.DEBUG;break;case"silent":this._logger.logLevel=Gn.a.SILENT;break;default:this._logger.logLevel=Gn.a.ERROR}},Object.defineProperty(t.prototype,"fetchTimeMillis",{get:function(){return this._storageCache.getLastSuccessfulFetchTimestampMillis()||-1},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"lastFetchStatus",{get:function(){return this._storageCache.getLastFetchStatus()||"no-fetch-yet"},enumerable:!0,configurable:!0}),t.prototype.activate=function(){return Object(i.b)(this,void 0,void 0,(function(){var t,e,n;return Object(i.d)(this,(function(r){switch(r.label){case 0:return[4,Promise.all([this._storage.getLastSuccessfulFetchResponse(),this._storage.getActiveConfigEtag()])];case 1:return t=r.sent(),e=t[0],n=t[1],e&&e.config&&e.eTag&&e.eTag!==n?[4,Promise.all([this._storageCache.setActiveConfig(e.config),this._storage.setActiveConfigEtag(e.eTag)])]:[2,!1];case 2:return r.sent(),[2,!0]}}))}))},t.prototype.ensureInitialized=function(){var t=this;return this._initializePromise||(this._initializePromise=this._storageCache.loadFromStorage().then((function(){t._isInitializationComplete=!0}))),this._initializePromise},t.prototype.fetch=function(){return Object(i.b)(this,void 0,void 0,(function(){var t,e,n,r=this;return Object(i.d)(this,(function(o){switch(o.label){case 0:t=new Xr,setTimeout((function(){return Object(i.b)(r,void 0,void 0,(function(){return Object(i.d)(this,(function(e){return t.abort(),[2]}))}))}),this.settings.fetchTimeoutMillis),o.label=1;case 1:return o.trys.push([1,4,,6]),[4,this._client.fetch({cacheMaxAgeMillis:this.settings.minimumFetchIntervalMillis,signal:t})];case 2:return o.sent(),[4,this._storageCache.setLastFetchStatus("success")];case 3:return o.sent(),[3,6];case 4:return e=o.sent(),s="fetch-throttle",n=(a=e)instanceof m.d&&-1!==a.code.indexOf(s)?"throttle":"failure",[4,this._storageCache.setLastFetchStatus(n)];case 5:throw o.sent(),e;case 6:return[2]}var a,s}))}))},t.prototype.fetchAndActivate=function(){return Object(i.b)(this,void 0,void 0,(function(){return Object(i.d)(this,(function(t){switch(t.label){case 0:return[4,this.fetch()];case 1:return t.sent(),[2,this.activate()]}}))}))},t.prototype.getAll=function(){var t=this;return function(t,e){void 0===t&&(t={});void 0===e&&(e={});return Object.keys(Object(i.a)(Object(i.a)({},t),e))}
/**
 * @license
 * Copyright 2019 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */(this._storageCache.getActiveConfig(),this.defaultConfig).reduce((function(e,n){return e[n]=t.getValue(n),e}),{})},t.prototype.getBoolean=function(t){return this.getValue(t).asBoolean()},t.prototype.getNumber=function(t){return this.getValue(t).asNumber()},t.prototype.getString=function(t){return this.getValue(t).asString()},t.prototype.getValue=function(t){this._isInitializationComplete||this._logger.debug('A value was requested for key "'+t+'" before SDK initialization completed. Await on ensureInitialized if the intent was to get a previously activated value.');var e=this._storageCache.getActiveConfig();return e&&void 0!==e[t]?new $r("remote",e[t]):this.defaultConfig&&void 0!==this.defaultConfig[t]?new $r("default",String(this.defaultConfig[t])):(this._logger.debug('Returning static value for key "'+t+'". Define a default or remote value if this is unintentional.'),new $r("static"))},t}();
/**
 * @license
 * Copyright 2019 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ti(t,e){var n=t.target.error||void 0;return zr.create(e,{originalErrorMessage:n&&n.message})}var ei=function(){function t(t,e,n,r){void 0===r&&(r=new Promise((function(t,e){var n=indexedDB.open("firebase_remote_config",1);n.onerror=function(t){e(ti(t,"storage-open"))},n.onsuccess=function(e){t(e.target.result)},n.onupgradeneeded=function(t){var e=t.target.result;switch(t.oldVersion){case 0:e.createObjectStore("app_namespace_store",{keyPath:"compositeKey"})}}}))),this.appId=t,this.appName=e,this.namespace=n,this.openDbPromise=r}return t.prototype.getLastFetchStatus=function(){return this.get("last_fetch_status")},t.prototype.setLastFetchStatus=function(t){return this.set("last_fetch_status",t)},t.prototype.getLastSuccessfulFetchTimestampMillis=function(){return this.get("last_successful_fetch_timestamp_millis")},t.prototype.setLastSuccessfulFetchTimestampMillis=function(t){return this.set("last_successful_fetch_timestamp_millis",t)},t.prototype.getLastSuccessfulFetchResponse=function(){return this.get("last_successful_fetch_response")},t.prototype.setLastSuccessfulFetchResponse=function(t){return this.set("last_successful_fetch_response",t)},t.prototype.getActiveConfig=function(){return this.get("active_config")},t.prototype.setActiveConfig=function(t){return this.set("active_config",t)},t.prototype.getActiveConfigEtag=function(){return this.get("active_config_etag")},t.prototype.setActiveConfigEtag=function(t){return this.set("active_config_etag",t)},t.prototype.getThrottleMetadata=function(){return this.get("throttle_metadata")},t.prototype.setThrottleMetadata=function(t){return this.set("throttle_metadata",t)},t.prototype.deleteThrottleMetadata=function(){return this.delete("throttle_metadata")},t.prototype.get=function(t){return Object(i.b)(this,void 0,void 0,(function(){var e,n=this;return Object(i.d)(this,(function(r){switch(r.label){case 0:return[4,this.openDbPromise];case 1:return e=r.sent(),[2,new Promise((function(r,i){var o=e.transaction(["app_namespace_store"],"readonly").objectStore("app_namespace_store"),a=n.createCompositeKey(t);try{var s=o.get(a);s.onerror=function(t){i(ti(t,"storage-get"))},s.onsuccess=function(t){var e=t.target.result;r(e?e.value:void 0)}}catch(t){i(zr.create("storage-get",{originalErrorMessage:t&&t.message}))}}))]}}))}))},t.prototype.set=function(t,e){return Object(i.b)(this,void 0,void 0,(function(){var n,r=this;return Object(i.d)(this,(function(i){switch(i.label){case 0:return[4,this.openDbPromise];case 1:return n=i.sent(),[2,new Promise((function(i,o){var a=n.transaction(["app_namespace_store"],"readwrite").objectStore("app_namespace_store"),s=r.createCompositeKey(t);try{var u=a.put({compositeKey:s,value:e});u.onerror=function(t){o(ti(t,"storage-set"))},u.onsuccess=function(){i()}}catch(t){o(zr.create("storage-set",{originalErrorMessage:t&&t.message}))}}))]}}))}))},t.prototype.delete=function(t){return Object(i.b)(this,void 0,void 0,(function(){var e,n=this;return Object(i.d)(this,(function(r){switch(r.label){case 0:return[4,this.openDbPromise];case 1:return e=r.sent(),[2,new Promise((function(r,i){var o=e.transaction(["app_namespace_store"],"readwrite").objectStore("app_namespace_store"),a=n.createCompositeKey(t);try{var s=o.delete(a);s.onerror=function(t){i(ti(t,"storage-delete"))},s.onsuccess=function(){r()}}catch(t){i(zr.create("storage-delete",{originalErrorMessage:t&&t.message}))}}))]}}))}))},t.prototype.createCompositeKey=function(t){return[this.appId,this.appName,this.namespace,t].join()},t}(),ni=function(){function t(t){this.storage=t}return t.prototype.getLastFetchStatus=function(){return this.lastFetchStatus},t.prototype.getLastSuccessfulFetchTimestampMillis=function(){return this.lastSuccessfulFetchTimestampMillis},t.prototype.getActiveConfig=function(){return this.activeConfig},t.prototype.loadFromStorage=function(){return Object(i.b)(this,void 0,void 0,(function(){var t,e,n,r,o,a;return Object(i.d)(this,(function(i){switch(i.label){case 0:return t=this.storage.getLastFetchStatus(),e=this.storage.getLastSuccessfulFetchTimestampMillis(),n=this.storage.getActiveConfig(),[4,t];case 1:return(r=i.sent())&&(this.lastFetchStatus=r),[4,e];case 2:return(o=i.sent())&&(this.lastSuccessfulFetchTimestampMillis=o),[4,n];case 3:return(a=i.sent())&&(this.activeConfig=a),[2]}}))}))},t.prototype.setLastFetchStatus=function(t){return this.lastFetchStatus=t,this.storage.setLastFetchStatus(t)},t.prototype.setLastSuccessfulFetchTimestampMillis=function(t){return this.lastSuccessfulFetchTimestampMillis=t,this.storage.setLastSuccessfulFetchTimestampMillis(t)},t.prototype.setActiveConfig=function(t){return this.activeConfig=t,this.storage.setActiveConfig(t)},t}();
/**
 * @license
 * Copyright 2019 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ri(t){var e=1e3*Math.pow(2,t),n=Math.round(.5*e*(Math.random()-.5)*2);return Math.min(144e5,e+n)}
/**
 * @license
 * Copyright 2019 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ii(t,e){return new Promise((function(n,r){var i=Math.max(e-Date.now(),0),o=setTimeout(n,i);t.addEventListener((function(){clearTimeout(o),r(zr.create("fetch-throttle",{throttleEndTimeMillis:e}))}))}))}var oi,ai=function(){function t(t,e){this.client=t,this.storage=e}return t.prototype.fetch=function(t){return Object(i.b)(this,void 0,void 0,(function(){var e;return Object(i.d)(this,(function(n){switch(n.label){case 0:return[4,this.storage.getThrottleMetadata()];case 1:return e=n.sent()||{backoffCount:0,throttleEndTimeMillis:Date.now()},[2,this.attemptFetch(t,e)]}}))}))},t.prototype.attemptFetch=function(t,e){var n=e.throttleEndTimeMillis,r=e.backoffCount;return Object(i.b)(this,void 0,void 0,(function(){var e,o,a;return Object(i.d)(this,(function(i){switch(i.label){case 0:return[4,ii(t.signal,n)];case 1:i.sent(),i.label=2;case 2:return i.trys.push([2,5,,7]),[4,this.client.fetch(t)];case 3:return e=i.sent(),[4,this.storage.deleteThrottleMetadata()];case 4:return i.sent(),[2,e];case 5:if(!function(t){if(!(t instanceof m.d))return!1;var e=Number(t.httpStatus);return 429===e||500===e||503===e||504===e}(o=i.sent()))throw o;return a={throttleEndTimeMillis:Date.now()+ri(r),backoffCount:r+1},[4,this.storage.setThrottleMetadata(a)];case 6:return i.sent(),[2,this.attemptFetch(t,a)];case 7:return[2]}}))}))},t}();(oi=r.default).INTERNAL.registerComponent(new o.a("remoteConfig",(function(t,e){var n=t.getProvider("app").getImmediate(),r=t.getProvider("installations").getImmediate();if("undefined"==typeof window)throw zr.create("registration-window");var i=n.options,o=i.projectId,a=i.apiKey,s=i.appId;if(!o)throw zr.create("registration-project-id");if(!a)throw zr.create("registration-api-key");if(!s)throw zr.create("registration-app-id");e=e||"firebase";var u=new ei(s,n.name,e),c=new ni(u),h=new Gn.b("@firebase/remote-config");h.logLevel=Gn.a.ERROR;var l=new Yr(r,oi.SDK_VERSION,e,o,a,s),f=new ai(l,u),p=new Gr(f,u,c,h),d=new Zr(n,p,c,u,h);return d.ensureInitialized(),d}),"PUBLIC").setMultipleInstances(!0)),oi.registerVersion("@firebase/remote-config","0.1.10");
/**
 * @license
 * Copyright 2018 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
r.default.registerVersion("firebase","7.6.2","app");
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
console.warn("\nIt looks like you're using the development build of the Firebase JS SDK.\nWhen deploying Firebase apps to production, it is advisable to only import\nthe individual SDK components you intend to use.\n\nFor the module builds, these are available in the following manner\n(replace <PACKAGE> with the name of a component - i.e. auth, database, etc):\n\nCommonJS Modules:\nconst firebase = require('firebase/app');\nrequire('firebase/<PACKAGE>');\n\nES Modules:\nimport firebase from 'firebase/app';\nimport 'firebase/<PACKAGE>';\n\nTypescript:\nimport * as firebase from 'firebase/app';\nimport 'firebase/<PACKAGE>';\n"),r.default.registerVersion("firebase","7.6.2");e.a=r.default},function(t,e,n){"use strict";(function(t){var e=n(11);(function(){var n,r="function"==typeof Object.defineProperties?Object.defineProperty:function(t,e,n){t!=Array.prototype&&t!=Object.prototype&&(t[e]=n.value)},i="undefined"!=typeof window&&window===this?this:void 0!==t&&null!=t?t:this;function o(t){var e=0;return function(){return e<t.length?{done:!1,value:t[e++]}:{done:!0}}}function a(t){var e="undefined"!=typeof Symbol&&Symbol.iterator&&t[Symbol.iterator];return e?e.call(t):{next:o(t)}}!function(t,e){if(e){var n=i;t=t.split(".");for(var o=0;o<t.length-1;o++){var a=t[o];a in n||(n[a]={}),n=n[a]}(e=e(o=n[t=t[t.length-1]]))!=o&&null!=e&&r(n,t,{configurable:!0,writable:!0,value:e})}}("Promise",(function(t){function e(t){this.b=0,this.c=void 0,this.a=[];var e=this.f();try{t(e.resolve,e.reject)}catch(t){e.reject(t)}}function n(){this.a=null}function r(t){return t instanceof e?t:new e((function(e){e(t)}))}if(t)return t;n.prototype.b=function(t){if(null==this.a){this.a=[];var e=this;this.c((function(){e.g()}))}this.a.push(t)};var o=i.setTimeout;n.prototype.c=function(t){o(t,0)},n.prototype.g=function(){for(;this.a&&this.a.length;){var t=this.a;this.a=[];for(var e=0;e<t.length;++e){var n=t[e];t[e]=null;try{n()}catch(t){this.f(t)}}}this.a=null},n.prototype.f=function(t){this.c((function(){throw t}))},e.prototype.f=function(){function t(t){return function(r){n||(n=!0,t.call(e,r))}}var e=this,n=!1;return{resolve:t(this.m),reject:t(this.g)}},e.prototype.m=function(t){if(t===this)this.g(new TypeError("A Promise cannot resolve to itself"));else if(t instanceof e)this.o(t);else{t:switch(typeof t){case"object":var n=null!=t;break t;case"function":n=!0;break t;default:n=!1}n?this.u(t):this.h(t)}},e.prototype.u=function(t){var e=void 0;try{e=t.then}catch(t){return void this.g(t)}"function"==typeof e?this.v(e,t):this.h(t)},e.prototype.g=function(t){this.i(2,t)},e.prototype.h=function(t){this.i(1,t)},e.prototype.i=function(t,e){if(0!=this.b)throw Error("Cannot settle("+t+", "+e+"): Promise already settled in state"+this.b);this.b=t,this.c=e,this.l()},e.prototype.l=function(){if(null!=this.a){for(var t=0;t<this.a.length;++t)s.b(this.a[t]);this.a=null}};var s=new n;return e.prototype.o=function(t){var e=this.f();t.La(e.resolve,e.reject)},e.prototype.v=function(t,e){var n=this.f();try{t.call(e,n.resolve,n.reject)}catch(t){n.reject(t)}},e.prototype.then=function(t,n){function r(t,e){return"function"==typeof t?function(e){try{i(t(e))}catch(t){o(t)}}:e}var i,o,a=new e((function(t,e){i=t,o=e}));return this.La(r(t,i),r(n,o)),a},e.prototype.catch=function(t){return this.then(void 0,t)},e.prototype.La=function(t,e){function n(){switch(r.b){case 1:t(r.c);break;case 2:e(r.c);break;default:throw Error("Unexpected state: "+r.b)}}var r=this;null==this.a?s.b(n):this.a.push(n)},e.resolve=r,e.reject=function(t){return new e((function(e,n){n(t)}))},e.race=function(t){return new e((function(e,n){for(var i=a(t),o=i.next();!o.done;o=i.next())r(o.value).La(e,n)}))},e.all=function(t){var n=a(t),i=n.next();return i.done?r([]):new e((function(t,e){function o(e){return function(n){a[e]=n,0==--s&&t(a)}}var a=[],s=0;do{a.push(void 0),s++,r(i.value).La(o(a.length-1),e),i=n.next()}while(!i.done)}))},e}));var s=s||{},u=this||self;function c(t){return"string"==typeof t}function h(t){return"boolean"==typeof t}var l=/^[\w+/_-]+[=]{0,2}$/,f=null;function p(){}function d(t){var e=typeof t;if("object"==e){if(!t)return"null";if(t instanceof Array)return"array";if(t instanceof Object)return e;var n=Object.prototype.toString.call(t);if("[object Window]"==n)return"object";if("[object Array]"==n||"number"==typeof t.length&&void 0!==t.splice&&void 0!==t.propertyIsEnumerable&&!t.propertyIsEnumerable("splice"))return"array";if("[object Function]"==n||void 0!==t.call&&void 0!==t.propertyIsEnumerable&&!t.propertyIsEnumerable("call"))return"function"}else if("function"==e&&void 0===t.call)return"object";return e}function m(t){return null===t}function y(t){return"array"==d(t)}function g(t){var e=d(t);return"array"==e||"object"==e&&"number"==typeof t.length}function v(t){return"function"==d(t)}function b(t){var e=typeof t;return"object"==e&&null!=t||"function"==e}var w="closure_uid_"+(1e9*Math.random()>>>0),T=0;function _(t,e,n){return t.call.apply(t.bind,arguments)}function E(t,e,n){if(!t)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var n=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(n,r),t.apply(e,n)}}return function(){return t.apply(e,arguments)}}function S(t,e,n){return(S=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?_:E).apply(null,arguments)}function I(t,e){var n=Array.prototype.slice.call(arguments,1);return function(){var e=n.slice();return e.push.apply(e,arguments),t.apply(this,e)}}var C=Date.now||function(){return+new Date};function N(t,e){function n(){}n.prototype=e.prototype,t.qb=e.prototype,t.prototype=new n,t.prototype.constructor=t,t.gd=function(t,n,r){for(var i=Array(arguments.length-2),o=2;o<arguments.length;o++)i[o-2]=arguments[o];return e.prototype[n].apply(t,i)}}function D(t){if(!t)return!1;try{return!!t.$goog_Thenable}catch(t){return!1}}function A(t){if(Error.captureStackTrace)Error.captureStackTrace(this,A);else{var e=Error().stack;e&&(this.stack=e)}t&&(this.message=String(t))}function O(t,e){for(var n="",r=(t=t.split("%s")).length-1,i=0;i<r;i++)n+=t[i]+(i<e.length?e[i]:"%s");A.call(this,n+t[r])}function k(t,e){throw new O("Failure"+(t?": "+t:""),Array.prototype.slice.call(arguments,1))}function R(t,e){this.c=t,this.f=e,this.b=0,this.a=null}function P(t,e){t.f(e),100>t.b&&(t.b++,e.next=t.a,t.a=e)}function M(){this.b=this.a=null}N(A,Error),A.prototype.name="CustomError",N(O,A),O.prototype.name="AssertionError",R.prototype.get=function(){if(0<this.b){this.b--;var t=this.a;this.a=t.next,t.next=null}else t=this.c();return t};var L=new R((function(){return new F}),(function(t){t.reset()}));function x(){var t=Kt,e=null;return t.a&&(e=t.a,t.a=t.a.next,t.a||(t.b=null),e.next=null),e}function F(){this.next=this.b=this.a=null}function j(t,e){t:{try{var n=t&&t.ownerDocument,r=n&&(n.defaultView||n.parentWindow);if((r=r||u).Element&&r.Location){var i=r;break t}}catch(t){}i=null}if(i&&void 0!==i[e]&&(!t||!(t instanceof i[e])&&(t instanceof i.Location||t instanceof i.Element))){if(b(t))try{var o=t.constructor.displayName||t.constructor.name||Object.prototype.toString.call(t)}catch(t){o="<object could not be stringified>"}else o=void 0===t?"undefined":null===t?"null":typeof t;k("Argument is not a %s (or a non-Element, non-Location mock); got: %s",e,o)}}M.prototype.add=function(t,e){var n=L.get();n.set(t,e),this.b?this.b.next=n:this.a=n,this.b=n},F.prototype.set=function(t,e){this.a=t,this.b=e,this.next=null},F.prototype.reset=function(){this.next=this.b=this.a=null};var U=Array.prototype.indexOf?function(t,e){return Array.prototype.indexOf.call(t,e,void 0)}:function(t,e){if(c(t))return c(e)&&1==e.length?t.indexOf(e,0):-1;for(var n=0;n<t.length;n++)if(n in t&&t[n]===e)return n;return-1},q=Array.prototype.forEach?function(t,e,n){Array.prototype.forEach.call(t,e,n)}:function(t,e,n){for(var r=t.length,i=c(t)?t.split(""):t,o=0;o<r;o++)o in i&&e.call(n,i[o],o,t)};var V=Array.prototype.map?function(t,e){return Array.prototype.map.call(t,e,void 0)}:function(t,e){for(var n=t.length,r=Array(n),i=c(t)?t.split(""):t,o=0;o<n;o++)o in i&&(r[o]=e.call(void 0,i[o],o,t));return r},B=Array.prototype.some?function(t,e){return Array.prototype.some.call(t,e,void 0)}:function(t,e){for(var n=t.length,r=c(t)?t.split(""):t,i=0;i<n;i++)if(i in r&&e.call(void 0,r[i],i,t))return!0;return!1};function W(t,e){return 0<=U(t,e)}function K(t,e){var n;return(n=0<=(e=U(t,e)))&&Array.prototype.splice.call(t,e,1),n}function Q(t,e){!function(t,e){for(var n=c(t)?t.split(""):t,r=t.length-1;0<=r;--r)r in n&&e.call(void 0,n[r],r,t)}(t,(function(n,r){e.call(void 0,n,r,t)&&1==Array.prototype.splice.call(t,r,1).length&&0}))}function G(t){return Array.prototype.concat.apply([],arguments)}function H(t){var e=t.length;if(0<e){for(var n=Array(e),r=0;r<e;r++)n[r]=t[r];return n}return[]}function z(t,e){for(var n in t)e.call(void 0,t[n],n,t)}function Y(t){for(var e in t)return!1;return!0}function X(t){var e,n={};for(e in t)n[e]=t[e];return n}var J="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function $(t,e){for(var n,r,i=1;i<arguments.length;i++){for(n in r=arguments[i])t[n]=r[n];for(var o=0;o<J.length;o++)n=J[o],Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}}function Z(t,e){this.a=t===nt&&e||"",this.b=et}function tt(t){return t instanceof Z&&t.constructor===Z&&t.b===et?t.a:(k("expected object of type Const, got '"+t+"'"),"type_error:Const")}Z.prototype.qa=!0,Z.prototype.pa=function(){return this.a},Z.prototype.toString=function(){return"Const{"+this.a+"}"};var et={},nt={},rt=new Z(nt,"");function it(){this.a="",this.b=ct}function ot(t){return t instanceof it&&t.constructor===it&&t.b===ct?t.a:(k("expected object of type TrustedResourceUrl, got '"+t+"' of type "+d(t)),"type_error:TrustedResourceUrl")}function at(t,e){var n=tt(t);if(!ut.test(n))throw Error("Invalid TrustedResourceUrl format: "+n);return ht(t=n.replace(st,(function(t,r){if(!Object.prototype.hasOwnProperty.call(e,r))throw Error('Found marker, "'+r+'", in format string, "'+n+'", but no valid label mapping found in args: '+JSON.stringify(e));return(t=e[r])instanceof Z?tt(t):encodeURIComponent(String(t))})))}it.prototype.qa=!0,it.prototype.pa=function(){return this.a.toString()},it.prototype.toString=function(){return"TrustedResourceUrl{"+this.a+"}"};var st=/%{(\w+)}/g,ut=/^((https:)?\/\/[0-9a-z.:[\]-]+\/|\/[^/\\]|[^:/\\%]+\/|[^:/\\%]*[?#]|about:blank#)/i,ct={};function ht(t){var e=new it;return e.a=t,e}var lt=String.prototype.trim?function(t){return t.trim()}:function(t){return/^[\s\xa0]*([\s\S]*?)[\s\xa0]*$/.exec(t)[1]},ft=/&/g,pt=/</g,dt=/>/g,mt=/"/g,yt=/'/g,gt=/\x00/g,vt=/[\x00&<>"']/;function bt(t,e){return-1!=t.indexOf(e)}function wt(t,e){return t<e?-1:t>e?1:0}function Tt(){this.a="",this.b=Ct}function _t(t){return t instanceof Tt&&t.constructor===Tt&&t.b===Ct?t.a:(k("expected object of type SafeUrl, got '"+t+"' of type "+d(t)),"type_error:SafeUrl")}Tt.prototype.qa=!0,Tt.prototype.pa=function(){return this.a.toString()},Tt.prototype.toString=function(){return"SafeUrl{"+this.a+"}"};var Et=/^(?:(?:https?|mailto|ftp):|[^:/?#]*(?:[/?#]|$))/i;function St(t){return t instanceof Tt?t:(t="object"==typeof t&&t.qa?t.pa():String(t),Et.test(t)||(t="about:invalid#zClosurez"),Nt(t))}var It,Ct={};function Nt(t){var e=new Tt;return e.a=t,e}Nt("about:blank");t:{var Dt=u.navigator;if(Dt){var At=Dt.userAgent;if(At){It=At;break t}}It=""}function Ot(t){return bt(It,t)}function kt(){this.a="",this.b=Pt}function Rt(t){return t instanceof kt&&t.constructor===kt&&t.b===Pt?t.a:(k("expected object of type SafeHtml, got '"+t+"' of type "+d(t)),"type_error:SafeHtml")}kt.prototype.qa=!0,kt.prototype.pa=function(){return this.a.toString()},kt.prototype.toString=function(){return"SafeHtml{"+this.a+"}"};var Pt={};function Mt(t){var e=new kt;return e.a=t,e}Mt("<!DOCTYPE html>");var Lt,xt,Ft=Mt("");function jt(t,e){for(var n=t.split("%s"),r="",i=Array.prototype.slice.call(arguments,1);i.length&&1<n.length;)r+=n.shift()+i.shift();return r+n.join("%s")}function Ut(t){return vt.test(t)&&(-1!=t.indexOf("&")&&(t=t.replace(ft,"&amp;")),-1!=t.indexOf("<")&&(t=t.replace(pt,"&lt;")),-1!=t.indexOf(">")&&(t=t.replace(dt,"&gt;")),-1!=t.indexOf('"')&&(t=t.replace(mt,"&quot;")),-1!=t.indexOf("'")&&(t=t.replace(yt,"&#39;")),-1!=t.indexOf("\0")&&(t=t.replace(gt,"&#0;"))),t}function qt(t){u.setTimeout((function(){throw t}),0)}function Vt(){var t=u.MessageChannel;if(void 0===t&&"undefined"!=typeof window&&window.postMessage&&window.addEventListener&&!Ot("Presto")&&(t=function(){var t=document.createElement("IFRAME");t.style.display="none",function(t){var e=ht(tt(rt));j(t,"HTMLIFrameElement"),t.src=ot(e).toString()}(t),document.documentElement.appendChild(t);var e=t.contentWindow;(t=e.document).open(),t.write(Rt(Ft)),t.close();var n="callImmediate"+Math.random(),r="file:"==e.location.protocol?"*":e.location.protocol+"//"+e.location.host;t=S((function(t){"*"!=r&&t.origin!=r||t.data!=n||this.port1.onmessage()}),this),e.addEventListener("message",t,!1),this.port1={},this.port2={postMessage:function(){e.postMessage(n,r)}}}),void 0!==t&&!Ot("Trident")&&!Ot("MSIE")){var e=new t,n={},r=n;return e.port1.onmessage=function(){if(void 0!==n.next){var t=(n=n.next).yb;n.yb=null,t()}},function(t){r.next={yb:t},r=r.next,e.port2.postMessage(0)}}return"undefined"!=typeof document&&"onreadystatechange"in document.createElement("SCRIPT")?function(t){var e=document.createElement("SCRIPT");e.onreadystatechange=function(){e.onreadystatechange=null,e.parentNode.removeChild(e),e=null,t(),t=null},document.documentElement.appendChild(e)}:function(t){u.setTimeout(t,0)}}function Bt(t,e){xt||function(){if(u.Promise&&u.Promise.resolve){var t=u.Promise.resolve(void 0);xt=function(){t.then(Qt)}}else xt=function(){var t=Qt;!v(u.setImmediate)||u.Window&&u.Window.prototype&&!Ot("Edge")&&u.Window.prototype.setImmediate==u.setImmediate?(Lt||(Lt=Vt()),Lt(t)):u.setImmediate(t)}}(),Wt||(xt(),Wt=!0),Kt.add(t,e)}Mt("<br>");var Wt=!1,Kt=new M;function Qt(){for(var t;t=x();){try{t.a.call(t.b)}catch(t){qt(t)}P(L,t)}Wt=!1}function Gt(t,e){if(this.a=Ht,this.i=void 0,this.f=this.b=this.c=null,this.g=this.h=!1,t!=p)try{var n=this;t.call(e,(function(t){oe(n,zt,t)}),(function(t){if(!(t instanceof fe))try{if(t instanceof Error)throw t;throw Error("Promise rejected.")}catch(t){}oe(n,Yt,t)}))}catch(t){oe(this,Yt,t)}}var Ht=0,zt=2,Yt=3;function Xt(){this.next=this.f=this.b=this.g=this.a=null,this.c=!1}Xt.prototype.reset=function(){this.f=this.b=this.g=this.a=null,this.c=!1};var Jt=new R((function(){return new Xt}),(function(t){t.reset()}));function $t(t,e,n){var r=Jt.get();return r.g=t,r.b=e,r.f=n,r}function Zt(t){if(t instanceof Gt)return t;var e=new Gt(p);return oe(e,zt,t),e}function te(t){return new Gt((function(e,n){n(t)}))}function ee(t,e,n){ae(t,e,n,null)||Bt(I(e,t))}function ne(t){return new Gt((function(e){var n=t.length,r=[];if(n)for(var i=function(t,i,o){n--,r[t]=i?{Gb:!0,value:o}:{Gb:!1,reason:o},0==n&&e(r)},o=0;o<t.length;o++)ee(t[o],I(i,o,!0),I(i,o,!1));else e(r)}))}function re(t,e){t.b||t.a!=zt&&t.a!=Yt||se(t),t.f?t.f.next=e:t.b=e,t.f=e}function ie(t,e,n,r){var i=$t(null,null,null);return i.a=new Gt((function(t,o){i.g=e?function(n){try{var i=e.call(r,n);t(i)}catch(t){o(t)}}:t,i.b=n?function(e){try{var i=n.call(r,e);void 0===i&&e instanceof fe?o(e):t(i)}catch(t){o(t)}}:o})),i.a.c=t,re(t,i),i.a}function oe(t,e,n){t.a==Ht&&(t===n&&(e=Yt,n=new TypeError("Promise cannot resolve to itself")),t.a=1,ae(n,t.Oc,t.Pc,t)||(t.i=n,t.a=e,t.c=null,se(t),e!=Yt||n instanceof fe||function(t,e){t.g=!0,Bt((function(){t.g&&le.call(null,e)}))}(t,n)))}function ae(t,e,n,r){if(t instanceof Gt)return re(t,$t(e||p,n||null,r)),!0;if(D(t))return t.then(e,n,r),!0;if(b(t))try{var i=t.then;if(v(i))return function(t,e,n,r,i){function o(t){a||(a=!0,r.call(i,t))}var a=!1;try{e.call(t,(function(t){a||(a=!0,n.call(i,t))}),o)}catch(t){o(t)}}(t,i,e,n,r),!0}catch(t){return n.call(r,t),!0}return!1}function se(t){t.h||(t.h=!0,Bt(t.Zb,t))}function ue(t){var e=null;return t.b&&(e=t.b,t.b=e.next,e.next=null),t.b||(t.f=null),e}function ce(t,e,n,r){if(n==Yt&&e.b&&!e.c)for(;t&&t.g;t=t.c)t.g=!1;if(e.a)e.a.c=null,he(e,n,r);else try{e.c?e.g.call(e.f):he(e,n,r)}catch(t){le.call(null,t)}P(Jt,e)}function he(t,e,n){e==zt?t.g.call(t.f,n):t.b&&t.b.call(t.f,n)}Gt.prototype.then=function(t,e,n){return ie(this,v(t)?t:null,v(e)?e:null,n)},Gt.prototype.$goog_Thenable=!0,(n=Gt.prototype).ka=function(t,e){return(t=$t(t,t,e)).c=!0,re(this,t),this},n.s=function(t,e){return ie(this,null,t,e)},n.cancel=function(t){this.a==Ht&&Bt((function(){!function t(e,n){if(e.a==Ht)if(e.c){var r=e.c;if(r.b){for(var i=0,o=null,a=null,s=r.b;s&&(s.c||(i++,s.a==e&&(o=s),!(o&&1<i)));s=s.next)o||(a=s);o&&(r.a==Ht&&1==i?t(r,n):(a?((i=a).next==r.f&&(r.f=i),i.next=i.next.next):ue(r),ce(r,o,Yt,n)))}e.c=null}else oe(e,Yt,n)}(this,new fe(t))}),this)},n.Oc=function(t){this.a=Ht,oe(this,zt,t)},n.Pc=function(t){this.a=Ht,oe(this,Yt,t)},n.Zb=function(){for(var t;t=ue(this);)ce(this,t,this.a,this.i);this.h=!1};var le=qt;function fe(t){A.call(this,t)}function pe(){0!=de&&(me[this[w]||(this[w]=++T)]=this),this.va=this.va,this.la=this.la}N(fe,A),fe.prototype.name="cancel";var de=0,me={};function ye(t){if(!t.va&&(t.va=!0,t.za(),0!=de)){var e=t[w]||(t[w]=++T);if(0!=de&&t.la&&0<t.la.length)throw Error(t+" did not empty its onDisposeCallbacks queue. This probably means it overrode dispose() or disposeInternal() without calling the superclass' method.");delete me[e]}}function ge(t){return ge[" "](t),t}pe.prototype.va=!1,pe.prototype.za=function(){if(this.la)for(;this.la.length;)this.la.shift()()},ge[" "]=p;var ve,be,we=Ot("Opera"),Te=Ot("Trident")||Ot("MSIE"),_e=Ot("Edge"),Ee=_e||Te,Se=Ot("Gecko")&&!(bt(It.toLowerCase(),"webkit")&&!Ot("Edge"))&&!(Ot("Trident")||Ot("MSIE"))&&!Ot("Edge"),Ie=bt(It.toLowerCase(),"webkit")&&!Ot("Edge");function Ce(){var t=u.document;return t?t.documentMode:void 0}t:{var Ne="",De=(be=It,Se?/rv:([^\);]+)(\)|;)/.exec(be):_e?/Edge\/([\d\.]+)/.exec(be):Te?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(be):Ie?/WebKit\/(\S+)/.exec(be):we?/(?:Version)[ \/]?(\S+)/.exec(be):void 0);if(De&&(Ne=De?De[1]:""),Te){var Ae=Ce();if(null!=Ae&&Ae>parseFloat(Ne)){ve=String(Ae);break t}}ve=Ne}var Oe,ke={};function Re(t){return function(t,e){var n=ke;return Object.prototype.hasOwnProperty.call(n,t)?n[t]:n[t]=e(t)}(t,(function(){for(var e=0,n=lt(String(ve)).split("."),r=lt(String(t)).split("."),i=Math.max(n.length,r.length),o=0;0==e&&o<i;o++){var a=n[o]||"",s=r[o]||"";do{if(a=/(\d*)(\D*)(.*)/.exec(a)||["","","",""],s=/(\d*)(\D*)(.*)/.exec(s)||["","","",""],0==a[0].length&&0==s[0].length)break;e=wt(0==a[1].length?0:parseInt(a[1],10),0==s[1].length?0:parseInt(s[1],10))||wt(0==a[2].length,0==s[2].length)||wt(a[2],s[2]),a=a[3],s=s[3]}while(0==e)}return 0<=e}))}Oe=u.document&&Te?Ce():void 0;var Pe=Object.freeze||function(t){return t},Me=!Te||9<=Number(Oe),Le=Te&&!Re("9"),xe=function(){if(!u.addEventListener||!Object.defineProperty)return!1;var t=!1,e=Object.defineProperty({},"passive",{get:function(){t=!0}});try{u.addEventListener("test",p,e),u.removeEventListener("test",p,e)}catch(t){}return t}();function Fe(t,e){this.type=t,this.b=this.target=e,this.Mb=!0}function je(t,e){if(Fe.call(this,t?t.type:""),this.relatedTarget=this.b=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.pointerId=0,this.pointerType="",this.a=null,t){var n=this.type=t.type,r=t.changedTouches&&t.changedTouches.length?t.changedTouches[0]:null;if(this.target=t.target||t.srcElement,this.b=e,e=t.relatedTarget){if(Se){t:{try{ge(e.nodeName);var i=!0;break t}catch(t){}i=!1}i||(e=null)}}else"mouseover"==n?e=t.fromElement:"mouseout"==n&&(e=t.toElement);this.relatedTarget=e,r?(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=void 0!==t.clientX?t.clientX:t.pageX,this.clientY=void 0!==t.clientY?t.clientY:t.pageY,this.screenX=t.screenX||0,this.screenY=t.screenY||0),this.button=t.button,this.key=t.key||"",this.ctrlKey=t.ctrlKey,this.altKey=t.altKey,this.shiftKey=t.shiftKey,this.metaKey=t.metaKey,this.pointerId=t.pointerId||0,this.pointerType=c(t.pointerType)?t.pointerType:Ue[t.pointerType]||"",this.a=t,t.defaultPrevented&&this.preventDefault()}}Fe.prototype.preventDefault=function(){this.Mb=!1},N(je,Fe);var Ue=Pe({2:"touch",3:"pen",4:"mouse"});je.prototype.preventDefault=function(){je.qb.preventDefault.call(this);var t=this.a;if(t.preventDefault)t.preventDefault();else if(t.returnValue=!1,Le)try{(t.ctrlKey||112<=t.keyCode&&123>=t.keyCode)&&(t.keyCode=-1)}catch(t){}},je.prototype.f=function(){return this.a};var qe="closure_listenable_"+(1e6*Math.random()|0),Ve=0;function Be(t,e,n,r,i){this.listener=t,this.proxy=null,this.src=e,this.type=n,this.capture=!!r,this.Pa=i,this.key=++Ve,this.ta=this.Ka=!1}function We(t){t.ta=!0,t.listener=null,t.proxy=null,t.src=null,t.Pa=null}function Ke(t){this.src=t,this.a={},this.b=0}function Qe(t,e){var n=e.type;n in t.a&&K(t.a[n],e)&&(We(e),0==t.a[n].length&&(delete t.a[n],t.b--))}function Ge(t,e,n,r){for(var i=0;i<t.length;++i){var o=t[i];if(!o.ta&&o.listener==e&&o.capture==!!n&&o.Pa==r)return i}return-1}Ke.prototype.add=function(t,e,n,r,i){var o=t.toString();(t=this.a[o])||(t=this.a[o]=[],this.b++);var a=Ge(t,e,r,i);return-1<a?(e=t[a],n||(e.Ka=!1)):((e=new Be(e,this.src,o,!!r,i)).Ka=n,t.push(e)),e};var He="closure_lm_"+(1e6*Math.random()|0),ze={};function Ye(t,e,n,r,i){if(r&&r.once)Je(t,e,n,r,i);else if(y(e))for(var o=0;o<e.length;o++)Ye(t,e[o],n,r,i);else n=sn(n),t&&t[qe]?cn(t,e,n,b(r)?!!r.capture:!!r,i):Xe(t,e,n,!1,r,i)}function Xe(t,e,n,r,i,o){if(!e)throw Error("Invalid event type");var a=b(i)?!!i.capture:!!i,s=on(t);if(s||(t[He]=s=new Ke(t)),!(n=s.add(e,n,r,a,o)).proxy){if(r=function(){var t=rn,e=Me?function(n){return t.call(e.src,e.listener,n)}:function(n){if(!(n=t.call(e.src,e.listener,n)))return n};return e}(),n.proxy=r,r.src=t,r.listener=n,t.addEventListener)xe||(i=a),void 0===i&&(i=!1),t.addEventListener(e.toString(),r,i);else if(t.attachEvent)t.attachEvent(tn(e.toString()),r);else{if(!t.addListener||!t.removeListener)throw Error("addEventListener and attachEvent are unavailable.");t.addListener(r)}0}}function Je(t,e,n,r,i){if(y(e))for(var o=0;o<e.length;o++)Je(t,e[o],n,r,i);else n=sn(n),t&&t[qe]?hn(t,e,n,b(r)?!!r.capture:!!r,i):Xe(t,e,n,!0,r,i)}function $e(t,e,n,r,i){if(y(e))for(var o=0;o<e.length;o++)$e(t,e[o],n,r,i);else r=b(r)?!!r.capture:!!r,n=sn(n),t&&t[qe]?(t=t.u,(e=String(e).toString())in t.a&&(-1<(n=Ge(o=t.a[e],n,r,i))&&(We(o[n]),Array.prototype.splice.call(o,n,1),0==o.length&&(delete t.a[e],t.b--)))):t&&(t=on(t))&&(e=t.a[e.toString()],t=-1,e&&(t=Ge(e,n,r,i)),(n=-1<t?e[t]:null)&&Ze(n))}function Ze(t){if("number"!=typeof t&&t&&!t.ta){var e=t.src;if(e&&e[qe])Qe(e.u,t);else{var n=t.type,r=t.proxy;e.removeEventListener?e.removeEventListener(n,r,t.capture):e.detachEvent?e.detachEvent(tn(n),r):e.addListener&&e.removeListener&&e.removeListener(r),(n=on(e))?(Qe(n,t),0==n.b&&(n.src=null,e[He]=null)):We(t)}}}function tn(t){return t in ze?ze[t]:ze[t]="on"+t}function en(t,e,n,r){var i=!0;if((t=on(t))&&(e=t.a[e.toString()]))for(e=e.concat(),t=0;t<e.length;t++){var o=e[t];o&&o.capture==n&&!o.ta&&(o=nn(o,r),i=i&&!1!==o)}return i}function nn(t,e){var n=t.listener,r=t.Pa||t.src;return t.Ka&&Ze(t),n.call(r,e)}function rn(t,e){if(t.ta)return!0;if(!Me){if(!e)t:{e=["window","event"];for(var n=u,r=0;r<e.length;r++)if(null==(n=n[e[r]])){e=null;break t}e=n}if(e=new je(r=e,this),n=!0,!(0>r.keyCode||null!=r.returnValue)){t:{var i=!1;if(0==r.keyCode)try{r.keyCode=-1;break t}catch(t){i=!0}(i||null==r.returnValue)&&(r.returnValue=!0)}for(r=[],i=e.b;i;i=i.parentNode)r.push(i);for(t=t.type,i=r.length-1;0<=i;i--){e.b=r[i];var o=en(r[i],t,!0,e);n=n&&o}for(i=0;i<r.length;i++)e.b=r[i],o=en(r[i],t,!1,e),n=n&&o}return n}return nn(t,new je(e,this))}function on(t){return(t=t[He])instanceof Ke?t:null}var an="__closure_events_fn_"+(1e9*Math.random()>>>0);function sn(t){return v(t)?t:(t[an]||(t[an]=function(e){return t.handleEvent(e)}),t[an])}function un(){pe.call(this),this.u=new Ke(this),this.Sb=this,this.Xa=null}function cn(t,e,n,r,i){t.u.add(String(e),n,!1,r,i)}function hn(t,e,n,r,i){t.u.add(String(e),n,!0,r,i)}function ln(t,e,n,r){if(!(e=t.u.a[String(e)]))return!0;e=e.concat();for(var i=!0,o=0;o<e.length;++o){var a=e[o];if(a&&!a.ta&&a.capture==n){var s=a.listener,u=a.Pa||a.src;a.Ka&&Qe(t.u,a),i=!1!==s.call(u,r)&&i}}return i&&0!=r.Mb}function fn(t,e,n){if(v(t))n&&(t=S(t,n));else{if(!t||"function"!=typeof t.handleEvent)throw Error("Invalid listener argument");t=S(t.handleEvent,t)}return 2147483647<Number(e)?-1:u.setTimeout(t,e||0)}function pn(t){var e=null;return new Gt((function(n,r){-1==(e=fn((function(){n(void 0)}),t))&&r(Error("Failed to schedule timer."))})).s((function(t){throw u.clearTimeout(e),t}))}function dn(t){if(t.U&&"function"==typeof t.U)return t.U();if(c(t))return t.split("");if(g(t)){for(var e=[],n=t.length,r=0;r<n;r++)e.push(t[r]);return e}for(r in e=[],n=0,t)e[n++]=t[r];return e}function mn(t){if(t.X&&"function"==typeof t.X)return t.X();if(!t.U||"function"!=typeof t.U){if(g(t)||c(t)){var e=[];t=t.length;for(var n=0;n<t;n++)e.push(n);return e}for(var r in e=[],n=0,t)e[n++]=r;return e}}function yn(t,e){this.b={},this.a=[],this.c=0;var n=arguments.length;if(1<n){if(n%2)throw Error("Uneven number of arguments");for(var r=0;r<n;r+=2)this.set(arguments[r],arguments[r+1])}else if(t)if(t instanceof yn)for(n=t.X(),r=0;r<n.length;r++)this.set(n[r],t.get(n[r]));else for(r in t)this.set(r,t[r])}function gn(t){if(t.c!=t.a.length){for(var e=0,n=0;e<t.a.length;){var r=t.a[e];vn(t.b,r)&&(t.a[n++]=r),e++}t.a.length=n}if(t.c!=t.a.length){var i={};for(n=e=0;e<t.a.length;)vn(i,r=t.a[e])||(t.a[n++]=r,i[r]=1),e++;t.a.length=n}}function vn(t,e){return Object.prototype.hasOwnProperty.call(t,e)}N(un,pe),un.prototype[qe]=!0,un.prototype.addEventListener=function(t,e,n,r){Ye(this,t,e,n,r)},un.prototype.removeEventListener=function(t,e,n,r){$e(this,t,e,n,r)},un.prototype.dispatchEvent=function(t){var e,n=this.Xa;if(n)for(e=[];n;n=n.Xa)e.push(n);n=this.Sb;var r=t.type||t;if(c(t))t=new Fe(t,n);else if(t instanceof Fe)t.target=t.target||n;else{var i=t;$(t=new Fe(r,n),i)}if(i=!0,e)for(var o=e.length-1;0<=o;o--){var a=t.b=e[o];i=ln(a,r,!0,t)&&i}if(i=ln(a=t.b=n,r,!0,t)&&i,i=ln(a,r,!1,t)&&i,e)for(o=0;o<e.length;o++)i=ln(a=t.b=e[o],r,!1,t)&&i;return i},un.prototype.za=function(){if(un.qb.za.call(this),this.u){var t,e=this.u;for(t in e.a){for(var n=e.a[t],r=0;r<n.length;r++)We(n[r]);delete e.a[t],e.b--}}this.Xa=null},(n=yn.prototype).U=function(){gn(this);for(var t=[],e=0;e<this.a.length;e++)t.push(this.b[this.a[e]]);return t},n.X=function(){return gn(this),this.a.concat()},n.clear=function(){this.b={},this.c=this.a.length=0},n.get=function(t,e){return vn(this.b,t)?this.b[t]:e},n.set=function(t,e){vn(this.b,t)||(this.c++,this.a.push(t)),this.b[t]=e},n.forEach=function(t,e){for(var n=this.X(),r=0;r<n.length;r++){var i=n[r],o=this.get(i);t.call(e,o,i,this)}};var bn=/^(?:([^:/?#.]+):)?(?:\/\/(?:([^/?#]*)@)?([^/#?]*?)(?::([0-9]+))?(?=[/#?]|$))?([^?#]+)?(?:\?([^#]*))?(?:#([\s\S]*))?$/;function wn(t,e){var n;this.b=this.i=this.f="",this.l=null,this.g=this.c="",this.h=!1,t instanceof wn?(this.h=void 0!==e?e:t.h,Tn(this,t.f),this.i=t.i,this.b=t.b,_n(this,t.l),this.c=t.c,En(this,Bn(t.a)),this.g=t.g):t&&(n=String(t).match(bn))?(this.h=!!e,Tn(this,n[1]||"",!0),this.i=Dn(n[2]||""),this.b=Dn(n[3]||"",!0),_n(this,n[4]),this.c=Dn(n[5]||"",!0),En(this,n[6]||"",!0),this.g=Dn(n[7]||"")):(this.h=!!e,this.a=new xn(null,this.h))}function Tn(t,e,n){t.f=n?Dn(e,!0):e,t.f&&(t.f=t.f.replace(/:$/,""))}function _n(t,e){if(e){if(e=Number(e),isNaN(e)||0>e)throw Error("Bad port number "+e);t.l=e}else t.l=null}function En(t,e,n){e instanceof xn?(t.a=e,function(t,e){e&&!t.f&&(Fn(t),t.c=null,t.a.forEach((function(t,e){var n=e.toLowerCase();e!=n&&(Un(this,e),Vn(this,n,t))}),t)),t.f=e}(t.a,t.h)):(n||(e=An(e,Mn)),t.a=new xn(e,t.h))}function Sn(t,e,n){t.a.set(e,n)}function In(t,e){return t.a.get(e)}function Cn(t){return t instanceof wn?new wn(t):new wn(t,void 0)}function Nn(t,e){var n=new wn(null,void 0);return Tn(n,"https"),t&&(n.b=t),e&&(n.c=e),n}function Dn(t,e){return t?e?decodeURI(t.replace(/%25/g,"%2525")):decodeURIComponent(t):""}function An(t,e,n){return c(t)?(t=encodeURI(t).replace(e,On),n&&(t=t.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),t):null}function On(t){return"%"+((t=t.charCodeAt(0))>>4&15).toString(16)+(15&t).toString(16)}wn.prototype.toString=function(){var t=[],e=this.f;e&&t.push(An(e,kn,!0),":");var n=this.b;return(n||"file"==e)&&(t.push("//"),(e=this.i)&&t.push(An(e,kn,!0),"@"),t.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.l)&&t.push(":",String(n))),(n=this.c)&&(this.b&&"/"!=n.charAt(0)&&t.push("/"),t.push(An(n,"/"==n.charAt(0)?Pn:Rn,!0))),(n=this.a.toString())&&t.push("?",n),(n=this.g)&&t.push("#",An(n,Ln)),t.join("")},wn.prototype.resolve=function(t){var e=new wn(this),n=!!t.f;n?Tn(e,t.f):n=!!t.i,n?e.i=t.i:n=!!t.b,n?e.b=t.b:n=null!=t.l;var r=t.c;if(n)_n(e,t.l);else if(n=!!t.c){if("/"!=r.charAt(0))if(this.b&&!this.c)r="/"+r;else{var i=e.c.lastIndexOf("/");-1!=i&&(r=e.c.substr(0,i+1)+r)}if(".."==(i=r)||"."==i)r="";else if(bt(i,"./")||bt(i,"/.")){r=0==i.lastIndexOf("/",0),i=i.split("/");for(var o=[],a=0;a<i.length;){var s=i[a++];"."==s?r&&a==i.length&&o.push(""):".."==s?((1<o.length||1==o.length&&""!=o[0])&&o.pop(),r&&a==i.length&&o.push("")):(o.push(s),r=!0)}r=o.join("/")}else r=i}return n?e.c=r:n=""!==t.a.toString(),n?En(e,Bn(t.a)):n=!!t.g,n&&(e.g=t.g),e};var kn=/[#\/\?@]/g,Rn=/[#\?:]/g,Pn=/[#\?]/g,Mn=/[#\?@]/g,Ln=/#/g;function xn(t,e){this.b=this.a=null,this.c=t||null,this.f=!!e}function Fn(t){t.a||(t.a=new yn,t.b=0,t.c&&function(t,e){if(t){t=t.split("&");for(var n=0;n<t.length;n++){var r=t[n].indexOf("="),i=null;if(0<=r){var o=t[n].substring(0,r);i=t[n].substring(r+1)}else o=t[n];e(o,i?decodeURIComponent(i.replace(/\+/g," ")):"")}}}(t.c,(function(e,n){t.add(decodeURIComponent(e.replace(/\+/g," ")),n)})))}function jn(t){var e=mn(t);if(void 0===e)throw Error("Keys are undefined");var n=new xn(null,void 0);t=dn(t);for(var r=0;r<e.length;r++){var i=e[r],o=t[r];y(o)?Vn(n,i,o):n.add(i,o)}return n}function Un(t,e){Fn(t),e=Wn(t,e),vn(t.a.b,e)&&(t.c=null,t.b-=t.a.get(e).length,vn((t=t.a).b,e)&&(delete t.b[e],t.c--,t.a.length>2*t.c&&gn(t)))}function qn(t,e){return Fn(t),e=Wn(t,e),vn(t.a.b,e)}function Vn(t,e,n){Un(t,e),0<n.length&&(t.c=null,t.a.set(Wn(t,e),H(n)),t.b+=n.length)}function Bn(t){var e=new xn;return e.c=t.c,t.a&&(e.a=new yn(t.a),e.b=t.b),e}function Wn(t,e){return e=String(e),t.f&&(e=e.toLowerCase()),e}(n=xn.prototype).add=function(t,e){Fn(this),this.c=null,t=Wn(this,t);var n=this.a.get(t);return n||this.a.set(t,n=[]),n.push(e),this.b+=1,this},n.clear=function(){this.a=this.c=null,this.b=0},n.forEach=function(t,e){Fn(this),this.a.forEach((function(n,r){q(n,(function(n){t.call(e,n,r,this)}),this)}),this)},n.X=function(){Fn(this);for(var t=this.a.U(),e=this.a.X(),n=[],r=0;r<e.length;r++)for(var i=t[r],o=0;o<i.length;o++)n.push(e[r]);return n},n.U=function(t){Fn(this);var e=[];if(c(t))qn(this,t)&&(e=G(e,this.a.get(Wn(this,t))));else{t=this.a.U();for(var n=0;n<t.length;n++)e=G(e,t[n])}return e},n.set=function(t,e){return Fn(this),this.c=null,qn(this,t=Wn(this,t))&&(this.b-=this.a.get(t).length),this.a.set(t,[e]),this.b+=1,this},n.get=function(t,e){return t&&0<(t=this.U(t)).length?String(t[0]):e},n.toString=function(){if(this.c)return this.c;if(!this.a)return"";for(var t=[],e=this.a.X(),n=0;n<e.length;n++){var r=e[n],i=encodeURIComponent(String(r));r=this.U(r);for(var o=0;o<r.length;o++){var a=i;""!==r[o]&&(a+="="+encodeURIComponent(String(r[o]))),t.push(a)}}return this.c=t.join("&")};var Kn=!Te||9<=Number(Oe);function Qn(t){var e=document;return c(t)?e.getElementById(t):t}function Gn(t,e){z(e,(function(e,n){e&&"object"==typeof e&&e.qa&&(e=e.pa()),"style"==n?t.style.cssText=e:"class"==n?t.className=e:"for"==n?t.htmlFor=e:Hn.hasOwnProperty(n)?t.setAttribute(Hn[n],e):0==n.lastIndexOf("aria-",0)||0==n.lastIndexOf("data-",0)?t.setAttribute(n,e):t[n]=e}))}var Hn={cellpadding:"cellPadding",cellspacing:"cellSpacing",colspan:"colSpan",frameborder:"frameBorder",height:"height",maxlength:"maxLength",nonce:"nonce",role:"role",rowspan:"rowSpan",type:"type",usemap:"useMap",valign:"vAlign",width:"width"};function zn(t,e,n){function r(n){n&&e.appendChild(c(n)?t.createTextNode(n):n)}for(var i=2;i<n.length;i++){var o=n[i];!g(o)||b(o)&&0<o.nodeType?r(o):q(Yn(o)?H(o):o,r)}}function Yn(t){if(t&&"number"==typeof t.length){if(b(t))return"function"==typeof t.item||"string"==typeof t.item;if(v(t))return"function"==typeof t.item}return!1}function Xn(t){var e=[];return function t(e,n,r){if(null==n)r.push("null");else{if("object"==typeof n){if(y(n)){var i=n;n=i.length,r.push("[");for(var o="",a=0;a<n;a++)r.push(o),t(e,i[a],r),o=",";return void r.push("]")}if(!(n instanceof String||n instanceof Number||n instanceof Boolean)){for(i in r.push("{"),o="",n)Object.prototype.hasOwnProperty.call(n,i)&&("function"!=typeof(a=n[i])&&(r.push(o),tr(i,r),r.push(":"),t(e,a,r),o=","));return void r.push("}")}n=n.valueOf()}switch(typeof n){case"string":tr(n,r);break;case"number":r.push(isFinite(n)&&!isNaN(n)?String(n):"null");break;case"boolean":r.push(String(n));break;case"function":r.push("null");break;default:throw Error("Unknown type: "+typeof n)}}}(new Jn,t,e),e.join("")}function Jn(){}var $n={'"':'\\"',"\\":"\\\\","/":"\\/","\b":"\\b","\f":"\\f","\n":"\\n","\r":"\\r","\t":"\\t","\v":"\\u000b"},Zn=/\uffff/.test("")?/[\\"\x00-\x1f\x7f-\uffff]/g:/[\\"\x00-\x1f\x7f-\xff]/g;function tr(t,e){e.push('"',t.replace(Zn,(function(t){var e=$n[t];return e||(e="\\u"+(65536|t.charCodeAt(0)).toString(16).substr(1),$n[t]=e),e})),'"')}function er(){var t=wr();return Te&&!!Oe&&11==Oe||/Edge\/\d+/.test(t)}function nr(){return u.window&&u.window.location.href||self&&self.location&&self.location.href||""}function rr(t,e){e=e||u.window;var n="about:blank";t&&(n=_t(St(t)).toString()),e.location.href=n}function ir(t){return!!((t=(t||wr()).toLowerCase()).match(/android/)||t.match(/webos/)||t.match(/iphone|ipad|ipod/)||t.match(/blackberry/)||t.match(/windows phone/)||t.match(/iemobile/))}function or(t){t=t||u.window;try{t.close()}catch(t){}}function ar(t,e,n){var r=Math.floor(1e9*Math.random()).toString();e=e||500,n=n||600;var i=(window.screen.availHeight-n)/2,o=(window.screen.availWidth-e)/2;for(a in e={width:e,height:n,top:0<i?i:0,left:0<o?o:0,location:!0,resizable:!0,statusbar:!0,toolbar:!1},n=wr().toLowerCase(),r&&(e.target=r,bt(n,"crios/")&&(e.target="_blank")),gr(wr())==mr&&(t=t||"http://localhost",e.scrollbars=!0),n=t||"",(t=e)||(t={}),r=window,e=n instanceof Tt?n:St(void 0!==n.href?n.href:String(n)),n=t.target||n.target,i=[],t)switch(a){case"width":case"height":case"top":case"left":i.push(a+"="+t[a]);break;case"target":case"noopener":case"noreferrer":break;default:i.push(a+"="+(t[a]?1:0))}var a=i.join(",");if((Ot("iPhone")&&!Ot("iPod")&&!Ot("iPad")||Ot("iPad")||Ot("iPod"))&&r.navigator&&r.navigator.standalone&&n&&"_self"!=n?(j(a=r.document.createElement("A"),"HTMLAnchorElement"),e instanceof Tt||e instanceof Tt||(e="object"==typeof e&&e.qa?e.pa():String(e),Et.test(e)||(e="about:invalid#zClosurez"),e=Nt(e)),a.href=_t(e),a.setAttribute("target",n),t.noreferrer&&a.setAttribute("rel","noreferrer"),(t=document.createEvent("MouseEvent")).initMouseEvent("click",!0,!0,r,1),a.dispatchEvent(t),a={}):t.noreferrer?(a=r.open("",n,a),t=_t(e).toString(),a&&(Ee&&bt(t,";")&&(t="'"+t.replace(/'/g,"%27")+"'"),a.opener=null,t=Mt('<meta name="referrer" content="no-referrer"><meta http-equiv="refresh" content="0; url='+Ut(t)+'">'),a.document.write(Rt(t)),a.document.close())):(a=r.open(_t(e).toString(),n,a))&&t.noopener&&(a.opener=null),a)try{a.focus()}catch(t){}return a}var sr=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,ur=/^[^@]+@[^@]+$/;function cr(){var t=null;return new Gt((function(e){"complete"==u.document.readyState?e():(t=function(){e()},Je(window,"load",t))})).s((function(e){throw $e(window,"load",t),e}))}function hr(t){return t=t||wr(),!("file:"!==Ir()&&"ionic:"!==Ir()||!t.toLowerCase().match(/iphone|ipad|ipod|android/))}function lr(){var t=u.window;try{return!(!t||t==t.top)}catch(t){return!1}}function fr(){return void 0!==u.WorkerGlobalScope&&"function"==typeof u.importScripts}function pr(){return e.default.INTERNAL.hasOwnProperty("reactNative")?"ReactNative":e.default.INTERNAL.hasOwnProperty("node")?"Node":fr()?"Worker":"Browser"}function dr(){var t=pr();return"ReactNative"===t||"Node"===t}var mr="Firefox",yr="Chrome";function gr(t){var e=t.toLowerCase();return bt(e,"opera/")||bt(e,"opr/")||bt(e,"opios/")?"Opera":bt(e,"iemobile")?"IEMobile":bt(e,"msie")||bt(e,"trident/")?"IE":bt(e,"edge/")?"Edge":bt(e,"firefox/")?mr:bt(e,"silk/")?"Silk":bt(e,"blackberry")?"Blackberry":bt(e,"webos")?"Webos":!bt(e,"safari/")||bt(e,"chrome/")||bt(e,"crios/")||bt(e,"android")?!bt(e,"chrome/")&&!bt(e,"crios/")||bt(e,"edge/")?bt(e,"android")?"Android":(t=t.match(/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/))&&2==t.length?t[1]:"Other":yr:"Safari"}var vr={Wc:"FirebaseCore-web",Yc:"FirebaseUI-web"};function br(t,e){e=e||[];var n,r=[],i={};for(n in vr)i[vr[n]]=!0;for(n=0;n<e.length;n++)void 0!==i[e[n]]&&(delete i[e[n]],r.push(e[n]));return r.sort(),(e=r).length||(e=["FirebaseCore-web"]),"Browser"===(r=pr())?r=gr(i=wr()):"Worker"===r&&(r=gr(i=wr())+"-"+r),r+"/JsCore/"+t+"/"+e.join(",")}function wr(){return u.navigator&&u.navigator.userAgent||""}function Tr(t,e){t=t.split("."),e=e||u;for(var n=0;n<t.length&&"object"==typeof e&&null!=e;n++)e=e[t[n]];return n!=t.length&&(e=void 0),e}function _r(){try{var t=u.localStorage,e=Or();if(t)return t.setItem(e,"1"),t.removeItem(e),!er()||!!u.indexedDB}catch(t){return fr()&&!!u.indexedDB}return!1}function Er(){return(Sr()||"chrome-extension:"===Ir()||hr())&&!dr()&&_r()&&!fr()}function Sr(){return"http:"===Ir()||"https:"===Ir()}function Ir(){return u.location&&u.location.protocol||null}function Cr(t){return!ir(t=t||wr())&&gr(t)!=mr}function Nr(t){return void 0===t?null:Xn(t)}function Dr(t){var e,n={};for(e in t)t.hasOwnProperty(e)&&null!==t[e]&&void 0!==t[e]&&(n[e]=t[e]);return n}function Ar(t){if(null!==t)return JSON.parse(t)}function Or(t){return t||Math.floor(1e9*Math.random()).toString()}function kr(t){return"Safari"!=gr(t=t||wr())&&!t.toLowerCase().match(/iphone|ipad|ipod/)}function Rr(){var t=u.___jsl;if(t&&t.H)for(var e in t.H)if(t.H[e].r=t.H[e].r||[],t.H[e].L=t.H[e].L||[],t.H[e].r=t.H[e].L.concat(),t.CP)for(var n=0;n<t.CP.length;n++)t.CP[n]=null}function Pr(t,e){if(t>e)throw Error("Short delay should be less than long delay!");this.a=t,this.c=e,t=wr(),e=pr(),this.b=ir(t)||"ReactNative"===e}function Mr(){var t=u.document;return!t||void 0===t.visibilityState||"visible"==t.visibilityState}function Lr(t){try{var e=new Date(parseInt(t,10));if(!isNaN(e.getTime())&&!/[^0-9]/.test(t))return e.toUTCString()}catch(t){}return null}function xr(){return!(!Tr("fireauth.oauthhelper",u)&&!Tr("fireauth.iframe",u))}Pr.prototype.get=function(){var t=u.navigator;return!t||"boolean"!=typeof t.onLine||!Sr()&&"chrome-extension:"!==Ir()&&void 0===t.connection||t.onLine?this.b?this.c:this.a:Math.min(5e3,this.a)};var Fr,jr={};function Ur(t){jr[t]||(jr[t]=!0,"undefined"!=typeof console&&"function"==typeof console.warn&&console.warn(t))}try{var qr={};Object.defineProperty(qr,"abcd",{configurable:!0,enumerable:!0,value:1}),Object.defineProperty(qr,"abcd",{configurable:!0,enumerable:!0,value:2}),Fr=2==qr.abcd}catch(be){Fr=!1}function Vr(t,e,n){Fr?Object.defineProperty(t,e,{configurable:!0,enumerable:!0,value:n}):t[e]=n}function Br(t,e){if(e)for(var n in e)e.hasOwnProperty(n)&&Vr(t,n,e[n])}function Wr(t){var e={};return Br(e,t),e}function Kr(t){var e=t;if("object"==typeof t&&null!=t)for(var n in e="length"in t?[]:{},t)Vr(e,n,Kr(t[n]));return e}function Qr(t){var e={},n=t[Hr],r=t[zr];if(!(t=t[Yr])||t!=Gr&&!n)throw Error("Invalid provider user info!");e[Jr]=r||null,e[Xr]=n||null,Vr(this,Zr,t),Vr(this,$r,Kr(e))}var Gr="EMAIL_SIGNIN",Hr="email",zr="newEmail",Yr="requestType",Xr="email",Jr="fromEmail",$r="data",Zr="operation";function ti(t,e){this.code=ni+t,this.message=e||ri[t]||""}function ei(t){var e=t&&t.code;return e?new ti(e.substring(ni.length),t.message):null}N(ti,Error),ti.prototype.A=function(){return{code:this.code,message:this.message}},ti.prototype.toJSON=function(){return this.A()};var ni="auth/",ri={"admin-restricted-operation":"This operation is restricted to administrators only.","argument-error":"","app-not-authorized":"This app, identified by the domain where it's hosted, is not authorized to use Firebase Authentication with the provided API key. Review your key configuration in the Google API console.","app-not-installed":"The requested mobile application corresponding to the identifier (Android package name or iOS bundle ID) provided is not installed on this device.","captcha-check-failed":"The reCAPTCHA response token provided is either invalid, expired, already used or the domain associated with it does not match the list of whitelisted domains.","code-expired":"The SMS code has expired. Please re-send the verification code to try again.","cordova-not-ready":"Cordova framework is not ready.","cors-unsupported":"This browser is not supported.","credential-already-in-use":"This credential is already associated with a different user account.","custom-token-mismatch":"The custom token corresponds to a different audience.","requires-recent-login":"This operation is sensitive and requires recent authentication. Log in again before retrying this request.","dynamic-link-not-activated":"Please activate Dynamic Links in the Firebase Console and agree to the terms and conditions.","email-already-in-use":"The email address is already in use by another account.","expired-action-code":"The action code has expired. ","cancelled-popup-request":"This operation has been cancelled due to another conflicting popup being opened.","internal-error":"An internal error has occurred.","invalid-app-credential":"The phone verification request contains an invalid application verifier. The reCAPTCHA token response is either invalid or expired.","invalid-app-id":"The mobile app identifier is not registed for the current project.","invalid-user-token":"This user's credential isn't valid for this project. This can happen if the user's token has been tampered with, or if the user isn't for the project associated with this API key.","invalid-auth-event":"An internal error has occurred.","invalid-verification-code":"The SMS verification code used to create the phone auth credential is invalid. Please resend the verification code sms and be sure use the verification code provided by the user.","invalid-continue-uri":"The continue URL provided in the request is invalid.","invalid-cordova-configuration":"The following Cordova plugins must be installed to enable OAuth sign-in: cordova-plugin-buildinfo, cordova-universal-links-plugin, cordova-plugin-browsertab, cordova-plugin-inappbrowser and cordova-plugin-customurlscheme.","invalid-custom-token":"The custom token format is incorrect. Please check the documentation.","invalid-dynamic-link-domain":"The provided dynamic link domain is not configured or authorized for the current project.","invalid-email":"The email address is badly formatted.","invalid-api-key":"Your API key is invalid, please check you have copied it correctly.","invalid-cert-hash":"The SHA-1 certificate hash provided is invalid.","invalid-credential":"The supplied auth credential is malformed or has expired.","invalid-message-payload":"The email template corresponding to this action contains invalid characters in its message. Please fix by going to the Auth email templates section in the Firebase Console.","invalid-oauth-provider":"EmailAuthProvider is not supported for this operation. This operation only supports OAuth providers.","invalid-oauth-client-id":"The OAuth client ID provided is either invalid or does not match the specified API key.","unauthorized-domain":"This domain is not authorized for OAuth operations for your Firebase project. Edit the list of authorized domains from the Firebase console.","invalid-action-code":"The action code is invalid. This can happen if the code is malformed, expired, or has already been used.","wrong-password":"The password is invalid or the user does not have a password.","invalid-persistence-type":"The specified persistence type is invalid. It can only be local, session or none.","invalid-phone-number":"The format of the phone number provided is incorrect. Please enter the phone number in a format that can be parsed into E.164 format. E.164 phone numbers are written in the format [+][country code][subscriber number including area code].","invalid-provider-id":"The specified provider ID is invalid.","invalid-recipient-email":"The email corresponding to this action failed to send as the provided recipient email address is invalid.","invalid-sender":"The email template corresponding to this action contains an invalid sender email or name. Please fix by going to the Auth email templates section in the Firebase Console.","invalid-verification-id":"The verification ID used to create the phone auth credential is invalid.","invalid-tenant-id":"The Auth instance's tenant ID is invalid.","missing-android-pkg-name":"An Android Package Name must be provided if the Android App is required to be installed.","auth-domain-config-required":"Be sure to include authDomain when calling firebase.initializeApp(), by following the instructions in the Firebase console.","missing-app-credential":"The phone verification request is missing an application verifier assertion. A reCAPTCHA response token needs to be provided.","missing-verification-code":"The phone auth credential was created with an empty SMS verification code.","missing-continue-uri":"A continue URL must be provided in the request.","missing-iframe-start":"An internal error has occurred.","missing-ios-bundle-id":"An iOS Bundle ID must be provided if an App Store ID is provided.","missing-or-invalid-nonce":"The request does not contain a valid nonce. This can occur if the SHA-256 hash of the provided raw nonce does not match the hashed nonce in the ID token payload.","missing-phone-number":"To send verification codes, provide a phone number for the recipient.","missing-verification-id":"The phone auth credential was created with an empty verification ID.","app-deleted":"This instance of FirebaseApp has been deleted.","account-exists-with-different-credential":"An account already exists with the same email address but different sign-in credentials. Sign in using a provider associated with this email address.","network-request-failed":"A network error (such as timeout, interrupted connection or unreachable host) has occurred.","no-auth-event":"An internal error has occurred.","no-such-provider":"User was not linked to an account with the given provider.","null-user":"A null user object was provided as the argument for an operation which requires a non-null user object.","operation-not-allowed":"The given sign-in provider is disabled for this Firebase project. Enable it in the Firebase console, under the sign-in method tab of the Auth section.","operation-not-supported-in-this-environment":'This operation is not supported in the environment this application is running on. "location.protocol" must be http, https or chrome-extension and web storage must be enabled.',"popup-blocked":"Unable to establish a connection with the popup. It may have been blocked by the browser.","popup-closed-by-user":"The popup has been closed by the user before finalizing the operation.","provider-already-linked":"User can only be linked to one identity for the given provider.","quota-exceeded":"The project's quota for this operation has been exceeded.","redirect-cancelled-by-user":"The redirect operation has been cancelled by the user before finalizing.","redirect-operation-pending":"A redirect sign-in operation is already pending.","rejected-credential":"The request contains malformed or mismatching credentials.","tenant-id-mismatch":"The provided tenant ID does not match the Auth instance's tenant ID",timeout:"The operation has timed out.","user-token-expired":"The user's credential is no longer valid. The user must sign in again.","too-many-requests":"We have blocked all requests from this device due to unusual activity. Try again later.","unauthorized-continue-uri":"The domain of the continue URL is not whitelisted.  Please whitelist the domain in the Firebase console.","unsupported-persistence-type":"The current environment does not support the specified persistence type.","unsupported-tenant-operation":"This operation is not supported in a multi-tenant context.","user-cancelled":"The user did not grant your application the permissions it requested.","user-not-found":"There is no user record corresponding to this identifier. The user may have been deleted.","user-disabled":"The user account has been disabled by an administrator.","user-mismatch":"The supplied credentials do not correspond to the previously signed in user.","user-signed-out":"","weak-password":"The password must be 6 characters long or more.","web-storage-unsupported":"This browser is not supported or 3rd party cookies and data may be disabled."};function ii(t){var e=In(t=Cn(t),oi)||null,n=In(t,ai)||null,r=In(t,ci)||null;if(r=r&&li[r]||null,!e||!n||!r)throw new ti("argument-error",oi+", "+ai+"and "+ci+" are required in a valid action code URL.");Br(this,{apiKey:e,operation:r,code:n,continueUrl:In(t,si)||null,languageCode:In(t,ui)||null,tenantId:In(t,hi)||null})}var oi="apiKey",ai="oobCode",si="continueUrl",ui="languageCode",ci="mode",hi="tenantId",li={recoverEmail:"RECOVER_EMAIL",resetPassword:"PASSWORD_RESET",signIn:Gr,verifyEmail:"VERIFY_EMAIL"};function fi(t){try{return new ii(t)}catch(t){return null}}function pi(t){var e=t[vi];if(void 0===e)throw new ti("missing-continue-uri");if("string"!=typeof e||"string"==typeof e&&!e.length)throw new ti("invalid-continue-uri");this.h=e,this.b=this.a=null,this.g=!1;var n=t[di];if(n&&"object"==typeof n){e=n[Ti];var r=n[bi];if(n=n[wi],"string"==typeof e&&e.length){if(this.a=e,void 0!==r&&"boolean"!=typeof r)throw new ti("argument-error",bi+" property must be a boolean when specified.");if(this.g=!!r,void 0!==n&&("string"!=typeof n||"string"==typeof n&&!n.length))throw new ti("argument-error",wi+" property must be a non empty string when specified.");this.b=n||null}else{if(void 0!==e)throw new ti("argument-error",Ti+" property must be a non empty string when specified.");if(void 0!==r||void 0!==n)throw new ti("missing-android-pkg-name")}}else if(void 0!==n)throw new ti("argument-error",di+" property must be a non null object when specified.");if(this.f=null,(e=t[gi])&&"object"==typeof e){if("string"==typeof(e=e[_i])&&e.length)this.f=e;else if(void 0!==e)throw new ti("argument-error",_i+" property must be a non empty string when specified.")}else if(void 0!==e)throw new ti("argument-error",gi+" property must be a non null object when specified.");if(void 0!==(e=t[yi])&&"boolean"!=typeof e)throw new ti("argument-error",yi+" property must be a boolean when specified.");if(this.c=!!e,void 0!==(t=t[mi])&&("string"!=typeof t||"string"==typeof t&&!t.length))throw new ti("argument-error",mi+" property must be a non empty string when specified.");this.i=t||null}var di="android",mi="dynamicLinkDomain",yi="handleCodeInApp",gi="iOS",vi="url",bi="installApp",wi="minimumVersion",Ti="packageName",_i="bundleId";function Ei(t){var e={};for(var n in e.continueUrl=t.h,e.canHandleCodeInApp=t.c,(e.androidPackageName=t.a)&&(e.androidMinimumVersion=t.b,e.androidInstallApp=t.g),e.iOSBundleId=t.f,e.dynamicLinkDomain=t.i,e)null===e[n]&&delete e[n];return e}var Si=null,Ii=null;function Ci(t){var e="";return function(t,e){function n(e){for(;r<t.length;){var n=t.charAt(r++),i=Ii[n];if(null!=i)return i;if(!/^[\s\xa0]*$/.test(n))throw Error("Unknown base64 encoding at char: "+n)}return e}!function(){if(!Si){Si={},Ii={};for(var t=0;65>t;t++)Si[t]="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(t),Ii[Si[t]]=t,62<=t&&(Ii["ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_.".charAt(t)]=t)}}();for(var r=0;;){var i=n(-1),o=n(0),a=n(64),s=n(64);if(64===s&&-1===i)break;e(i<<2|o>>4),64!=a&&(e(o<<4&240|a>>2),64!=s&&e(a<<6&192|s))}}(t,(function(t){e+=String.fromCharCode(t)})),e}function Ni(t){this.f=t.sub,C(),this.a=t.provider_id||t.firebase&&t.firebase.sign_in_provider||null,this.c=t.firebase&&t.firebase.tenant||null,this.b=!!t.is_anonymous||"anonymous"==this.a}function Di(t){return(t=Ai(t))&&t.sub&&t.iss&&t.aud&&t.exp?new Ni(t):null}function Ai(t){if(!t)return null;if(3!=(t=t.split(".")).length)return null;for(var e=(4-(t=t[1]).length%4)%4,n=0;n<e;n++)t+=".";try{return JSON.parse(Ci(t))}catch(t){}return null}Ni.prototype.R=function(){return this.c},Ni.prototype.g=function(){return this.b};var Oi,ki={bd:{cb:"https://www.googleapis.com/identitytoolkit/v3/relyingparty/",ib:"https://securetoken.googleapis.com/v1/token",id:"p"},dd:{cb:"https://staging-www.sandbox.googleapis.com/identitytoolkit/v3/relyingparty/",ib:"https://staging-securetoken.sandbox.googleapis.com/v1/token",id:"s"},ed:{cb:"https://www-googleapis-test.sandbox.google.com/identitytoolkit/v3/relyingparty/",ib:"https://test-securetoken.sandbox.googleapis.com/v1/token",id:"t"}};function Ri(t){for(var e in ki)if(ki[e].id===t)return{firebaseEndpoint:(t=ki[e]).cb,secureTokenEndpoint:t.ib};return null}Oi=Ri("__EID__")?"__EID__":void 0;var Pi="oauth_consumer_key oauth_nonce oauth_signature oauth_signature_method oauth_timestamp oauth_token oauth_version".split(" "),Mi=["client_id","response_type","scope","redirect_uri","state"],Li={Xc:{Ea:"locale",sa:700,ra:600,Fa:"facebook.com",Qa:Mi},Zc:{Ea:null,sa:500,ra:750,Fa:"github.com",Qa:Mi},$c:{Ea:"hl",sa:515,ra:680,Fa:"google.com",Qa:Mi},fd:{Ea:"lang",sa:485,ra:705,Fa:"twitter.com",Qa:Pi},Vc:{Ea:"locale",sa:600,ra:600,Fa:"apple.com",Qa:[]}};function xi(t){for(var e in Li)if(Li[e].Fa==t)return Li[e];return null}function Fi(t){var e={};e["facebook.com"]=Bi,e["google.com"]=Ki,e["github.com"]=Wi,e["twitter.com"]=Qi;var n=t&&t[Ui];try{if(n)return e[n]?new e[n](t):new Vi(t);if(void 0!==t[ji])return new qi(t)}catch(t){}return null}var ji="idToken",Ui="providerId";function qi(t){var e=t[Ui];if(!e&&t[ji]){var n=Di(t[ji]);n&&n.a&&(e=n.a)}if(!e)throw Error("Invalid additional user info!");"anonymous"!=e&&"custom"!=e||(e=null),n=!1,void 0!==t.isNewUser?n=!!t.isNewUser:"identitytoolkit#SignupNewUserResponse"===t.kind&&(n=!0),Vr(this,"providerId",e),Vr(this,"isNewUser",n)}function Vi(t){qi.call(this,t),Vr(this,"profile",Kr((t=Ar(t.rawUserInfo||"{}"))||{}))}function Bi(t){if(Vi.call(this,t),"facebook.com"!=this.providerId)throw Error("Invalid provider ID!")}function Wi(t){if(Vi.call(this,t),"github.com"!=this.providerId)throw Error("Invalid provider ID!");Vr(this,"username",this.profile&&this.profile.login||null)}function Ki(t){if(Vi.call(this,t),"google.com"!=this.providerId)throw Error("Invalid provider ID!")}function Qi(t){if(Vi.call(this,t),"twitter.com"!=this.providerId)throw Error("Invalid provider ID!");Vr(this,"username",t.screenName||null)}function Gi(t){var e=Cn(t),n=In(e,"link"),r=In(Cn(n),"link");return e=In(e,"deep_link_id"),In(Cn(e),"link")||e||r||n||t}function Hi(){}function zi(t,e){return t.then((function(t){if(t[xa]){var n=Di(t[xa]);if(!n||e!=n.f)throw new ti("user-mismatch");return t}throw new ti("user-mismatch")})).s((function(t){throw t&&t.code&&t.code==ni+"user-not-found"?new ti("user-mismatch"):t}))}function Yi(t,e){if(!e)throw new ti("internal-error","failed to construct a credential");this.a=e,Vr(this,"providerId",t),Vr(this,"signInMethod",t)}function Xi(t){return{pendingToken:t.a,requestUri:"http://localhost"}}function Ji(t){if(t&&t.providerId&&t.signInMethod&&0==t.providerId.indexOf("saml.")&&t.pendingToken)try{return new Yi(t.providerId,t.pendingToken)}catch(t){}return null}function $i(t,e,n){if(this.a=null,e.idToken||e.accessToken)e.idToken&&Vr(this,"idToken",e.idToken),e.accessToken&&Vr(this,"accessToken",e.accessToken),e.nonce&&!e.pendingToken&&Vr(this,"nonce",e.nonce),e.pendingToken&&(this.a=e.pendingToken);else{if(!e.oauthToken||!e.oauthTokenSecret)throw new ti("internal-error","failed to construct a credential");Vr(this,"accessToken",e.oauthToken),Vr(this,"secret",e.oauthTokenSecret)}Vr(this,"providerId",t),Vr(this,"signInMethod",n)}function Zi(t){var e={};return t.idToken&&(e.id_token=t.idToken),t.accessToken&&(e.access_token=t.accessToken),t.secret&&(e.oauth_token_secret=t.secret),e.providerId=t.providerId,t.nonce&&!t.a&&(e.nonce=t.nonce),e={postBody:jn(e).toString(),requestUri:"http://localhost"},t.a&&(delete e.postBody,e.pendingToken=t.a),e}function to(t){if(t&&t.providerId&&t.signInMethod){var e={idToken:t.oauthIdToken,accessToken:t.oauthTokenSecret?null:t.oauthAccessToken,oauthTokenSecret:t.oauthTokenSecret,oauthToken:t.oauthTokenSecret&&t.oauthAccessToken,nonce:t.nonce,pendingToken:t.pendingToken};try{return new $i(t.providerId,e,t.signInMethod)}catch(t){}}return null}function eo(t,e){this.Fc=e||[],Br(this,{providerId:t,isOAuthProvider:!0}),this.zb={},this.eb=(xi(t)||{}).Ea||null,this.bb=null}function no(t){if("string"!=typeof t||0!=t.indexOf("saml."))throw new ti("argument-error",'SAML provider IDs must be prefixed with "saml."');eo.call(this,t,[])}function ro(t){eo.call(this,t,Mi),this.a=[]}function io(){ro.call(this,"facebook.com")}function oo(t){if(!t)throw new ti("argument-error","credential failed: expected 1 argument (the OAuth access token).");var e=t;return b(t)&&(e=t.accessToken),(new io).credential({accessToken:e})}function ao(){ro.call(this,"github.com")}function so(t){if(!t)throw new ti("argument-error","credential failed: expected 1 argument (the OAuth access token).");var e=t;return b(t)&&(e=t.accessToken),(new ao).credential({accessToken:e})}function uo(){ro.call(this,"google.com"),this.ya("profile")}function co(t,e){var n=t;return b(t)&&(n=t.idToken,e=t.accessToken),(new uo).credential({idToken:n,accessToken:e})}function ho(){eo.call(this,"twitter.com",Pi)}function lo(t,e){var n=t;if(b(n)||(n={oauthToken:t,oauthTokenSecret:e}),!n.oauthToken||!n.oauthTokenSecret)throw new ti("argument-error","credential failed: expected 2 arguments (the OAuth access token and secret).");return new $i("twitter.com",n,"twitter.com")}function fo(t,e,n){this.a=t,this.c=e,Vr(this,"providerId","password"),Vr(this,"signInMethod",n===mo.EMAIL_LINK_SIGN_IN_METHOD?mo.EMAIL_LINK_SIGN_IN_METHOD:mo.EMAIL_PASSWORD_SIGN_IN_METHOD)}function po(t){return t&&t.email&&t.password?new fo(t.email,t.password,t.signInMethod):null}function mo(){Br(this,{providerId:"password",isOAuthProvider:!1})}function yo(t,e){if(!(e=go(e)))throw new ti("argument-error","Invalid email link!");return new fo(t,e.code,mo.EMAIL_LINK_SIGN_IN_METHOD)}function go(t){return(t=fi(t=Gi(t)))&&t.operation===Gr?t:null}function vo(t){if(!(t.Va&&t.Ua||t.Ha&&t.ba))throw new ti("internal-error");this.a=t,Vr(this,"providerId","phone"),Vr(this,"signInMethod","phone")}function bo(t){if(t&&"phone"===t.providerId&&(t.verificationId&&t.verificationCode||t.temporaryProof&&t.phoneNumber)){var e={};return q(["verificationId","verificationCode","temporaryProof","phoneNumber"],(function(n){t[n]&&(e[n]=t[n])})),new vo(e)}return null}function wo(t){return t.a.Ha&&t.a.ba?{temporaryProof:t.a.Ha,phoneNumber:t.a.ba}:{sessionInfo:t.a.Va,code:t.a.Ua}}function To(t){try{this.a=t||e.default.auth()}catch(t){throw new ti("argument-error","Either an instance of firebase.auth.Auth must be passed as an argument to the firebase.auth.PhoneAuthProvider constructor, or the default firebase App instance must be initialized via firebase.initializeApp().")}Br(this,{providerId:"phone",isOAuthProvider:!1})}function _o(t,e){if(!t)throw new ti("missing-verification-id");if(!e)throw new ti("missing-verification-code");return new vo({Va:t,Ua:e})}function Eo(t){if(t.temporaryProof&&t.phoneNumber)return new vo({Ha:t.temporaryProof,ba:t.phoneNumber});var e=t&&t.providerId;if(!e||"password"===e)return null;var n=t&&t.oauthAccessToken,r=t&&t.oauthTokenSecret,i=t&&t.nonce,o=t&&t.oauthIdToken,a=t&&t.pendingToken;try{switch(e){case"google.com":return co(o,n);case"facebook.com":return oo(n);case"github.com":return so(n);case"twitter.com":return lo(n,r);default:return n||r||o||a?a?0==e.indexOf("saml.")?new Yi(e,a):new $i(e,{pendingToken:a,idToken:t.oauthIdToken,accessToken:t.oauthAccessToken},e):new ro(e).credential({idToken:o,accessToken:n,rawNonce:i}):null}}catch(t){return null}}function So(t){if(!t.isOAuthProvider)throw new ti("invalid-oauth-provider")}function Io(t,e,n,r,i,o,a){if(this.c=t,this.b=e||null,this.g=n||null,this.f=r||null,this.i=o||null,this.h=a||null,this.a=i||null,!this.g&&!this.a)throw new ti("invalid-auth-event");if(this.g&&this.a)throw new ti("invalid-auth-event");if(this.g&&!this.f)throw new ti("invalid-auth-event")}function Co(t){return(t=t||{}).type?new Io(t.type,t.eventId,t.urlResponse,t.sessionId,t.error&&ei(t.error),t.postBody,t.tenantId):null}function No(){this.b=null,this.a=[]}N(Vi,qi),N(Bi,Vi),N(Wi,Vi),N(Ki,Vi),N(Qi,Vi),Yi.prototype.na=function(t){return ts(t,Xi(this))},Yi.prototype.b=function(t,e){var n=Xi(this);return n.idToken=e,es(t,n)},Yi.prototype.f=function(t,e){return zi(ns(t,Xi(this)),e)},Yi.prototype.A=function(){return{providerId:this.providerId,signInMethod:this.signInMethod,pendingToken:this.a}},$i.prototype.na=function(t){return ts(t,Zi(this))},$i.prototype.b=function(t,e){var n=Zi(this);return n.idToken=e,es(t,n)},$i.prototype.f=function(t,e){return zi(ns(t,Zi(this)),e)},$i.prototype.A=function(){var t={providerId:this.providerId,signInMethod:this.signInMethod};return this.idToken&&(t.oauthIdToken=this.idToken),this.accessToken&&(t.oauthAccessToken=this.accessToken),this.secret&&(t.oauthTokenSecret=this.secret),this.nonce&&(t.nonce=this.nonce),this.a&&(t.pendingToken=this.a),t},eo.prototype.Ga=function(t){return this.zb=X(t),this},N(no,eo),N(ro,eo),ro.prototype.ya=function(t){return W(this.a,t)||this.a.push(t),this},ro.prototype.Hb=function(){return H(this.a)},ro.prototype.credential=function(t,e){var n;if(!(n=b(t)?{idToken:t.idToken||null,accessToken:t.accessToken||null,nonce:t.rawNonce||null}:{idToken:t||null,accessToken:e||null}).idToken&&!n.accessToken)throw new ti("argument-error","credential failed: must provide the ID token and/or the access token.");return new $i(this.providerId,n,this.providerId)},N(io,ro),Vr(io,"PROVIDER_ID","facebook.com"),Vr(io,"FACEBOOK_SIGN_IN_METHOD","facebook.com"),N(ao,ro),Vr(ao,"PROVIDER_ID","github.com"),Vr(ao,"GITHUB_SIGN_IN_METHOD","github.com"),N(uo,ro),Vr(uo,"PROVIDER_ID","google.com"),Vr(uo,"GOOGLE_SIGN_IN_METHOD","google.com"),N(ho,eo),Vr(ho,"PROVIDER_ID","twitter.com"),Vr(ho,"TWITTER_SIGN_IN_METHOD","twitter.com"),fo.prototype.na=function(t){return this.signInMethod==mo.EMAIL_LINK_SIGN_IN_METHOD?ks(t,hs,{email:this.a,oobCode:this.c}):ks(t,Ns,{email:this.a,password:this.c})},fo.prototype.b=function(t,e){return this.signInMethod==mo.EMAIL_LINK_SIGN_IN_METHOD?ks(t,ls,{idToken:e,email:this.a,oobCode:this.c}):ks(t,Ts,{idToken:e,email:this.a,password:this.c})},fo.prototype.f=function(t,e){return zi(this.na(t),e)},fo.prototype.A=function(){return{email:this.a,password:this.c,signInMethod:this.signInMethod}},Br(mo,{PROVIDER_ID:"password"}),Br(mo,{EMAIL_LINK_SIGN_IN_METHOD:"emailLink"}),Br(mo,{EMAIL_PASSWORD_SIGN_IN_METHOD:"password"}),vo.prototype.na=function(t){return t.Wa(wo(this))},vo.prototype.b=function(t,e){var n=wo(this);return n.idToken=e,ks(t,As,n)},vo.prototype.f=function(t,e){var n=wo(this);return n.operation="REAUTH",zi(t=ks(t,Os,n),e)},vo.prototype.A=function(){var t={providerId:"phone"};return this.a.Va&&(t.verificationId=this.a.Va),this.a.Ua&&(t.verificationCode=this.a.Ua),this.a.Ha&&(t.temporaryProof=this.a.Ha),this.a.ba&&(t.phoneNumber=this.a.ba),t},To.prototype.Wa=function(t,e){var n=this.a.b;return Zt(e.verify()).then((function(r){if(!c(r))throw new ti("argument-error","An implementation of firebase.auth.ApplicationVerifier.prototype.verify() must return a firebase.Promise that resolves with a string.");switch(e.type){case"recaptcha":return function(t,e){return ks(t,bs,e)}(n,{phoneNumber:t,recaptchaToken:r}).then((function(t){return"function"==typeof e.reset&&e.reset(),t}),(function(t){throw"function"==typeof e.reset&&e.reset(),t}));default:throw new ti("argument-error",'Only firebase.auth.ApplicationVerifiers with type="recaptcha" are currently supported.')}}))},Br(To,{PROVIDER_ID:"phone"}),Br(To,{PHONE_SIGN_IN_METHOD:"phone"}),Io.prototype.getUid=function(){var t=[];return t.push(this.c),this.b&&t.push(this.b),this.f&&t.push(this.f),this.h&&t.push(this.h),t.join("-")},Io.prototype.R=function(){return this.h},Io.prototype.A=function(){return{type:this.c,eventId:this.b,urlResponse:this.g,sessionId:this.f,postBody:this.i,tenantId:this.h,error:this.a&&this.a.A()}};var Do,Ao=null;function Oo(t){var e="unauthorized-domain",n=void 0,r=Cn(t);t=r.b,"chrome-extension"==(r=r.f)?n=jt("This chrome extension ID (chrome-extension://%s) is not authorized to run this operation. Add it to the OAuth redirect domains list in the Firebase console -> Auth section -> Sign in method tab.",t):"http"==r||"https"==r?n=jt("This domain (%s) is not authorized to run this operation. Add it to the OAuth redirect domains list in the Firebase console -> Auth section -> Sign in method tab.",t):e="operation-not-supported-in-this-environment",ti.call(this,e,n)}function ko(t,e,n){ti.call(this,t,n),(t=e||{}).Ab&&Vr(this,"email",t.Ab),t.ba&&Vr(this,"phoneNumber",t.ba),t.credential&&Vr(this,"credential",t.credential),t.Qb&&Vr(this,"tenantId",t.Qb)}function Ro(t){if(t.code){var e=t.code||"";0==e.indexOf(ni)&&(e=e.substring(ni.length));var n={credential:Eo(t),Qb:t.tenantId};if(t.email)n.Ab=t.email;else if(t.phoneNumber)n.ba=t.phoneNumber;else if(!n.credential)return new ti(e,t.message||void 0);return new ko(e,n,t.message)}return null}function Po(){}function Mo(t){return t.c||(t.c=t.b())}function Lo(){}function xo(t){if(!t.f&&"undefined"==typeof XMLHttpRequest&&"undefined"!=typeof ActiveXObject){for(var e=["MSXML2.XMLHTTP.6.0","MSXML2.XMLHTTP.3.0","MSXML2.XMLHTTP","Microsoft.XMLHTTP"],n=0;n<e.length;n++){var r=e[n];try{return new ActiveXObject(r),t.f=r}catch(t){}}throw Error("Could not create ActiveXObject. ActiveX might be disabled, or MSXML might not be installed")}return t.f}function Fo(){}function jo(){this.a=new XDomainRequest,this.readyState=0,this.onreadystatechange=null,this.responseType=this.responseText=this.response="",this.status=-1,this.statusText="",this.a.onload=S(this.fc,this),this.a.onerror=S(this.Ib,this),this.a.onprogress=S(this.gc,this),this.a.ontimeout=S(this.kc,this)}function Uo(t,e){t.readyState=e,t.onreadystatechange&&t.onreadystatechange()}function qo(t,e,n){this.reset(t,e,n,void 0,void 0)}N(Oo,ti),N(ko,ti),ko.prototype.A=function(){var t={code:this.code,message:this.message};this.email&&(t.email=this.email),this.phoneNumber&&(t.phoneNumber=this.phoneNumber),this.tenantId&&(t.tenantId=this.tenantId);var e=this.credential&&this.credential.A();return e&&$(t,e),t},ko.prototype.toJSON=function(){return this.A()},Po.prototype.c=null,N(Lo,Po),Lo.prototype.a=function(){var t=xo(this);return t?new ActiveXObject(t):new XMLHttpRequest},Lo.prototype.b=function(){var t={};return xo(this)&&(t[0]=!0,t[1]=!0),t},Do=new Lo,N(Fo,Po),Fo.prototype.a=function(){var t=new XMLHttpRequest;if("withCredentials"in t)return t;if("undefined"!=typeof XDomainRequest)return new jo;throw Error("Unsupported browser")},Fo.prototype.b=function(){return{}},(n=jo.prototype).open=function(t,e,n){if(null!=n&&!n)throw Error("Only async requests are supported.");this.a.open(t,e)},n.send=function(t){if(t){if("string"!=typeof t)throw Error("Only string data is supported");this.a.send(t)}else this.a.send()},n.abort=function(){this.a.abort()},n.setRequestHeader=function(){},n.getResponseHeader=function(t){return"content-type"==t.toLowerCase()?this.a.contentType:""},n.fc=function(){this.status=200,this.response=this.responseText=this.a.responseText,Uo(this,4)},n.Ib=function(){this.status=500,this.response=this.responseText="",Uo(this,4)},n.kc=function(){this.Ib()},n.gc=function(){this.status=200,Uo(this,1)},n.getAllResponseHeaders=function(){return"content-type: "+this.a.contentType},qo.prototype.a=null;function Vo(t){this.f=t,this.b=this.c=this.a=null}function Bo(t,e){this.name=t,this.value=e}qo.prototype.reset=function(t,e,n,r,i){"number"==typeof i||0,r||C(),delete this.a},Bo.prototype.toString=function(){return this.name};var Wo=new Bo("SEVERE",1e3),Ko=new Bo("WARNING",900),Qo=new Bo("CONFIG",700),Go=new Bo("FINE",500);Vo.prototype.log=function(t,e,n){if(t.value>=function t(e){return e.c?e.c:e.a?t(e.a):(k("Root logger has no level set."),null)}(this).value)for(v(e)&&(e=e()),t=new qo(t,String(e),this.f),n&&(t.a=n),n=this;n;)n=n.a};var Ho={},zo=null;function Yo(t){var e;if(zo||(zo=new Vo(""),Ho[""]=zo,zo.c=Qo),!(e=Ho[t])){e=new Vo(t);var n=t.lastIndexOf("."),r=t.substr(n+1);(n=Yo(t.substr(0,n))).b||(n.b={}),n.b[r]=e,e.a=n,Ho[t]=e}return e}function Xo(t,e){t&&t.log(Go,e,void 0)}function Jo(t){this.f=t}function $o(t){un.call(this),this.o=t,this.readyState=Zo,this.status=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.i=new Headers,this.b=null,this.m="GET",this.g="",this.a=!1,this.h=Yo("goog.net.FetchXmlHttp"),this.l=this.c=this.f=null}N(Jo,Po),Jo.prototype.a=function(){return new $o(this.f)},Jo.prototype.b=function(t){return function(){return t}}({}),N($o,un);var Zo=0;function ta(t){t.c.read().then(t.ec.bind(t)).catch(t.Oa.bind(t))}function ea(t,e){e&&t.f&&(t.status=t.f.status,t.statusText=t.f.statusText),t.readyState=4,t.f=null,t.c=null,t.l=null,na(t)}function na(t){t.onreadystatechange&&t.onreadystatechange.call(t)}function ra(t){un.call(this),this.headers=new yn,this.B=t||null,this.c=!1,this.w=this.a=null,this.h=this.O=this.l="",this.f=this.J=this.i=this.I=!1,this.g=0,this.o=null,this.m=ia,this.v=this.P=!1}(n=$o.prototype).open=function(t,e){if(this.readyState!=Zo)throw this.abort(),Error("Error reopening a connection");this.m=t,this.g=e,this.readyState=1,na(this)},n.send=function(t){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.a=!0;var e={headers:this.i,method:this.m,credentials:void 0,cache:void 0};t&&(e.body=t),this.o.fetch(new Request(this.g,e)).then(this.jc.bind(this),this.Oa.bind(this))},n.abort=function(){this.response=this.responseText="",this.i=new Headers,this.status=0,this.c&&this.c.cancel("Request was aborted."),1<=this.readyState&&this.a&&4!=this.readyState&&(this.a=!1,ea(this,!1)),this.readyState=Zo},n.jc=function(t){this.a&&(this.f=t,this.b||(this.b=t.headers,this.readyState=2,na(this)),this.a&&(this.readyState=3,na(this),this.a&&("arraybuffer"===this.responseType?t.arrayBuffer().then(this.hc.bind(this),this.Oa.bind(this)):void 0!==u.ReadableStream&&"body"in t?(this.response=this.responseText="",this.c=t.body.getReader(),this.l=new TextDecoder,ta(this)):t.text().then(this.ic.bind(this),this.Oa.bind(this)))))},n.ec=function(t){if(this.a){var e=this.l.decode(t.value?t.value:new Uint8Array(0),{stream:!t.done});e&&(this.response=this.responseText+=e),t.done?ea(this,!0):na(this),3==this.readyState&&ta(this)}},n.ic=function(t){this.a&&(this.response=this.responseText=t,ea(this,!0))},n.hc=function(t){this.a&&(this.response=t,ea(this,!0))},n.Oa=function(t){var e=this.h;e&&e.log(Ko,"Failed to fetch url "+this.g,t instanceof Error?t:Error(t)),this.a&&ea(this,!0)},n.setRequestHeader=function(t,e){this.i.append(t,e)},n.getResponseHeader=function(t){return this.b?this.b.get(t.toLowerCase())||"":((t=this.h)&&t.log(Ko,"Attempting to get response header but no headers have been received for url: "+this.g,void 0),"")},n.getAllResponseHeaders=function(){if(!this.b){var t=this.h;return t&&t.log(Ko,"Attempting to get all response headers but no headers have been received for url: "+this.g,void 0),""}t=[];for(var e=this.b.entries(),n=e.next();!n.done;)n=n.value,t.push(n[0]+": "+n[1]),n=e.next();return t.join("\r\n")},N(ra,un);var ia="";ra.prototype.b=Yo("goog.net.XhrIo");var oa=/^https?$/i,aa=["POST","PUT"];function sa(t,e,n,r,i){if(t.a)throw Error("[goog.net.XhrIo] Object is active with another request="+t.l+"; newUri="+e);n=n?n.toUpperCase():"GET",t.l=e,t.h="",t.O=n,t.I=!1,t.c=!0,t.a=t.B?t.B.a():Do.a(),t.w=t.B?Mo(t.B):Mo(Do),t.a.onreadystatechange=S(t.Lb,t);try{Xo(t.b,ya(t,"Opening Xhr")),t.J=!0,t.a.open(n,String(e),!0),t.J=!1}catch(e){return Xo(t.b,ya(t,"Error opening Xhr: "+e.message)),void ca(t,e)}e=r||"";var o=new yn(t.headers);i&&function(t,e){if(t.forEach&&"function"==typeof t.forEach)t.forEach(e,void 0);else if(g(t)||c(t))q(t,e,void 0);else for(var n=mn(t),r=dn(t),i=r.length,o=0;o<i;o++)e.call(void 0,r[o],n&&n[o],t)}(i,(function(t,e){o.set(e,t)})),i=function(t){t:{for(var e=ua,n=t.length,r=c(t)?t.split(""):t,i=0;i<n;i++)if(i in r&&e.call(void 0,r[i],i,t)){e=i;break t}e=-1}return 0>e?null:c(t)?t.charAt(e):t[e]}(o.X()),r=u.FormData&&e instanceof u.FormData,!W(aa,n)||i||r||o.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8"),o.forEach((function(t,e){this.a.setRequestHeader(e,t)}),t),t.m&&(t.a.responseType=t.m),"withCredentials"in t.a&&t.a.withCredentials!==t.P&&(t.a.withCredentials=t.P);try{pa(t),0<t.g&&(t.v=function(t){return Te&&Re(9)&&"number"==typeof t.timeout&&void 0!==t.ontimeout}(t.a),Xo(t.b,ya(t,"Will abort after "+t.g+"ms if incomplete, xhr2 "+t.v)),t.v?(t.a.timeout=t.g,t.a.ontimeout=S(t.Ia,t)):t.o=fn(t.Ia,t.g,t)),Xo(t.b,ya(t,"Sending request")),t.i=!0,t.a.send(e),t.i=!1}catch(e){Xo(t.b,ya(t,"Send error: "+e.message)),ca(t,e)}}function ua(t){return"content-type"==t.toLowerCase()}function ca(t,e){t.c=!1,t.a&&(t.f=!0,t.a.abort(),t.f=!1),t.h=e,ha(t),fa(t)}function ha(t){t.I||(t.I=!0,t.dispatchEvent("complete"),t.dispatchEvent("error"))}function la(t){if(t.c&&void 0!==s)if(t.w[1]&&4==da(t)&&2==ma(t))Xo(t.b,ya(t,"Local request error detected and ignored"));else if(t.i&&4==da(t))fn(t.Lb,0,t);else if(t.dispatchEvent("readystatechange"),4==da(t)){Xo(t.b,ya(t,"Request complete")),t.c=!1;try{var e,n=ma(t);t:switch(n){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var r=!0;break t;default:r=!1}if(!(e=r)){var i;if(i=0===n){var o=String(t.l).match(bn)[1]||null;if(!o&&u.self&&u.self.location){var a=u.self.location.protocol;o=a.substr(0,a.length-1)}i=!oa.test(o?o.toLowerCase():"")}e=i}if(e)t.dispatchEvent("complete"),t.dispatchEvent("success");else{try{var c=2<da(t)?t.a.statusText:""}catch(e){Xo(t.b,"Can not get status: "+e.message),c=""}t.h=c+" ["+ma(t)+"]",ha(t)}}finally{fa(t)}}}function fa(t,e){if(t.a){pa(t);var n=t.a,r=t.w[0]?p:null;t.a=null,t.w=null,e||t.dispatchEvent("ready");try{n.onreadystatechange=r}catch(e){(t=t.b)&&t.log(Wo,"Problem encountered resetting onreadystatechange: "+e.message,void 0)}}}function pa(t){t.a&&t.v&&(t.a.ontimeout=null),t.o&&(u.clearTimeout(t.o),t.o=null)}function da(t){return t.a?t.a.readyState:0}function ma(t){try{return 2<da(t)?t.a.status:-1}catch(t){return-1}}function ya(t,e){return e+" ["+t.O+" "+t.l+" "+ma(t)+"]"}function ga(t){var e=Da;this.g=[],this.v=e,this.o=t||null,this.f=this.a=!1,this.c=void 0,this.u=this.w=this.i=!1,this.h=0,this.b=null,this.l=0}function va(t,e,n){t.a=!0,t.c=n,t.f=!e,_a(t)}function ba(t){if(t.a){if(!t.u)throw new Ea(t);t.u=!1}}function wa(t,e,n,r){t.g.push([e,n,r]),t.a&&_a(t)}function Ta(t){return B(t.g,(function(t){return v(t[1])}))}function _a(t){if(t.h&&t.a&&Ta(t)){var e=t.h,n=Ca[e];n&&(u.clearTimeout(n.a),delete Ca[e]),t.h=0}t.b&&(t.b.l--,delete t.b),e=t.c;for(var r=n=!1;t.g.length&&!t.i;){var i=t.g.shift(),o=i[0],a=i[1];if(i=i[2],o=t.f?a:o)try{var s=o.call(i||t.o,e);void 0!==s&&(t.f=t.f&&(s==e||s instanceof Error),t.c=e=s),(D(e)||"function"==typeof u.Promise&&e instanceof u.Promise)&&(r=!0,t.i=!0)}catch(r){e=r,t.f=!0,Ta(t)||(n=!0)}}t.c=e,r&&(s=S(t.m,t,!0),r=S(t.m,t,!1),e instanceof ga?(wa(e,s,r),e.w=!0):e.then(s,r)),n&&(e=new Ia(e),Ca[e.a]=e,t.h=e.a)}function Ea(){A.call(this)}function Sa(){A.call(this)}function Ia(t){this.a=u.setTimeout(S(this.c,this),0),this.b=t}(n=ra.prototype).Ia=function(){void 0!==s&&this.a&&(this.h="Timed out after "+this.g+"ms, aborting",Xo(this.b,ya(this,this.h)),this.dispatchEvent("timeout"),this.abort(8))},n.abort=function(){this.a&&this.c&&(Xo(this.b,ya(this,"Aborting")),this.c=!1,this.f=!0,this.a.abort(),this.f=!1,this.dispatchEvent("complete"),this.dispatchEvent("abort"),fa(this))},n.za=function(){this.a&&(this.c&&(this.c=!1,this.f=!0,this.a.abort(),this.f=!1),fa(this,!0)),ra.qb.za.call(this)},n.Lb=function(){this.va||(this.J||this.i||this.f?la(this):this.yc())},n.yc=function(){la(this)},n.getResponse=function(){try{if(!this.a)return null;if("response"in this.a)return this.a.response;switch(this.m){case ia:case"text":return this.a.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in this.a)return this.a.mozResponseArrayBuffer}var t=this.b;return t&&t.log(Wo,"Response type "+this.m+" is not supported on this browser",void 0),null}catch(t){return Xo(this.b,"Can not get response: "+t.message),null}},ga.prototype.cancel=function(t){if(this.a)this.c instanceof ga&&this.c.cancel();else{if(this.b){var e=this.b;delete this.b,t?e.cancel(t):(e.l--,0>=e.l&&e.cancel())}this.v?this.v.call(this.o,this):this.u=!0,this.a||(t=new Sa(this),ba(this),va(this,!1,t))}},ga.prototype.m=function(t,e){this.i=!1,va(this,t,e)},ga.prototype.then=function(t,e,n){var r,i,o=new Gt((function(t,e){r=t,i=e}));return wa(this,r,(function(t){t instanceof Sa?o.cancel():i(t)})),o.then(t,e,n)},ga.prototype.$goog_Thenable=!0,N(Ea,A),Ea.prototype.message="Deferred has already fired",Ea.prototype.name="AlreadyCalledError",N(Sa,A),Sa.prototype.message="Deferred was canceled",Sa.prototype.name="CanceledError",Ia.prototype.c=function(){throw delete Ca[this.a],this.b};var Ca={};function Na(t){var e={},n=e.document||document,r=ot(t).toString(),i=document.createElement("SCRIPT"),o={Nb:i,Ia:void 0},a=new ga(o),s=null,c=null!=e.timeout?e.timeout:5e3;return 0<c&&(s=window.setTimeout((function(){Aa(i,!0);var t=new Ra(ka,"Timeout reached for loading script "+r);ba(a),va(a,!1,t)}),c),o.Ia=s),i.onload=i.onreadystatechange=function(){i.readyState&&"loaded"!=i.readyState&&"complete"!=i.readyState||(Aa(i,e.hd||!1,s),ba(a),va(a,!0,null))},i.onerror=function(){Aa(i,!0,s);var t=new Ra(Oa,"Error while loading script "+r);ba(a),va(a,!1,t)},$(o=e.attributes||{},{type:"text/javascript",charset:"UTF-8"}),Gn(i,o),function(t,e){j(t,"HTMLScriptElement"),t.src=ot(e),null===f&&(f=(e=(e=u.document).querySelector&&e.querySelector("script[nonce]"))&&(e=e.nonce||e.getAttribute("nonce"))&&l.test(e)?e:""),(e=f)&&t.setAttribute("nonce",e)}(i,t),function(t){var e;return(e=(t||document).getElementsByTagName("HEAD"))&&0!=e.length?e[0]:t.documentElement}(n).appendChild(i),a}function Da(){if(this&&this.Nb){var t=this.Nb;t&&"SCRIPT"==t.tagName&&Aa(t,!0,this.Ia)}}function Aa(t,e,n){null!=n&&u.clearTimeout(n),t.onload=p,t.onerror=p,t.onreadystatechange=p,e&&window.setTimeout((function(){t&&t.parentNode&&t.parentNode.removeChild(t)}),0)}var Oa=0,ka=1;function Ra(t,e){var n="Jsloader error (code #"+t+")";e&&(n+=": "+e),A.call(this,n),this.code=t}function Pa(t){this.f=t}function Ma(t,n,r){if(this.c=t,t=n||{},this.l=t.secureTokenEndpoint||"https://securetoken.googleapis.com/v1/token",this.u=t.secureTokenTimeout||Fa,this.g=X(t.secureTokenHeaders||ja),this.h=t.firebaseEndpoint||"https://www.googleapis.com/identitytoolkit/v3/relyingparty/",this.i=t.firebaseTimeout||Ua,this.a=X(t.firebaseHeaders||qa),r&&(this.a["X-Client-Version"]=r,this.g["X-Client-Version"]=r),r="Node"==pr(),!(r=u.XMLHttpRequest||r&&e.default.INTERNAL.node&&e.default.INTERNAL.node.XMLHttpRequest)&&!fr())throw new ti("internal-error","The XMLHttpRequest compatibility library was not found.");this.f=void 0,fr()?this.f=new Jo(self):dr()?this.f=new Pa(r):this.f=new Fo,this.b=null}N(Ra,A),N(Pa,Po),Pa.prototype.a=function(){return new this.f},Pa.prototype.b=function(){return{}};var La,xa="idToken",Fa=new Pr(3e4,6e4),ja={"Content-Type":"application/x-www-form-urlencoded"},Ua=new Pr(3e4,6e4),qa={"Content-Type":"application/json"};function Va(t,e){e?t.a["X-Firebase-Locale"]=e:delete t.a["X-Firebase-Locale"]}function Ba(t,e){e?(t.a["X-Client-Version"]=e,t.g["X-Client-Version"]=e):(delete t.a["X-Client-Version"],delete t.g["X-Client-Version"])}function Wa(t,e,n,r,i,o,a){(function(){var t=wr();return!((t=gr(t)!=yr?null:(t=t.match(/\sChrome\/(\d+)/i))&&2==t.length?parseInt(t[1],10):null)&&30>t)&&(!Te||!Oe||9<Oe)})()||fr()?t=S(t.o,t):(La||(La=new Gt((function(t,e){!function(t,e){if(((window.gapi||{}).client||{}).request)t();else{u[Qa]=function(){((window.gapi||{}).client||{}).request?t():e(Error("CORS_UNSUPPORTED"))},function(t,e){wa(t,null,e,void 0)}(Na(at(Ka,{onload:Qa})),(function(){e(Error("CORS_UNSUPPORTED"))}))}}(t,e)}))),t=S(t.m,t)),t(e,n,r,i,o,a)}Ma.prototype.R=function(){return this.b},Ma.prototype.o=function(t,e,n,r,i,o){if(fr()&&(void 0===u.fetch||void 0===u.Headers||void 0===u.Request))throw new ti("operation-not-supported-in-this-environment","fetch, Headers and Request native APIs or equivalent Polyfills must be available to support HTTP requests from a Worker environment.");var a=new ra(this.f);if(o){a.g=Math.max(0,o);var s=setTimeout((function(){a.dispatchEvent("timeout")}),o)}cn(a,"complete",(function(){s&&clearTimeout(s);var t=null;try{t=JSON.parse(function(t){try{return t.a?t.a.responseText:""}catch(e){return Xo(t.b,"Can not get responseText: "+e.message),""}}(this))||null}catch(e){t=null}e&&e(t)})),hn(a,"ready",(function(){s&&clearTimeout(s),ye(this)})),hn(a,"timeout",(function(){s&&clearTimeout(s),ye(this),e&&e(null)})),sa(a,t,n,r,i)};var Ka=new Z(nt,"https://apis.google.com/js/client.js?onload=%{onload}"),Qa="__fcb"+Math.floor(1e6*Math.random()).toString();function Ga(t){if(!c(t=t.email)||!ur.test(t))throw new ti("invalid-email")}function Ha(t){"email"in t&&Ga(t)}function za(t){if(!t[xa])throw new ti("internal-error")}function Ya(t){if(t.phoneNumber||t.temporaryProof){if(!t.phoneNumber||!t.temporaryProof)throw new ti("internal-error")}else{if(!t.sessionInfo)throw new ti("missing-verification-id");if(!t.code)throw new ti("missing-verification-code")}}Ma.prototype.m=function(t,e,n,r,i){var o=this;La.then((function(){window.gapi.client.setApiKey(o.c);var a=window.gapi.auth.getToken();window.gapi.auth.setToken(null),window.gapi.client.request({path:t,method:n,body:r,headers:i,authType:"none",callback:function(t){window.gapi.auth.setToken(a),e&&e(t)}})})).s((function(t){e&&e({error:{message:t&&t.message||"CORS_UNSUPPORTED"}})}))},Ma.prototype.ob=function(){return ks(this,_s,{})},Ma.prototype.rb=function(t,e){return ks(this,ws,{idToken:t,email:e})},Ma.prototype.sb=function(t,e){return ks(this,Ts,{idToken:t,password:e})};var Xa={displayName:"DISPLAY_NAME",photoUrl:"PHOTO_URL"};function Ja(t){if(!t.requestUri||!t.sessionId&&!t.postBody&&!t.pendingToken)throw new ti("internal-error")}function $a(t,e){return e.oauthIdToken&&e.providerId&&0==e.providerId.indexOf("oidc.")&&!e.pendingToken&&(t.sessionId?e.nonce=t.sessionId:t.postBody&&(qn(t=new xn(t.postBody),"nonce")&&(e.nonce=t.get("nonce")))),e}function Za(t){var e=null;if(t.needConfirmation?(t.code="account-exists-with-different-credential",e=Ro(t)):"FEDERATED_USER_ID_ALREADY_LINKED"==t.errorMessage?(t.code="credential-already-in-use",e=Ro(t)):"EMAIL_EXISTS"==t.errorMessage?(t.code="email-already-in-use",e=Ro(t)):t.errorMessage&&(e=Rs(t.errorMessage)),e)throw e;if(!t[xa])throw new ti("internal-error")}function ts(t,e){return e.returnIdpCredential=!0,ks(t,Es,e)}function es(t,e){return e.returnIdpCredential=!0,ks(t,Is,e)}function ns(t,e){return e.returnIdpCredential=!0,e.autoCreate=!1,ks(t,Ss,e)}function rs(t){if(!t.oobCode)throw new ti("invalid-action-code")}(n=Ma.prototype).tb=function(t,e){var n={idToken:t},r=[];return z(Xa,(function(t,i){var o=e[i];null===o?r.push(t):i in e&&(n[i]=o)})),r.length&&(n.deleteAttribute=r),ks(this,ws,n)},n.kb=function(t,e){return $(t={requestType:"PASSWORD_RESET",email:t},e),ks(this,ms,t)},n.lb=function(t,e){return $(t={requestType:"EMAIL_SIGNIN",email:t},e),ks(this,ps,t)},n.jb=function(t,e){return $(t={requestType:"VERIFY_EMAIL",idToken:t},e),ks(this,ds,t)},n.Wa=function(t){return ks(this,Ds,t)},n.ab=function(t,e){return ks(this,vs,{oobCode:t,newPassword:e})},n.Ma=function(t){return ks(this,os,{oobCode:t})},n.Ya=function(t){return ks(this,is,{oobCode:t})};var is={endpoint:"setAccountInfo",D:rs,fa:"email",F:!0},os={endpoint:"resetPassword",D:rs,K:function(t){var e=t.requestType;if(!e||!t.email&&"EMAIL_SIGNIN"!=e)throw new ti("internal-error")},F:!0},as={endpoint:"signupNewUser",D:function(t){if(Ga(t),!t.password)throw new ti("weak-password")},K:za,T:!0,F:!0},ss={endpoint:"createAuthUri",F:!0},us={endpoint:"deleteAccount",V:["idToken"]},cs={endpoint:"setAccountInfo",V:["idToken","deleteProvider"],D:function(t){if(!y(t.deleteProvider))throw new ti("internal-error")}},hs={endpoint:"emailLinkSignin",V:["email","oobCode"],D:Ga,K:za,T:!0,F:!0},ls={endpoint:"emailLinkSignin",V:["idToken","email","oobCode"],D:Ga,K:za,T:!0},fs={endpoint:"getAccountInfo"},ps={endpoint:"getOobConfirmationCode",V:["requestType"],D:function(t){if("EMAIL_SIGNIN"!=t.requestType)throw new ti("internal-error");Ga(t)},fa:"email",F:!0},ds={endpoint:"getOobConfirmationCode",V:["idToken","requestType"],D:function(t){if("VERIFY_EMAIL"!=t.requestType)throw new ti("internal-error")},fa:"email",F:!0},ms={endpoint:"getOobConfirmationCode",V:["requestType"],D:function(t){if("PASSWORD_RESET"!=t.requestType)throw new ti("internal-error");Ga(t)},fa:"email",F:!0},ys={wb:!0,endpoint:"getProjectConfig",Kb:"GET"},gs={wb:!0,endpoint:"getRecaptchaParam",Kb:"GET",K:function(t){if(!t.recaptchaSiteKey)throw new ti("internal-error")}},vs={endpoint:"resetPassword",D:rs,fa:"email",F:!0},bs={endpoint:"sendVerificationCode",V:["phoneNumber","recaptchaToken"],fa:"sessionInfo",F:!0},ws={endpoint:"setAccountInfo",V:["idToken"],D:Ha,T:!0},Ts={endpoint:"setAccountInfo",V:["idToken"],D:function(t){if(Ha(t),!t.password)throw new ti("weak-password")},K:za,T:!0},_s={endpoint:"signupNewUser",K:za,T:!0,F:!0},Es={endpoint:"verifyAssertion",D:Ja,Ra:$a,K:Za,T:!0,F:!0},Ss={endpoint:"verifyAssertion",D:Ja,Ra:$a,K:function(t){if(t.errorMessage&&"USER_NOT_FOUND"==t.errorMessage)throw new ti("user-not-found");if(t.errorMessage)throw Rs(t.errorMessage);if(!t[xa])throw new ti("internal-error")},T:!0,F:!0},Is={endpoint:"verifyAssertion",D:function(t){if(Ja(t),!t.idToken)throw new ti("internal-error")},Ra:$a,K:Za,T:!0},Cs={endpoint:"verifyCustomToken",D:function(t){if(!t.token)throw new ti("invalid-custom-token")},K:za,T:!0,F:!0},Ns={endpoint:"verifyPassword",D:function(t){if(Ga(t),!t.password)throw new ti("wrong-password")},K:za,T:!0,F:!0},Ds={endpoint:"verifyPhoneNumber",D:Ya,K:za,F:!0},As={endpoint:"verifyPhoneNumber",D:function(t){if(!t.idToken)throw new ti("internal-error");Ya(t)},K:function(t){if(t.temporaryProof)throw t.code="credential-already-in-use",Ro(t);za(t)}},Os={Yb:{USER_NOT_FOUND:"user-not-found"},endpoint:"verifyPhoneNumber",D:Ya,K:za,F:!0};function ks(t,e,n){if(!function(t,e){if(!e||!e.length)return!0;if(!t)return!1;for(var n=0;n<e.length;n++){var r=t[e[n]];if(null==r||""===r)return!1}return!0}(n,e.V))return te(new ti("internal-error"));var r,i=e.Kb||"POST";return Zt(n).then(e.D).then((function(){return e.T&&(n.returnSecureToken=!0),e.F&&t.b&&void 0===n.tenantId&&(n.tenantId=t.b),function(t,e,n,r,i,o){var a=Cn(t.h+e);Sn(a,"key",t.c),o&&Sn(a,"cb",C().toString());var s="GET"==n;if(s)for(var u in r)r.hasOwnProperty(u)&&Sn(a,u,r[u]);return new Gt((function(e,o){Wa(t,a.toString(),(function(t){t?t.error?o(Ps(t,i||{})):e(t):o(new ti("network-request-failed"))}),n,s?void 0:Xn(Dr(r)),t.a,t.i.get())}))}(t,e.endpoint,i,n,e.Yb,e.wb||!1)})).then((function(t){return r=t,e.Ra?e.Ra(n,r):r})).then(e.K).then((function(){if(!e.fa)return r;if(!(e.fa in r))throw new ti("internal-error");return r[e.fa]}))}function Rs(t){return Ps({error:{errors:[{message:t}],code:400,message:t}})}function Ps(t,e){var n=(t.error&&t.error.errors&&t.error.errors[0]||{}).reason||"",r={keyInvalid:"invalid-api-key",ipRefererBlocked:"app-not-authorized"};if(n=r[n]?new ti(r[n]):null)return n;for(var i in n=t.error&&t.error.message||"",$(r={INVALID_CUSTOM_TOKEN:"invalid-custom-token",CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_EMAIL:"invalid-email",INVALID_PASSWORD:"wrong-password",USER_DISABLED:"user-disabled",MISSING_PASSWORD:"internal-error",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_OR_INVALID_NONCE:"missing-or-invalid-nonce",INVALID_MESSAGE_PAYLOAD:"invalid-message-payload",INVALID_RECIPIENT_EMAIL:"invalid-recipient-email",INVALID_SENDER:"invalid-sender",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",INVALID_PROVIDER_ID:"invalid-provider-id",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",CORS_UNSUPPORTED:"cors-unsupported",DYNAMIC_LINK_NOT_ACTIVATED:"dynamic-link-not-activated",INVALID_APP_ID:"invalid-app-id",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",WEAK_PASSWORD:"weak-password",OPERATION_NOT_ALLOWED:"operation-not-allowed",USER_CANCELLED:"user-cancelled",CAPTCHA_CHECK_FAILED:"captcha-check-failed",INVALID_APP_CREDENTIAL:"invalid-app-credential",INVALID_CODE:"invalid-verification-code",INVALID_PHONE_NUMBER:"invalid-phone-number",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_APP_CREDENTIAL:"missing-app-credential",MISSING_CODE:"missing-verification-code",MISSING_PHONE_NUMBER:"missing-phone-number",MISSING_SESSION_INFO:"missing-verification-id",QUOTA_EXCEEDED:"quota-exceeded",SESSION_EXPIRED:"code-expired",REJECTED_CREDENTIAL:"rejected-credential",INVALID_CONTINUE_URI:"invalid-continue-uri",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",MISSING_IOS_BUNDLE_ID:"missing-ios-bundle-id",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_DYNAMIC_LINK_DOMAIN:"invalid-dynamic-link-domain",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",INVALID_CERT_HASH:"invalid-cert-hash",UNSUPPORTED_TENANT_OPERATION:"unsupported-tenant-operation",INVALID_TENANT_ID:"invalid-tenant-id",TENANT_ID_MISMATCH:"tenant-id-mismatch",ADMIN_ONLY_OPERATION:"admin-restricted-operation"},e||{}),e=(e=n.match(/^[^\s]+\s*:\s*([\s\S]*)$/))&&1<e.length?e[1]:void 0,r)if(0===n.indexOf(i))return new ti(r[i],e);return!e&&t&&(e=Nr(t)),new ti("internal-error",e)}function Ms(t){this.b=t,this.a=null,this.gb=function(t){return(js||(js=new Gt((function(t,e){function n(){Rr(),Tr("gapi.load")("gapi.iframes",{callback:t,ontimeout:function(){Rr(),e(Error("Network Error"))},timeout:xs.get()})}if(Tr("gapi.iframes.Iframe"))t();else if(Tr("gapi.load"))n();else{var r="__iframefcb"+Math.floor(1e6*Math.random()).toString();u[r]=function(){Tr("gapi.load")?n():e(Error("Network Error"))},Zt(Na(r=at(Ls,{onload:r}))).s((function(){e(Error("Network Error"))}))}})).s((function(t){throw js=null,t})))).then((function(){return new Gt((function(e,n){Tr("gapi.iframes.getContext")().open({where:document.body,url:t.b,messageHandlersFilter:Tr("gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER"),attributes:{style:{position:"absolute",top:"-100px",width:"1px",height:"1px"}},dontclear:!0},(function(r){function i(){clearTimeout(o),e()}t.a=r,t.a.restyle({setHideOnLeave:!1});var o=setTimeout((function(){n(Error("Network Error"))}),Fs.get());r.ping(i).then(i,(function(){n(Error("Network Error"))}))}))}))}))}(this)}var Ls=new Z(nt,"https://apis.google.com/js/api.js?onload=%{onload}"),xs=new Pr(3e4,6e4),Fs=new Pr(5e3,15e3),js=null;function Us(t,e,n){this.i=t,this.g=e,this.h=n,this.f=null,this.a=Nn(this.i,"/__/auth/iframe"),Sn(this.a,"apiKey",this.g),Sn(this.a,"appName",this.h),this.b=null,this.c=[]}function qs(t,e,n,r,i){this.o=t,this.m=e,this.c=n,this.u=r,this.i=this.g=this.l=null,this.a=i,this.h=this.f=null}function Vs(t){try{return e.default.app(t).auth().Ca()}catch(t){return[]}}function Bs(t,e,n,r,i){this.u=t,this.f=e,this.b=n,this.c=r||null,this.h=i||null,this.m=this.o=this.v=null,this.g=[],this.l=this.a=null}function Ws(t){var e=nr();return function(t){return ks(t,ys,{}).then((function(t){return t.authorizedDomains||[]}))}(t).then((function(t){t:{var n=Cn(e),r=n.f;n=n.b;for(var i=0;i<t.length;i++){var o=t[i],a=n,s=r;if(0==o.indexOf("chrome-extension://")?a=Cn(o).b==a&&"chrome-extension"==s:"http"!=s&&"https"!=s?a=!1:sr.test(o)?a=a==o:(o=o.split(".").join("\\."),a=new RegExp("^(.+\\."+o+"|"+o+")$","i").test(a)),a){t=!0;break t}}t=!1}if(!t)throw new Oo(nr())}))}function Ks(t){return t.l?t.l:(t.l=cr().then((function(){if(!t.o){var e=t.c,n=t.h,r=Vs(t.b),i=new Us(t.u,t.f,t.b);i.f=e,i.b=n,i.c=H(r||[]),t.o=i.toString()}t.i=new Ms(t.o),function(t){if(!t.i)throw Error("IfcHandler must be initialized!");!function(t,e){t.gb.then((function(){t.a.register("authEvent",e,Tr("gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER"))}))}(t.i,(function(e){var n={};if(e&&e.authEvent){var r=!1;for(e=Co(e.authEvent),n=0;n<t.g.length;n++)r=t.g[n](e)||r;return(n={}).status=r?"ACK":"ERROR",Zt(n)}return n.status="ERROR",Zt(n)}))}(t)})),t.l)}function Qs(t){return t.m||(t.v=t.c?br(t.c,Vs(t.b)):null,t.m=new Ma(t.f,Ri(t.h),t.v)),t.m}function Gs(t,e,n,r,i,o,a,s,u,c,h){return(t=new qs(t,e,n,r,i)).l=o,t.g=a,t.i=s,t.b=X(u||null),t.f=c,t.nb(h).toString()}function Hs(t){if(this.a=t||e.default.INTERNAL.reactNative&&e.default.INTERNAL.reactNative.AsyncStorage,!this.a)throw new ti("internal-error","The React Native compatibility library was not found.");this.type="asyncStorage"}function zs(t){this.b=t,this.a={},this.f=S(this.c,this)}Us.prototype.toString=function(){return this.f?Sn(this.a,"v",this.f):Un(this.a.a,"v"),this.b?Sn(this.a,"eid",this.b):Un(this.a.a,"eid"),this.c.length?Sn(this.a,"fw",this.c.join(",")):Un(this.a.a,"fw"),this.a.toString()},qs.prototype.nb=function(t){return this.h=t,this},qs.prototype.toString=function(){var t=Nn(this.o,"/__/auth/handler");if(Sn(t,"apiKey",this.m),Sn(t,"appName",this.c),Sn(t,"authType",this.u),this.a.isOAuthProvider){var n=this.a;try{var r=e.default.app(this.c).auth().ha()}catch(t){r=null}for(var i in n.bb=r,Sn(t,"providerId",this.a.providerId),r=Dr((n=this.a).zb))r[i]=r[i].toString();i=n.Fc,r=X(r);for(var o=0;o<i.length;o++){var a=i[o];a in r&&delete r[a]}n.eb&&n.bb&&!r[n.eb]&&(r[n.eb]=n.bb),Y(r)||Sn(t,"customParameters",Nr(r))}if("function"==typeof this.a.Hb&&((n=this.a.Hb()).length&&Sn(t,"scopes",n.join(","))),this.l?Sn(t,"redirectUrl",this.l):Un(t.a,"redirectUrl"),this.g?Sn(t,"eventId",this.g):Un(t.a,"eventId"),this.i?Sn(t,"v",this.i):Un(t.a,"v"),this.b)for(var s in this.b)this.b.hasOwnProperty(s)&&!In(t,s)&&Sn(t,s,this.b[s]);return this.h?Sn(t,"tid",this.h):Un(t.a,"tid"),this.f?Sn(t,"eid",this.f):Un(t.a,"eid"),(s=Vs(this.c)).length&&Sn(t,"fw",s.join(",")),t.toString()},(n=Bs.prototype).Fb=function(t,e,n){var r=new ti("popup-closed-by-user"),i=new ti("web-storage-unsupported"),o=this,a=!1;return this.ia().then((function(){(function(t){var e={type:"webStorageSupport"};return Ks(t).then((function(){return function(t,e){return t.gb.then((function(){return new Gt((function(n){t.a.send(e.type,e,n,Tr("gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER"))}))}))}(t.i,e)})).then((function(t){if(t&&t.length&&void 0!==t[0].webStorageSupport)return t[0].webStorageSupport;throw Error()}))})(o).then((function(n){n||(t&&or(t),e(i),a=!0)}))})).s((function(){})).then((function(){if(!a)return function(t){return new Gt((function(e){return function n(){pn(2e3).then((function(){if(t&&!t.closed)return n();e()}))}()}))}(t)})).then((function(){if(!a)return pn(n).then((function(){e(r)}))}))},n.Ob=function(){var t=wr();return!Cr(t)&&!kr(t)},n.Jb=function(){return!1},n.Db=function(t,e,n,r,i,o,a,s){if(!t)return te(new ti("popup-blocked"));if(a&&!Cr())return this.ia().s((function(e){or(t),i(e)})),r(),Zt();this.a||(this.a=Ws(Qs(this)));var u=this;return this.a.then((function(){var e=u.ia().s((function(e){throw or(t),i(e),e}));return r(),e})).then((function(){(So(n),a)||rr(Gs(u.u,u.f,u.b,e,n,null,o,u.c,void 0,u.h,s),t)})).s((function(t){throw"auth/network-request-failed"==t.code&&(u.a=null),t}))},n.Eb=function(t,e,n,r){this.a||(this.a=Ws(Qs(this)));var i=this;return this.a.then((function(){So(e),rr(Gs(i.u,i.f,i.b,t,e,nr(),n,i.c,void 0,i.h,r))})).s((function(t){throw"auth/network-request-failed"==t.code&&(i.a=null),t}))},n.ia=function(){var t=this;return Ks(this).then((function(){return t.i.gb})).s((function(){throw t.a=null,new ti("network-request-failed")}))},n.Rb=function(){return!0},n.Aa=function(t){this.g.push(t)},n.Na=function(t){Q(this.g,(function(e){return e==t}))},(n=Hs.prototype).get=function(t){return Zt(this.a.getItem(t)).then((function(t){return t&&Ar(t)}))},n.set=function(t,e){return Zt(this.a.setItem(t,Nr(e)))},n.S=function(t){return Zt(this.a.removeItem(t))},n.$=function(){},n.ea=function(){};var Ys,Xs=[];function Js(t,e,n){Y(t.a)&&t.b.addEventListener("message",t.f),void 0===t.a[e]&&(t.a[e]=[]),t.a[e].push(n)}function $s(t){this.a=t}function Zs(t){this.c=t,this.b=!1,this.a=[]}function tu(t,e,n,r){var i,o,a,s,u=n||{},c=null;if(t.b)return te(Error("connection_unavailable"));var h=r?800:50,l="undefined"!=typeof MessageChannel?new MessageChannel:null;return new Gt((function(n,r){l?(i=Math.floor(Math.random()*Math.pow(10,20)).toString(),l.port1.start(),a=setTimeout((function(){r(Error("unsupported_event"))}),h),c={messageChannel:l,onMessage:o=function(t){t.data.eventId===i&&("ack"===t.data.status?(clearTimeout(a),s=setTimeout((function(){r(Error("timeout"))}),3e3)):"done"===t.data.status?(clearTimeout(s),void 0!==t.data.response?n(t.data.response):r(Error("unknown_error"))):(clearTimeout(a),clearTimeout(s),r(Error("invalid_response"))))}},t.a.push(c),l.port1.addEventListener("message",o),t.c.postMessage({eventType:e,eventId:i,data:u},[l.port2])):r(Error("connection_unavailable"))})).then((function(e){return eu(t,c),e})).s((function(e){throw eu(t,c),e}))}function eu(t,e){if(e){var n=e.messageChannel,r=e.onMessage;n&&(n.port1.removeEventListener("message",r),n.port1.close()),Q(t.a,(function(t){return t==e}))}}function nu(){if(!ou())throw new ti("web-storage-unsupported");this.c={},this.a=[],this.b=0,this.u=u.indexedDB,this.type="indexedDB",this.g=this.l=this.f=this.i=null,this.o=!1,this.h=null;var t=this;fr()&&self?(this.l=function(){var t=fr()?self:null;if(q(Xs,(function(n){n.b==t&&(e=n)})),!e){var e=new zs(t);Xs.push(e)}return e}(),Js(this.l,"keyChanged",(function(e,n){return hu(t).then((function(e){return 0<e.length&&q(t.a,(function(t){t(e)})),{keyProcessed:W(e,n.key)}}))})),Js(this.l,"ping",(function(){return Zt(["keyChanged"])}))):function(){var t=u.navigator;return t&&t.serviceWorker?Zt().then((function(){return t.serviceWorker.ready})).then((function(t){return t.active||null})).s((function(){return null})):Zt(null)}().then((function(e){(t.h=e)&&(t.g=new Zs(new $s(e)),tu(t.g,"ping",null,!0).then((function(e){e[0].fulfilled&&W(e[0].value,"keyChanged")&&(t.o=!0)})).s((function(){})))}))}function ru(t){return new Gt((function(e,n){var r=t.u.open("firebaseLocalStorageDb",1);r.onerror=function(t){try{t.preventDefault()}catch(t){}n(Error(t.target.error))},r.onupgradeneeded=function(t){t=t.target.result;try{t.createObjectStore("firebaseLocalStorage",{keyPath:"fbase_key"})}catch(t){n(t)}},r.onsuccess=function(r){(r=r.target.result).objectStoreNames.contains("firebaseLocalStorage")?e(r):function(t){return new Gt((function(e,n){var r=t.u.deleteDatabase("firebaseLocalStorageDb");r.onsuccess=function(){e()},r.onerror=function(t){n(Error(t.target.error))}}))}(t).then((function(){return ru(t)})).then((function(t){e(t)})).s((function(t){n(t)}))}}))}function iu(t){return t.m||(t.m=ru(t)),t.m}function ou(){try{return!!u.indexedDB}catch(t){return!1}}function au(t){return t.objectStore("firebaseLocalStorage")}function su(t,e){return t.transaction(["firebaseLocalStorage"],e?"readwrite":"readonly")}function uu(t){return new Gt((function(e,n){t.onsuccess=function(t){t&&t.target?e(t.target.result):e()},t.onerror=function(t){n(t.target.error)}}))}function cu(t,e){return t.g&&t.h&&function(){var t=u.navigator;return t&&t.serviceWorker&&t.serviceWorker.controller||null}()===t.h?tu(t.g,"keyChanged",{key:e},t.o).then((function(){})).s((function(){})):Zt()}function hu(t){return iu(t).then((function(t){var e=au(su(t,!1));return e.getAll?uu(e.getAll()):new Gt((function(t,n){var r=[],i=e.openCursor();i.onsuccess=function(e){(e=e.target.result)?(r.push(e.value),e.continue()):t(r)},i.onerror=function(t){n(t.target.error)}}))})).then((function(e){var n={},r=[];if(0==t.b){for(r=0;r<e.length;r++)n[e[r].fbase_key]=e[r].value;r=function t(e,n){var r,i=[];for(r in e)r in n?typeof e[r]!=typeof n[r]?i.push(r):"object"==typeof e[r]&&null!=e[r]&&null!=n[r]?0<t(e[r],n[r]).length&&i.push(r):e[r]!==n[r]&&i.push(r):i.push(r);for(r in n)r in e||i.push(r);return i}(t.c,n),t.c=n}return r}))}function lu(t){t.i&&t.i.cancel("STOP_EVENT"),t.f&&(clearTimeout(t.f),t.f=null)}function fu(t){var e=this,n=null;this.a=[],this.type="indexedDB",this.c=t,this.b=Zt().then((function(){if(ou()){var t=Or(),r="__sak"+t;return Ys||(Ys=new nu),(n=Ys).set(r,t).then((function(){return n.get(r)})).then((function(e){if(e!==t)throw Error("indexedDB not supported!");return n.S(r)})).then((function(){return n})).s((function(){return e.c}))}return e.c})).then((function(t){return e.type=t.type,t.$((function(t){q(e.a,(function(e){e(t)}))})),t}))}function pu(){this.a={},this.type="inMemory"}function du(){if(!function(){var t="Node"==pr();if(!(t=mu()||t&&e.default.INTERNAL.node&&e.default.INTERNAL.node.localStorage))return!1;try{return t.setItem("__sak","1"),t.removeItem("__sak"),!0}catch(t){return!1}}()){if("Node"==pr())throw new ti("internal-error","The LocalStorage compatibility library was not found.");throw new ti("web-storage-unsupported")}this.a=mu()||e.default.INTERNAL.node.localStorage,this.type="localStorage"}function mu(){try{var t=u.localStorage,e=Or();return t&&(t.setItem(e,"1"),t.removeItem(e)),t}catch(t){return null}}function yu(){this.type="nullStorage"}function gu(){if(!function(){var t="Node"==pr();if(!(t=vu()||t&&e.default.INTERNAL.node&&e.default.INTERNAL.node.sessionStorage))return!1;try{return t.setItem("__sak","1"),t.removeItem("__sak"),!0}catch(t){return!1}}()){if("Node"==pr())throw new ti("internal-error","The SessionStorage compatibility library was not found.");throw new ti("web-storage-unsupported")}this.a=vu()||e.default.INTERNAL.node.sessionStorage,this.type="sessionStorage"}function vu(){try{var t=u.sessionStorage,e=Or();return t&&(t.setItem(e,"1"),t.removeItem(e)),t}catch(t){return null}}function bu(){var t={};t.Browser=_u,t.Node=Eu,t.ReactNative=Su,t.Worker=Iu,this.a=t[pr()]}zs.prototype.c=function(t){var e=t.data.eventType,n=t.data.eventId,r=this.a[e];if(r&&0<r.length){t.ports[0].postMessage({status:"ack",eventId:n,eventType:e,response:null});var i=[];q(r,(function(e){i.push(Zt().then((function(){return e(t.origin,t.data.data)})))})),ne(i).then((function(r){var i=[];q(r,(function(t){i.push({fulfilled:t.Gb,value:t.value,reason:t.reason?t.reason.message:void 0})})),q(i,(function(t){for(var e in t)void 0===t[e]&&delete t[e]})),t.ports[0].postMessage({status:"done",eventId:n,eventType:e,response:i})}))}},$s.prototype.postMessage=function(t,e){this.a.postMessage(t,e)},Zs.prototype.close=function(){for(;0<this.a.length;)eu(this,this.a[0]);this.b=!0},(n=nu.prototype).set=function(t,e){var n,r=!1,i=this;return iu(this).then((function(e){return uu((e=au(su(n=e,!0))).get(t))})).then((function(o){var a=au(su(n,!0));return o?(o.value=e,uu(a.put(o))):(i.b++,r=!0,(o={}).fbase_key=t,o.value=e,uu(a.add(o)))})).then((function(){return i.c[t]=e,cu(i,t)})).ka((function(){r&&i.b--}))},n.get=function(t){return iu(this).then((function(e){return uu(au(su(e,!1)).get(t))})).then((function(t){return t&&t.value}))},n.S=function(t){var e=!1,n=this;return iu(this).then((function(r){return e=!0,n.b++,uu(au(su(r,!0)).delete(t))})).then((function(){return delete n.c[t],cu(n,t)})).ka((function(){e&&n.b--}))},n.$=function(t){0==this.a.length&&function(t){lu(t),function e(){t.f=setTimeout((function(){t.i=hu(t).then((function(e){0<e.length&&q(t.a,(function(t){t(e)}))})).then((function(){e()})).s((function(t){"STOP_EVENT"!=t.message&&e()}))}),800)}()}(this),this.a.push(t)},n.ea=function(t){Q(this.a,(function(e){return e==t})),0==this.a.length&&lu(this)},(n=fu.prototype).get=function(t){return this.b.then((function(e){return e.get(t)}))},n.set=function(t,e){return this.b.then((function(n){return n.set(t,e)}))},n.S=function(t){return this.b.then((function(e){return e.S(t)}))},n.$=function(t){this.a.push(t)},n.ea=function(t){Q(this.a,(function(e){return e==t}))},(n=pu.prototype).get=function(t){return Zt(this.a[t])},n.set=function(t,e){return this.a[t]=e,Zt()},n.S=function(t){return delete this.a[t],Zt()},n.$=function(){},n.ea=function(){},(n=du.prototype).get=function(t){var e=this;return Zt().then((function(){return Ar(e.a.getItem(t))}))},n.set=function(t,e){var n=this;return Zt().then((function(){var r=Nr(e);null===r?n.S(t):n.a.setItem(t,r)}))},n.S=function(t){var e=this;return Zt().then((function(){e.a.removeItem(t)}))},n.$=function(t){u.window&&Ye(u.window,"storage",t)},n.ea=function(t){u.window&&$e(u.window,"storage",t)},(n=yu.prototype).get=function(){return Zt(null)},n.set=function(){return Zt()},n.S=function(){return Zt()},n.$=function(){},n.ea=function(){},(n=gu.prototype).get=function(t){var e=this;return Zt().then((function(){return Ar(e.a.getItem(t))}))},n.set=function(t,e){var n=this;return Zt().then((function(){var r=Nr(e);null===r?n.S(t):n.a.setItem(t,r)}))},n.S=function(t){var e=this;return Zt().then((function(){e.a.removeItem(t)}))},n.$=function(){},n.ea=function(){};var wu,Tu,_u={C:du,Ta:gu},Eu={C:du,Ta:gu},Su={C:Hs,Ta:yu},Iu={C:du,Ta:yu},Cu={ad:"local",NONE:"none",cd:"session"};function Nu(){var t=!(kr(wr())||!lr()),e=Cr(),n=_r();this.m=t,this.h=e,this.l=n,this.a={},wu||(wu=new bu),t=wu;try{this.g=!er()&&xr()||!u.indexedDB?new t.a.C:new fu(fr()?new pu:new t.a.C)}catch(t){this.g=new pu,this.h=!0}try{this.i=new t.a.Ta}catch(t){this.i=new pu}this.u=new pu,this.f=S(this.Pb,this),this.b={}}function Du(){return Tu||(Tu=new Nu),Tu}function Au(t,e){switch(e){case"session":return t.i;case"none":return t.u;default:return t.g}}function Ou(t,e){return"firebase:"+t.name+(e?":"+e:"")}function ku(t,e,n){return n=Ou(e,n),"local"==e.C&&(t.b[n]=null),Au(t,e.C).S(n)}function Ru(t){t.c&&(clearInterval(t.c),t.c=null)}function Pu(t){this.a=t,this.b=Du()}(n=Nu.prototype).get=function(t,e){return Au(this,t.C).get(Ou(t,e))},n.set=function(t,e,n){var r=Ou(t,n),i=this,o=Au(this,t.C);return o.set(r,e).then((function(){return o.get(r)})).then((function(e){"local"==t.C&&(i.b[r]=e)}))},n.addListener=function(t,e,n){t=Ou(t,e),this.l&&(this.b[t]=u.localStorage.getItem(t)),Y(this.a)&&(Au(this,"local").$(this.f),this.h||(er()||!xr())&&u.indexedDB||!this.l||function(t){Ru(t),t.c=setInterval((function(){for(var e in t.a){var n=u.localStorage.getItem(e),r=t.b[e];n!=r&&(t.b[e]=n,n=new je({type:"storage",key:e,target:window,oldValue:r,newValue:n,a:!0}),t.Pb(n))}}),1e3)}(this)),this.a[t]||(this.a[t]=[]),this.a[t].push(n)},n.removeListener=function(t,e,n){t=Ou(t,e),this.a[t]&&(Q(this.a[t],(function(t){return t==n})),0==this.a[t].length&&delete this.a[t]),Y(this.a)&&(Au(this,"local").ea(this.f),Ru(this))},n.Pb=function(t){if(t&&t.f){var e=t.a.key;if(null==e)for(var n in this.a){var r=this.b[n];void 0===r&&(r=null);var i=u.localStorage.getItem(n);i!==r&&(this.b[n]=i,this.$a(n))}else if(0==e.indexOf("firebase:")&&this.a[e]){if(void 0!==t.a.a?Au(this,"local").ea(this.f):Ru(this),this.m)if(n=u.localStorage.getItem(e),(r=t.a.newValue)!==n)null!==r?u.localStorage.setItem(e,r):u.localStorage.removeItem(e);else if(this.b[e]===r&&void 0===t.a.a)return;var o=this;n=function(){void 0===t.a.a&&o.b[e]===u.localStorage.getItem(e)||(o.b[e]=u.localStorage.getItem(e),o.$a(e))},Te&&Oe&&10==Oe&&u.localStorage.getItem(e)!==t.a.newValue&&t.a.newValue!==t.a.oldValue?setTimeout(n,10):n()}}else q(t,S(this.$a,this))},n.$a=function(t){this.a[t]&&q(this.a[t],(function(t){t()}))};var Mu,Lu={name:"authEvent",C:"local"};function xu(){this.a=Du()}function Fu(t,e){this.b=ju,this.f=u.Uint8Array?new Uint8Array(this.b):Array(this.b),this.g=this.c=0,this.a=[],this.i=t,this.h=e,this.l=u.Int32Array?new Int32Array(64):Array(64),void 0!==Mu||(Mu=u.Int32Array?new Int32Array(Qu):Qu),this.reset()}N(Fu,(function(){this.b=-1}));for(var ju=64,Uu=ju-1,qu=[],Vu=0;Vu<Uu;Vu++)qu[Vu]=0;var Bu=G(128,qu);function Wu(t){for(var e=t.f,n=t.l,r=0,i=0;i<e.length;)n[r++]=e[i]<<24|e[i+1]<<16|e[i+2]<<8|e[i+3],i=4*r;for(e=16;64>e;e++){i=0|n[e-15],r=0|n[e-2];var o=(0|n[e-16])+((i>>>7|i<<25)^(i>>>18|i<<14)^i>>>3)|0,a=(0|n[e-7])+((r>>>17|r<<15)^(r>>>19|r<<13)^r>>>10)|0;n[e]=o+a|0}r=0|t.a[0],i=0|t.a[1];var s=0|t.a[2],u=0|t.a[3],c=0|t.a[4],h=0|t.a[5],l=0|t.a[6];for(o=0|t.a[7],e=0;64>e;e++){var f=((r>>>2|r<<30)^(r>>>13|r<<19)^(r>>>22|r<<10))+(r&i^r&s^i&s)|0;a=(o=o+((c>>>6|c<<26)^(c>>>11|c<<21)^(c>>>25|c<<7))|0)+((a=(a=c&h^~c&l)+(0|Mu[e])|0)+(0|n[e])|0)|0,o=l,l=h,h=c,c=u+a|0,u=s,s=i,i=r,r=a+f|0}t.a[0]=t.a[0]+r|0,t.a[1]=t.a[1]+i|0,t.a[2]=t.a[2]+s|0,t.a[3]=t.a[3]+u|0,t.a[4]=t.a[4]+c|0,t.a[5]=t.a[5]+h|0,t.a[6]=t.a[6]+l|0,t.a[7]=t.a[7]+o|0}function Ku(t,e,n){void 0===n&&(n=e.length);var r=0,i=t.c;if(c(e))for(;r<n;)t.f[i++]=e.charCodeAt(r++),i==t.b&&(Wu(t),i=0);else{if(!g(e))throw Error("message must be string or array");for(;r<n;){var o=e[r++];if(!("number"==typeof o&&0<=o&&255>=o&&o==(0|o)))throw Error("message must be a byte array");t.f[i++]=o,i==t.b&&(Wu(t),i=0)}}t.c=i,t.g+=n}Fu.prototype.reset=function(){this.g=this.c=0,this.a=u.Int32Array?new Int32Array(this.h):H(this.h)};var Qu=[1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298];function Gu(){Fu.call(this,8,Hu)}N(Gu,Fu);var Hu=[1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225];function zu(t,e,n,r,i){this.u=t,this.i=e,this.l=n,this.m=r||null,this.o=i||null,this.h=e+":"+n,this.v=new xu,this.g=new Pu(this.h),this.f=null,this.b=[],this.a=this.c=null}function Yu(t){return new ti("invalid-cordova-configuration",t)}function Xu(t){var e=new Gu;Ku(e,t),t=[];var n=8*e.g;56>e.c?Ku(e,Bu,56-e.c):Ku(e,Bu,e.b-(e.c-56));for(var r=63;56<=r;r--)e.f[r]=255&n,n/=256;for(Wu(e),r=n=0;r<e.i;r++)for(var i=24;0<=i;i-=8)t[n++]=e.a[r]>>i&255;return function(t){return V(t,(function(t){return 1<(t=t.toString(16)).length?t:"0"+t})).join("")}(t)}function Ju(t,e){for(var n=0;n<t.b.length;n++)try{t.b[n](e)}catch(t){}}function $u(t){return t.f||(t.f=t.ia().then((function(){return new Gt((function(e){t.Aa((function n(r){return e(r),t.Na(n),!1})),function(t){function e(e){r=!0,i&&i.cancel(),Zu(t).then((function(r){var i=n;if(r&&e&&e.url){var o=null;-1!=(i=Gi(e.url)).indexOf("/__/auth/callback")&&(o=(o="object"==typeof(o=Ar(In(o=Cn(i),"firebaseError")||null))?ei(o):null)?new Io(r.c,r.b,null,null,o,null,r.R()):new Io(r.c,r.b,i,r.f,null,null,r.R())),i=o||n}Ju(t,i)}))}var n=new Io("unknown",null,null,null,new ti("no-auth-event")),r=!1,i=pn(500).then((function(){return Zu(t).then((function(){r||Ju(t,n)}))})),o=u.handleOpenURL;u.handleOpenURL=function(t){if(0==t.toLowerCase().indexOf(Tr("BuildInfo.packageName",u).toLowerCase()+"://")&&e({url:t}),"function"==typeof o)try{o(t)}catch(t){console.error(t)}},Ao||(Ao=new No),function(t){var e=Ao;e.a.push(t),e.b||(e.b=function(t){for(var n=0;n<e.a.length;n++)e.a[n](t)},"function"==typeof(t=Tr("universalLinks.subscribe",u))&&t(null,e.b))}(e)}(t)}))}))),t.f}function Zu(t){var e=null;return function(t){return t.b.get(Lu,t.a).then((function(t){return Co(t)}))}(t.g).then((function(n){return e=n,ku((n=t.g).b,Lu,n.a)})).then((function(){return e}))}function tc(t){this.a=t,this.b=Du()}(n=zu.prototype).ia=function(){return this.Da?this.Da:this.Da=(hr(void 0)?cr().then((function(){return new Gt((function(t,e){var n=u.document,r=setTimeout((function(){e(Error("Cordova framework is not ready."))}),1e3);n.addEventListener("deviceready",(function(){clearTimeout(r),t()}),!1)}))})):te(Error("Cordova must run in an Android or iOS file scheme."))).then((function(){if("function"!=typeof Tr("universalLinks.subscribe",u))throw Yu("cordova-universal-links-plugin-fix is not installed");if(void 0===Tr("BuildInfo.packageName",u))throw Yu("cordova-plugin-buildinfo is not installed");if("function"!=typeof Tr("cordova.plugins.browsertab.openUrl",u))throw Yu("cordova-plugin-browsertab is not installed");if("function"!=typeof Tr("cordova.InAppBrowser.open",u))throw Yu("cordova-plugin-inappbrowser is not installed")}),(function(){throw new ti("cordova-not-ready")}))},n.Fb=function(t,e){return e(new ti("operation-not-supported-in-this-environment")),Zt()},n.Db=function(){return te(new ti("operation-not-supported-in-this-environment"))},n.Rb=function(){return!1},n.Ob=function(){return!0},n.Jb=function(){return!0},n.Eb=function(t,e,n,r){if(this.c)return te(new ti("redirect-operation-pending"));var i=this,o=u.document,a=null,s=null,c=null,h=null;return this.c=Zt().then((function(){return So(e),$u(i)})).then((function(){return function(t,e,n,r,i){var o=function(){for(var t=20,e=[];0<t;)e.push("1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ".charAt(Math.floor(62*Math.random()))),t--;return e.join("")}(),a=new Io(e,r,null,o,new ti("no-auth-event"),null,i),s=Tr("BuildInfo.packageName",u);if("string"!=typeof s)throw new ti("invalid-cordova-configuration");var c=Tr("BuildInfo.displayName",u),h={};if(wr().toLowerCase().match(/iphone|ipad|ipod/))h.ibi=s;else{if(!wr().toLowerCase().match(/android/))return te(new ti("operation-not-supported-in-this-environment"));h.apn=s}c&&(h.appDisplayName=c),o=Xu(o),h.sessionId=o;var l=Gs(t.u,t.i,t.l,e,n,null,r,t.m,h,t.o,i);return t.ia().then((function(){var e=t.h;return t.v.a.set(Lu,a.A(),e)})).then((function(){var e=Tr("cordova.plugins.browsertab.isAvailable",u);if("function"!=typeof e)throw new ti("invalid-cordova-configuration");var n=null;e((function(e){if(e){if("function"!=typeof(n=Tr("cordova.plugins.browsertab.openUrl",u)))throw new ti("invalid-cordova-configuration");n(l)}else{if("function"!=typeof(n=Tr("cordova.InAppBrowser.open",u)))throw new ti("invalid-cordova-configuration");e=wr(),t.a=n(l,e.match(/(iPad|iPhone|iPod).*OS 7_\d/i)||e.match(/(iPad|iPhone|iPod).*OS 8_\d/i)?"_blank":"_system","location=yes")}}))}))}(i,t,e,n,r)})).then((function(){return new Gt((function(t,e){s=function(){var e=Tr("cordova.plugins.browsertab.close",u);return t(),"function"==typeof e&&e(),i.a&&"function"==typeof i.a.close&&(i.a.close(),i.a=null),!1},i.Aa(s),c=function(){a||(a=pn(2e3).then((function(){e(new ti("redirect-cancelled-by-user"))})))},h=function(){Mr()&&c()},o.addEventListener("resume",c,!1),wr().toLowerCase().match(/android/)||o.addEventListener("visibilitychange",h,!1)})).s((function(t){return Zu(i).then((function(){throw t}))}))})).ka((function(){c&&o.removeEventListener("resume",c,!1),h&&o.removeEventListener("visibilitychange",h,!1),a&&a.cancel(),s&&i.Na(s),i.c=null}))},n.Aa=function(t){this.b.push(t),$u(this).s((function(e){"auth/invalid-cordova-configuration"===e.code&&(e=new Io("unknown",null,null,null,new ti("no-auth-event")),t(e))}))},n.Na=function(t){Q(this.b,(function(e){return e==t}))};var ec={name:"pendingRedirect",C:"session"};function nc(t){return ku(t.b,ec,t.a)}function rc(t,e,n){this.i={},this.v=0,this.B=t,this.u=e,this.m=n,this.h=[],this.f=!1,this.l=S(this.o,this),this.b=new gc,this.w=new _c,this.g=new tc(this.u+":"+this.m),this.c={},this.c.unknown=this.b,this.c.signInViaRedirect=this.b,this.c.linkViaRedirect=this.b,this.c.reauthViaRedirect=this.b,this.c.signInViaPopup=this.w,this.c.linkViaPopup=this.w,this.c.reauthViaPopup=this.w,this.a=ic(this.B,this.u,this.m,Oi)}function ic(t,n,r,i){var o=e.default.SDK_VERSION||null;return hr()?new zu(t,n,r,o,i):new Bs(t,n,r,o,i)}function oc(t){t.f||(t.f=!0,t.a.Aa(t.l));var e=t.a;return t.a.ia().s((function(n){throw t.a==e&&t.reset(),n}))}function ac(t){t.a.Ob()&&oc(t).s((function(e){var n=new Io("unknown",null,null,null,new ti("operation-not-supported-in-this-environment"));fc(e)&&t.o(n)})),t.a.Jb()||vc(t.b)}function sc(t,e){W(t.h,e)||t.h.push(e),t.f||function(t){return t.b.get(ec,t.a).then((function(t){return"pending"==t}))}(t.g).then((function(e){e?nc(t.g).then((function(){oc(t).s((function(e){var n=new Io("unknown",null,null,null,new ti("operation-not-supported-in-this-environment"));fc(e)&&t.o(n)}))})):ac(t)})).s((function(){ac(t)}))}function uc(t,e){Q(t.h,(function(t){return t==e}))}rc.prototype.reset=function(){this.f=!1,this.a.Na(this.l),this.a=ic(this.B,this.u,this.m),this.i={}},rc.prototype.o=function(t){if(!t)throw new ti("invalid-auth-event");if(6e5<=C()-this.v&&(this.i={},this.v=0),t&&t.getUid()&&this.i.hasOwnProperty(t.getUid()))return!1;for(var e=!1,n=0;n<this.h.length;n++){var r=this.h[n];if(r.xb(t.c,t.b)){(e=this.c[t.c])&&(e.h(t,r),t&&(t.f||t.b)&&(this.i[t.getUid()]=!0,this.v=C())),e=!0;break}}return vc(this.b),e};var cc=new Pr(2e3,1e4),hc=new Pr(3e4,6e4);function lc(t,e,n,r,i,o,a){return t.a.Db(e,n,r,(function(){t.f||(t.f=!0,t.a.Aa(t.l))}),(function(){t.reset()}),i,o,a)}function fc(t){return!(!t||"auth/cordova-not-ready"!=t.code)}function pc(t,e,n,r,i){var o;return function(t){return t.b.set(ec,"pending",t.a)}(t.g).then((function(){return t.a.Eb(e,n,r,i).s((function(e){if(fc(e))throw new ti("operation-not-supported-in-this-environment");return o=e,nc(t.g).then((function(){throw o}))})).then((function(){return t.a.Rb()?new Gt((function(){})):nc(t.g).then((function(){return t.oa()})).then((function(){})).s((function(){}))}))}))}function dc(t,e,n,r,i){return t.a.Fb(r,(function(t){e.ja(n,null,t,i)}),cc.get())}rc.prototype.oa=function(){return this.b.oa()};var mc={};function yc(t,e,n){var r=e+":"+n;return mc[r]||(mc[r]=new rc(t,e,n)),mc[r]}function gc(){this.b=null,this.f=[],this.c=[],this.a=null,this.i=this.g=!1}function vc(t){t.g||(t.g=!0,Tc(t,!1,null,null))}function bc(t){t.g&&!t.i&&Tc(t,!1,null,null)}function wc(t,e){if(t.b=function(){return Zt(e)},t.f.length)for(var n=0;n<t.f.length;n++)t.f[n](e)}function Tc(t,e,n,r){e?r?function(t,e){if(t.b=function(){return te(e)},t.c.length)for(var n=0;n<t.c.length;n++)t.c[n](e)}(t,r):wc(t,n):wc(t,{user:null}),t.f=[],t.c=[]}function _c(){}function Ec(){this.vb=!1,Object.defineProperty(this,"appVerificationDisabled",{get:function(){return this.vb},set:function(t){this.vb=t},enumerable:!1})}function Sc(t,e){this.a=e,Vr(this,"verificationId",t)}function Ic(t,e,n,r){return new To(t).Wa(e,n).then((function(t){return new Sc(t,r)}))}function Cc(t){var e=Ai(t);if(!(e&&e.exp&&e.auth_time&&e.iat))throw new ti("internal-error","An internal error occurred. The token obtained by Firebase appears to be malformed. Please retry the operation.");Br(this,{token:t,expirationTime:Lr(1e3*e.exp),authTime:Lr(1e3*e.auth_time),issuedAtTime:Lr(1e3*e.iat),signInProvider:e.firebase&&e.firebase.sign_in_provider?e.firebase.sign_in_provider:null,claims:e})}function Nc(t,e,n){if(this.h=t,this.i=e,this.g=n,this.c=3e4,this.f=96e4,this.b=null,this.a=this.c,this.f<this.c)throw Error("Proactive refresh lower bound greater than upper bound!")}function Dc(t){this.f=t,this.b=this.a=null,this.c=0}function Ac(t,e){var n=e[xa],r=e.refreshToken;e=Oc(e.expiresIn),t.b=n,t.c=e,t.a=r}function Oc(t){return C()+1e3*parseInt(t,10)}function kc(t,e){return function(t,e){return new Gt((function(n,r){"refresh_token"==e.grant_type&&e.refresh_token||"authorization_code"==e.grant_type&&e.code?Wa(t,t.l+"?key="+encodeURIComponent(t.c),(function(t){t?t.error?r(Ps(t)):t.access_token&&t.refresh_token?n(t):r(new ti("internal-error")):r(new ti("network-request-failed"))}),"POST",jn(e).toString(),t.g,t.u.get()):r(new ti("internal-error"))}))}(t.f,e).then((function(e){return t.b=e.access_token,t.c=Oc(e.expires_in),t.a=e.refresh_token,{accessToken:t.b,expirationTime:t.c,refreshToken:t.a}})).s((function(e){throw"auth/user-token-expired"==e.code&&(t.a=null),e}))}function Rc(t,e){this.a=t||null,this.b=e||null,Br(this,{lastSignInTime:Lr(e||null),creationTime:Lr(t||null)})}function Pc(t,e,n,r,i,o){Br(this,{uid:t,displayName:r||null,photoURL:i||null,email:n||null,phoneNumber:o||null,providerId:e})}function Mc(t,e){for(var n in Fe.call(this,t),e)this[n]=e[n]}function Lc(t,n,r){this.I=[],this.l=t.apiKey,this.m=t.appName,this.o=t.authDomain||null,t=e.default.SDK_VERSION?br(e.default.SDK_VERSION):null,this.a=new Ma(this.l,Ri(Oi),t),this.b=new Dc(this.a),Bc(this,n[xa]),Ac(this.b,n),Vr(this,"refreshToken",this.b.a),Qc(this,r||{}),un.call(this),this.J=!1,this.o&&Er()&&(this.i=yc(this.o,this.l,this.m)),this.O=[],this.h=null,this.w=function(t){return new Nc((function(){return t.G(!0)}),(function(t){return!(!t||"auth/network-request-failed"!=t.code)}),(function(){var e=t.b.c-C()-3e5;return 0<e?e:0}))}(this),this.W=S(this.Ja,this);var i=this;this.ga=null,this.xa=function(t){i.ua(t.g)},this.Z=null,this.P=[],this.wa=function(t){Fc(i,t.c)},this.Y=null}function xc(t,e){t.Z&&$e(t.Z,"languageCodeChanged",t.xa),(t.Z=e)&&Ye(e,"languageCodeChanged",t.xa)}function Fc(t,n){t.P=n,Ba(t.a,e.default.SDK_VERSION?br(e.default.SDK_VERSION,t.P):null)}function jc(t,e){t.Y&&$e(t.Y,"frameworkChanged",t.wa),(t.Y=e)&&Ye(e,"frameworkChanged",t.wa)}function Uc(t){try{return e.default.app(t.m).auth()}catch(e){throw new ti("internal-error","No firebase.auth.Auth instance is available for the Firebase App '"+t.m+"'!")}}function qc(t){t.B||t.w.b||(t.w.start(),$e(t,"tokenChanged",t.W),Ye(t,"tokenChanged",t.W))}function Vc(t){$e(t,"tokenChanged",t.W),t.w.stop()}function Bc(t,e){t.ma=e,Vr(t,"_lat",e)}function Wc(t){for(var e=[],n=0;n<t.O.length;n++)e.push(t.O[n](t));return ne(e).then((function(){return t}))}function Kc(t){t.i&&!t.J&&(t.J=!0,sc(t.i,t))}function Qc(t,e){Br(t,{uid:e.uid,displayName:e.displayName||null,photoURL:e.photoURL||null,email:e.email||null,emailVerified:e.emailVerified||!1,phoneNumber:e.phoneNumber||null,isAnonymous:e.isAnonymous||!1,tenantId:e.tenantId||null,metadata:new Rc(e.createdAt,e.lastLoginAt),providerData:[]}),t.a.b=t.tenantId}function Gc(){}function Hc(t){return Zt().then((function(){if(t.B)throw new ti("app-deleted")}))}function zc(t){return V(t.providerData,(function(t){return t.providerId}))}function Yc(t,e){e&&(Xc(t,e.providerId),t.providerData.push(e))}function Xc(t,e){Q(t.providerData,(function(t){return t.providerId==e}))}function Jc(t,e,n){("uid"!=e||n)&&t.hasOwnProperty(e)&&Vr(t,e,n)}function $c(t,e){t!=e&&(Br(t,{uid:e.uid,displayName:e.displayName,photoURL:e.photoURL,email:e.email,emailVerified:e.emailVerified,phoneNumber:e.phoneNumber,isAnonymous:e.isAnonymous,tenantId:e.tenantId,providerData:[]}),e.metadata?Vr(t,"metadata",function(t){return new Rc(t.a,t.b)}(e.metadata)):Vr(t,"metadata",new Rc),q(e.providerData,(function(e){Yc(t,e)})),function(t,e){t.b=e.b,t.a=e.a,t.c=e.c}(t.b,e.b),Vr(t,"refreshToken",t.b.a))}function Zc(t){return t.G().then((function(e){var n=t.isAnonymous;return function(t,e){return ks(t.a,fs,{idToken:e}).then(S(t.zc,t))}(t,e).then((function(){return n||Jc(t,"isAnonymous",!1),e}))}))}function th(t,e){e[xa]&&t.ma!=e[xa]&&(Ac(t.b,e),t.dispatchEvent(new Mc("tokenChanged")),Bc(t,e[xa]),Jc(t,"refreshToken",t.b.a))}function eh(t,e){return Zc(t).then((function(){if(W(zc(t),e))return Wc(t).then((function(){throw new ti("provider-already-linked")}))}))}function nh(t,e,n){return Wr({user:t,credential:Eo(e),additionalUserInfo:e=Fi(e),operationType:n})}function rh(t,e){return th(t,e),t.reload().then((function(){return t}))}function ih(t,n,r,i,o){if(!Er())return te(new ti("operation-not-supported-in-this-environment"));if(t.h&&!o)return te(t.h);var a=xi(r.providerId),s=Or(t.uid+":::"),u=null;(!Cr()||lr())&&t.o&&r.isOAuthProvider&&(u=Gs(t.o,t.l,t.m,n,r,null,s,e.default.SDK_VERSION||null,null,null,t.tenantId));var c=ar(u,a&&a.sa,a&&a.ra);return i=i().then((function(){if(ah(t),!o)return t.G().then((function(){}))})).then((function(){return lc(t.i,c,n,r,s,!!u,t.tenantId)})).then((function(){return new Gt((function(e,r){t.ja(n,null,new ti("cancelled-popup-request"),t.g||null),t.f=e,t.v=r,t.g=s,t.c=dc(t.i,t,n,c,s)}))})).then((function(t){return c&&or(c),t?Wr(t):null})).s((function(t){throw c&&or(c),t})),sh(t,i,o)}function oh(t,e,n,r,i){if(!Er())return te(new ti("operation-not-supported-in-this-environment"));if(t.h&&!i)return te(t.h);var o=null,a=Or(t.uid+":::");return r=r().then((function(){if(ah(t),!i)return t.G().then((function(){}))})).then((function(){return t.ca=a,Wc(t)})).then((function(e){return t.da&&(e=(e=t.da).b.set(hh,t.A(),e.a)),e})).then((function(){return pc(t.i,e,n,a,t.tenantId)})).s((function(e){if(o=e,t.da)return lh(t.da);throw o})).then((function(){if(o)throw o})),sh(t,r,i)}function ah(t){if(!t.i||!t.J){if(t.i&&!t.J)throw new ti("internal-error");throw new ti("auth-domain-config-required")}}function sh(t,e,n){var r=function(t,e,n){return t.h&&!n?(e.cancel(),te(t.h)):e.s((function(e){throw!e||"auth/user-disabled"!=e.code&&"auth/user-token-expired"!=e.code||(t.h||t.dispatchEvent(new Mc("userInvalidated")),t.h=e),e}))}(t,e,n);return t.I.push(r),r.ka((function(){K(t.I,r)})),r}function uh(t){if(!t.apiKey)return null;var e={apiKey:t.apiKey,authDomain:t.authDomain,appName:t.appName},n={};if(!(t.stsTokenManager&&t.stsTokenManager.accessToken&&t.stsTokenManager.expirationTime))return null;n[xa]=t.stsTokenManager.accessToken,n.refreshToken=t.stsTokenManager.refreshToken||null,n.expiresIn=(t.stsTokenManager.expirationTime-C())/1e3;var r=new Lc(e,n,t);return t.providerData&&q(t.providerData,(function(t){t&&Yc(r,Wr(t))})),t.redirectEventId&&(r.ca=t.redirectEventId),r}function ch(t){this.a=t,this.b=Du()}gc.prototype.reset=function(){this.b=null,this.a&&(this.a.cancel(),this.a=null)},gc.prototype.h=function(t,e){if(t){this.reset(),this.g=!0;var n=t.c,r=t.b,i=t.a&&"auth/web-storage-unsupported"==t.a.code,o=t.a&&"auth/operation-not-supported-in-this-environment"==t.a.code;this.i=!(!i&&!o),"unknown"!=n||i||o?t.a?(Tc(this,!0,null,t.a),Zt()):e.Ba(n,r)?function(t,e,n){n=n.Ba(e.c,e.b);var r=e.g,i=e.f,o=e.i,a=e.R(),s=!!e.c.match(/Redirect$/);n(r,i,a,o).then((function(e){Tc(t,s,e,null)})).s((function(e){Tc(t,s,null,e)}))}(this,t,e):te(new ti("invalid-auth-event")):(Tc(this,!1,null,null),Zt())}else te(new ti("invalid-auth-event"))},gc.prototype.oa=function(){var t=this;return new Gt((function(e,n){t.b?t.b().then(e,n):(t.f.push(e),t.c.push(n),function(t){var e=new ti("timeout");t.a&&t.a.cancel(),t.a=pn(hc.get()).then((function(){t.b||(t.g=!0,Tc(t,!0,null,e))}))}(t))}))},_c.prototype.h=function(t,e){if(t){var n=t.c,r=t.b;t.a?(e.ja(t.c,null,t.a,t.b),Zt()):e.Ba(n,r)?function(t,e){var n=t.b,r=t.c;e.Ba(r,n)(t.g,t.f,t.R(),t.i).then((function(t){e.ja(r,t,null,n)})).s((function(t){e.ja(r,null,t,n)}))}(t,e):te(new ti("invalid-auth-event"))}else te(new ti("invalid-auth-event"))},Sc.prototype.confirm=function(t){return t=_o(this.verificationId,t),this.a(t)},Nc.prototype.start=function(){this.a=this.c,function t(e,n){e.stop(),e.b=pn(function(t,e){return e?(t.a=t.c,t.g()):(e=t.a,t.a*=2,t.a>t.f&&(t.a=t.f),e)}(e,n)).then((function(){return function(){var t=u.document,e=null;return Mr()||!t?Zt():new Gt((function(n){e=function(){Mr()&&(t.removeEventListener("visibilitychange",e,!1),n())},t.addEventListener("visibilitychange",e,!1)})).s((function(n){throw t.removeEventListener("visibilitychange",e,!1),n}))}()})).then((function(){return e.h()})).then((function(){t(e,!0)})).s((function(n){e.i(n)&&t(e,!1)}))}(this,!0)},Nc.prototype.stop=function(){this.b&&(this.b.cancel(),this.b=null)},Dc.prototype.A=function(){return{apiKey:this.f.c,refreshToken:this.a,accessToken:this.b,expirationTime:this.c}},Dc.prototype.getToken=function(t){return t=!!t,this.b&&!this.a?te(new ti("user-token-expired")):t||!this.b||C()>this.c-3e4?this.a?kc(this,{grant_type:"refresh_token",refresh_token:this.a}):Zt(null):Zt({accessToken:this.b,expirationTime:this.c,refreshToken:this.a})},Rc.prototype.A=function(){return{lastLoginAt:this.b,createdAt:this.a}},N(Mc,Fe),N(Lc,un),Lc.prototype.ua=function(t){this.ga=t,Va(this.a,t)},Lc.prototype.ha=function(){return this.ga},Lc.prototype.Ca=function(){return H(this.P)},Lc.prototype.Ja=function(){this.w.b&&(this.w.stop(),this.w.start())},Vr(Lc.prototype,"providerId","firebase"),(n=Lc.prototype).reload=function(){var t=this;return sh(this,Hc(this).then((function(){return Zc(t).then((function(){return Wc(t)})).then(Gc)})))},n.dc=function(t){return this.G(t).then((function(t){return new Cc(t)}))},n.G=function(t){var e=this;return sh(this,Hc(this).then((function(){return e.b.getToken(t)})).then((function(t){if(!t)throw new ti("internal-error");return t.accessToken!=e.ma&&(Bc(e,t.accessToken),e.dispatchEvent(new Mc("tokenChanged"))),Jc(e,"refreshToken",t.refreshToken),t.accessToken})))},n.zc=function(t){if(!(t=t.users)||!t.length)throw new ti("internal-error");Qc(this,{uid:(t=t[0]).localId,displayName:t.displayName,photoURL:t.photoUrl,email:t.email,emailVerified:!!t.emailVerified,phoneNumber:t.phoneNumber,lastLoginAt:t.lastLoginAt,createdAt:t.createdAt,tenantId:t.tenantId});for(var e=function(t){return(t=t.providerUserInfo)&&t.length?V(t,(function(t){return new Pc(t.rawId,t.providerId,t.email,t.displayName,t.photoUrl,t.phoneNumber)})):[]}(t),n=0;n<e.length;n++)Yc(this,e[n]);Jc(this,"isAnonymous",!(this.email&&t.passwordHash||this.providerData&&this.providerData.length))},n.Ac=function(t){return Ur("firebase.User.prototype.reauthenticateAndRetrieveDataWithCredential is deprecated. Please use firebase.User.prototype.reauthenticateWithCredential instead."),this.hb(t)},n.hb=function(t){var e=this,n=null;return sh(this,t.f(this.a,this.uid).then((function(t){return th(e,t),n=nh(e,t,"reauthenticate"),e.h=null,e.reload()})).then((function(){return n})),!0)},n.rc=function(t){return Ur("firebase.User.prototype.linkAndRetrieveDataWithCredential is deprecated. Please use firebase.User.prototype.linkWithCredential instead."),this.fb(t)},n.fb=function(t){var e=this,n=null;return sh(this,eh(this,t.providerId).then((function(){return e.G()})).then((function(n){return t.b(e.a,n)})).then((function(t){return n=nh(e,t,"link"),rh(e,t)})).then((function(){return n})))},n.sc=function(t,e){var n=this;return sh(this,eh(this,"phone").then((function(){return Ic(Uc(n),t,e,S(n.fb,n))})))},n.Bc=function(t,e){var n=this;return sh(this,Zt().then((function(){return Ic(Uc(n),t,e,S(n.hb,n))})),!0)},n.rb=function(t){var e=this;return sh(this,this.G().then((function(n){return e.a.rb(n,t)})).then((function(t){return th(e,t),e.reload()})))},n.Sc=function(t){var e=this;return sh(this,this.G().then((function(n){return t.b(e.a,n)})).then((function(t){return th(e,t),e.reload()})))},n.sb=function(t){var e=this;return sh(this,this.G().then((function(n){return e.a.sb(n,t)})).then((function(t){return th(e,t),e.reload()})))},n.tb=function(t){if(void 0===t.displayName&&void 0===t.photoURL)return Hc(this);var e=this;return sh(this,this.G().then((function(n){return e.a.tb(n,{displayName:t.displayName,photoUrl:t.photoURL})})).then((function(t){return th(e,t),Jc(e,"displayName",t.displayName||null),Jc(e,"photoURL",t.photoUrl||null),q(e.providerData,(function(t){"password"===t.providerId&&(Vr(t,"displayName",e.displayName),Vr(t,"photoURL",e.photoURL))})),Wc(e)})).then(Gc))},n.Qc=function(t){var e=this;return sh(this,Zc(this).then((function(n){return W(zc(e),t)?function(t,e,n){return ks(t,cs,{idToken:e,deleteProvider:n})}(e.a,n,[t]).then((function(t){var n={};return q(t.providerUserInfo||[],(function(t){n[t.providerId]=!0})),q(zc(e),(function(t){n[t]||Xc(e,t)})),n[To.PROVIDER_ID]||Vr(e,"phoneNumber",null),Wc(e)})):Wc(e).then((function(){throw new ti("no-such-provider")}))})))},n.delete=function(){var t=this;return sh(this,this.G().then((function(e){return ks(t.a,us,{idToken:e})})).then((function(){t.dispatchEvent(new Mc("userDeleted"))}))).then((function(){for(var e=0;e<t.I.length;e++)t.I[e].cancel("app-deleted");xc(t,null),jc(t,null),t.I=[],t.B=!0,Vc(t),Vr(t,"refreshToken",null),t.i&&uc(t.i,t)}))},n.xb=function(t,e){return!!("linkViaPopup"==t&&(this.g||null)==e&&this.f||"reauthViaPopup"==t&&(this.g||null)==e&&this.f||"linkViaRedirect"==t&&(this.ca||null)==e||"reauthViaRedirect"==t&&(this.ca||null)==e)},n.ja=function(t,e,n,r){"linkViaPopup"!=t&&"reauthViaPopup"!=t||r!=(this.g||null)||(n&&this.v?this.v(n):e&&!n&&this.f&&this.f(e),this.c&&(this.c.cancel(),this.c=null),delete this.f,delete this.v)},n.Ba=function(t,e){return"linkViaPopup"==t&&e==(this.g||null)?S(this.Bb,this):"reauthViaPopup"==t&&e==(this.g||null)?S(this.Cb,this):"linkViaRedirect"==t&&(this.ca||null)==e?S(this.Bb,this):"reauthViaRedirect"==t&&(this.ca||null)==e?S(this.Cb,this):null},n.tc=function(t){var e=this;return ih(this,"linkViaPopup",t,(function(){return eh(e,t.providerId).then((function(){return Wc(e)}))}),!1)},n.Cc=function(t){return ih(this,"reauthViaPopup",t,(function(){return Zt()}),!0)},n.uc=function(t){var e=this;return oh(this,"linkViaRedirect",t,(function(){return eh(e,t.providerId)}),!1)},n.Dc=function(t){return oh(this,"reauthViaRedirect",t,(function(){return Zt()}),!0)},n.Bb=function(t,e,n,r){var i=this;this.c&&(this.c.cancel(),this.c=null);var o=null;return sh(this,this.G().then((function(n){return es(i.a,{requestUri:t,postBody:r,sessionId:e,idToken:n})})).then((function(t){return o=nh(i,t,"link"),rh(i,t)})).then((function(){return o})))},n.Cb=function(t,e,n,r){var i=this;this.c&&(this.c.cancel(),this.c=null);var o=null;return sh(this,Zt().then((function(){return zi(ns(i.a,{requestUri:t,sessionId:e,postBody:r,tenantId:n}),i.uid)})).then((function(t){return o=nh(i,t,"reauthenticate"),th(i,t),i.h=null,i.reload()})).then((function(){return o})),!0)},n.jb=function(t){var e=this,n=null;return sh(this,this.G().then((function(e){return n=e,void 0===t||Y(t)?{}:Ei(new pi(t))})).then((function(t){return e.a.jb(n,t)})).then((function(t){if(e.email!=t)return e.reload()})).then((function(){})))},n.toJSON=function(){return this.A()},n.A=function(){var t={uid:this.uid,displayName:this.displayName,photoURL:this.photoURL,email:this.email,emailVerified:this.emailVerified,phoneNumber:this.phoneNumber,isAnonymous:this.isAnonymous,tenantId:this.tenantId,providerData:[],apiKey:this.l,appName:this.m,authDomain:this.o,stsTokenManager:this.b.A(),redirectEventId:this.ca||null};return this.metadata&&$(t,this.metadata.A()),q(this.providerData,(function(e){t.providerData.push(function(t){var e,n={};for(e in t)t.hasOwnProperty(e)&&(n[e]=t[e]);return n}(e))})),t};var hh={name:"redirectUser",C:"session"};function lh(t){return ku(t.b,hh,t.a)}function fh(t){this.a=t,this.b=Du(),this.c=null,this.f=function(t){var e=mh("local"),n=mh("session"),r=mh("none");return function(t,e,n){var r=Ou(e,n),i=Au(t,e.C);return t.get(e,n).then((function(o){var a=null;try{a=Ar(u.localStorage.getItem(r))}catch(t){}if(a&&!o)return u.localStorage.removeItem(r),t.set(e,a,n);a&&o&&"localStorage"!=i.type&&u.localStorage.removeItem(r)}))}(t.b,e,t.a).then((function(){return t.b.get(n,t.a)})).then((function(i){return i?n:t.b.get(r,t.a).then((function(n){return n?r:t.b.get(e,t.a).then((function(n){return n?e:t.b.get(dh,t.a).then((function(t){return t?mh(t):e}))}))}))})).then((function(e){return t.c=e,ph(t,e.C)})).s((function(){t.c||(t.c=e)}))}(this),this.b.addListener(mh("local"),this.a,S(this.g,this))}function ph(t,e){var n,r=[];for(n in Cu)Cu[n]!==e&&r.push(ku(t.b,mh(Cu[n]),t.a));return r.push(ku(t.b,dh,t.a)),function(t){return new Gt((function(e,n){var r=t.length,i=[];if(r)for(var o=function(t,n){r--,i[t]=n,0==r&&e(i)},a=function(t){n(t)},s=0;s<t.length;s++)ee(t[s],I(o,s),a);else e(i)}))}(r)}fh.prototype.g=function(){var t=this,e=mh("local");bh(this,(function(){return Zt().then((function(){return t.c&&"local"!=t.c.C?t.b.get(e,t.a):null})).then((function(n){if(n)return ph(t,"local").then((function(){t.c=e}))}))}))};var dh={name:"persistence",C:"session"};function mh(t){return{name:"authUser",C:t}}function yh(t,e){return bh(t,(function(){return t.b.set(t.c,e.A(),t.a)}))}function gh(t){return bh(t,(function(){return ku(t.b,t.c,t.a)}))}function vh(t,e){return bh(t,(function(){return t.b.get(t.c,t.a).then((function(t){return t&&e&&(t.authDomain=e),uh(t||{})}))}))}function bh(t,e){return t.f=t.f.then(e,e),t.f}function wh(t){if(this.l=!1,Vr(this,"settings",new Ec),Vr(this,"app",t),!Dh(this).options||!Dh(this).options.apiKey)throw new ti("invalid-api-key");t=e.default.SDK_VERSION?br(e.default.SDK_VERSION):null,this.b=new Ma(Dh(this).options&&Dh(this).options.apiKey,Ri(Oi),t),this.O=[],this.m=[],this.J=[],this.Ub=e.default.INTERNAL.createSubscribe(S(this.oc,this)),this.W=void 0,this.Vb=e.default.INTERNAL.createSubscribe(S(this.pc,this)),Ch(this,null),this.h=new fh(Dh(this).options.apiKey+":"+Dh(this).name),this.w=new ch(Dh(this).options.apiKey+":"+Dh(this).name),this.Y=Rh(this,function(t){var e=Dh(t).options.authDomain,n=function(t){var e=function(t,e){return t.b.get(hh,t.a).then((function(t){return t&&e&&(t.authDomain=e),uh(t||{})}))}(t.w,Dh(t).options.authDomain).then((function(e){return(t.B=e)&&(e.da=t.w),lh(t.w)}));return Rh(t,e)}(t).then((function(){return vh(t.h,e)})).then((function(e){return e?(e.da=t.w,t.B&&(t.B.ca||null)==(e.ca||null)?e:e.reload().then((function(){return yh(t.h,e).then((function(){return e}))})).s((function(n){return"auth/network-request-failed"==n.code?e:gh(t.h)}))):null})).then((function(e){Ch(t,e||null)}));return Rh(t,n)}(this)),this.i=Rh(this,function(t){return t.Y.then((function(){return Sh(t)})).s((function(){})).then((function(){if(!t.l)return t.ma()})).s((function(){})).then((function(){if(!t.l){t.ga=!0;var e=t.h;e.b.addListener(mh("local"),e.a,t.ma)}}))}(this)),this.ga=!1,this.ma=S(this.Nc,this),this.ub=S(this.aa,this),this.wa=S(this.bc,this),this.xa=S(this.mc,this),this.Ja=S(this.nc,this),this.a=null,function(t){var e=Dh(t).options.authDomain,n=Dh(t).options.apiKey;e&&Er()&&(t.Tb=t.Y.then((function(){if(!t.l){if(t.a=yc(e,n,Dh(t).name),sc(t.a,t),Ah(t)&&Kc(Ah(t)),t.B){Kc(t.B);var r=t.B;r.ua(t.ha()),xc(r,t),Fc(r=t.B,t.I),jc(r,t),t.B=null}return t.a}})))}(this),this.INTERNAL={},this.INTERNAL.delete=S(this.delete,this),this.INTERNAL.logFramework=S(this.vc,this),this.o=0,un.call(this),function(t){Object.defineProperty(t,"lc",{get:function(){return this.ha()},set:function(t){this.ua(t)},enumerable:!1}),t.Z=null,Object.defineProperty(t,"ti",{get:function(){return this.R()},set:function(t){this.nb(t)},enumerable:!1}),t.P=null}(this),this.I=[]}function Th(t){Fe.call(this,"languageCodeChanged"),this.g=t}function _h(t){Fe.call(this,"frameworkChanged"),this.c=t}function Eh(t){return t.Tb||te(new ti("auth-domain-config-required"))}function Sh(t){if(!Er())return te(new ti("operation-not-supported-in-this-environment"));var e=Eh(t).then((function(){return t.a.oa()})).then((function(t){return t?Wr(t):null}));return Rh(t,e)}function Ih(t,e){var n={};return n.apiKey=Dh(t).options.apiKey,n.authDomain=Dh(t).options.authDomain,n.appName=Dh(t).name,t.Y.then((function(){return function(t,e,n,r){var i=new Lc(t,e);return n&&(i.da=n),r&&Fc(i,r),i.reload().then((function(){return i}))}(n,e,t.w,t.Ca())})).then((function(e){return Ah(t)&&e.uid==Ah(t).uid?($c(Ah(t),e),t.aa(e)):(Ch(t,e),Kc(e),t.aa(e))})).then((function(){kh(t)}))}function Ch(t,e){Ah(t)&&(function(t,e){Q(t.O,(function(t){return t==e}))}(Ah(t),t.ub),$e(Ah(t),"tokenChanged",t.wa),$e(Ah(t),"userDeleted",t.xa),$e(Ah(t),"userInvalidated",t.Ja),Vc(Ah(t))),e&&(e.O.push(t.ub),Ye(e,"tokenChanged",t.wa),Ye(e,"userDeleted",t.xa),Ye(e,"userInvalidated",t.Ja),0<t.o&&qc(e)),Vr(t,"currentUser",e),e&&(e.ua(t.ha()),xc(e,t),Fc(e,t.I),jc(e,t))}function Nh(t,e){var n=null,r=null;return Rh(t,e.then((function(e){return n=Eo(e),r=Fi(e),Ih(t,e)})).then((function(){return Wr({user:Ah(t),credential:n,additionalUserInfo:r,operationType:"signIn"})})))}function Dh(t){return t.app}function Ah(t){return t.currentUser}function Oh(t){return Ah(t)&&Ah(t)._lat||null}function kh(t){if(t.ga){for(var e=0;e<t.m.length;e++)t.m[e]&&t.m[e](Oh(t));if(t.W!==t.getUid()&&t.J.length)for(t.W=t.getUid(),e=0;e<t.J.length;e++)t.J[e]&&t.J[e](Oh(t))}}function Rh(t,e){return t.O.push(e),e.ka((function(){K(t.O,e)})),e}function Ph(){}function Mh(){this.a={},this.b=1e12}fh.prototype.mb=function(t){var e=null,n=this;return function(t){var e=new ti("invalid-persistence-type"),n=new ti("unsupported-persistence-type");t:{for(r in Cu)if(Cu[r]==t){var r=!0;break t}r=!1}if(!r||"string"!=typeof t)throw e;switch(pr()){case"ReactNative":if("session"===t)throw n;break;case"Node":if("none"!==t)throw n;break;default:if(!_r()&&"none"!==t)throw n}}(t),bh(this,(function(){return t!=n.c.C?n.b.get(n.c,n.a).then((function(r){return e=r,ph(n,t)})).then((function(){if(n.c=mh(t),e)return n.b.set(n.c,e,n.a)})):Zt()}))},N(wh,un),N(Th,Fe),N(_h,Fe),(n=wh.prototype).mb=function(t){return Rh(this,t=this.h.mb(t))},n.ua=function(t){this.Z===t||this.l||(this.Z=t,Va(this.b,this.Z),this.dispatchEvent(new Th(this.ha())))},n.ha=function(){return this.Z},n.Tc=function(){var t=u.navigator;this.ua(t&&(t.languages&&t.languages[0]||t.language||t.userLanguage)||null)},n.vc=function(t){this.I.push(t),Ba(this.b,e.default.SDK_VERSION?br(e.default.SDK_VERSION,this.I):null),this.dispatchEvent(new _h(this.I))},n.Ca=function(){return H(this.I)},n.nb=function(t){this.P===t||this.l||(this.P=t,this.b.b=this.P)},n.R=function(){return this.P},n.toJSON=function(){return{apiKey:Dh(this).options.apiKey,authDomain:Dh(this).options.authDomain,appName:Dh(this).name,currentUser:Ah(this)&&Ah(this).A()}},n.xb=function(t,e){switch(t){case"unknown":case"signInViaRedirect":return!0;case"signInViaPopup":return this.g==e&&!!this.f;default:return!1}},n.ja=function(t,e,n,r){"signInViaPopup"==t&&this.g==r&&(n&&this.v?this.v(n):e&&!n&&this.f&&this.f(e),this.c&&(this.c.cancel(),this.c=null),delete this.f,delete this.v)},n.Ba=function(t,e){return"signInViaRedirect"==t||"signInViaPopup"==t&&this.g==e&&this.f?S(this.ac,this):null},n.ac=function(t,e,n,r){var i=this;t={requestUri:t,postBody:r,sessionId:e,tenantId:n},this.c&&(this.c.cancel(),this.c=null);var o=null,a=null,s=ts(i.b,t).then((function(t){return o=Eo(t),a=Fi(t),t}));return Rh(this,t=i.Y.then((function(){return s})).then((function(t){return Ih(i,t)})).then((function(){return Wr({user:Ah(i),credential:o,additionalUserInfo:a,operationType:"signIn"})})))},n.Lc=function(t){if(!Er())return te(new ti("operation-not-supported-in-this-environment"));var n=this,r=xi(t.providerId),i=Or(),o=null;(!Cr()||lr())&&Dh(this).options.authDomain&&t.isOAuthProvider&&(o=Gs(Dh(this).options.authDomain,Dh(this).options.apiKey,Dh(this).name,"signInViaPopup",t,null,i,e.default.SDK_VERSION||null,null,null,this.R()));var a=ar(o,r&&r.sa,r&&r.ra);return Rh(this,r=Eh(this).then((function(e){return lc(e,a,"signInViaPopup",t,i,!!o,n.R())})).then((function(){return new Gt((function(t,e){n.ja("signInViaPopup",null,new ti("cancelled-popup-request"),n.g),n.f=t,n.v=e,n.g=i,n.c=dc(n.a,n,"signInViaPopup",a,i)}))})).then((function(t){return a&&or(a),t?Wr(t):null})).s((function(t){throw a&&or(a),t})))},n.Mc=function(t){if(!Er())return te(new ti("operation-not-supported-in-this-environment"));var e=this;return Rh(this,Eh(this).then((function(){return function(t){return bh(t,(function(){return t.b.set(dh,t.c.C,t.a)}))}(e.h)})).then((function(){return pc(e.a,"signInViaRedirect",t,void 0,e.R())})))},n.oa=function(){var t=this;return Sh(this).then((function(e){return t.a&&bc(t.a.b),e})).s((function(e){throw t.a&&bc(t.a.b),e}))},n.Rc=function(t){if(!t)return te(new ti("null-user"));if(this.P!=t.tenantId)return te(new ti("tenant-id-mismatch"));var e=this,n={};n.apiKey=Dh(this).options.apiKey,n.authDomain=Dh(this).options.authDomain,n.appName=Dh(this).name;var r=function(t,e,n,r){e=e||{apiKey:t.l,authDomain:t.o,appName:t.m};var i=t.b,o={};return o[xa]=i.b,o.refreshToken=i.a,o.expiresIn=(i.c-C())/1e3,e=new Lc(e,o),n&&(e.da=n),r&&Fc(e,r),$c(e,t),e}(t,n,e.w,e.Ca());return Rh(this,this.i.then((function(){if(Dh(e).options.apiKey!=t.l)return r.reload()})).then((function(){return Ah(e)&&t.uid==Ah(e).uid?($c(Ah(e),t),e.aa(t)):(Ch(e,r),Kc(r),e.aa(r))})).then((function(){kh(e)})))},n.pb=function(){var t=this;return Rh(this,this.i.then((function(){return t.a&&bc(t.a.b),Ah(t)?(Ch(t,null),gh(t.h).then((function(){kh(t)}))):Zt()})))},n.Nc=function(){var t=this;return vh(this.h,Dh(this).options.authDomain).then((function(e){if(!t.l){var n;if(n=Ah(t)&&e){n=Ah(t).uid;var r=e.uid;n=null!=n&&""!==n&&null!=r&&""!==r&&n==r}if(n)return $c(Ah(t),e),Ah(t).G();(Ah(t)||e)&&(Ch(t,e),e&&(Kc(e),e.da=t.w),t.a&&sc(t.a,t),kh(t))}}))},n.aa=function(t){return yh(this.h,t)},n.bc=function(){kh(this),this.aa(Ah(this))},n.mc=function(){this.pb()},n.nc=function(){this.pb()},n.oc=function(t){var e=this;this.addAuthTokenListener((function(){t.next(Ah(e))}))},n.pc=function(t){var e=this;!function(t,e){t.J.push(e),Rh(t,t.i.then((function(){!t.l&&W(t.J,e)&&t.W!==t.getUid()&&(t.W=t.getUid(),e(Oh(t)))})))}(this,(function(){t.next(Ah(e))}))},n.xc=function(t,e,n){var r=this;return this.ga&&Promise.resolve().then((function(){v(t)?t(Ah(r)):v(t.next)&&t.next(Ah(r))})),this.Ub(t,e,n)},n.wc=function(t,e,n){var r=this;return this.ga&&Promise.resolve().then((function(){r.W=r.getUid(),v(t)?t(Ah(r)):v(t.next)&&t.next(Ah(r))})),this.Vb(t,e,n)},n.cc=function(t){var e=this;return Rh(this,this.i.then((function(){return Ah(e)?Ah(e).G(t).then((function(t){return{accessToken:t}})):null})))},n.Hc=function(t){var e=this;return this.i.then((function(){return Nh(e,ks(e.b,Cs,{token:t}))})).then((function(t){var n=t.user;return Jc(n,"isAnonymous",!1),e.aa(n),t}))},n.Ic=function(t,e){var n=this;return this.i.then((function(){return Nh(n,ks(n.b,Ns,{email:t,password:e}))}))},n.Xb=function(t,e){var n=this;return this.i.then((function(){return Nh(n,ks(n.b,as,{email:t,password:e}))}))},n.Sa=function(t){var e=this;return this.i.then((function(){return Nh(e,t.na(e.b))}))},n.Gc=function(t){return Ur("firebase.auth.Auth.prototype.signInAndRetrieveDataWithCredential is deprecated. Please use firebase.auth.Auth.prototype.signInWithCredential instead."),this.Sa(t)},n.ob=function(){var t=this;return this.i.then((function(){var e=Ah(t);if(e&&e.isAnonymous){var n=Wr({providerId:null,isNewUser:!1});return Wr({user:e,credential:null,additionalUserInfo:n,operationType:"signIn"})}return Nh(t,t.b.ob()).then((function(e){var n=e.user;return Jc(n,"isAnonymous",!0),t.aa(n),e}))}))},n.getUid=function(){return Ah(this)&&Ah(this).uid||null},n.Wb=function(t){this.addAuthTokenListener(t),this.o++,0<this.o&&Ah(this)&&qc(Ah(this))},n.Ec=function(t){var e=this;q(this.m,(function(n){n==t&&e.o--})),0>this.o&&(this.o=0),0==this.o&&Ah(this)&&Vc(Ah(this)),this.removeAuthTokenListener(t)},n.addAuthTokenListener=function(t){var e=this;this.m.push(t),Rh(this,this.i.then((function(){e.l||W(e.m,t)&&t(Oh(e))})))},n.removeAuthTokenListener=function(t){Q(this.m,(function(e){return e==t}))},n.delete=function(){this.l=!0;for(var t=0;t<this.O.length;t++)this.O[t].cancel("app-deleted");return this.O=[],this.h&&(t=this.h).b.removeListener(mh("local"),t.a,this.ma),this.a&&(uc(this.a,this),bc(this.a.b)),Promise.resolve()},n.$b=function(t){return Rh(this,function(t,e){return ks(t,ss,{identifier:e,continueUri:Sr()?nr():"http://localhost"}).then((function(t){return t.signinMethods||[]}))}(this.b,t))},n.qc=function(t){return!!go(t)},n.lb=function(t,e){var n=this;return Rh(this,Zt().then((function(){var t=new pi(e);if(!t.c)throw new ti("argument-error",yi+" must be true when sending sign in link to email");return Ei(t)})).then((function(e){return n.b.lb(t,e)})).then((function(){})))},n.Uc=function(t){return this.Ma(t).then((function(t){return t.data.email}))},n.ab=function(t,e){return Rh(this,this.b.ab(t,e).then((function(){})))},n.Ma=function(t){return Rh(this,this.b.Ma(t).then((function(t){return new Qr(t)})))},n.Ya=function(t){return Rh(this,this.b.Ya(t).then((function(){})))},n.kb=function(t,e){var n=this;return Rh(this,Zt().then((function(){return void 0===e||Y(e)?{}:Ei(new pi(e))})).then((function(e){return n.b.kb(t,e)})).then((function(){})))},n.Kc=function(t,e){return Rh(this,Ic(this,t,e,S(this.Sa,this)))},n.Jc=function(t,e){var n=this;return Rh(this,Zt().then((function(){var r=e||nr(),i=yo(t,r);if(!(r=go(r)))throw new ti("argument-error","Invalid email link!");if(r.tenantId!==n.R())throw new ti("tenant-id-mismatch");return n.Sa(i)})))},Ph.prototype.render=function(){},Ph.prototype.reset=function(){},Ph.prototype.getResponse=function(){},Ph.prototype.execute=function(){};var Lh=null;function xh(t,e){return(e=Fh(e))&&t.a[e]||null}function Fh(t){return(t=void 0===t?1e12:t)?t.toString():null}function jh(t,e){this.g=!1,this.c=e,this.a=this.b=null,this.h="invisible"!==this.c.size,this.f=Qn(t);var n=this;this.i=function(){n.execute()},this.h?this.execute():Ye(this.f,"click",this.i)}function Uh(t){if(t.g)throw Error("reCAPTCHA mock was already deleted!")}function qh(){}Mh.prototype.render=function(t,e){return this.a[this.b.toString()]=new jh(t,e),this.b++},Mh.prototype.reset=function(t){var e=xh(this,t);t=Fh(t),e&&t&&(e.delete(),delete this.a[t])},Mh.prototype.getResponse=function(t){return(t=xh(this,t))?t.getResponse():null},Mh.prototype.execute=function(t){(t=xh(this,t))&&t.execute()},jh.prototype.getResponse=function(){return Uh(this),this.b},jh.prototype.execute=function(){Uh(this);var t=this;this.a||(this.a=setTimeout((function(){t.b=function(){for(var t=50,e=[];0<t;)e.push("1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ".charAt(Math.floor(62*Math.random()))),t--;return e.join("")}();var e=t.c.callback,n=t.c["expired-callback"];if(e)try{e(t.b)}catch(t){}t.a=setTimeout((function(){if(t.a=null,t.b=null,n)try{n()}catch(t){}t.h&&t.execute()}),6e4)}),500))},jh.prototype.delete=function(){Uh(this),this.g=!0,clearTimeout(this.a),this.a=null,$e(this.f,"click",this.i)},qh.prototype.g=function(){return Lh||(Lh=new Mh),Zt(Lh)},qh.prototype.c=function(){};var Vh=null;function Bh(){this.b=u.grecaptcha?1/0:0,this.f=null,this.a="__rcb"+Math.floor(1e6*Math.random()).toString()}var Wh=new Z(nt,"https://www.google.com/recaptcha/api.js?onload=%{onload}&render=explicit&hl=%{hl}"),Kh=new Pr(3e4,6e4);Bh.prototype.g=function(t){var e=this;return new Gt((function(n,r){var i=setTimeout((function(){r(new ti("network-request-failed"))}),Kh.get());!u.grecaptcha||t!==e.f&&!e.b?(u[e.a]=function(){if(u.grecaptcha){e.f=t;var o=u.grecaptcha.render;u.grecaptcha.render=function(t,n){return t=o(t,n),e.b++,t},clearTimeout(i),n(u.grecaptcha)}else clearTimeout(i),r(new ti("internal-error"));delete u[e.a]},Zt(Na(at(Wh,{onload:e.a,hl:t||""}))).s((function(){clearTimeout(i),r(new ti("internal-error","Unable to load external reCAPTCHA dependencies!"))}))):(clearTimeout(i),n(u.grecaptcha))}))},Bh.prototype.c=function(){this.b--};var Qh=null;function Gh(t,e,n,r,i,o,a){if(Vr(this,"type","recaptcha"),this.c=this.f=null,this.B=!1,this.u=e,this.g=null,a?(Vh||(Vh=new qh),a=Vh):(Qh||(Qh=new Bh),a=Qh),this.m=a,this.a=n||{theme:"light",type:"image"},this.h=[],this.a[Yh])throw new ti("argument-error","sitekey should not be provided for reCAPTCHA as one is automatically provisioned for the current project.");if(this.i="invisible"===this.a[Xh],!u.document)throw new ti("operation-not-supported-in-this-environment","RecaptchaVerifier is only supported in a browser HTTP/HTTPS environment with DOM support.");if(!Qn(e)||!this.i&&Qn(e).hasChildNodes())throw new ti("argument-error","reCAPTCHA container is either not found or already contains inner elements!");this.o=new Ma(t,o||null,i||null),this.v=r||function(){return null};var s=this;this.l=[];var c=this.a[Hh];this.a[Hh]=function(t){if(Jh(s,t),"function"==typeof c)c(t);else if("string"==typeof c){var e=Tr(c,u);"function"==typeof e&&e(t)}};var h=this.a[zh];this.a[zh]=function(){if(Jh(s,null),"function"==typeof h)h();else if("string"==typeof h){var t=Tr(h,u);"function"==typeof t&&t()}}}var Hh="callback",zh="expired-callback",Yh="sitekey",Xh="size";function Jh(t,e){for(var n=0;n<t.l.length;n++)try{t.l[n](e)}catch(t){}}function $h(t,e){return t.h.push(e),e.ka((function(){K(t.h,e)})),e}function Zh(t){if(t.B)throw new ti("internal-error","RecaptchaVerifier instance has been destroyed.")}function tl(t,n,r){var i=!1;try{this.b=r||e.default.app()}catch(t){throw new ti("argument-error","No firebase.app.App instance is currently initialized.")}if(!this.b.options||!this.b.options.apiKey)throw new ti("invalid-api-key");r=this.b.options.apiKey;var o=this,a=null;try{a=this.b.auth().Ca()}catch(t){}try{i=this.b.auth().settings.appVerificationDisabledForTesting}catch(t){}a=e.default.SDK_VERSION?br(e.default.SDK_VERSION,a):null,Gh.call(this,r,t,n,(function(){try{var t=o.b.auth().ha()}catch(e){t=null}return t}),a,Ri(Oi),i)}function el(t,e,n,r){t:{n=Array.prototype.slice.call(n);for(var i=0,o=!1,a=0;a<e.length;a++)if(e[a].optional)o=!0;else{if(o)throw new ti("internal-error","Argument validator encountered a required argument after an optional argument.");i++}if(o=e.length,n.length<i||o<n.length)r="Expected "+(i==o?1==i?"1 argument":i+" arguments":i+"-"+o+" arguments")+" but got "+n.length+".";else{for(i=0;i<n.length;i++)if(o=e[i].optional&&void 0===n[i],!e[i].N(n[i])&&!o){if(e=e[i],0>i||i>=nl.length)throw new ti("internal-error","Argument validator received an unsupported number of arguments.");n=nl[i],r=(r?"":n+" argument ")+(e.name?'"'+e.name+'" ':"")+"must be "+e.M+".";break t}r=null}}if(r)throw new ti("argument-error",t+" failed: "+r)}(n=Gh.prototype).Da=function(){var t=this;return this.f?this.f:this.f=$h(this,Zt().then((function(){if(Sr()&&!fr())return cr();throw new ti("operation-not-supported-in-this-environment","RecaptchaVerifier is only supported in a browser HTTP/HTTPS environment.")})).then((function(){return t.m.g(t.v())})).then((function(e){return t.g=e,ks(t.o,gs,{})})).then((function(e){t.a[Yh]=e.recaptchaSiteKey})).s((function(e){throw t.f=null,e})))},n.render=function(){Zh(this);var t=this;return $h(this,this.Da().then((function(){if(null===t.c){var e=t.u;if(!t.i){var n=Qn(e);e=function(t,e,n){var r=arguments,i=document,o=String(r[0]),a=r[1];if(!Kn&&a&&(a.name||a.type)){if(o=["<",o],a.name&&o.push(' name="',Ut(a.name),'"'),a.type){o.push(' type="',Ut(a.type),'"');var s={};$(s,a),delete s.type,a=s}o.push(">"),o=o.join("")}return o=i.createElement(o),a&&(c(a)?o.className=a:y(a)?o.className=a.join(" "):Gn(o,a)),2<r.length&&zn(i,o,r),o}("DIV"),n.appendChild(e)}t.c=t.g.render(e,t.a)}return t.c})))},n.verify=function(){Zh(this);var t=this;return $h(this,this.render().then((function(e){return new Gt((function(n){var r=t.g.getResponse(e);if(r)n(r);else{var i=function(e){e&&(function(t,e){Q(t.l,(function(t){return t==e}))}(t,i),n(e))};t.l.push(i),t.i&&t.g.execute(t.c)}}))})))},n.reset=function(){Zh(this),null!==this.c&&this.g.reset(this.c)},n.clear=function(){Zh(this),this.B=!0,this.m.c();for(var t=0;t<this.h.length;t++)this.h[t].cancel("RecaptchaVerifier instance has been destroyed.");if(!this.i){t=Qn(this.u);for(var e;e=t.firstChild;)t.removeChild(e)}},N(tl,Gh);var nl="First Second Third Fourth Fifth Sixth Seventh Eighth Ninth".split(" ");function rl(t,e){return{name:t||"",M:"a valid string",optional:!!e,N:c}}function il(t,e){return{name:t||"",M:"a boolean",optional:!!e,N:h}}function ol(t,e){return{name:t||"",M:"a valid object",optional:!!e,N:b}}function al(t,e){return{name:t||"",M:"a function",optional:!!e,N:v}}function sl(t,e){return{name:t||"",M:"null",optional:!!e,N:m}}function ul(t){return{name:t?t+"Credential":"credential",M:t?"a valid "+t+" credential":"a valid credential",optional:!1,N:function(e){if(!e)return!1;var n=!t||e.providerId===t;return!(!e.na||!n)}}}function cl(){return{name:"applicationVerifier",M:"an implementation of firebase.auth.ApplicationVerifier",optional:!1,N:function(t){return!!(t&&c(t.type)&&v(t.verify))}}}function hl(t,e,n,r){return{name:n||"",M:t.M+" or "+e.M,optional:!!r,N:function(n){return t.N(n)||e.N(n)}}}function ll(t,e){for(var n in e){var r=e[n].name;t[r]=dl(r,t[n],e[n].j)}}function fl(t,e){for(var n in e){var r=e[n].name;r!==n&&Object.defineProperty(t,r,{get:I((function(t){return this[t]}),n),set:I((function(t,e,n,r){el(t,[n],[r],!0),this[e]=r}),r,n,e[n].Za),enumerable:!0})}}function pl(t,e,n,r){t[e]=dl(e,n,r)}function dl(t,e,n){function r(){var t=Array.prototype.slice.call(arguments);return el(o,n,t),e.apply(this,t)}if(!n)return e;var i,o=function(t){return(t=t.split("."))[t.length-1]}(t);for(i in e)r[i]=e[i];for(i in e.prototype)r.prototype[i]=e.prototype[i];return r}ll(wh.prototype,{Ya:{name:"applyActionCode",j:[rl("code")]},Ma:{name:"checkActionCode",j:[rl("code")]},ab:{name:"confirmPasswordReset",j:[rl("code"),rl("newPassword")]},Xb:{name:"createUserWithEmailAndPassword",j:[rl("email"),rl("password")]},$b:{name:"fetchSignInMethodsForEmail",j:[rl("email")]},oa:{name:"getRedirectResult",j:[]},qc:{name:"isSignInWithEmailLink",j:[rl("emailLink")]},wc:{name:"onAuthStateChanged",j:[hl(ol(),al(),"nextOrObserver"),al("opt_error",!0),al("opt_completed",!0)]},xc:{name:"onIdTokenChanged",j:[hl(ol(),al(),"nextOrObserver"),al("opt_error",!0),al("opt_completed",!0)]},kb:{name:"sendPasswordResetEmail",j:[rl("email"),hl(ol("opt_actionCodeSettings",!0),sl(null,!0),"opt_actionCodeSettings",!0)]},lb:{name:"sendSignInLinkToEmail",j:[rl("email"),ol("actionCodeSettings")]},mb:{name:"setPersistence",j:[rl("persistence")]},Gc:{name:"signInAndRetrieveDataWithCredential",j:[ul()]},ob:{name:"signInAnonymously",j:[]},Sa:{name:"signInWithCredential",j:[ul()]},Hc:{name:"signInWithCustomToken",j:[rl("token")]},Ic:{name:"signInWithEmailAndPassword",j:[rl("email"),rl("password")]},Jc:{name:"signInWithEmailLink",j:[rl("email"),rl("emailLink",!0)]},Kc:{name:"signInWithPhoneNumber",j:[rl("phoneNumber"),cl()]},Lc:{name:"signInWithPopup",j:[{name:"authProvider",M:"a valid Auth provider",optional:!1,N:function(t){return!!(t&&t.providerId&&t.hasOwnProperty&&t.hasOwnProperty("isOAuthProvider"))}}]},Mc:{name:"signInWithRedirect",j:[{name:"authProvider",M:"a valid Auth provider",optional:!1,N:function(t){return!!(t&&t.providerId&&t.hasOwnProperty&&t.hasOwnProperty("isOAuthProvider"))}}]},Rc:{name:"updateCurrentUser",j:[hl({name:"user",M:"an instance of Firebase User",optional:!1,N:function(t){return!!(t&&t instanceof Lc)}},sl(),"user")]},pb:{name:"signOut",j:[]},toJSON:{name:"toJSON",j:[rl(null,!0)]},Tc:{name:"useDeviceLanguage",j:[]},Uc:{name:"verifyPasswordResetCode",j:[rl("code")]}}),fl(wh.prototype,{lc:{name:"languageCode",Za:hl(rl(),sl(),"languageCode")},ti:{name:"tenantId",Za:hl(rl(),sl(),"tenantId")}}),wh.Persistence=Cu,wh.Persistence.LOCAL="local",wh.Persistence.SESSION="session",wh.Persistence.NONE="none",ll(Lc.prototype,{delete:{name:"delete",j:[]},dc:{name:"getIdTokenResult",j:[il("opt_forceRefresh",!0)]},G:{name:"getIdToken",j:[il("opt_forceRefresh",!0)]},rc:{name:"linkAndRetrieveDataWithCredential",j:[ul()]},fb:{name:"linkWithCredential",j:[ul()]},sc:{name:"linkWithPhoneNumber",j:[rl("phoneNumber"),cl()]},tc:{name:"linkWithPopup",j:[{name:"authProvider",M:"a valid Auth provider",optional:!1,N:function(t){return!!(t&&t.providerId&&t.hasOwnProperty&&t.hasOwnProperty("isOAuthProvider"))}}]},uc:{name:"linkWithRedirect",j:[{name:"authProvider",M:"a valid Auth provider",optional:!1,N:function(t){return!!(t&&t.providerId&&t.hasOwnProperty&&t.hasOwnProperty("isOAuthProvider"))}}]},Ac:{name:"reauthenticateAndRetrieveDataWithCredential",j:[ul()]},hb:{name:"reauthenticateWithCredential",j:[ul()]},Bc:{name:"reauthenticateWithPhoneNumber",j:[rl("phoneNumber"),cl()]},Cc:{name:"reauthenticateWithPopup",j:[{name:"authProvider",M:"a valid Auth provider",optional:!1,N:function(t){return!!(t&&t.providerId&&t.hasOwnProperty&&t.hasOwnProperty("isOAuthProvider"))}}]},Dc:{name:"reauthenticateWithRedirect",j:[{name:"authProvider",M:"a valid Auth provider",optional:!1,N:function(t){return!!(t&&t.providerId&&t.hasOwnProperty&&t.hasOwnProperty("isOAuthProvider"))}}]},reload:{name:"reload",j:[]},jb:{name:"sendEmailVerification",j:[hl(ol("opt_actionCodeSettings",!0),sl(null,!0),"opt_actionCodeSettings",!0)]},toJSON:{name:"toJSON",j:[rl(null,!0)]},Qc:{name:"unlink",j:[rl("provider")]},rb:{name:"updateEmail",j:[rl("email")]},sb:{name:"updatePassword",j:[rl("password")]},Sc:{name:"updatePhoneNumber",j:[ul("phone")]},tb:{name:"updateProfile",j:[ol("profile")]}}),ll(Mh.prototype,{execute:{name:"execute"},render:{name:"render"},reset:{name:"reset"},getResponse:{name:"getResponse"}}),ll(Ph.prototype,{execute:{name:"execute"},render:{name:"render"},reset:{name:"reset"},getResponse:{name:"getResponse"}}),ll(Gt.prototype,{ka:{name:"finally"},s:{name:"catch"},then:{name:"then"}}),fl(Ec.prototype,{appVerificationDisabled:{name:"appVerificationDisabledForTesting",Za:il("appVerificationDisabledForTesting")}}),ll(Sc.prototype,{confirm:{name:"confirm",j:[rl("verificationCode")]}}),pl(Hi,"fromJSON",(function(t){t=c(t)?JSON.parse(t):t;for(var e,n=[to,po,bo,Ji],r=0;r<n.length;r++)if(e=n[r](t))return e;return null}),[hl(rl(),ol(),"json")]),pl(mo,"credential",(function(t,e){return new fo(t,e)}),[rl("email"),rl("password")]),ll(fo.prototype,{A:{name:"toJSON",j:[rl(null,!0)]}}),ll(io.prototype,{ya:{name:"addScope",j:[rl("scope")]},Ga:{name:"setCustomParameters",j:[ol("customOAuthParameters")]}}),pl(io,"credential",oo,[hl(rl(),ol(),"token")]),pl(mo,"credentialWithLink",yo,[rl("email"),rl("emailLink")]),ll(ao.prototype,{ya:{name:"addScope",j:[rl("scope")]},Ga:{name:"setCustomParameters",j:[ol("customOAuthParameters")]}}),pl(ao,"credential",so,[hl(rl(),ol(),"token")]),ll(uo.prototype,{ya:{name:"addScope",j:[rl("scope")]},Ga:{name:"setCustomParameters",j:[ol("customOAuthParameters")]}}),pl(uo,"credential",co,[hl(rl(),hl(ol(),sl()),"idToken"),hl(rl(),sl(),"accessToken",!0)]),ll(ho.prototype,{Ga:{name:"setCustomParameters",j:[ol("customOAuthParameters")]}}),pl(ho,"credential",lo,[hl(rl(),ol(),"token"),rl("secret",!0)]),ll(ro.prototype,{ya:{name:"addScope",j:[rl("scope")]},credential:{name:"credential",j:[hl(rl(),hl(ol(),sl()),"optionsOrIdToken"),hl(rl(),sl(),"accessToken",!0)]},Ga:{name:"setCustomParameters",j:[ol("customOAuthParameters")]}}),ll($i.prototype,{A:{name:"toJSON",j:[rl(null,!0)]}}),ll(Yi.prototype,{A:{name:"toJSON",j:[rl(null,!0)]}}),pl(To,"credential",_o,[rl("verificationId"),rl("verificationCode")]),ll(To.prototype,{Wa:{name:"verifyPhoneNumber",j:[rl("phoneNumber"),cl()]}}),ll(vo.prototype,{A:{name:"toJSON",j:[rl(null,!0)]}}),ll(ti.prototype,{toJSON:{name:"toJSON",j:[rl(null,!0)]}}),ll(ko.prototype,{toJSON:{name:"toJSON",j:[rl(null,!0)]}}),ll(Oo.prototype,{toJSON:{name:"toJSON",j:[rl(null,!0)]}}),ll(tl.prototype,{clear:{name:"clear",j:[]},render:{name:"render",j:[]},verify:{name:"verify",j:[]}}),pl(ii,"parseLink",fi,[rl("link")]),function(){if(void 0===e.default||!e.default.INTERNAL||!e.default.INTERNAL.registerComponent)throw Error("Cannot find the firebase namespace; be sure to include firebase-app.js before this library.");var t={ActionCodeInfo:{Operation:{EMAIL_SIGNIN:Gr,PASSWORD_RESET:"PASSWORD_RESET",RECOVER_EMAIL:"RECOVER_EMAIL",VERIFY_EMAIL:"VERIFY_EMAIL"}},Auth:wh,AuthCredential:Hi,Error:ti};pl(t,"EmailAuthProvider",mo,[]),pl(t,"FacebookAuthProvider",io,[]),pl(t,"GithubAuthProvider",ao,[]),pl(t,"GoogleAuthProvider",uo,[]),pl(t,"TwitterAuthProvider",ho,[]),pl(t,"OAuthProvider",ro,[rl("providerId")]),pl(t,"SAMLAuthProvider",no,[rl("providerId")]),pl(t,"PhoneAuthProvider",To,[{name:"auth",M:"an instance of Firebase Auth",optional:!0,N:function(t){return!!(t&&t instanceof wh)}}]),pl(t,"RecaptchaVerifier",tl,[hl(rl(),{name:"",M:"an HTML element",optional:!1,N:function(t){return!!(t&&t instanceof Element)}},"recaptchaContainer"),ol("recaptchaParameters",!0),{name:"app",M:"an instance of Firebase App",optional:!0,N:function(t){return!!(t&&t instanceof e.default.app.App)}}]),pl(t,"ActionCodeURL",ii,[]),e.default.INTERNAL.registerComponent({name:"auth",instanceFactory:function(t){return new wh(t=t.getProvider("app").getImmediate())},multipleInstances:!1,serviceProps:t,instantiationMode:"LAZY",type:"PUBLIC"}),e.default.INTERNAL.registerComponent({name:"auth-internal",instanceFactory:function(t){return{getUid:S((t=t.getProvider("auth").getImmediate()).getUid,t),getToken:S(t.cc,t),addAuthTokenListener:S(t.Wb,t),removeAuthTokenListener:S(t.Ec,t)}},multipleInstances:!1,instantiationMode:"LAZY",type:"PRIVATE"}),e.default.registerVersion("@firebase/auth","0.13.3"),e.default.INTERNAL.extendNamespace({User:Lc})}()}).apply(void 0!==t?t:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})}).call(this,n(3))},function(t,e,n){"use strict";(function(t,e){var r,i=n(11),o=n(12),a=n(14),s=n(16),u=n(13),c=function(){function t(t){this.domStorage_=t,this.prefix_="firebase:"}return t.prototype.set=function(t,e){null==e?this.domStorage_.removeItem(this.prefixedName_(t)):this.domStorage_.setItem(this.prefixedName_(t),Object(a.G)(e))},t.prototype.get=function(t){var e=this.domStorage_.getItem(this.prefixedName_(t));return null==e?null:Object(a.A)(e)},t.prototype.remove=function(t){this.domStorage_.removeItem(this.prefixedName_(t))},t.prototype.prefixedName_=function(t){return this.prefix_+t},t.prototype.toString=function(){return this.domStorage_.toString()},t}(),h=function(){function t(){this.cache_={},this.isInMemoryStorage=!0}return t.prototype.set=function(t,e){null==e?delete this.cache_[t]:this.cache_[t]=e},t.prototype.get=function(t){return Object(a.j)(this.cache_,t)?this.cache_[t]:null},t.prototype.remove=function(t){delete this.cache_[t]},t}(),l=function(t){try{if("undefined"!=typeof window&&void 0!==window[t]){var e=window[t];return e.setItem("firebase:sentinel","cache"),e.removeItem("firebase:sentinel"),new c(e)}}catch(t){}return new h},f=l("localStorage"),p=l("sessionStorage"),d=new s.b("@firebase/database"),m=(r=1,function(){return r++}),y=function(t){var e=Object(a.F)(t),n=new a.e;n.update(e);var r=n.digest();return a.h.encodeByteArray(r)},g=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var n="",r=0;r<t.length;r++){var i=t[r];Array.isArray(i)||i&&"object"==typeof i&&"number"==typeof i.length?n+=g.apply(null,i):n+="object"==typeof i?Object(a.G)(i):i,n+=" "}return n},v=null,b=!0,w=function(t,e){Object(a.f)(!e||!0===t||!1===t,"Can't turn on custom loggers persistently."),!0===t?(d.logLevel=s.a.VERBOSE,v=d.log.bind(d),e&&p.set("logging_enabled",!0)):"function"==typeof t?v=t:(v=null,p.remove("logging_enabled"))},T=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];if(!0===b&&(b=!1,null===v&&!0===p.get("logging_enabled")&&w(!0)),v){var n=g.apply(null,t);v(n)}},_=function(t){return function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];T.apply(void 0,Object(o.f)([t],e))}},E=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n="FIREBASE INTERNAL ERROR: "+g.apply(void 0,Object(o.f)(t));d.error(n)},S=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n="FIREBASE FATAL ERROR: "+g.apply(void 0,Object(o.f)(t));throw d.error(n),new Error(n)},I=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n="FIREBASE WARNING: "+g.apply(void 0,Object(o.f)(t));d.warn(n)},C=function(t){return"number"==typeof t&&(t!=t||t===Number.POSITIVE_INFINITY||t===Number.NEGATIVE_INFINITY)},N="[MIN_NAME]",D="[MAX_NAME]",A=function(t,e){if(t===e)return 0;if(t===N||e===D)return-1;if(e===N||t===D)return 1;var n=F(t),r=F(e);return null!==n?null!==r?n-r==0?t.length-e.length:n-r:-1:null!==r?1:t<e?-1:1},O=function(t,e){return t===e?0:t<e?-1:1},k=function(t,e){if(e&&t in e)return e[t];throw new Error("Missing required key ("+t+") in object: "+Object(a.G)(e))},R=function(t){if("object"!=typeof t||null===t)return Object(a.G)(t);var e=[];for(var n in t)e.push(n);e.sort();for(var r="{",i=0;i<e.length;i++)0!==i&&(r+=","),r+=Object(a.G)(e[i]),r+=":",r+=R(t[e[i]]);return r+="}"},P=function(t,e){var n=t.length;if(n<=e)return[t];for(var r=[],i=0;i<n;i+=e)i+e>n?r.push(t.substring(i,n)):r.push(t.substring(i,i+e));return r};function M(t,e){for(var n in t)t.hasOwnProperty(n)&&e(n,t[n])}var L=function(t){Object(a.f)(!C(t),"Invalid JSON number");var e,n,r,i,o;0===t?(n=0,r=0,e=1/t==-1/0?1:0):(e=t<0,(t=Math.abs(t))>=Math.pow(2,-1022)?(n=(i=Math.min(Math.floor(Math.log(t)/Math.LN2),1023))+1023,r=Math.round(t*Math.pow(2,52-i)-Math.pow(2,52))):(n=0,r=Math.round(t/Math.pow(2,-1074))));var s=[];for(o=52;o;o-=1)s.push(r%2?1:0),r=Math.floor(r/2);for(o=11;o;o-=1)s.push(n%2?1:0),n=Math.floor(n/2);s.push(e?1:0),s.reverse();var u=s.join(""),c="";for(o=0;o<64;o+=8){var h=parseInt(u.substr(o,8),2).toString(16);1===h.length&&(h="0"+h),c+=h}return c.toLowerCase()},x=new RegExp("^-?(0*)\\d{1,10}$"),F=function(t){if(x.test(t)){var e=Number(t);if(e>=-2147483648&&e<=2147483647)return e}return null},j=function(t){try{t()}catch(t){setTimeout((function(){var e=t.stack||"";throw I("Exception was thrown by user callback.",e),t}),Math.floor(0))}},U=function(t,e){var n=setTimeout(t,e);return"object"==typeof n&&n.unref&&n.unref(),n},q=function(){function t(t,e){if(void 0===e){this.pieces_=t.split("/");for(var n=0,r=0;r<this.pieces_.length;r++)this.pieces_[r].length>0&&(this.pieces_[n]=this.pieces_[r],n++);this.pieces_.length=n,this.pieceNum_=0}else this.pieces_=t,this.pieceNum_=e}return Object.defineProperty(t,"Empty",{get:function(){return new t("")},enumerable:!0,configurable:!0}),t.prototype.getFront=function(){return this.pieceNum_>=this.pieces_.length?null:this.pieces_[this.pieceNum_]},t.prototype.getLength=function(){return this.pieces_.length-this.pieceNum_},t.prototype.popFront=function(){var e=this.pieceNum_;return e<this.pieces_.length&&e++,new t(this.pieces_,e)},t.prototype.getBack=function(){return this.pieceNum_<this.pieces_.length?this.pieces_[this.pieces_.length-1]:null},t.prototype.toString=function(){for(var t="",e=this.pieceNum_;e<this.pieces_.length;e++)""!==this.pieces_[e]&&(t+="/"+this.pieces_[e]);return t||"/"},t.prototype.toUrlEncodedString=function(){for(var t="",e=this.pieceNum_;e<this.pieces_.length;e++)""!==this.pieces_[e]&&(t+="/"+encodeURIComponent(String(this.pieces_[e])));return t||"/"},t.prototype.slice=function(t){return void 0===t&&(t=0),this.pieces_.slice(this.pieceNum_+t)},t.prototype.parent=function(){if(this.pieceNum_>=this.pieces_.length)return null;for(var e=[],n=this.pieceNum_;n<this.pieces_.length-1;n++)e.push(this.pieces_[n]);return new t(e,0)},t.prototype.child=function(e){for(var n=[],r=this.pieceNum_;r<this.pieces_.length;r++)n.push(this.pieces_[r]);if(e instanceof t)for(r=e.pieceNum_;r<e.pieces_.length;r++)n.push(e.pieces_[r]);else{var i=e.split("/");for(r=0;r<i.length;r++)i[r].length>0&&n.push(i[r])}return new t(n,0)},t.prototype.isEmpty=function(){return this.pieceNum_>=this.pieces_.length},t.relativePath=function(e,n){var r=e.getFront(),i=n.getFront();if(null===r)return n;if(r===i)return t.relativePath(e.popFront(),n.popFront());throw new Error("INTERNAL ERROR: innerPath ("+n+") is not within outerPath ("+e+")")},t.comparePaths=function(t,e){for(var n=t.slice(),r=e.slice(),i=0;i<n.length&&i<r.length;i++){var o=A(n[i],r[i]);if(0!==o)return o}return n.length===r.length?0:n.length<r.length?-1:1},t.prototype.equals=function(t){if(this.getLength()!==t.getLength())return!1;for(var e=this.pieceNum_,n=t.pieceNum_;e<=this.pieces_.length;e++,n++)if(this.pieces_[e]!==t.pieces_[n])return!1;return!0},t.prototype.contains=function(t){var e=this.pieceNum_,n=t.pieceNum_;if(this.getLength()>t.getLength())return!1;for(;e<this.pieces_.length;){if(this.pieces_[e]!==t.pieces_[n])return!1;++e,++n}return!0},t}(),V=function(){function t(t,e){this.errorPrefix_=e,this.parts_=t.slice(),this.byteLength_=Math.max(1,this.parts_.length);for(var n=0;n<this.parts_.length;n++)this.byteLength_+=Object(a.E)(this.parts_[n]);this.checkValid_()}return Object.defineProperty(t,"MAX_PATH_DEPTH",{get:function(){return 32},enumerable:!0,configurable:!0}),Object.defineProperty(t,"MAX_PATH_LENGTH_BYTES",{get:function(){return 768},enumerable:!0,configurable:!0}),t.prototype.push=function(t){this.parts_.length>0&&(this.byteLength_+=1),this.parts_.push(t),this.byteLength_+=Object(a.E)(t),this.checkValid_()},t.prototype.pop=function(){var t=this.parts_.pop();this.byteLength_-=Object(a.E)(t),this.parts_.length>0&&(this.byteLength_-=1)},t.prototype.checkValid_=function(){if(this.byteLength_>t.MAX_PATH_LENGTH_BYTES)throw new Error(this.errorPrefix_+"has a key path longer than "+t.MAX_PATH_LENGTH_BYTES+" bytes ("+this.byteLength_+").");if(this.parts_.length>t.MAX_PATH_DEPTH)throw new Error(this.errorPrefix_+"path specified exceeds the maximum depth that can be written ("+t.MAX_PATH_DEPTH+") or object contains a cycle "+this.toErrorString())},t.prototype.toErrorString=function(){return 0===this.parts_.length?"":"in property '"+this.parts_.join(".")+"'"},t}(),B=function(){function t(t,e,n,r,i,o){void 0===i&&(i=""),void 0===o&&(o=!1),this.secure=e,this.namespace=n,this.webSocketOnly=r,this.persistenceKey=i,this.includeNamespaceInQueryParams=o,this.host=t.toLowerCase(),this.domain=this.host.substr(this.host.indexOf(".")+1),this.internalHost=f.get("host:"+t)||this.host}return t.prototype.needsQueryParam=function(){return this.host!==this.internalHost||this.isCustomHost()||this.includeNamespaceInQueryParams},t.prototype.isCacheableHost=function(){return"s-"===this.internalHost.substr(0,2)},t.prototype.isDemoHost=function(){return"firebaseio-demo.com"===this.domain},t.prototype.isCustomHost=function(){return"firebaseio.com"!==this.domain&&"firebaseio-demo.com"!==this.domain},t.prototype.updateHost=function(t){t!==this.internalHost&&(this.internalHost=t,this.isCacheableHost()&&f.set("host:"+this.host,this.internalHost))},t.prototype.connectionURL=function(t,e){var n;if(Object(a.f)("string"==typeof t,"typeof type must == string"),Object(a.f)("object"==typeof e,"typeof params must == object"),"websocket"===t)n=(this.secure?"wss://":"ws://")+this.internalHost+"/.ws?";else{if("long_polling"!==t)throw new Error("Unknown connection type: "+t);n=(this.secure?"https://":"http://")+this.internalHost+"/.lp?"}this.needsQueryParam()&&(e.ns=this.namespace);var r=[];return M(e,(function(t,e){r.push(t+"="+e)})),n+r.join("&")},t.prototype.toString=function(){var t=this.toURLString();return this.persistenceKey&&(t+="<"+this.persistenceKey+">"),t},t.prototype.toURLString=function(){return(this.secure?"https://":"http://")+this.host},t}();var W,K,Q,G,H,z=function(t){var e=Y(t),n=e.namespace;"firebase"===e.domain&&S(e.host+" is no longer supported. Please use <YOUR FIREBASE>.firebaseio.com instead"),n&&"undefined"!==n||"localhost"===e.domain||S("Cannot parse Firebase url. Please use https://<YOUR FIREBASE>.firebaseio.com"),e.secure||"undefined"!=typeof window&&window.location&&window.location.protocol&&-1!==window.location.protocol.indexOf("https:")&&I("Insecure Firebase access from a secure page. Please use https in calls to new Firebase().");var r="ws"===e.scheme||"wss"===e.scheme;return{repoInfo:new B(e.host,e.secure,n,r,"",n!==e.subdomain),path:new q(e.pathString)}},Y=function(t){var e="",n="",r="",i="",a="",s=!0,u="https",c=443;if("string"==typeof t){var h=t.indexOf("//");h>=0&&(u=t.substring(0,h-1),t=t.substring(h+2));var l=t.indexOf("/");-1===l&&(l=t.length);var f=t.indexOf("?");-1===f&&(f=t.length),e=t.substring(0,Math.min(l,f)),l<f&&(i=
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function(t){for(var e="",n=t.split("/"),r=0;r<n.length;r++)if(n[r].length>0){var i=n[r];try{i=decodeURIComponent(i.replace(/\+/g," "))}catch(t){}e+="/"+i}return e}(t.substring(l,f)));var p=function(t){var e,n,r={};"?"===t.charAt(0)&&(t=t.substring(1));try{for(var i=Object(o.h)(t.split("&")),a=i.next();!a.done;a=i.next()){var s=a.value;if(0!==s.length){var u=s.split("=");2===u.length?r[decodeURIComponent(u[0])]=decodeURIComponent(u[1]):I("Invalid query segment '"+s+"' in query '"+t+"'")}}}catch(t){e={error:t}}finally{try{a&&!a.done&&(n=i.return)&&n.call(i)}finally{if(e)throw e.error}}return r}(t.substring(Math.min(t.length,f)));(h=e.indexOf(":"))>=0?(s="https"===u||"wss"===u,c=parseInt(e.substring(h+1),10)):h=t.length;var d=e.split(".");3===d.length?(n=d[1],a=r=d[0].toLowerCase()):2===d.length?n=d[0]:"localhost"===d[0].slice(0,h).toLowerCase()&&(n="localhost"),"ns"in p&&(a=p.ns)}return{host:e,port:c,domain:n,subdomain:r,secure:s,scheme:u,pathString:i,namespace:a}},X=/[\[\].#$\/\u0000-\u001F\u007F]/,J=/[\[\].#$\u0000-\u001F\u007F]/,$=function(t){return"string"==typeof t&&0!==t.length&&!X.test(t)},Z=function(t){return"string"==typeof t&&0!==t.length&&!J.test(t)},tt=function(t){return null===t||"string"==typeof t||"number"==typeof t&&!C(t)||t&&"object"==typeof t&&Object(a.j)(t,".sv")},et=function(t,e,n,r,i){i&&void 0===n||nt(Object(a.n)(t,e,i),n,r)},nt=function(t,e,n){var r=n instanceof q?new V(n,t):n;if(void 0===e)throw new Error(t+"contains undefined "+r.toErrorString());if("function"==typeof e)throw new Error(t+"contains a function "+r.toErrorString()+" with contents = "+e.toString());if(C(e))throw new Error(t+"contains "+e.toString()+" "+r.toErrorString());if("string"==typeof e&&e.length>10485760/3&&Object(a.E)(e)>10485760)throw new Error(t+"contains a string greater than 10485760 utf8 bytes "+r.toErrorString()+" ('"+e.substring(0,50)+"...')");if(e&&"object"==typeof e){var i=!1,o=!1;if(M(e,(function(e,n){if(".value"===e)i=!0;else if(".priority"!==e&&".sv"!==e&&(o=!0,!$(e)))throw new Error(t+" contains an invalid key ("+e+") "+r.toErrorString()+'.  Keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]"');r.push(e),nt(t,n,r),r.pop()})),i&&o)throw new Error(t+' contains ".value" child '+r.toErrorString()+" in addition to actual children.")}},rt=function(t,e,n,r,i){if(!i||void 0!==n){var o=Object(a.n)(t,e,i);if(!n||"object"!=typeof n||Array.isArray(n))throw new Error(o+" must be an object containing the children to replace.");var s=[];M(n,(function(t,e){var n=new q(t);if(nt(o,e,r.child(n)),".priority"===n.getBack()&&!tt(e))throw new Error(o+"contains an invalid value for '"+n.toString()+"', which must be a valid Firebase priority (a string, finite number, server value, or null).");s.push(n)})),function(t,e){var n,r;for(n=0;n<e.length;n++)for(var i=(r=e[n]).slice(),o=0;o<i.length;o++)if(".priority"===i[o]&&o===i.length-1);else if(!$(i[o]))throw new Error(t+"contains an invalid key ("+i[o]+") in path "+r.toString()+'. Keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]"');e.sort(q.comparePaths);var a=null;for(n=0;n<e.length;n++){if(r=e[n],null!==a&&a.contains(r))throw new Error(t+"contains a path "+a.toString()+" that is ancestor of another path "+r.toString());a=r}}(o,s)}},it=function(t,e,n,r){if(!r||void 0!==n){if(C(n))throw new Error(Object(a.n)(t,e,r)+"is "+n.toString()+", but must be a valid Firebase priority (a string, finite number, server value, or null).");if(!tt(n))throw new Error(Object(a.n)(t,e,r)+"must be a valid Firebase priority (a string, finite number, server value, or null).")}},ot=function(t,e,n,r){if(!r||void 0!==n)switch(n){case"value":case"child_added":case"child_removed":case"child_changed":case"child_moved":break;default:throw new Error(Object(a.n)(t,e,r)+'must be a valid event type = "value", "child_added", "child_removed", "child_changed", or "child_moved".')}},at=function(t,e,n,r){if(!(r&&void 0===n||$(n)))throw new Error(Object(a.n)(t,e,r)+'was an invalid key = "'+n+'".  Firebase keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]").')},st=function(t,e,n,r){if(!(r&&void 0===n||Z(n)))throw new Error(Object(a.n)(t,e,r)+'was an invalid path = "'+n+'". Paths must be non-empty strings and can\'t contain ".", "#", "$", "[", or "]"')},ut=function(t,e,n,r){n&&(n=n.replace(/^\/*\.info(\/|$)/,"/")),st(t,e,n,r)},ct=function(t,e){if(".info"===e.getFront())throw new Error(t+" failed = Can't modify data under /.info/")},ht=function(t,e,n){var r=n.path.toString();if("string"!=typeof n.repoInfo.host||0===n.repoInfo.host.length||!$(n.repoInfo.namespace)&&"localhost"!==n.repoInfo.host.split(":")[0]||0!==r.length&&!function(t){return t&&(t=t.replace(/^\/*\.info(\/|$)/,"/")),Z(t)}(r))throw new Error(Object(a.n)(t,e,!1)+'must be a valid firebase URL and the path can\'t contain ".", "#", "$", "[", or "]".')},lt=function(t,e,n,r){if((!r||void 0!==n)&&"boolean"!=typeof n)throw new Error(Object(a.n)(t,e,r)+"must be a boolean.")},ft=function(){function t(t,e){this.repo_=t,this.path_=e}return t.prototype.cancel=function(t){Object(a.H)("OnDisconnect.cancel",0,1,arguments.length),Object(a.I)("OnDisconnect.cancel",1,t,!0);var e=new a.b;return this.repo_.onDisconnectCancel(this.path_,e.wrapCallback(t)),e.promise},t.prototype.remove=function(t){Object(a.H)("OnDisconnect.remove",0,1,arguments.length),ct("OnDisconnect.remove",this.path_),Object(a.I)("OnDisconnect.remove",1,t,!0);var e=new a.b;return this.repo_.onDisconnectSet(this.path_,null,e.wrapCallback(t)),e.promise},t.prototype.set=function(t,e){Object(a.H)("OnDisconnect.set",1,2,arguments.length),ct("OnDisconnect.set",this.path_),et("OnDisconnect.set",1,t,this.path_,!1),Object(a.I)("OnDisconnect.set",2,e,!0);var n=new a.b;return this.repo_.onDisconnectSet(this.path_,t,n.wrapCallback(e)),n.promise},t.prototype.setWithPriority=function(t,e,n){Object(a.H)("OnDisconnect.setWithPriority",2,3,arguments.length),ct("OnDisconnect.setWithPriority",this.path_),et("OnDisconnect.setWithPriority",1,t,this.path_,!1),it("OnDisconnect.setWithPriority",2,e,!1),Object(a.I)("OnDisconnect.setWithPriority",3,n,!0);var r=new a.b;return this.repo_.onDisconnectSetWithPriority(this.path_,t,e,r.wrapCallback(n)),r.promise},t.prototype.update=function(t,e){if(Object(a.H)("OnDisconnect.update",1,2,arguments.length),ct("OnDisconnect.update",this.path_),Array.isArray(t)){for(var n={},r=0;r<t.length;++r)n[""+r]=t[r];t=n,I("Passing an Array to firebase.database.onDisconnect().update() is deprecated. Use set() if you want to overwrite the existing data, or an Object with integer keys if you really do want to only update some of the children.")}rt("OnDisconnect.update",1,t,this.path_,!1),Object(a.I)("OnDisconnect.update",2,e,!0);var i=new a.b;return this.repo_.onDisconnectUpdate(this.path_,t,i.wrapCallback(e)),i.promise},t}(),pt=function(){function t(t,e){this.committed=t,this.snapshot=e}return t.prototype.toJSON=function(){return Object(a.H)("TransactionResult.toJSON",0,1,arguments.length),{committed:this.committed,snapshot:this.snapshot.toJSON()}},t}(),dt=(W="-0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz",K=0,Q=[],function(t){var e,n=t===K;K=t;var r=new Array(8);for(e=7;e>=0;e--)r[e]=W.charAt(t%64),t=Math.floor(t/64);Object(a.f)(0===t,"Cannot push at time == 0");var i=r.join("");if(n){for(e=11;e>=0&&63===Q[e];e--)Q[e]=0;Q[e]++}else for(e=0;e<12;e++)Q[e]=Math.floor(64*Math.random());for(e=0;e<12;e++)i+=W.charAt(Q[e]);return Object(a.f)(20===i.length,"nextPushId: Length should be 20."),i}),mt=function(){function t(t,e){this.name=t,this.node=e}return t.Wrap=function(e,n){return new t(e,n)},t}(),yt=function(){function t(){}return t.prototype.getCompare=function(){return this.compare.bind(this)},t.prototype.indexedValueChanged=function(t,e){var n=new mt(N,t),r=new mt(N,e);return 0!==this.compare(n,r)},t.prototype.minPost=function(){return mt.MIN},t}(),gt=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(o.c)(e,t),Object.defineProperty(e,"__EMPTY_NODE",{get:function(){return G},set:function(t){G=t},enumerable:!0,configurable:!0}),e.prototype.compare=function(t,e){return A(t.name,e.name)},e.prototype.isDefinedOn=function(t){throw Object(a.g)("KeyIndex.isDefinedOn not expected to be called.")},e.prototype.indexedValueChanged=function(t,e){return!1},e.prototype.minPost=function(){return mt.MIN},e.prototype.maxPost=function(){return new mt(D,G)},e.prototype.makePost=function(t,e){return Object(a.f)("string"==typeof t,"KeyIndex indexValue must always be a string."),new mt(t,G)},e.prototype.toString=function(){return".key"},e}(yt),vt=new gt;var bt,wt,Tt,_t=function(t){return"number"==typeof t?"number:"+L(t):"string:"+t},Et=function(t){if(t.isLeafNode()){var e=t.val();Object(a.f)("string"==typeof e||"number"==typeof e||"object"==typeof e&&Object(a.j)(e,".sv"),"Priority must be a string or number.")}else Object(a.f)(t===H||t.isEmpty(),"priority of unexpected type.");Object(a.f)(t===H||t.getPriority().isEmpty(),"Priority nodes can't have a priority of their own.")},St=function(){function t(e,n){void 0===n&&(n=t.__childrenNodeConstructor.EMPTY_NODE),this.value_=e,this.priorityNode_=n,this.lazyHash_=null,Object(a.f)(void 0!==this.value_&&null!==this.value_,"LeafNode shouldn't be created with null/undefined value."),Et(this.priorityNode_)}return Object.defineProperty(t,"__childrenNodeConstructor",{get:function(){return bt},set:function(t){bt=t},enumerable:!0,configurable:!0}),t.prototype.isLeafNode=function(){return!0},t.prototype.getPriority=function(){return this.priorityNode_},t.prototype.updatePriority=function(e){return new t(this.value_,e)},t.prototype.getImmediateChild=function(e){return".priority"===e?this.priorityNode_:t.__childrenNodeConstructor.EMPTY_NODE},t.prototype.getChild=function(e){return e.isEmpty()?this:".priority"===e.getFront()?this.priorityNode_:t.__childrenNodeConstructor.EMPTY_NODE},t.prototype.hasChild=function(){return!1},t.prototype.getPredecessorChildName=function(t,e){return null},t.prototype.updateImmediateChild=function(e,n){return".priority"===e?this.updatePriority(n):n.isEmpty()&&".priority"!==e?this:t.__childrenNodeConstructor.EMPTY_NODE.updateImmediateChild(e,n).updatePriority(this.priorityNode_)},t.prototype.updateChild=function(e,n){var r=e.getFront();return null===r?n:n.isEmpty()&&".priority"!==r?this:(Object(a.f)(".priority"!==r||1===e.getLength(),".priority must be the last token in a path"),this.updateImmediateChild(r,t.__childrenNodeConstructor.EMPTY_NODE.updateChild(e.popFront(),n)))},t.prototype.isEmpty=function(){return!1},t.prototype.numChildren=function(){return 0},t.prototype.forEachChild=function(t,e){return!1},t.prototype.val=function(t){return t&&!this.getPriority().isEmpty()?{".value":this.getValue(),".priority":this.getPriority().val()}:this.getValue()},t.prototype.hash=function(){if(null===this.lazyHash_){var t="";this.priorityNode_.isEmpty()||(t+="priority:"+_t(this.priorityNode_.val())+":");var e=typeof this.value_;t+=e+":",t+="number"===e?L(this.value_):this.value_,this.lazyHash_=y(t)}return this.lazyHash_},t.prototype.getValue=function(){return this.value_},t.prototype.compareTo=function(e){return e===t.__childrenNodeConstructor.EMPTY_NODE?1:e instanceof t.__childrenNodeConstructor?-1:(Object(a.f)(e.isLeafNode(),"Unknown node type"),this.compareToLeafNode_(e))},t.prototype.compareToLeafNode_=function(e){var n=typeof e.value_,r=typeof this.value_,i=t.VALUE_TYPE_ORDER.indexOf(n),o=t.VALUE_TYPE_ORDER.indexOf(r);return Object(a.f)(i>=0,"Unknown leaf type: "+n),Object(a.f)(o>=0,"Unknown leaf type: "+r),i===o?"object"===r?0:this.value_<e.value_?-1:this.value_===e.value_?0:1:o-i},t.prototype.withIndex=function(){return this},t.prototype.isIndexed=function(){return!0},t.prototype.equals=function(t){if(t===this)return!0;if(t.isLeafNode()){var e=t;return this.value_===e.value_&&this.priorityNode_.equals(e.priorityNode_)}return!1},t.VALUE_TYPE_ORDER=["object","boolean","number","string"],t}();var It,Ct,Nt=new(function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(o.c)(e,t),e.prototype.compare=function(t,e){var n=t.node.getPriority(),r=e.node.getPriority(),i=n.compareTo(r);return 0===i?A(t.name,e.name):i},e.prototype.isDefinedOn=function(t){return!t.getPriority().isEmpty()},e.prototype.indexedValueChanged=function(t,e){return!t.getPriority().equals(e.getPriority())},e.prototype.minPost=function(){return mt.MIN},e.prototype.maxPost=function(){return new mt(D,new St("[PRIORITY-POST]",Tt))},e.prototype.makePost=function(t,e){var n=wt(t);return new mt(e,new St("[PRIORITY-POST]",n))},e.prototype.toString=function(){return".priority"},e}(yt)),Dt=function(){function t(t,e,n,r,i){void 0===i&&(i=null),this.isReverse_=r,this.resultGenerator_=i,this.nodeStack_=[];for(var o=1;!t.isEmpty();)if(t=t,o=e?n(t.key,e):1,r&&(o*=-1),o<0)t=this.isReverse_?t.left:t.right;else{if(0===o){this.nodeStack_.push(t);break}this.nodeStack_.push(t),t=this.isReverse_?t.right:t.left}}return t.prototype.getNext=function(){if(0===this.nodeStack_.length)return null;var t,e=this.nodeStack_.pop();if(t=this.resultGenerator_?this.resultGenerator_(e.key,e.value):{key:e.key,value:e.value},this.isReverse_)for(e=e.left;!e.isEmpty();)this.nodeStack_.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack_.push(e),e=e.left;return t},t.prototype.hasNext=function(){return this.nodeStack_.length>0},t.prototype.peek=function(){if(0===this.nodeStack_.length)return null;var t=this.nodeStack_[this.nodeStack_.length-1];return this.resultGenerator_?this.resultGenerator_(t.key,t.value):{key:t.key,value:t.value}},t}(),At=function(){function t(e,n,r,i,o){this.key=e,this.value=n,this.color=null!=r?r:t.RED,this.left=null!=i?i:kt.EMPTY_NODE,this.right=null!=o?o:kt.EMPTY_NODE}return t.prototype.copy=function(e,n,r,i,o){return new t(null!=e?e:this.key,null!=n?n:this.value,null!=r?r:this.color,null!=i?i:this.left,null!=o?o:this.right)},t.prototype.count=function(){return this.left.count()+1+this.right.count()},t.prototype.isEmpty=function(){return!1},t.prototype.inorderTraversal=function(t){return this.left.inorderTraversal(t)||!!t(this.key,this.value)||this.right.inorderTraversal(t)},t.prototype.reverseTraversal=function(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)},t.prototype.min_=function(){return this.left.isEmpty()?this:this.left.min_()},t.prototype.minKey=function(){return this.min_().key},t.prototype.maxKey=function(){return this.right.isEmpty()?this.key:this.right.maxKey()},t.prototype.insert=function(t,e,n){var r=this,i=n(t,r.key);return(r=i<0?r.copy(null,null,null,r.left.insert(t,e,n),null):0===i?r.copy(null,e,null,null,null):r.copy(null,null,null,null,r.right.insert(t,e,n))).fixUp_()},t.prototype.removeMin_=function(){if(this.left.isEmpty())return kt.EMPTY_NODE;var t=this;return t.left.isRed_()||t.left.left.isRed_()||(t=t.moveRedLeft_()),(t=t.copy(null,null,null,t.left.removeMin_(),null)).fixUp_()},t.prototype.remove=function(t,e){var n,r;if(e(t,(n=this).key)<0)n.left.isEmpty()||n.left.isRed_()||n.left.left.isRed_()||(n=n.moveRedLeft_()),n=n.copy(null,null,null,n.left.remove(t,e),null);else{if(n.left.isRed_()&&(n=n.rotateRight_()),n.right.isEmpty()||n.right.isRed_()||n.right.left.isRed_()||(n=n.moveRedRight_()),0===e(t,n.key)){if(n.right.isEmpty())return kt.EMPTY_NODE;r=n.right.min_(),n=n.copy(r.key,r.value,null,null,n.right.removeMin_())}n=n.copy(null,null,null,null,n.right.remove(t,e))}return n.fixUp_()},t.prototype.isRed_=function(){return this.color},t.prototype.fixUp_=function(){var t=this;return t.right.isRed_()&&!t.left.isRed_()&&(t=t.rotateLeft_()),t.left.isRed_()&&t.left.left.isRed_()&&(t=t.rotateRight_()),t.left.isRed_()&&t.right.isRed_()&&(t=t.colorFlip_()),t},t.prototype.moveRedLeft_=function(){var t=this.colorFlip_();return t.right.left.isRed_()&&(t=(t=(t=t.copy(null,null,null,null,t.right.rotateRight_())).rotateLeft_()).colorFlip_()),t},t.prototype.moveRedRight_=function(){var t=this.colorFlip_();return t.left.left.isRed_()&&(t=(t=t.rotateRight_()).colorFlip_()),t},t.prototype.rotateLeft_=function(){var e=this.copy(null,null,t.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)},t.prototype.rotateRight_=function(){var e=this.copy(null,null,t.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)},t.prototype.colorFlip_=function(){var t=this.left.copy(null,null,!this.left.color,null,null),e=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,e)},t.prototype.checkMaxDepth_=function(){var t=this.check_();return Math.pow(2,t)<=this.count()+1},t.prototype.check_=function(){if(this.isRed_()&&this.left.isRed_())throw new Error("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed_())throw new Error("Right child of ("+this.key+","+this.value+") is red");var t=this.left.check_();if(t!==this.right.check_())throw new Error("Black depths differ");return t+(this.isRed_()?0:1)},t.RED=!0,t.BLACK=!1,t}(),Ot=function(){function t(){}return t.prototype.copy=function(t,e,n,r,i){return this},t.prototype.insert=function(t,e,n){return new At(t,e,null)},t.prototype.remove=function(t,e){return this},t.prototype.count=function(){return 0},t.prototype.isEmpty=function(){return!0},t.prototype.inorderTraversal=function(t){return!1},t.prototype.reverseTraversal=function(t){return!1},t.prototype.minKey=function(){return null},t.prototype.maxKey=function(){return null},t.prototype.check_=function(){return 0},t.prototype.isRed_=function(){return!1},t}(),kt=function(){function t(e,n){void 0===n&&(n=t.EMPTY_NODE),this.comparator_=e,this.root_=n}return t.prototype.insert=function(e,n){return new t(this.comparator_,this.root_.insert(e,n,this.comparator_).copy(null,null,At.BLACK,null,null))},t.prototype.remove=function(e){return new t(this.comparator_,this.root_.remove(e,this.comparator_).copy(null,null,At.BLACK,null,null))},t.prototype.get=function(t){for(var e,n=this.root_;!n.isEmpty();){if(0===(e=this.comparator_(t,n.key)))return n.value;e<0?n=n.left:e>0&&(n=n.right)}return null},t.prototype.getPredecessorKey=function(t){for(var e,n=this.root_,r=null;!n.isEmpty();){if(0===(e=this.comparator_(t,n.key))){if(n.left.isEmpty())return r?r.key:null;for(n=n.left;!n.right.isEmpty();)n=n.right;return n.key}e<0?n=n.left:e>0&&(r=n,n=n.right)}throw new Error("Attempted to find predecessor key for a nonexistent key.  What gives?")},t.prototype.isEmpty=function(){return this.root_.isEmpty()},t.prototype.count=function(){return this.root_.count()},t.prototype.minKey=function(){return this.root_.minKey()},t.prototype.maxKey=function(){return this.root_.maxKey()},t.prototype.inorderTraversal=function(t){return this.root_.inorderTraversal(t)},t.prototype.reverseTraversal=function(t){return this.root_.reverseTraversal(t)},t.prototype.getIterator=function(t){return new Dt(this.root_,null,this.comparator_,!1,t)},t.prototype.getIteratorFrom=function(t,e){return new Dt(this.root_,t,this.comparator_,!1,e)},t.prototype.getReverseIteratorFrom=function(t,e){return new Dt(this.root_,t,this.comparator_,!0,e)},t.prototype.getReverseIterator=function(t){return new Dt(this.root_,null,this.comparator_,!0,t)},t.EMPTY_NODE=new Ot,t}(),Rt=Math.log(2),Pt=function(){function t(t){var e;this.count=(e=t+1,parseInt(Math.log(e)/Rt,10)),this.current_=this.count-1;var n,r=(n=this.count,parseInt(Array(n+1).join("1"),2));this.bits_=t+1&r}return t.prototype.nextBitIsOne=function(){var t=!(this.bits_&1<<this.current_);return this.current_--,t},t}(),Mt=function(t,e,n,r){t.sort(e);var i=function(e,r){var o,a,s=r-e;if(0===s)return null;if(1===s)return o=t[e],a=n?n(o):o,new At(a,o.node,At.BLACK,null,null);var u=parseInt(s/2,10)+e,c=i(e,u),h=i(u+1,r);return o=t[u],a=n?n(o):o,new At(a,o.node,At.BLACK,c,h)},o=function(e){for(var r=null,o=null,a=t.length,s=function(e,r){var o=a-e,s=a;a-=e;var c=i(o+1,s),h=t[o],l=n?n(h):h;u(new At(l,h.node,r,null,c))},u=function(t){r?(r.left=t,r=t):(o=t,r=t)},c=0;c<e.count;++c){var h=e.nextBitIsOne(),l=Math.pow(2,e.count-(c+1));h?s(l,At.BLACK):(s(l,At.BLACK),s(l,At.RED))}return o}(new Pt(t.length));return new kt(r||e,o)},Lt={},xt=function(){function t(t,e){this.indexes_=t,this.indexSet_=e}return Object.defineProperty(t,"Default",{get:function(){return Object(a.f)(Lt&&Nt,"ChildrenNode.ts has not been loaded"),It=It||new t({".priority":Lt},{".priority":Nt})},enumerable:!0,configurable:!0}),t.prototype.get=function(t){var e=Object(a.D)(this.indexes_,t);if(!e)throw new Error("No index defined for "+t);return e instanceof kt?e:null},t.prototype.hasIndex=function(t){return Object(a.j)(this.indexSet_,t.toString())},t.prototype.addIndex=function(e,n){Object(a.f)(e!==vt,"KeyIndex always exists and isn't meant to be added to the IndexMap.");for(var r,i=[],s=!1,u=n.getIterator(mt.Wrap),c=u.getNext();c;)s=s||e.isDefinedOn(c.node),i.push(c),c=u.getNext();r=s?Mt(i,e.getCompare()):Lt;var h=e.toString(),l=Object(o.a)({},this.indexSet_);l[h]=e;var f=Object(o.a)({},this.indexes_);return f[h]=r,new t(f,l)},t.prototype.addToIndexes=function(e,n){var r=this;return new t(Object(a.B)(this.indexes_,(function(t,i){var o=Object(a.D)(r.indexSet_,i);if(Object(a.f)(o,"Missing index implementation for "+i),t===Lt){if(o.isDefinedOn(e.node)){for(var s=[],u=n.getIterator(mt.Wrap),c=u.getNext();c;)c.name!==e.name&&s.push(c),c=u.getNext();return s.push(e),Mt(s,o.getCompare())}return Lt}var h=n.get(e.name),l=t;return h&&(l=l.remove(new mt(e.name,h))),l.insert(e,e.node)})),this.indexSet_)},t.prototype.removeFromIndexes=function(e,n){return new t(Object(a.B)(this.indexes_,(function(t){if(t===Lt)return t;var r=n.get(e.name);return r?t.remove(new mt(e.name,r)):t})),this.indexSet_)},t}();
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function Ft(t,e){return A(t.name,e.name)}function jt(t,e){return A(t,e)}
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Ut=function(){function t(t,e,n){this.children_=t,this.priorityNode_=e,this.indexMap_=n,this.lazyHash_=null,this.priorityNode_&&Et(this.priorityNode_),this.children_.isEmpty()&&Object(a.f)(!this.priorityNode_||this.priorityNode_.isEmpty(),"An empty node cannot have a priority")}return Object.defineProperty(t,"EMPTY_NODE",{get:function(){return Ct||(Ct=new t(new kt(jt),null,xt.Default))},enumerable:!0,configurable:!0}),t.prototype.isLeafNode=function(){return!1},t.prototype.getPriority=function(){return this.priorityNode_||Ct},t.prototype.updatePriority=function(e){return this.children_.isEmpty()?this:new t(this.children_,e,this.indexMap_)},t.prototype.getImmediateChild=function(t){if(".priority"===t)return this.getPriority();var e=this.children_.get(t);return null===e?Ct:e},t.prototype.getChild=function(t){var e=t.getFront();return null===e?this:this.getImmediateChild(e).getChild(t.popFront())},t.prototype.hasChild=function(t){return null!==this.children_.get(t)},t.prototype.updateImmediateChild=function(e,n){if(Object(a.f)(n,"We should always be passing snapshot nodes"),".priority"===e)return this.updatePriority(n);var r=new mt(e,n),i=void 0,o=void 0;n.isEmpty()?(i=this.children_.remove(e),o=this.indexMap_.removeFromIndexes(r,this.children_)):(i=this.children_.insert(e,n),o=this.indexMap_.addToIndexes(r,this.children_));var s=i.isEmpty()?Ct:this.priorityNode_;return new t(i,s,o)},t.prototype.updateChild=function(t,e){var n=t.getFront();if(null===n)return e;Object(a.f)(".priority"!==t.getFront()||1===t.getLength(),".priority must be the last token in a path");var r=this.getImmediateChild(n).updateChild(t.popFront(),e);return this.updateImmediateChild(n,r)},t.prototype.isEmpty=function(){return this.children_.isEmpty()},t.prototype.numChildren=function(){return this.children_.count()},t.prototype.val=function(e){if(this.isEmpty())return null;var n={},r=0,i=0,o=!0;if(this.forEachChild(Nt,(function(a,s){n[a]=s.val(e),r++,o&&t.INTEGER_REGEXP_.test(a)?i=Math.max(i,Number(a)):o=!1})),!e&&o&&i<2*r){var a=[];for(var s in n)a[s]=n[s];return a}return e&&!this.getPriority().isEmpty()&&(n[".priority"]=this.getPriority().val()),n},t.prototype.hash=function(){if(null===this.lazyHash_){var t="";this.getPriority().isEmpty()||(t+="priority:"+_t(this.getPriority().val())+":"),this.forEachChild(Nt,(function(e,n){var r=n.hash();""!==r&&(t+=":"+e+":"+r)})),this.lazyHash_=""===t?"":y(t)}return this.lazyHash_},t.prototype.getPredecessorChildName=function(t,e,n){var r=this.resolveIndex_(n);if(r){var i=r.getPredecessorKey(new mt(t,e));return i?i.name:null}return this.children_.getPredecessorKey(t)},t.prototype.getFirstChildName=function(t){var e=this.resolveIndex_(t);if(e){var n=e.minKey();return n&&n.name}return this.children_.minKey()},t.prototype.getFirstChild=function(t){var e=this.getFirstChildName(t);return e?new mt(e,this.children_.get(e)):null},t.prototype.getLastChildName=function(t){var e=this.resolveIndex_(t);if(e){var n=e.maxKey();return n&&n.name}return this.children_.maxKey()},t.prototype.getLastChild=function(t){var e=this.getLastChildName(t);return e?new mt(e,this.children_.get(e)):null},t.prototype.forEachChild=function(t,e){var n=this.resolveIndex_(t);return n?n.inorderTraversal((function(t){return e(t.name,t.node)})):this.children_.inorderTraversal(e)},t.prototype.getIterator=function(t){return this.getIteratorFrom(t.minPost(),t)},t.prototype.getIteratorFrom=function(t,e){var n=this.resolveIndex_(e);if(n)return n.getIteratorFrom(t,(function(t){return t}));for(var r=this.children_.getIteratorFrom(t.name,mt.Wrap),i=r.peek();null!=i&&e.compare(i,t)<0;)r.getNext(),i=r.peek();return r},t.prototype.getReverseIterator=function(t){return this.getReverseIteratorFrom(t.maxPost(),t)},t.prototype.getReverseIteratorFrom=function(t,e){var n=this.resolveIndex_(e);if(n)return n.getReverseIteratorFrom(t,(function(t){return t}));for(var r=this.children_.getReverseIteratorFrom(t.name,mt.Wrap),i=r.peek();null!=i&&e.compare(i,t)>0;)r.getNext(),i=r.peek();return r},t.prototype.compareTo=function(t){return this.isEmpty()?t.isEmpty()?0:-1:t.isLeafNode()||t.isEmpty()?1:t===qt?-1:0},t.prototype.withIndex=function(e){if(e===vt||this.indexMap_.hasIndex(e))return this;var n=this.indexMap_.addIndex(e,this.children_);return new t(this.children_,this.priorityNode_,n)},t.prototype.isIndexed=function(t){return t===vt||this.indexMap_.hasIndex(t)},t.prototype.equals=function(t){if(t===this)return!0;if(t.isLeafNode())return!1;var e=t;if(this.getPriority().equals(e.getPriority())){if(this.children_.count()===e.children_.count()){for(var n=this.getIterator(Nt),r=e.getIterator(Nt),i=n.getNext(),o=r.getNext();i&&o;){if(i.name!==o.name||!i.node.equals(o.node))return!1;i=n.getNext(),o=r.getNext()}return null===i&&null===o}return!1}return!1},t.prototype.resolveIndex_=function(t){return t===vt?null:this.indexMap_.get(t.toString())},t.INTEGER_REGEXP_=/^(0|[1-9]\d*)$/,t}(),qt=new(function(t){function e(){return t.call(this,new kt(jt),Ut.EMPTY_NODE,xt.Default)||this}return Object(o.c)(e,t),e.prototype.compareTo=function(t){return t===this?0:1},e.prototype.equals=function(t){return t===this},e.prototype.getPriority=function(){return this},e.prototype.getImmediateChild=function(t){return Ut.EMPTY_NODE},e.prototype.isEmpty=function(){return!1},e}(Ut));Object.defineProperties(mt,{MIN:{value:new mt(N,Ut.EMPTY_NODE)},MAX:{value:new mt(D,qt)}}),gt.__EMPTY_NODE=Ut.EMPTY_NODE,St.__childrenNodeConstructor=Ut,H=qt,function(t){Tt=t}(qt);function Vt(t,e){if(void 0===e&&(e=null),null===t)return Ut.EMPTY_NODE;if("object"==typeof t&&".priority"in t&&(e=t[".priority"]),Object(a.f)(null===e||"string"==typeof e||"number"==typeof e||"object"==typeof e&&".sv"in e,"Invalid priority type found: "+typeof e),"object"==typeof t&&".value"in t&&null!==t[".value"]&&(t=t[".value"]),"object"!=typeof t||".sv"in t)return new St(t,Vt(e));if(t instanceof Array){var n=Ut.EMPTY_NODE;return M(t,(function(e,r){if(Object(a.j)(t,e)&&"."!==e.substring(0,1)){var i=Vt(r);!i.isLeafNode()&&i.isEmpty()||(n=n.updateImmediateChild(e,i))}})),n.updatePriority(Vt(e))}var r=[],i=!1;if(M(t,(function(t,e){if("."!==t.substring(0,1)){var n=Vt(e);n.isEmpty()||(i=i||!n.getPriority().isEmpty(),r.push(new mt(t,n)))}})),0===r.length)return Ut.EMPTY_NODE;var o=Mt(r,Ft,(function(t){return t.name}),jt);if(i){var s=Mt(r,Nt.getCompare());return new Ut(o,Vt(e),new xt({".priority":s},{".priority":Nt}))}return new Ut(o,Vt(e),xt.Default)}!function(t){wt=t}(Vt);
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var Bt,Wt,Kt=new(function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(o.c)(e,t),e.prototype.compare=function(t,e){var n=t.node.compareTo(e.node);return 0===n?A(t.name,e.name):n},e.prototype.isDefinedOn=function(t){return!0},e.prototype.indexedValueChanged=function(t,e){return!t.equals(e)},e.prototype.minPost=function(){return mt.MIN},e.prototype.maxPost=function(){return mt.MAX},e.prototype.makePost=function(t,e){var n=Vt(t);return new mt(e,n)},e.prototype.toString=function(){return".value"},e}(yt)),Qt=function(t){function e(e){var n=t.call(this)||this;return n.indexPath_=e,Object(a.f)(!e.isEmpty()&&".priority"!==e.getFront(),"Can't create PathIndex with empty path or .priority key"),n}return Object(o.c)(e,t),e.prototype.extractChild=function(t){return t.getChild(this.indexPath_)},e.prototype.isDefinedOn=function(t){return!t.getChild(this.indexPath_).isEmpty()},e.prototype.compare=function(t,e){var n=this.extractChild(t.node),r=this.extractChild(e.node),i=n.compareTo(r);return 0===i?A(t.name,e.name):i},e.prototype.makePost=function(t,e){var n=Vt(t),r=Ut.EMPTY_NODE.updateChild(this.indexPath_,n);return new mt(e,r)},e.prototype.maxPost=function(){var t=Ut.EMPTY_NODE.updateChild(this.indexPath_,qt);return new mt(D,t)},e.prototype.toString=function(){return this.indexPath_.slice().join("/")},e}(yt),Gt=function(){function t(t,e,n){this.node_=t,this.ref_=e,this.index_=n}return t.prototype.val=function(){return Object(a.H)("DataSnapshot.val",0,0,arguments.length),this.node_.val()},t.prototype.exportVal=function(){return Object(a.H)("DataSnapshot.exportVal",0,0,arguments.length),this.node_.val(!0)},t.prototype.toJSON=function(){return Object(a.H)("DataSnapshot.toJSON",0,1,arguments.length),this.exportVal()},t.prototype.exists=function(){return Object(a.H)("DataSnapshot.exists",0,0,arguments.length),!this.node_.isEmpty()},t.prototype.child=function(e){Object(a.H)("DataSnapshot.child",0,1,arguments.length),e=String(e),st("DataSnapshot.child",1,e,!1);var n=new q(e),r=this.ref_.child(n);return new t(this.node_.getChild(n),r,Nt)},t.prototype.hasChild=function(t){Object(a.H)("DataSnapshot.hasChild",1,1,arguments.length),st("DataSnapshot.hasChild",1,t,!1);var e=new q(t);return!this.node_.getChild(e).isEmpty()},t.prototype.getPriority=function(){return Object(a.H)("DataSnapshot.getPriority",0,0,arguments.length),this.node_.getPriority().val()},t.prototype.forEach=function(e){var n=this;if(Object(a.H)("DataSnapshot.forEach",1,1,arguments.length),Object(a.I)("DataSnapshot.forEach",1,e,!1),this.node_.isLeafNode())return!1;var r=this.node_;return!!r.forEachChild(this.index_,(function(r,i){return e(new t(i,n.ref_.child(r),Nt))}))},t.prototype.hasChildren=function(){return Object(a.H)("DataSnapshot.hasChildren",0,0,arguments.length),!this.node_.isLeafNode()&&!this.node_.isEmpty()},Object.defineProperty(t.prototype,"key",{get:function(){return this.ref_.getKey()},enumerable:!0,configurable:!0}),t.prototype.numChildren=function(){return Object(a.H)("DataSnapshot.numChildren",0,0,arguments.length),this.node_.numChildren()},t.prototype.getRef=function(){return Object(a.H)("DataSnapshot.ref",0,0,arguments.length),this.ref_},Object.defineProperty(t.prototype,"ref",{get:function(){return this.getRef()},enumerable:!0,configurable:!0}),t}(),Ht=function(){function t(t,e,n,r){this.eventType=t,this.eventRegistration=e,this.snapshot=n,this.prevName=r}return t.prototype.getPath=function(){var t=this.snapshot.getRef();return"value"===this.eventType?t.path:t.getParent().path},t.prototype.getEventType=function(){return this.eventType},t.prototype.getEventRunner=function(){return this.eventRegistration.getEventRunner(this)},t.prototype.toString=function(){return this.getPath().toString()+":"+this.eventType+":"+Object(a.G)(this.snapshot.exportVal())},t}(),zt=function(){function t(t,e,n){this.eventRegistration=t,this.error=e,this.path=n}return t.prototype.getPath=function(){return this.path},t.prototype.getEventType=function(){return"cancel"},t.prototype.getEventRunner=function(){return this.eventRegistration.getEventRunner(this)},t.prototype.toString=function(){return this.path.toString()+":cancel"},t}(),Yt=function(){function t(t,e,n){this.callback_=t,this.cancelCallback_=e,this.context_=n}return t.prototype.respondsTo=function(t){return"value"===t},t.prototype.createEvent=function(t,e){var n=e.getQueryParams().getIndex();return new Ht("value",this,new Gt(t.snapshotNode,e.getRef(),n))},t.prototype.getEventRunner=function(t){var e=this.context_;if("cancel"===t.getEventType()){Object(a.f)(this.cancelCallback_,"Raising a cancel event on a listener with no cancel callback");var n=this.cancelCallback_;return function(){n.call(e,t.error)}}var r=this.callback_;return function(){r.call(e,t.snapshot)}},t.prototype.createCancelEvent=function(t,e){return this.cancelCallback_?new zt(this,t,e):null},t.prototype.matches=function(e){return e instanceof t&&(!e.callback_||!this.callback_||e.callback_===this.callback_&&e.context_===this.context_)},t.prototype.hasAnyCallback=function(){return null!==this.callback_},t}(),Xt=function(){function t(t,e,n){this.callbacks_=t,this.cancelCallback_=e,this.context_=n}return t.prototype.respondsTo=function(t){var e="children_added"===t?"child_added":t;return e="children_removed"===e?"child_removed":e,Object(a.j)(this.callbacks_,e)},t.prototype.createCancelEvent=function(t,e){return this.cancelCallback_?new zt(this,t,e):null},t.prototype.createEvent=function(t,e){Object(a.f)(null!=t.childName,"Child events should have a childName.");var n=e.getRef().child(t.childName),r=e.getQueryParams().getIndex();return new Ht(t.type,this,new Gt(t.snapshotNode,n,r),t.prevName)},t.prototype.getEventRunner=function(t){var e=this.context_;if("cancel"===t.getEventType()){Object(a.f)(this.cancelCallback_,"Raising a cancel event on a listener with no cancel callback");var n=this.cancelCallback_;return function(){n.call(e,t.error)}}var r=this.callbacks_[t.eventType];return function(){r.call(e,t.snapshot,t.prevName)}},t.prototype.matches=function(e){var n=this;if(e instanceof t){if(!this.callbacks_||!e.callbacks_)return!0;if(this.context_===e.context_){var r=Object.keys(e.callbacks_),i=Object.keys(this.callbacks_),o=r.length;if(o===i.length){if(1===o){var a=r[0],s=i[0];return!(s!==a||e.callbacks_[a]&&this.callbacks_[s]&&e.callbacks_[a]!==this.callbacks_[s])}return i.every((function(t){return e.callbacks_[t]===n.callbacks_[t]}))}}}return!1},t.prototype.hasAnyCallback=function(){return null!==this.callbacks_},t}(),Jt=function(){function t(t,e,n,r){this.repo=t,this.path=e,this.queryParams_=n,this.orderByCalled_=r}return Object.defineProperty(t,"__referenceConstructor",{get:function(){return Object(a.f)(Bt,"Reference.ts has not been loaded"),Bt},set:function(t){Bt=t},enumerable:!0,configurable:!0}),t.validateQueryEndpoints_=function(t){var e=null,n=null;if(t.hasStart()&&(e=t.getIndexStartValue()),t.hasEnd()&&(n=t.getIndexEndValue()),t.getIndex()===vt){var r="Query: When ordering by key, you may only pass one argument to startAt(), endAt(), or equalTo().",i="Query: When ordering by key, the argument passed to startAt(), endAt(),or equalTo() must be a string.";if(t.hasStart()){if(t.getIndexStartName()!==N)throw new Error(r);if("string"!=typeof e)throw new Error(i)}if(t.hasEnd()){if(t.getIndexEndName()!==D)throw new Error(r);if("string"!=typeof n)throw new Error(i)}}else if(t.getIndex()===Nt){if(null!=e&&!tt(e)||null!=n&&!tt(n))throw new Error("Query: When ordering by priority, the first argument passed to startAt(), endAt(), or equalTo() must be a valid priority value (null, a number, or a string).")}else if(Object(a.f)(t.getIndex()instanceof Qt||t.getIndex()===Kt,"unknown index type."),null!=e&&"object"==typeof e||null!=n&&"object"==typeof n)throw new Error("Query: First argument passed to startAt(), endAt(), or equalTo() cannot be an object.")},t.validateLimit_=function(t){if(t.hasStart()&&t.hasEnd()&&t.hasLimit()&&!t.hasAnchoredLimit())throw new Error("Query: Can't combine startAt(), endAt(), and limit(). Use limitToFirst() or limitToLast() instead.")},t.prototype.validateNoPreviousOrderByCall_=function(t){if(!0===this.orderByCalled_)throw new Error(t+": You can't combine multiple orderBy calls.")},t.prototype.getQueryParams=function(){return this.queryParams_},t.prototype.getRef=function(){return Object(a.H)("Query.ref",0,0,arguments.length),new t.__referenceConstructor(this.repo,this.path)},t.prototype.on=function(e,n,r,i){Object(a.H)("Query.on",2,4,arguments.length),ot("Query.on",1,e,!1),Object(a.I)("Query.on",2,n,!1);var o=t.getCancelAndContextArgs_("Query.on",r,i);if("value"===e)this.onValueEvent(n,o.cancel,o.context);else{var s={};s[e]=n,this.onChildEvent(s,o.cancel,o.context)}return n},t.prototype.onValueEvent=function(t,e,n){var r=new Yt(t,e||null,n||null);this.repo.addEventCallbackForQuery(this,r)},t.prototype.onChildEvent=function(t,e,n){var r=new Xt(t,e,n);this.repo.addEventCallbackForQuery(this,r)},t.prototype.off=function(t,e,n){Object(a.H)("Query.off",0,3,arguments.length),ot("Query.off",1,t,!0),Object(a.I)("Query.off",2,e,!0),Object(a.J)("Query.off",3,n,!0);var r=null,i=null;if("value"===t){var o=e||null;r=new Yt(o,null,n||null)}else t&&(e&&((i={})[t]=e),r=new Xt(i,null,n||null));this.repo.removeEventCallbackForQuery(this,r)},t.prototype.once=function(e,n,r,i){var o=this;Object(a.H)("Query.once",1,4,arguments.length),ot("Query.once",1,e,!1),Object(a.I)("Query.once",2,n,!0);var s=t.getCancelAndContextArgs_("Query.once",r,i),u=!0,c=new a.b;c.promise.catch((function(){}));var h=function(t){u&&(u=!1,o.off(e,h),n&&n.bind(s.context)(t),c.resolve(t))};return this.on(e,h,(function(t){o.off(e,h),s.cancel&&s.cancel.bind(s.context)(t),c.reject(t)})),c.promise},t.prototype.limitToFirst=function(e){if(Object(a.H)("Query.limitToFirst",1,1,arguments.length),"number"!=typeof e||Math.floor(e)!==e||e<=0)throw new Error("Query.limitToFirst: First argument must be a positive integer.");if(this.queryParams_.hasLimit())throw new Error("Query.limitToFirst: Limit was already set (by another call to limit, limitToFirst, or limitToLast).");return new t(this.repo,this.path,this.queryParams_.limitToFirst(e),this.orderByCalled_)},t.prototype.limitToLast=function(e){if(Object(a.H)("Query.limitToLast",1,1,arguments.length),"number"!=typeof e||Math.floor(e)!==e||e<=0)throw new Error("Query.limitToLast: First argument must be a positive integer.");if(this.queryParams_.hasLimit())throw new Error("Query.limitToLast: Limit was already set (by another call to limit, limitToFirst, or limitToLast).");return new t(this.repo,this.path,this.queryParams_.limitToLast(e),this.orderByCalled_)},t.prototype.orderByChild=function(e){if(Object(a.H)("Query.orderByChild",1,1,arguments.length),"$key"===e)throw new Error('Query.orderByChild: "$key" is invalid.  Use Query.orderByKey() instead.');if("$priority"===e)throw new Error('Query.orderByChild: "$priority" is invalid.  Use Query.orderByPriority() instead.');if("$value"===e)throw new Error('Query.orderByChild: "$value" is invalid.  Use Query.orderByValue() instead.');st("Query.orderByChild",1,e,!1),this.validateNoPreviousOrderByCall_("Query.orderByChild");var n=new q(e);if(n.isEmpty())throw new Error("Query.orderByChild: cannot pass in empty path.  Use Query.orderByValue() instead.");var r=new Qt(n),i=this.queryParams_.orderBy(r);return t.validateQueryEndpoints_(i),new t(this.repo,this.path,i,!0)},t.prototype.orderByKey=function(){Object(a.H)("Query.orderByKey",0,0,arguments.length),this.validateNoPreviousOrderByCall_("Query.orderByKey");var e=this.queryParams_.orderBy(vt);return t.validateQueryEndpoints_(e),new t(this.repo,this.path,e,!0)},t.prototype.orderByPriority=function(){Object(a.H)("Query.orderByPriority",0,0,arguments.length),this.validateNoPreviousOrderByCall_("Query.orderByPriority");var e=this.queryParams_.orderBy(Nt);return t.validateQueryEndpoints_(e),new t(this.repo,this.path,e,!0)},t.prototype.orderByValue=function(){Object(a.H)("Query.orderByValue",0,0,arguments.length),this.validateNoPreviousOrderByCall_("Query.orderByValue");var e=this.queryParams_.orderBy(Kt);return t.validateQueryEndpoints_(e),new t(this.repo,this.path,e,!0)},t.prototype.startAt=function(e,n){void 0===e&&(e=null),Object(a.H)("Query.startAt",0,2,arguments.length),et("Query.startAt",1,e,this.path,!0),at("Query.startAt",2,n,!0);var r=this.queryParams_.startAt(e,n);if(t.validateLimit_(r),t.validateQueryEndpoints_(r),this.queryParams_.hasStart())throw new Error("Query.startAt: Starting point was already set (by another call to startAt or equalTo).");return void 0===e&&(e=null,n=null),new t(this.repo,this.path,r,this.orderByCalled_)},t.prototype.endAt=function(e,n){void 0===e&&(e=null),Object(a.H)("Query.endAt",0,2,arguments.length),et("Query.endAt",1,e,this.path,!0),at("Query.endAt",2,n,!0);var r=this.queryParams_.endAt(e,n);if(t.validateLimit_(r),t.validateQueryEndpoints_(r),this.queryParams_.hasEnd())throw new Error("Query.endAt: Ending point was already set (by another call to endAt or equalTo).");return new t(this.repo,this.path,r,this.orderByCalled_)},t.prototype.equalTo=function(t,e){if(Object(a.H)("Query.equalTo",1,2,arguments.length),et("Query.equalTo",1,t,this.path,!1),at("Query.equalTo",2,e,!0),this.queryParams_.hasStart())throw new Error("Query.equalTo: Starting point was already set (by another call to startAt or equalTo).");if(this.queryParams_.hasEnd())throw new Error("Query.equalTo: Ending point was already set (by another call to endAt or equalTo).");return this.startAt(t,e).endAt(t,e)},t.prototype.toString=function(){return Object(a.H)("Query.toString",0,0,arguments.length),this.repo.toString()+this.path.toUrlEncodedString()},t.prototype.toJSON=function(){return Object(a.H)("Query.toJSON",0,1,arguments.length),this.toString()},t.prototype.queryObject=function(){return this.queryParams_.getQueryObject()},t.prototype.queryIdentifier=function(){var t=this.queryObject(),e=R(t);return"{}"===e?"default":e},t.prototype.isEqual=function(e){if(Object(a.H)("Query.isEqual",1,1,arguments.length),!(e instanceof t)){var n="Query.isEqual failed: First argument must be an instance of firebase.database.Query.";throw new Error(n)}var r=this.repo===e.repo,i=this.path.equals(e.path),o=this.queryIdentifier()===e.queryIdentifier();return r&&i&&o},t.getCancelAndContextArgs_=function(t,e,n){var r={cancel:null,context:null};if(e&&n)r.cancel=e,Object(a.I)(t,3,r.cancel,!0),r.context=n,Object(a.J)(t,4,r.context,!0);else if(e)if("object"==typeof e&&null!==e)r.context=e;else{if("function"!=typeof e)throw new Error(Object(a.n)(t,3,!0)+" must either be a cancel callback or a context object.");r.cancel=e}return r},Object.defineProperty(t.prototype,"ref",{get:function(){return this.getRef()},enumerable:!0,configurable:!0}),t}(),$t=function(){function t(){this.value=null,this.children=new Map}return t.prototype.find=function(t){if(null!=this.value)return this.value.getChild(t);if(!t.isEmpty()&&this.children.size>0){var e=t.getFront();return t=t.popFront(),this.children.has(e)?this.children.get(e).find(t):null}return null},t.prototype.remember=function(e,n){if(e.isEmpty())this.value=n,this.children.clear();else if(null!==this.value)this.value=this.value.updateChild(e,n);else{var r=e.getFront();this.children.has(r)||this.children.set(r,new t);var i=this.children.get(r);e=e.popFront(),i.remember(e,n)}},t.prototype.forget=function(t){if(t.isEmpty())return this.value=null,this.children.clear(),!0;if(null!==this.value){if(this.value.isLeafNode())return!1;var e=this.value;this.value=null;var n=this;return e.forEachChild(Nt,(function(t,e){n.remember(new q(t),e)})),this.forget(t)}if(this.children.size>0){var r=t.getFront();if(t=t.popFront(),this.children.has(r))this.children.get(r).forget(t)&&this.children.delete(r);return 0===this.children.size}return!0},t.prototype.forEachTree=function(t,e){null!==this.value?e(t,this.value):this.forEachChild((function(n,r){var i=new q(t.toString()+"/"+n);r.forEachTree(i,e)}))},t.prototype.forEachChild=function(t){this.children.forEach((function(e,n){t(n,e)}))},t}(),Zt=function(t,e){return t&&"object"==typeof t?(Object(a.f)(".sv"in t,"Unexpected leaf node or priority contents"),e[t[".sv"]]):t},te=function(t,e){var n,r=t.getPriority().val(),i=Zt(r,e);if(t.isLeafNode()){var o=t,a=Zt(o.getValue(),e);return a!==o.getValue()||i!==o.getPriority().val()?new St(a,Vt(i)):t}var s=t;return n=s,i!==s.getPriority().val()&&(n=n.updatePriority(new St(i))),s.forEachChild(Nt,(function(t,r){var i=te(r,e);i!==r&&(n=n.updateImmediateChild(t,i))})),n};!function(t){t[t.OVERWRITE=0]="OVERWRITE",t[t.MERGE=1]="MERGE",t[t.ACK_USER_WRITE=2]="ACK_USER_WRITE",t[t.LISTEN_COMPLETE=3]="LISTEN_COMPLETE"}(Wt||(Wt={}));var ee,ne,re=function(){function t(t,e,n,r){this.fromUser=t,this.fromServer=e,this.queryId=n,this.tagged=r,Object(a.f)(!r||e,"Tagged queries must be from server.")}return t.User=new t(!0,!1,null,!1),t.Server=new t(!1,!0,null,!1),t.forServerTaggedQuery=function(e){return new t(!1,!0,e,!0)},t}(),ie=function(){function t(t,e,n){this.path=t,this.affectedTree=e,this.revert=n,this.type=Wt.ACK_USER_WRITE,this.source=re.User}return t.prototype.operationForChild=function(e){if(this.path.isEmpty()){if(null!=this.affectedTree.value)return Object(a.f)(this.affectedTree.children.isEmpty(),"affectedTree should not have overlapping affected paths."),this;var n=this.affectedTree.subtree(new q(e));return new t(q.Empty,n,this.revert)}return Object(a.f)(this.path.getFront()===e,"operationForChild called for unrelated child."),new t(this.path.popFront(),this.affectedTree,this.revert)},t}(),oe=function(){function t(t,e){void 0===e&&(ee||(ee=new kt(O)),e=ee),this.value=t,this.children=e}return t.fromObject=function(e){var n=t.Empty;return M(e,(function(t,e){n=n.set(new q(t),e)})),n},t.prototype.isEmpty=function(){return null===this.value&&this.children.isEmpty()},t.prototype.findRootMostMatchingPathAndValue=function(t,e){if(null!=this.value&&e(this.value))return{path:q.Empty,value:this.value};if(t.isEmpty())return null;var n=t.getFront(),r=this.children.get(n);if(null!==r){var i=r.findRootMostMatchingPathAndValue(t.popFront(),e);return null!=i?{path:new q(n).child(i.path),value:i.value}:null}return null},t.prototype.findRootMostValueAndPath=function(t){return this.findRootMostMatchingPathAndValue(t,(function(){return!0}))},t.prototype.subtree=function(e){if(e.isEmpty())return this;var n=e.getFront(),r=this.children.get(n);return null!==r?r.subtree(e.popFront()):t.Empty},t.prototype.set=function(e,n){if(e.isEmpty())return new t(n,this.children);var r=e.getFront(),i=(this.children.get(r)||t.Empty).set(e.popFront(),n),o=this.children.insert(r,i);return new t(this.value,o)},t.prototype.remove=function(e){if(e.isEmpty())return this.children.isEmpty()?t.Empty:new t(null,this.children);var n=e.getFront(),r=this.children.get(n);if(r){var i=r.remove(e.popFront()),o=void 0;return o=i.isEmpty()?this.children.remove(n):this.children.insert(n,i),null===this.value&&o.isEmpty()?t.Empty:new t(this.value,o)}return this},t.prototype.get=function(t){if(t.isEmpty())return this.value;var e=t.getFront(),n=this.children.get(e);return n?n.get(t.popFront()):null},t.prototype.setTree=function(e,n){if(e.isEmpty())return n;var r=e.getFront(),i=(this.children.get(r)||t.Empty).setTree(e.popFront(),n),o=void 0;return o=i.isEmpty()?this.children.remove(r):this.children.insert(r,i),new t(this.value,o)},t.prototype.fold=function(t){return this.fold_(q.Empty,t)},t.prototype.fold_=function(t,e){var n={};return this.children.inorderTraversal((function(r,i){n[r]=i.fold_(t.child(r),e)})),e(t,this.value,n)},t.prototype.findOnPath=function(t,e){return this.findOnPath_(t,q.Empty,e)},t.prototype.findOnPath_=function(t,e,n){var r=!!this.value&&n(e,this.value);if(r)return r;if(t.isEmpty())return null;var i=t.getFront(),o=this.children.get(i);return o?o.findOnPath_(t.popFront(),e.child(i),n):null},t.prototype.foreachOnPath=function(t,e){return this.foreachOnPath_(t,q.Empty,e)},t.prototype.foreachOnPath_=function(e,n,r){if(e.isEmpty())return this;this.value&&r(n,this.value);var i=e.getFront(),o=this.children.get(i);return o?o.foreachOnPath_(e.popFront(),n.child(i),r):t.Empty},t.prototype.foreach=function(t){this.foreach_(q.Empty,t)},t.prototype.foreach_=function(t,e){this.children.inorderTraversal((function(n,r){r.foreach_(t.child(n),e)})),this.value&&e(t,this.value)},t.prototype.foreachChild=function(t){this.children.inorderTraversal((function(e,n){n.value&&t(e,n.value)}))},t.Empty=new t(null),t}(),ae=function(){function t(t,e){this.source=t,this.path=e,this.type=Wt.LISTEN_COMPLETE}return t.prototype.operationForChild=function(e){return this.path.isEmpty()?new t(this.source,q.Empty):new t(this.source,this.path.popFront())},t}(),se=function(){function t(t,e,n){this.source=t,this.path=e,this.snap=n,this.type=Wt.OVERWRITE}return t.prototype.operationForChild=function(e){return this.path.isEmpty()?new t(this.source,q.Empty,this.snap.getImmediateChild(e)):new t(this.source,this.path.popFront(),this.snap)},t}(),ue=function(){function t(t,e,n){this.source=t,this.path=e,this.children=n,this.type=Wt.MERGE}return t.prototype.operationForChild=function(e){if(this.path.isEmpty()){var n=this.children.subtree(new q(e));return n.isEmpty()?null:n.value?new se(this.source,q.Empty,n.value):new t(this.source,q.Empty,n)}return Object(a.f)(this.path.getFront()===e,"Can't get a merge for a child not on the path of the operation"),new t(this.source,this.path.popFront(),this.children)},t.prototype.toString=function(){return"Operation("+this.path+": "+this.source.toString()+" merge: "+this.children.toString()+")"},t}(),ce=function(){function t(t,e,n){this.node_=t,this.fullyInitialized_=e,this.filtered_=n}return t.prototype.isFullyInitialized=function(){return this.fullyInitialized_},t.prototype.isFiltered=function(){return this.filtered_},t.prototype.isCompleteForPath=function(t){if(t.isEmpty())return this.isFullyInitialized()&&!this.filtered_;var e=t.getFront();return this.isCompleteForChild(e)},t.prototype.isCompleteForChild=function(t){return this.isFullyInitialized()&&!this.filtered_||this.node_.hasChild(t)},t.prototype.getNode=function(){return this.node_},t}(),he=function(){function t(t,e){this.eventCache_=t,this.serverCache_=e}return t.prototype.updateEventSnap=function(e,n,r){return new t(new ce(e,n,r),this.serverCache_)},t.prototype.updateServerSnap=function(e,n,r){return new t(this.eventCache_,new ce(e,n,r))},t.prototype.getEventCache=function(){return this.eventCache_},t.prototype.getCompleteEventSnap=function(){return this.eventCache_.isFullyInitialized()?this.eventCache_.getNode():null},t.prototype.getServerCache=function(){return this.serverCache_},t.prototype.getCompleteServerSnap=function(){return this.serverCache_.isFullyInitialized()?this.serverCache_.getNode():null},t.Empty=new t(new ce(Ut.EMPTY_NODE,!1,!1),new ce(Ut.EMPTY_NODE,!1,!1)),t}(),le=function(){function t(t,e,n,r,i){this.type=t,this.snapshotNode=e,this.childName=n,this.oldSnap=r,this.prevName=i}return t.valueChange=function(e){return new t(t.VALUE,e)},t.childAddedChange=function(e,n){return new t(t.CHILD_ADDED,n,e)},t.childRemovedChange=function(e,n){return new t(t.CHILD_REMOVED,n,e)},t.childChangedChange=function(e,n,r){return new t(t.CHILD_CHANGED,n,e,r)},t.childMovedChange=function(e,n){return new t(t.CHILD_MOVED,n,e)},t.CHILD_ADDED="child_added",t.CHILD_REMOVED="child_removed",t.CHILD_CHANGED="child_changed",t.CHILD_MOVED="child_moved",t.VALUE="value",t}(),fe=function(){function t(t){this.index_=t}return t.prototype.updateChild=function(t,e,n,r,i,o){Object(a.f)(t.isIndexed(this.index_),"A node must be indexed if only a child is updated");var s=t.getImmediateChild(e);return s.getChild(r).equals(n.getChild(r))&&s.isEmpty()===n.isEmpty()?t:(null!=o&&(n.isEmpty()?t.hasChild(e)?o.trackChildChange(le.childRemovedChange(e,s)):Object(a.f)(t.isLeafNode(),"A child remove without an old child only makes sense on a leaf node"):s.isEmpty()?o.trackChildChange(le.childAddedChange(e,n)):o.trackChildChange(le.childChangedChange(e,n,s))),t.isLeafNode()&&n.isEmpty()?t:t.updateImmediateChild(e,n).withIndex(this.index_))},t.prototype.updateFullNode=function(t,e,n){return null!=n&&(t.isLeafNode()||t.forEachChild(Nt,(function(t,r){e.hasChild(t)||n.trackChildChange(le.childRemovedChange(t,r))})),e.isLeafNode()||e.forEachChild(Nt,(function(e,r){if(t.hasChild(e)){var i=t.getImmediateChild(e);i.equals(r)||n.trackChildChange(le.childChangedChange(e,r,i))}else n.trackChildChange(le.childAddedChange(e,r))}))),e.withIndex(this.index_)},t.prototype.updatePriority=function(t,e){return t.isEmpty()?Ut.EMPTY_NODE:t.updatePriority(e)},t.prototype.filtersNodes=function(){return!1},t.prototype.getIndexedFilter=function(){return this},t.prototype.getIndex=function(){return this.index_},t}(),pe=function(){function t(){this.changeMap=new Map}return t.prototype.trackChildChange=function(t){var e=t.type,n=t.childName;Object(a.f)(e===le.CHILD_ADDED||e===le.CHILD_CHANGED||e===le.CHILD_REMOVED,"Only child changes supported for tracking"),Object(a.f)(".priority"!==n,"Only non-priority child changes can be tracked.");var r=this.changeMap.get(n);if(r){var i=r.type;if(e===le.CHILD_ADDED&&i===le.CHILD_REMOVED)this.changeMap.set(n,le.childChangedChange(n,t.snapshotNode,r.snapshotNode));else if(e===le.CHILD_REMOVED&&i===le.CHILD_ADDED)this.changeMap.delete(n);else if(e===le.CHILD_REMOVED&&i===le.CHILD_CHANGED)this.changeMap.set(n,le.childRemovedChange(n,r.oldSnap));else if(e===le.CHILD_CHANGED&&i===le.CHILD_ADDED)this.changeMap.set(n,le.childAddedChange(n,t.snapshotNode));else{if(e!==le.CHILD_CHANGED||i!==le.CHILD_CHANGED)throw Object(a.g)("Illegal combination of changes: "+t+" occurred after "+r);this.changeMap.set(n,le.childChangedChange(n,t.snapshotNode,r.oldSnap))}}else this.changeMap.set(n,t)},t.prototype.getChanges=function(){return Array.from(this.changeMap.values())},t}(),de=new(function(){function t(){}return t.prototype.getCompleteChild=function(t){return null},t.prototype.getChildAfterChild=function(t,e,n){return null},t}()),me=function(){function t(t,e,n){void 0===n&&(n=null),this.writes_=t,this.viewCache_=e,this.optCompleteServerCache_=n}return t.prototype.getCompleteChild=function(t){var e=this.viewCache_.getEventCache();if(e.isCompleteForChild(t))return e.getNode().getImmediateChild(t);var n=null!=this.optCompleteServerCache_?new ce(this.optCompleteServerCache_,!0,!1):this.viewCache_.getServerCache();return this.writes_.calcCompleteChild(t,n)},t.prototype.getChildAfterChild=function(t,e,n){var r=null!=this.optCompleteServerCache_?this.optCompleteServerCache_:this.viewCache_.getCompleteServerSnap(),i=this.writes_.calcIndexedSlice(r,e,1,n,t);return 0===i.length?null:i[0]},t}(),ye=function(t,e){this.viewCache=t,this.changes=e},ge=function(){function t(t){this.filter_=t}return t.prototype.assertIndexed=function(t){Object(a.f)(t.getEventCache().getNode().isIndexed(this.filter_.getIndex()),"Event snap not indexed"),Object(a.f)(t.getServerCache().getNode().isIndexed(this.filter_.getIndex()),"Server snap not indexed")},t.prototype.applyOperation=function(e,n,r,i){var o,s,u=new pe;if(n.type===Wt.OVERWRITE){var c=n;c.source.fromUser?o=this.applyUserOverwrite_(e,c.path,c.snap,r,i,u):(Object(a.f)(c.source.fromServer,"Unknown source."),s=c.source.tagged||e.getServerCache().isFiltered()&&!c.path.isEmpty(),o=this.applyServerOverwrite_(e,c.path,c.snap,r,i,s,u))}else if(n.type===Wt.MERGE){var h=n;h.source.fromUser?o=this.applyUserMerge_(e,h.path,h.children,r,i,u):(Object(a.f)(h.source.fromServer,"Unknown source."),s=h.source.tagged||e.getServerCache().isFiltered(),o=this.applyServerMerge_(e,h.path,h.children,r,i,s,u))}else if(n.type===Wt.ACK_USER_WRITE){var l=n;o=l.revert?this.revertUserWrite_(e,l.path,r,i,u):this.ackUserWrite_(e,l.path,l.affectedTree,r,i,u)}else{if(n.type!==Wt.LISTEN_COMPLETE)throw Object(a.g)("Unknown operation type: "+n.type);o=this.listenComplete_(e,n.path,r,u)}var f=u.getChanges();return t.maybeAddValueEvent_(e,o,f),new ye(o,f)},t.maybeAddValueEvent_=function(t,e,n){var r=e.getEventCache();if(r.isFullyInitialized()){var i=r.getNode().isLeafNode()||r.getNode().isEmpty(),o=t.getCompleteEventSnap();(n.length>0||!t.getEventCache().isFullyInitialized()||i&&!r.getNode().equals(o)||!r.getNode().getPriority().equals(o.getPriority()))&&n.push(le.valueChange(e.getCompleteEventSnap()))}},t.prototype.generateEventCacheAfterServerEvent_=function(t,e,n,r,i){var o=t.getEventCache();if(null!=n.shadowingWrite(e))return t;var s=void 0,u=void 0;if(e.isEmpty())if(Object(a.f)(t.getServerCache().isFullyInitialized(),"If change path is empty, we must have complete server data"),t.getServerCache().isFiltered()){var c=t.getCompleteServerSnap(),h=c instanceof Ut?c:Ut.EMPTY_NODE,l=n.calcCompleteEventChildren(h);s=this.filter_.updateFullNode(t.getEventCache().getNode(),l,i)}else{var f=n.calcCompleteEventCache(t.getCompleteServerSnap());s=this.filter_.updateFullNode(t.getEventCache().getNode(),f,i)}else{var p=e.getFront();if(".priority"===p){Object(a.f)(1===e.getLength(),"Can't have a priority with additional path components");var d=o.getNode();u=t.getServerCache().getNode();var m=n.calcEventCacheAfterServerOverwrite(e,d,u);s=null!=m?this.filter_.updatePriority(d,m):o.getNode()}else{var y=e.popFront(),g=void 0;if(o.isCompleteForChild(p)){u=t.getServerCache().getNode();var v=n.calcEventCacheAfterServerOverwrite(e,o.getNode(),u);g=null!=v?o.getNode().getImmediateChild(p).updateChild(y,v):o.getNode().getImmediateChild(p)}else g=n.calcCompleteChild(p,t.getServerCache());s=null!=g?this.filter_.updateChild(o.getNode(),p,g,y,r,i):o.getNode()}}return t.updateEventSnap(s,o.isFullyInitialized()||e.isEmpty(),this.filter_.filtersNodes())},t.prototype.applyServerOverwrite_=function(t,e,n,r,i,o,a){var s,u=t.getServerCache(),c=o?this.filter_:this.filter_.getIndexedFilter();if(e.isEmpty())s=c.updateFullNode(u.getNode(),n,null);else if(c.filtersNodes()&&!u.isFiltered()){var h=u.getNode().updateChild(e,n);s=c.updateFullNode(u.getNode(),h,null)}else{var l=e.getFront();if(!u.isCompleteForPath(e)&&e.getLength()>1)return t;var f=e.popFront(),p=u.getNode().getImmediateChild(l).updateChild(f,n);s=".priority"===l?c.updatePriority(u.getNode(),p):c.updateChild(u.getNode(),l,p,f,de,null)}var d=t.updateServerSnap(s,u.isFullyInitialized()||e.isEmpty(),c.filtersNodes()),m=new me(r,d,i);return this.generateEventCacheAfterServerEvent_(d,e,r,m,a)},t.prototype.applyUserOverwrite_=function(t,e,n,r,i,o){var a,s,u=t.getEventCache(),c=new me(r,t,i);if(e.isEmpty())s=this.filter_.updateFullNode(t.getEventCache().getNode(),n,o),a=t.updateEventSnap(s,!0,this.filter_.filtersNodes());else{var h=e.getFront();if(".priority"===h)s=this.filter_.updatePriority(t.getEventCache().getNode(),n),a=t.updateEventSnap(s,u.isFullyInitialized(),u.isFiltered());else{var l=e.popFront(),f=u.getNode().getImmediateChild(h),p=void 0;if(l.isEmpty())p=n;else{var d=c.getCompleteChild(h);p=null!=d?".priority"===l.getBack()&&d.getChild(l.parent()).isEmpty()?d:d.updateChild(l,n):Ut.EMPTY_NODE}if(f.equals(p))a=t;else{var m=this.filter_.updateChild(u.getNode(),h,p,l,c,o);a=t.updateEventSnap(m,u.isFullyInitialized(),this.filter_.filtersNodes())}}}return a},t.cacheHasChild_=function(t,e){return t.getEventCache().isCompleteForChild(e)},t.prototype.applyUserMerge_=function(e,n,r,i,o,a){var s=this,u=e;return r.foreach((function(r,c){var h=n.child(r);t.cacheHasChild_(e,h.getFront())&&(u=s.applyUserOverwrite_(u,h,c,i,o,a))})),r.foreach((function(r,c){var h=n.child(r);t.cacheHasChild_(e,h.getFront())||(u=s.applyUserOverwrite_(u,h,c,i,o,a))})),u},t.prototype.applyMerge_=function(t,e){return e.foreach((function(e,n){t=t.updateChild(e,n)})),t},t.prototype.applyServerMerge_=function(t,e,n,r,i,o,a){var s=this;if(t.getServerCache().getNode().isEmpty()&&!t.getServerCache().isFullyInitialized())return t;var u,c=t;u=e.isEmpty()?n:oe.Empty.setTree(e,n);var h=t.getServerCache().getNode();return u.children.inorderTraversal((function(e,n){if(h.hasChild(e)){var u=t.getServerCache().getNode().getImmediateChild(e),l=s.applyMerge_(u,n);c=s.applyServerOverwrite_(c,new q(e),l,r,i,o,a)}})),u.children.inorderTraversal((function(e,n){var u=!t.getServerCache().isCompleteForChild(e)&&null==n.value;if(!h.hasChild(e)&&!u){var l=t.getServerCache().getNode().getImmediateChild(e),f=s.applyMerge_(l,n);c=s.applyServerOverwrite_(c,new q(e),f,r,i,o,a)}})),c},t.prototype.ackUserWrite_=function(t,e,n,r,i,o){if(null!=r.shadowingWrite(e))return t;var a=t.getServerCache().isFiltered(),s=t.getServerCache();if(null!=n.value){if(e.isEmpty()&&s.isFullyInitialized()||s.isCompleteForPath(e))return this.applyServerOverwrite_(t,e,s.getNode().getChild(e),r,i,a,o);if(e.isEmpty()){var u=oe.Empty;return s.getNode().forEachChild(vt,(function(t,e){u=u.set(new q(t),e)})),this.applyServerMerge_(t,e,u,r,i,a,o)}return t}var c=oe.Empty;return n.foreach((function(t,n){var r=e.child(t);s.isCompleteForPath(r)&&(c=c.set(t,s.getNode().getChild(r)))})),this.applyServerMerge_(t,e,c,r,i,a,o)},t.prototype.listenComplete_=function(t,e,n,r){var i=t.getServerCache(),o=t.updateServerSnap(i.getNode(),i.isFullyInitialized()||e.isEmpty(),i.isFiltered());return this.generateEventCacheAfterServerEvent_(o,e,n,de,r)},t.prototype.revertUserWrite_=function(t,e,n,r,i){var o;if(null!=n.shadowingWrite(e))return t;var s=new me(n,t,r),u=t.getEventCache().getNode(),c=void 0;if(e.isEmpty()||".priority"===e.getFront()){var h=void 0;if(t.getServerCache().isFullyInitialized())h=n.calcCompleteEventCache(t.getCompleteServerSnap());else{var l=t.getServerCache().getNode();Object(a.f)(l instanceof Ut,"serverChildren would be complete if leaf node"),h=n.calcCompleteEventChildren(l)}h=h,c=this.filter_.updateFullNode(u,h,i)}else{var f=e.getFront(),p=n.calcCompleteChild(f,t.getServerCache());null==p&&t.getServerCache().isCompleteForChild(f)&&(p=u.getImmediateChild(f)),(c=null!=p?this.filter_.updateChild(u,f,p,e.popFront(),s,i):t.getEventCache().getNode().hasChild(f)?this.filter_.updateChild(u,f,Ut.EMPTY_NODE,e.popFront(),s,i):u).isEmpty()&&t.getServerCache().isFullyInitialized()&&(o=n.calcCompleteEventCache(t.getCompleteServerSnap())).isLeafNode()&&(c=this.filter_.updateFullNode(c,o,i))}return o=t.getServerCache().isFullyInitialized()||null!=n.shadowingWrite(q.Empty),t.updateEventSnap(c,o,this.filter_.filtersNodes())},t}(),ve=function(){function t(t){this.query_=t,this.index_=this.query_.getQueryParams().getIndex()}return t.prototype.generateEventsForChanges=function(t,e,n){var r=this,i=[],o=[];return t.forEach((function(t){t.type===le.CHILD_CHANGED&&r.index_.indexedValueChanged(t.oldSnap,t.snapshotNode)&&o.push(le.childMovedChange(t.childName,t.snapshotNode))})),this.generateEventsForType_(i,le.CHILD_REMOVED,t,n,e),this.generateEventsForType_(i,le.CHILD_ADDED,t,n,e),this.generateEventsForType_(i,le.CHILD_MOVED,o,n,e),this.generateEventsForType_(i,le.CHILD_CHANGED,t,n,e),this.generateEventsForType_(i,le.VALUE,t,n,e),i},t.prototype.generateEventsForType_=function(t,e,n,r,i){var o=this,a=n.filter((function(t){return t.type===e}));a.sort(this.compareChanges_.bind(this)),a.forEach((function(e){var n=o.materializeSingleChange_(e,i);r.forEach((function(r){r.respondsTo(e.type)&&t.push(r.createEvent(n,o.query_))}))}))},t.prototype.materializeSingleChange_=function(t,e){return"value"===t.type||"child_removed"===t.type?t:(t.prevName=e.getPredecessorChildName(t.childName,t.snapshotNode,this.index_),t)},t.prototype.compareChanges_=function(t,e){if(null==t.childName||null==e.childName)throw Object(a.g)("Should only compare child_ events.");var n=new mt(t.childName,t.snapshotNode),r=new mt(e.childName,e.snapshotNode);return this.index_.compare(n,r)},t}(),be=function(){function t(t,e){this.query_=t,this.eventRegistrations_=[];var n=this.query_.getQueryParams(),r=new fe(n.getIndex()),i=n.getNodeFilter();this.processor_=new ge(i);var o=e.getServerCache(),a=e.getEventCache(),s=r.updateFullNode(Ut.EMPTY_NODE,o.getNode(),null),u=i.updateFullNode(Ut.EMPTY_NODE,a.getNode(),null),c=new ce(s,o.isFullyInitialized(),r.filtersNodes()),h=new ce(u,a.isFullyInitialized(),i.filtersNodes());this.viewCache_=new he(h,c),this.eventGenerator_=new ve(this.query_)}return t.prototype.getQuery=function(){return this.query_},t.prototype.getServerCache=function(){return this.viewCache_.getServerCache().getNode()},t.prototype.getCompleteServerCache=function(t){var e=this.viewCache_.getCompleteServerSnap();return e&&(this.query_.getQueryParams().loadsAllData()||!t.isEmpty()&&!e.getImmediateChild(t.getFront()).isEmpty())?e.getChild(t):null},t.prototype.isEmpty=function(){return 0===this.eventRegistrations_.length},t.prototype.addEventRegistration=function(t){this.eventRegistrations_.push(t)},t.prototype.removeEventRegistration=function(t,e){var n=[];if(e){Object(a.f)(null==t,"A cancel should cancel all event registrations.");var r=this.query_.path;this.eventRegistrations_.forEach((function(t){e=e;var i=t.createCancelEvent(e,r);i&&n.push(i)}))}if(t){for(var i=[],o=0;o<this.eventRegistrations_.length;++o){var s=this.eventRegistrations_[o];if(s.matches(t)){if(t.hasAnyCallback()){i=i.concat(this.eventRegistrations_.slice(o+1));break}}else i.push(s)}this.eventRegistrations_=i}else this.eventRegistrations_=[];return n},t.prototype.applyOperation=function(t,e,n){t.type===Wt.MERGE&&null!==t.source.queryId&&(Object(a.f)(this.viewCache_.getCompleteServerSnap(),"We should always have a full cache before handling merges"),Object(a.f)(this.viewCache_.getCompleteEventSnap(),"Missing event cache, even though we have a server cache"));var r=this.viewCache_,i=this.processor_.applyOperation(r,t,e,n);return this.processor_.assertIndexed(i.viewCache),Object(a.f)(i.viewCache.getServerCache().isFullyInitialized()||!r.getServerCache().isFullyInitialized(),"Once a server snap is complete, it should never go back"),this.viewCache_=i.viewCache,this.generateEventsForChanges_(i.changes,i.viewCache.getEventCache().getNode(),null)},t.prototype.getInitialEvents=function(t){var e=this.viewCache_.getEventCache(),n=[];e.getNode().isLeafNode()||e.getNode().forEachChild(Nt,(function(t,e){n.push(le.childAddedChange(t,e))}));return e.isFullyInitialized()&&n.push(le.valueChange(e.getNode())),this.generateEventsForChanges_(n,e.getNode(),t)},t.prototype.generateEventsForChanges_=function(t,e,n){var r=n?[n]:this.eventRegistrations_;return this.eventGenerator_.generateEventsForChanges(t,e,r)},t}(),we=function(){function t(){this.views=new Map}return Object.defineProperty(t,"__referenceConstructor",{get:function(){return Object(a.f)(ne,"Reference.ts has not been loaded"),ne},set:function(t){Object(a.f)(!ne,"__referenceConstructor has already been defined"),ne=t},enumerable:!0,configurable:!0}),t.prototype.isEmpty=function(){return 0===this.views.size},t.prototype.applyOperation=function(t,e,n){var r,i,s=t.source.queryId;if(null!==s){var u=this.views.get(s);return Object(a.f)(null!=u,"SyncTree gave us an op for an invalid query."),u.applyOperation(t,e,n)}var c=[];try{for(var h=Object(o.h)(this.views.values()),l=h.next();!l.done;l=h.next()){u=l.value;c=c.concat(u.applyOperation(t,e,n))}}catch(t){r={error:t}}finally{try{l&&!l.done&&(i=h.return)&&i.call(h)}finally{if(r)throw r.error}}return c},t.prototype.addEventRegistration=function(t,e,n,r,i){var o=t.queryIdentifier(),a=this.views.get(o);if(!a){var s=n.calcCompleteEventCache(i?r:null),u=!1;s?u=!0:r instanceof Ut?(s=n.calcCompleteEventChildren(r),u=!1):(s=Ut.EMPTY_NODE,u=!1);var c=new he(new ce(s,u,!1),new ce(r,i,!1));a=new be(t,c),this.views.set(o,a)}return a.addEventRegistration(e),a.getInitialEvents(e)},t.prototype.removeEventRegistration=function(e,n,r){var i,a,s=e.queryIdentifier(),u=[],c=[],h=this.hasCompleteView();if("default"===s)try{for(var l=Object(o.h)(this.views.entries()),f=l.next();!f.done;f=l.next()){var p=Object(o.e)(f.value,2),d=p[0],m=p[1];c=c.concat(m.removeEventRegistration(n,r)),m.isEmpty()&&(this.views.delete(d),m.getQuery().getQueryParams().loadsAllData()||u.push(m.getQuery()))}}catch(t){i={error:t}}finally{try{f&&!f.done&&(a=l.return)&&a.call(l)}finally{if(i)throw i.error}}else(m=this.views.get(s))&&(c=c.concat(m.removeEventRegistration(n,r)),m.isEmpty()&&(this.views.delete(s),m.getQuery().getQueryParams().loadsAllData()||u.push(m.getQuery())));return h&&!this.hasCompleteView()&&u.push(new t.__referenceConstructor(e.repo,e.path)),{removed:u,events:c}},t.prototype.getQueryViews=function(){var t,e,n=[];try{for(var r=Object(o.h)(this.views.values()),i=r.next();!i.done;i=r.next()){var a=i.value;a.getQuery().getQueryParams().loadsAllData()||n.push(a)}}catch(e){t={error:e}}finally{try{i&&!i.done&&(e=r.return)&&e.call(r)}finally{if(t)throw t.error}}return n},t.prototype.getCompleteServerCache=function(t){var e,n,r=null;try{for(var i=Object(o.h)(this.views.values()),a=i.next();!a.done;a=i.next()){var s=a.value;r=r||s.getCompleteServerCache(t)}}catch(t){e={error:t}}finally{try{a&&!a.done&&(n=i.return)&&n.call(i)}finally{if(e)throw e.error}}return r},t.prototype.viewForQuery=function(t){if(t.getQueryParams().loadsAllData())return this.getCompleteView();var e=t.queryIdentifier();return this.views.get(e)},t.prototype.viewExistsForQuery=function(t){return null!=this.viewForQuery(t)},t.prototype.hasCompleteView=function(){return null!=this.getCompleteView()},t.prototype.getCompleteView=function(){var t,e;try{for(var n=Object(o.h)(this.views.values()),r=n.next();!r.done;r=n.next()){var i=r.value;if(i.getQuery().getQueryParams().loadsAllData())return i}}catch(e){t={error:e}}finally{try{r&&!r.done&&(e=n.return)&&e.call(n)}finally{if(t)throw t.error}}return null},t}(),Te=function(){function t(t){this.writeTree_=t}return t.prototype.addWrite=function(e,n){if(e.isEmpty())return new t(new oe(n));var r=this.writeTree_.findRootMostValueAndPath(e);if(null!=r){var i=r.path,o=r.value,a=q.relativePath(i,e);return o=o.updateChild(a,n),new t(this.writeTree_.set(i,o))}var s=new oe(n);return new t(this.writeTree_.setTree(e,s))},t.prototype.addWrites=function(t,e){var n=this;return M(e,(function(e,r){n=n.addWrite(t.child(e),r)})),n},t.prototype.removeWrite=function(e){return e.isEmpty()?t.Empty:new t(this.writeTree_.setTree(e,oe.Empty))},t.prototype.hasCompleteWrite=function(t){return null!=this.getCompleteNode(t)},t.prototype.getCompleteNode=function(t){var e=this.writeTree_.findRootMostValueAndPath(t);return null!=e?this.writeTree_.get(e.path).getChild(q.relativePath(e.path,t)):null},t.prototype.getCompleteChildren=function(){var t=[],e=this.writeTree_.value;return null!=e?e.isLeafNode()||e.forEachChild(Nt,(function(e,n){t.push(new mt(e,n))})):this.writeTree_.children.inorderTraversal((function(e,n){null!=n.value&&t.push(new mt(e,n.value))})),t},t.prototype.childCompoundWrite=function(e){if(e.isEmpty())return this;var n=this.getCompleteNode(e);return new t(null!=n?new oe(n):this.writeTree_.subtree(e))},t.prototype.isEmpty=function(){return this.writeTree_.isEmpty()},t.prototype.apply=function(t){return function t(e,n,r){if(null!=n.value)return r.updateChild(e,n.value);var i=null;return n.children.inorderTraversal((function(n,o){".priority"===n?(Object(a.f)(null!==o.value,"Priority writes must always be leaf nodes"),i=o.value):r=t(e.child(n),o,r)})),r.getChild(e).isEmpty()||null===i||(r=r.updateChild(e.child(".priority"),i)),r}
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */(q.Empty,this.writeTree_,t)},t.Empty=new t(new oe(null)),t}();
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var _e=function(){function t(){this.visibleWrites_=Te.Empty,this.allWrites_=[],this.lastWriteId_=-1}return t.prototype.childWrites=function(t){return new Ee(t,this)},t.prototype.addOverwrite=function(t,e,n,r){Object(a.f)(n>this.lastWriteId_,"Stacking an older write on top of newer ones"),void 0===r&&(r=!0),this.allWrites_.push({path:t,snap:e,writeId:n,visible:r}),r&&(this.visibleWrites_=this.visibleWrites_.addWrite(t,e)),this.lastWriteId_=n},t.prototype.addMerge=function(t,e,n){Object(a.f)(n>this.lastWriteId_,"Stacking an older merge on top of newer ones"),this.allWrites_.push({path:t,children:e,writeId:n,visible:!0}),this.visibleWrites_=this.visibleWrites_.addWrites(t,e),this.lastWriteId_=n},t.prototype.getWrite=function(t){for(var e=0;e<this.allWrites_.length;e++){var n=this.allWrites_[e];if(n.writeId===t)return n}return null},t.prototype.removeWrite=function(t){var e=this,n=this.allWrites_.findIndex((function(e){return e.writeId===t}));Object(a.f)(n>=0,"removeWrite called with nonexistent writeId.");var r=this.allWrites_[n];this.allWrites_.splice(n,1);for(var i=r.visible,o=!1,s=this.allWrites_.length-1;i&&s>=0;){var u=this.allWrites_[s];u.visible&&(s>=n&&this.recordContainsPath_(u,r.path)?i=!1:r.path.contains(u.path)&&(o=!0)),s--}if(i){if(o)return this.resetTree_(),!0;r.snap?this.visibleWrites_=this.visibleWrites_.removeWrite(r.path):M(r.children,(function(t){e.visibleWrites_=e.visibleWrites_.removeWrite(r.path.child(t))}));return!0}return!1},t.prototype.getCompleteWriteData=function(t){return this.visibleWrites_.getCompleteNode(t)},t.prototype.calcCompleteEventCache=function(e,n,r,i){if(r||i){var o=this.visibleWrites_.childCompoundWrite(e);if(!i&&o.isEmpty())return n;if(i||null!=n||o.hasCompleteWrite(q.Empty)){var a=t.layerTree_(this.allWrites_,(function(t){return(t.visible||i)&&(!r||!~r.indexOf(t.writeId))&&(t.path.contains(e)||e.contains(t.path))}),e);c=n||Ut.EMPTY_NODE;return a.apply(c)}return null}var s=this.visibleWrites_.getCompleteNode(e);if(null!=s)return s;var u=this.visibleWrites_.childCompoundWrite(e);if(u.isEmpty())return n;if(null!=n||u.hasCompleteWrite(q.Empty)){var c=n||Ut.EMPTY_NODE;return u.apply(c)}return null},t.prototype.calcCompleteEventChildren=function(t,e){var n=Ut.EMPTY_NODE,r=this.visibleWrites_.getCompleteNode(t);if(r)return r.isLeafNode()||r.forEachChild(Nt,(function(t,e){n=n.updateImmediateChild(t,e)})),n;if(e){var i=this.visibleWrites_.childCompoundWrite(t);return e.forEachChild(Nt,(function(t,e){var r=i.childCompoundWrite(new q(t)).apply(e);n=n.updateImmediateChild(t,r)})),i.getCompleteChildren().forEach((function(t){n=n.updateImmediateChild(t.name,t.node)})),n}return this.visibleWrites_.childCompoundWrite(t).getCompleteChildren().forEach((function(t){n=n.updateImmediateChild(t.name,t.node)})),n},t.prototype.calcEventCacheAfterServerOverwrite=function(t,e,n,r){Object(a.f)(n||r,"Either existingEventSnap or existingServerSnap must exist");var i=t.child(e);if(this.visibleWrites_.hasCompleteWrite(i))return null;var o=this.visibleWrites_.childCompoundWrite(i);return o.isEmpty()?r.getChild(e):o.apply(r.getChild(e))},t.prototype.calcCompleteChild=function(t,e,n){var r=t.child(e),i=this.visibleWrites_.getCompleteNode(r);return null!=i?i:n.isCompleteForChild(e)?this.visibleWrites_.childCompoundWrite(r).apply(n.getNode().getImmediateChild(e)):null},t.prototype.shadowingWrite=function(t){return this.visibleWrites_.getCompleteNode(t)},t.prototype.calcIndexedSlice=function(t,e,n,r,i,o){var a,s=this.visibleWrites_.childCompoundWrite(t),u=s.getCompleteNode(q.Empty);if(null!=u)a=u;else{if(null==e)return[];a=s.apply(e)}if((a=a.withIndex(o)).isEmpty()||a.isLeafNode())return[];for(var c=[],h=o.getCompare(),l=i?a.getReverseIteratorFrom(n,o):a.getIteratorFrom(n,o),f=l.getNext();f&&c.length<r;)0!==h(f,n)&&c.push(f),f=l.getNext();return c},t.prototype.recordContainsPath_=function(t,e){if(t.snap)return t.path.contains(e);for(var n in t.children)if(t.children.hasOwnProperty(n)&&t.path.child(n).contains(e))return!0;return!1},t.prototype.resetTree_=function(){this.visibleWrites_=t.layerTree_(this.allWrites_,t.DefaultFilter_,q.Empty),this.allWrites_.length>0?this.lastWriteId_=this.allWrites_[this.allWrites_.length-1].writeId:this.lastWriteId_=-1},t.DefaultFilter_=function(t){return t.visible},t.layerTree_=function(t,e,n){for(var r=Te.Empty,i=0;i<t.length;++i){var o=t[i];if(e(o)){var s=o.path,u=void 0;if(o.snap)n.contains(s)?(u=q.relativePath(n,s),r=r.addWrite(u,o.snap)):s.contains(n)&&(u=q.relativePath(s,n),r=r.addWrite(q.Empty,o.snap.getChild(u)));else{if(!o.children)throw Object(a.g)("WriteRecord should have .snap or .children");if(n.contains(s))u=q.relativePath(n,s),r=r.addWrites(u,o.children);else if(s.contains(n))if((u=q.relativePath(s,n)).isEmpty())r=r.addWrites(q.Empty,o.children);else{var c=Object(a.D)(o.children,u.getFront());if(c){var h=c.getChild(u.popFront());r=r.addWrite(q.Empty,h)}}}}}return r},t}(),Ee=function(){function t(t,e){this.treePath_=t,this.writeTree_=e}return t.prototype.calcCompleteEventCache=function(t,e,n){return this.writeTree_.calcCompleteEventCache(this.treePath_,t,e,n)},t.prototype.calcCompleteEventChildren=function(t){return this.writeTree_.calcCompleteEventChildren(this.treePath_,t)},t.prototype.calcEventCacheAfterServerOverwrite=function(t,e,n){return this.writeTree_.calcEventCacheAfterServerOverwrite(this.treePath_,t,e,n)},t.prototype.shadowingWrite=function(t){return this.writeTree_.shadowingWrite(this.treePath_.child(t))},t.prototype.calcIndexedSlice=function(t,e,n,r,i){return this.writeTree_.calcIndexedSlice(this.treePath_,t,e,n,r,i)},t.prototype.calcCompleteChild=function(t,e){return this.writeTree_.calcCompleteChild(this.treePath_,t,e)},t.prototype.child=function(e){return new t(this.treePath_.child(e),this.writeTree_)},t}(),Se=function(){function t(t){this.listenProvider_=t,this.syncPointTree_=oe.Empty,this.pendingWriteTree_=new _e,this.tagToQueryMap=new Map,this.queryToTagMap=new Map}return t.prototype.applyUserOverwrite=function(t,e,n,r){return this.pendingWriteTree_.addOverwrite(t,e,n,r),r?this.applyOperationToSyncPoints_(new se(re.User,t,e)):[]},t.prototype.applyUserMerge=function(t,e,n){this.pendingWriteTree_.addMerge(t,e,n);var r=oe.fromObject(e);return this.applyOperationToSyncPoints_(new ue(re.User,t,r))},t.prototype.ackUserWrite=function(t,e){void 0===e&&(e=!1);var n=this.pendingWriteTree_.getWrite(t);if(this.pendingWriteTree_.removeWrite(t)){var r=oe.Empty;return null!=n.snap?r=r.set(q.Empty,!0):M(n.children,(function(t,e){r=r.set(new q(t),e)})),this.applyOperationToSyncPoints_(new ie(n.path,r,e))}return[]},t.prototype.applyServerOverwrite=function(t,e){return this.applyOperationToSyncPoints_(new se(re.Server,t,e))},t.prototype.applyServerMerge=function(t,e){var n=oe.fromObject(e);return this.applyOperationToSyncPoints_(new ue(re.Server,t,n))},t.prototype.applyListenComplete=function(t){return this.applyOperationToSyncPoints_(new ae(re.Server,t))},t.prototype.applyTaggedQueryOverwrite=function(e,n,r){var i=this.queryKeyForTag_(r);if(null!=i){var o=t.parseQueryKey_(i),a=o.path,s=o.queryId,u=q.relativePath(a,e),c=new se(re.forServerTaggedQuery(s),u,n);return this.applyTaggedOperation_(a,c)}return[]},t.prototype.applyTaggedQueryMerge=function(e,n,r){var i=this.queryKeyForTag_(r);if(i){var o=t.parseQueryKey_(i),a=o.path,s=o.queryId,u=q.relativePath(a,e),c=oe.fromObject(n),h=new ue(re.forServerTaggedQuery(s),u,c);return this.applyTaggedOperation_(a,h)}return[]},t.prototype.applyTaggedListenComplete=function(e,n){var r=this.queryKeyForTag_(n);if(r){var i=t.parseQueryKey_(r),o=i.path,a=i.queryId,s=q.relativePath(o,e),u=new ae(re.forServerTaggedQuery(a),s);return this.applyTaggedOperation_(o,u)}return[]},t.prototype.addEventRegistration=function(e,n){var r=e.path,i=null,o=!1;this.syncPointTree_.foreachOnPath(r,(function(t,e){var n=q.relativePath(t,r);i=i||e.getCompleteServerCache(n),o=o||e.hasCompleteView()}));var s,u=this.syncPointTree_.get(r);(u?(o=o||u.hasCompleteView(),i=i||u.getCompleteServerCache(q.Empty)):(u=new we,this.syncPointTree_=this.syncPointTree_.set(r,u)),null!=i)?s=!0:(s=!1,i=Ut.EMPTY_NODE,this.syncPointTree_.subtree(r).foreachChild((function(t,e){var n=e.getCompleteServerCache(q.Empty);n&&(i=i.updateImmediateChild(t,n))})));var c=u.viewExistsForQuery(e);if(!c&&!e.getQueryParams().loadsAllData()){var h=t.makeQueryKey_(e);Object(a.f)(!this.queryToTagMap.has(h),"View does not exist, but we have a tag");var l=t.getNextQueryTag_();this.queryToTagMap.set(h,l),this.tagToQueryMap.set(l,h)}var f=this.pendingWriteTree_.childWrites(r),p=u.addEventRegistration(e,n,f,i,s);if(!c&&!o){var d=u.viewForQuery(e);p=p.concat(this.setupListener_(e,d))}return p},t.prototype.removeEventRegistration=function(e,n,r){var i=this,o=e.path,a=this.syncPointTree_.get(o),s=[];if(a&&("default"===e.queryIdentifier()||a.viewExistsForQuery(e))){var u=a.removeEventRegistration(e,n,r);a.isEmpty()&&(this.syncPointTree_=this.syncPointTree_.remove(o));var c=u.removed;s=u.events;var h=-1!==c.findIndex((function(t){return t.getQueryParams().loadsAllData()})),l=this.syncPointTree_.findOnPath(o,(function(t,e){return e.hasCompleteView()}));if(h&&!l){var f=this.syncPointTree_.subtree(o);if(!f.isEmpty())for(var p=this.collectDistinctViewsForSubTree_(f),d=0;d<p.length;++d){var m=p[d],y=m.getQuery(),g=this.createListenerForView_(m);this.listenProvider_.startListening(t.queryForListening_(y),this.tagForQuery_(y),g.hashFn,g.onComplete)}}if(!l&&c.length>0&&!r)if(h){this.listenProvider_.stopListening(t.queryForListening_(e),null)}else c.forEach((function(e){var n=i.queryToTagMap.get(t.makeQueryKey_(e));i.listenProvider_.stopListening(t.queryForListening_(e),n)}));this.removeTags_(c)}return s},t.prototype.calcCompleteEventCache=function(t,e){var n=this.pendingWriteTree_,r=this.syncPointTree_.findOnPath(t,(function(e,n){var r=q.relativePath(e,t),i=n.getCompleteServerCache(r);if(i)return i}));return n.calcCompleteEventCache(t,r,e,!0)},t.prototype.collectDistinctViewsForSubTree_=function(t){return t.fold((function(t,e,n){if(e&&e.hasCompleteView())return[e.getCompleteView()];var r=[];return e&&(r=e.getQueryViews()),M(n,(function(t,e){r=r.concat(e)})),r}))},t.prototype.removeTags_=function(e){for(var n=0;n<e.length;++n){var r=e[n];if(!r.getQueryParams().loadsAllData()){var i=t.makeQueryKey_(r),o=this.queryToTagMap.get(i);this.queryToTagMap.delete(i),this.tagToQueryMap.delete(o)}}},t.queryForListening_=function(t){return t.getQueryParams().loadsAllData()&&!t.getQueryParams().isDefault()?t.getRef():t},t.prototype.setupListener_=function(e,n){var r=e.path,i=this.tagForQuery_(e),o=this.createListenerForView_(n),s=this.listenProvider_.startListening(t.queryForListening_(e),i,o.hashFn,o.onComplete),u=this.syncPointTree_.subtree(r);if(i)Object(a.f)(!u.value.hasCompleteView(),"If we're adding a query, it shouldn't be shadowed");else for(var c=u.fold((function(t,e,n){if(!t.isEmpty()&&e&&e.hasCompleteView())return[e.getCompleteView().getQuery()];var r=[];return e&&(r=r.concat(e.getQueryViews().map((function(t){return t.getQuery()})))),M(n,(function(t,e){r=r.concat(e)})),r})),h=0;h<c.length;++h){var l=c[h];this.listenProvider_.stopListening(t.queryForListening_(l),this.tagForQuery_(l))}return s},t.prototype.createListenerForView_=function(t){var e=this,n=t.getQuery(),r=this.tagForQuery_(n);return{hashFn:function(){return(t.getServerCache()||Ut.EMPTY_NODE).hash()},onComplete:function(t){if("ok"===t)return r?e.applyTaggedListenComplete(n.path,r):e.applyListenComplete(n.path);var i=function(t,e){var n="Unknown Error";"too_big"===t?n="The data requested exceeds the maximum size that can be accessed with a single request.":"permission_denied"===t?n="Client doesn't have permission to access the desired data.":"unavailable"===t&&(n="The service is unavailable");var r=new Error(t+" at "+e.path.toString()+": "+n);return r.code=t.toUpperCase(),r}(t,n);return e.removeEventRegistration(n,null,i)}}},t.makeQueryKey_=function(t){return t.path.toString()+"$"+t.queryIdentifier()},t.parseQueryKey_=function(t){var e=t.indexOf("$");return Object(a.f)(-1!==e&&e<t.length-1,"Bad queryKey."),{queryId:t.substr(e+1),path:new q(t.substr(0,e))}},t.prototype.queryKeyForTag_=function(t){return this.tagToQueryMap.get(t)},t.prototype.tagForQuery_=function(e){var n=t.makeQueryKey_(e);return this.queryToTagMap.get(n)},t.getNextQueryTag_=function(){return t.nextQueryTag_++},t.prototype.applyTaggedOperation_=function(t,e){var n=this.syncPointTree_.get(t);Object(a.f)(n,"Missing sync point for query tag that we're tracking");var r=this.pendingWriteTree_.childWrites(t);return n.applyOperation(e,r,null)},t.prototype.applyOperationToSyncPoints_=function(t){return this.applyOperationHelper_(t,this.syncPointTree_,null,this.pendingWriteTree_.childWrites(q.Empty))},t.prototype.applyOperationHelper_=function(t,e,n,r){if(t.path.isEmpty())return this.applyOperationDescendantsHelper_(t,e,n,r);var i=e.get(q.Empty);null==n&&null!=i&&(n=i.getCompleteServerCache(q.Empty));var o=[],a=t.path.getFront(),s=t.operationForChild(a),u=e.children.get(a);if(u&&s){var c=n?n.getImmediateChild(a):null,h=r.child(a);o=o.concat(this.applyOperationHelper_(s,u,c,h))}return i&&(o=o.concat(i.applyOperation(t,r,n))),o},t.prototype.applyOperationDescendantsHelper_=function(t,e,n,r){var i=this,o=e.get(q.Empty);null==n&&null!=o&&(n=o.getCompleteServerCache(q.Empty));var a=[];return e.children.inorderTraversal((function(e,o){var s=n?n.getImmediateChild(e):null,u=r.child(e),c=t.operationForChild(e);c&&(a=a.concat(i.applyOperationDescendantsHelper_(c,o,s,u)))})),o&&(a=a.concat(o.applyOperation(t,r,n))),a},t.nextQueryTag_=1,t}(),Ie=function(){function t(){this.rootNode_=Ut.EMPTY_NODE}return t.prototype.getNode=function(t){return this.rootNode_.getChild(t)},t.prototype.updateSnapshot=function(t,e){this.rootNode_=this.rootNode_.updateChild(t,e)},t}(),Ce=function(){function t(t,e){var n=this;this.app_=t,this.authProvider_=e,this.auth_=null,this.auth_=e.getImmediate({optional:!0}),this.auth_||e.get().then((function(t){return n.auth_=t}))}return t.prototype.getToken=function(t){return this.auth_?this.auth_.getToken(t).catch((function(t){return t&&"auth/token-not-initialized"===t.code?(T("Got auth/token-not-initialized error.  Treating as null token."),null):Promise.reject(t)})):Promise.resolve(null)},t.prototype.addTokenChangeListener=function(t){this.auth_?this.auth_.addAuthTokenListener(t):(setTimeout((function(){return t(null)}),0),this.authProvider_.get().then((function(e){return e.addAuthTokenListener(t)})))},t.prototype.removeTokenChangeListener=function(t){this.authProvider_.get().then((function(e){return e.removeAuthTokenListener(t)}))},t.prototype.notifyForInvalidToken=function(){var t='Provided authentication credentials for the app named "'+this.app_.name+'" are invalid. This usually indicates your app was not initialized correctly. ';"credential"in this.app_.options?t+='Make sure the "credential" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':"serviceAccount"in this.app_.options?t+='Make sure the "serviceAccount" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':t+='Make sure the "apiKey" and "databaseURL" properties provided to initializeApp() match the values provided for your app at https://console.firebase.google.com/.',I(t)},t}(),Ne=function(){function t(){this.counters_={}}return t.prototype.incrementCounter=function(t,e){void 0===e&&(e=1),Object(a.j)(this.counters_,t)||(this.counters_[t]=0),this.counters_[t]+=e},t.prototype.get=function(){return Object(a.l)(this.counters_)},t}(),De=function(){function t(){}return t.getCollection=function(t){var e=t.toString();return this.collections_[e]||(this.collections_[e]=new Ne),this.collections_[e]},t.getOrCreateReporter=function(t,e){var n=t.toString();return this.reporters_[n]||(this.reporters_[n]=e()),this.reporters_[n]},t.collections_={},t.reporters_={},t}(),Ae=function(){function t(t){this.collection_=t,this.last_=null}return t.prototype.get=function(){var t=this.collection_.get(),e=Object(o.a)({},t);return this.last_&&M(this.last_,(function(t,n){e[t]=e[t]-n})),this.last_=t,e},t}(),Oe=function(){function t(t,e){this.server_=e,this.statsToReport_={},this.statsListener_=new Ae(t);var n=1e4+2e4*Math.random();U(this.reportStats_.bind(this),Math.floor(n))}return t.prototype.includeStat=function(t){this.statsToReport_[t]=!0},t.prototype.reportStats_=function(){var t=this,e=this.statsListener_.get(),n={},r=!1;M(e,(function(e,i){i>0&&Object(a.j)(t.statsToReport_,e)&&(n[e]=i,r=!0)})),r&&this.server_.reportStats(n),U(this.reportStats_.bind(this),Math.floor(2*Math.random()*3e5))},t}(),ke=function(){function t(){this.eventLists_=[],this.recursionDepth_=0}return t.prototype.queueEvents=function(t){for(var e=null,n=0;n<t.length;n++){var r=t[n],i=r.getPath();null===e||i.equals(e.getPath())||(this.eventLists_.push(e),e=null),null===e&&(e=new Re(i)),e.add(r)}e&&this.eventLists_.push(e)},t.prototype.raiseEventsAtPath=function(t,e){this.queueEvents(e),this.raiseQueuedEventsMatchingPredicate_((function(e){return e.equals(t)}))},t.prototype.raiseEventsForChangedPath=function(t,e){this.queueEvents(e),this.raiseQueuedEventsMatchingPredicate_((function(e){return e.contains(t)||t.contains(e)}))},t.prototype.raiseQueuedEventsMatchingPredicate_=function(t){this.recursionDepth_++;for(var e=!0,n=0;n<this.eventLists_.length;n++){var r=this.eventLists_[n];if(r)t(r.getPath())?(this.eventLists_[n].raise(),this.eventLists_[n]=null):e=!1}e&&(this.eventLists_=[]),this.recursionDepth_--},t}(),Re=function(){function t(t){this.path_=t,this.events_=[]}return t.prototype.add=function(t){this.events_.push(t)},t.prototype.raise=function(){for(var t=0;t<this.events_.length;t++){var e=this.events_[t];if(null!==e){this.events_[t]=null;var n=e.getEventRunner();v&&T("event: "+e.toString()),j(n)}}},t.prototype.getPath=function(){return this.path_},t}(),Pe=function(){function t(t){this.allowedEvents_=t,this.listeners_={},Object(a.f)(Array.isArray(t)&&t.length>0,"Requires a non-empty array")}return t.prototype.trigger=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];if(Array.isArray(this.listeners_[t]))for(var r=Object(o.f)(this.listeners_[t]),i=0;i<r.length;i++)r[i].callback.apply(r[i].context,e)},t.prototype.on=function(t,e,n){this.validateEventType_(t),this.listeners_[t]=this.listeners_[t]||[],this.listeners_[t].push({callback:e,context:n});var r=this.getInitialEvent(t);r&&e.apply(n,r)},t.prototype.off=function(t,e,n){this.validateEventType_(t);for(var r=this.listeners_[t]||[],i=0;i<r.length;i++)if(r[i].callback===e&&(!n||n===r[i].context))return void r.splice(i,1)},t.prototype.validateEventType_=function(t){Object(a.f)(this.allowedEvents_.find((function(e){return e===t})),"Unknown event: "+t)},t}(),Me=function(t){function e(){var e,n,r=t.call(this,["visible"])||this;return"undefined"!=typeof document&&void 0!==document.addEventListener&&(void 0!==document.hidden?(n="visibilitychange",e="hidden"):void 0!==document.mozHidden?(n="mozvisibilitychange",e="mozHidden"):void 0!==document.msHidden?(n="msvisibilitychange",e="msHidden"):void 0!==document.webkitHidden&&(n="webkitvisibilitychange",e="webkitHidden")),r.visible_=!0,n&&document.addEventListener(n,(function(){var t=!document[e];t!==r.visible_&&(r.visible_=t,r.trigger("visible",t))}),!1),r}return Object(o.c)(e,t),e.getInstance=function(){return new e},e.prototype.getInitialEvent=function(t){return Object(a.f)("visible"===t,"Unknown event type: "+t),[this.visible_]},e}(Pe),Le=function(t){function e(){var e=t.call(this,["online"])||this;return e.online_=!0,"undefined"==typeof window||void 0===window.addEventListener||Object(a.u)()||(window.addEventListener("online",(function(){e.online_||(e.online_=!0,e.trigger("online",!0))}),!1),window.addEventListener("offline",(function(){e.online_&&(e.online_=!1,e.trigger("online",!1))}),!1)),e}return Object(o.c)(e,t),e.getInstance=function(){return new e},e.prototype.getInitialEvent=function(t){return Object(a.f)("online"===t,"Unknown event type: "+t),[this.online_]},e.prototype.currentlyOnline=function(){return this.online_},e}(Pe),xe=function(){function t(t){this.onMessage_=t,this.pendingResponses=[],this.currentResponseNum=0,this.closeAfterResponse=-1,this.onClose=null}return t.prototype.closeAfter=function(t,e){this.closeAfterResponse=t,this.onClose=e,this.closeAfterResponse<this.currentResponseNum&&(this.onClose(),this.onClose=null)},t.prototype.handleResponse=function(t,e){var n=this;this.pendingResponses[t]=e;for(var r=function(){var t=i.pendingResponses[i.currentResponseNum];delete i.pendingResponses[i.currentResponseNum];for(var e=function(e){t[e]&&j((function(){n.onMessage_(t[e])}))},r=0;r<t.length;++r)e(r);if(i.currentResponseNum===i.closeAfterResponse)return i.onClose&&(i.onClose(),i.onClose=null),"break";i.currentResponseNum++},i=this;this.pendingResponses[this.currentResponseNum];){if("break"===r())break}},t}(),Fe=function(){function t(t,e,n,r){this.connId=t,this.repoInfo=e,this.transportSessionId=n,this.lastSessionId=r,this.bytesSent=0,this.bytesReceived=0,this.everConnected_=!1,this.log_=_(t),this.stats_=De.getCollection(e),this.urlFn=function(t){return e.connectionURL("long_polling",t)}}return t.prototype.open=function(t,e){var n=this;this.curSegmentNum=0,this.onDisconnect_=e,this.myPacketOrderer=new xe(t),this.isClosed_=!1,this.connectTimeoutTimer_=setTimeout((function(){n.log_("Timed out trying to connect."),n.onClosed_(),n.connectTimeoutTimer_=null}),Math.floor(3e4)),function(t){if(Object(a.w)()||"complete"===document.readyState)t();else{var e=!1,n=function(){document.body?e||(e=!0,t()):setTimeout(n,Math.floor(10))};document.addEventListener?(document.addEventListener("DOMContentLoaded",n,!1),window.addEventListener("load",n,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",(function(){"complete"===document.readyState&&n()})),window.attachEvent("onload",n))}}((function(){if(!n.isClosed_){n.scriptTagHolder=new je((function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var r=Object(o.e)(t,5),i=r[0],a=r[1],s=r[2];r[3],r[4];if(n.incrementIncomingBytes_(t),n.scriptTagHolder)if(n.connectTimeoutTimer_&&(clearTimeout(n.connectTimeoutTimer_),n.connectTimeoutTimer_=null),n.everConnected_=!0,"start"===i)n.id=a,n.password=s;else{if("close"!==i)throw new Error("Unrecognized command received: "+i);a?(n.scriptTagHolder.sendNewPolls=!1,n.myPacketOrderer.closeAfter(a,(function(){n.onClosed_()}))):n.onClosed_()}}),(function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var r=Object(o.e)(t,2),i=r[0],a=r[1];n.incrementIncomingBytes_(t),n.myPacketOrderer.handleResponse(i,a)}),(function(){n.onClosed_()}),n.urlFn);var t={start:"t"};t.ser=Math.floor(1e8*Math.random()),n.scriptTagHolder.uniqueCallbackIdentifier&&(t.cb=n.scriptTagHolder.uniqueCallbackIdentifier),t.v="5",n.transportSessionId&&(t.s=n.transportSessionId),n.lastSessionId&&(t.ls=n.lastSessionId),"undefined"!=typeof location&&location.href&&-1!==location.href.indexOf("firebaseio.com")&&(t.r="f");var e=n.urlFn(t);n.log_("Connecting via long-poll to "+e),n.scriptTagHolder.addTag(e,(function(){}))}}))},t.prototype.start=function(){this.scriptTagHolder.startLongPoll(this.id,this.password),this.addDisconnectPingFrame(this.id,this.password)},t.forceAllow=function(){t.forceAllow_=!0},t.forceDisallow=function(){t.forceDisallow_=!0},t.isAvailable=function(){return!Object(a.w)()&&(!!t.forceAllow_||!(t.forceDisallow_||"undefined"==typeof document||null==document.createElement||"object"==typeof window&&window.chrome&&window.chrome.extension&&!/^chrome/.test(window.location.href)||"object"==typeof Windows&&"object"==typeof Windows.UI))},t.prototype.markConnectionHealthy=function(){},t.prototype.shutdown_=function(){this.isClosed_=!0,this.scriptTagHolder&&(this.scriptTagHolder.close(),this.scriptTagHolder=null),this.myDisconnFrame&&(document.body.removeChild(this.myDisconnFrame),this.myDisconnFrame=null),this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null)},t.prototype.onClosed_=function(){this.isClosed_||(this.log_("Longpoll is closing itself"),this.shutdown_(),this.onDisconnect_&&(this.onDisconnect_(this.everConnected_),this.onDisconnect_=null))},t.prototype.close=function(){this.isClosed_||(this.log_("Longpoll is being closed."),this.shutdown_())},t.prototype.send=function(t){var e=Object(a.G)(t);this.bytesSent+=e.length,this.stats_.incrementCounter("bytes_sent",e.length);for(var n=Object(a.i)(e),r=P(n,1840),i=0;i<r.length;i++)this.scriptTagHolder.enqueueSegment(this.curSegmentNum,r.length,r[i]),this.curSegmentNum++},t.prototype.addDisconnectPingFrame=function(t,e){if(!Object(a.w)()){this.myDisconnFrame=document.createElement("iframe");var n={dframe:"t"};n.id=t,n.pw=e,this.myDisconnFrame.src=this.urlFn(n),this.myDisconnFrame.style.display="none",document.body.appendChild(this.myDisconnFrame)}},t.prototype.incrementIncomingBytes_=function(t){var e=Object(a.G)(t).length;this.bytesReceived+=e,this.stats_.incrementCounter("bytes_received",e)},t}(),je=function(){function t(e,n,r,i){if(this.onDisconnect=r,this.urlFn=i,this.outstandingRequests=new Set,this.pendingSegs=[],this.currentSerial=Math.floor(1e8*Math.random()),this.sendNewPolls=!0,Object(a.w)())this.commandCB=e,this.onMessageCB=n;else{this.uniqueCallbackIdentifier=m(),window["pLPCommand"+this.uniqueCallbackIdentifier]=e,window["pRTLPCB"+this.uniqueCallbackIdentifier]=n,this.myIFrame=t.createIFrame_();var o="";if(this.myIFrame.src&&"javascript:"===this.myIFrame.src.substr(0,"javascript:".length))o='<script>document.domain="'+document.domain+'";<\/script>';var s="<html><body>"+o+"</body></html>";try{this.myIFrame.doc.open(),this.myIFrame.doc.write(s),this.myIFrame.doc.close()}catch(t){T("frame writing exception"),t.stack&&T(t.stack),T(t)}}}return t.createIFrame_=function(){var t=document.createElement("iframe");if(t.style.display="none",!document.body)throw"Document body has not initialized. Wait to initialize Firebase until after the document is ready.";document.body.appendChild(t);try{t.contentWindow.document||T("No IE domain setting required")}catch(n){var e=document.domain;t.src="javascript:void((function(){document.open();document.domain='"+e+"';document.close();})())"}return t.contentDocument?t.doc=t.contentDocument:t.contentWindow?t.doc=t.contentWindow.document:t.document&&(t.doc=t.document),t},t.prototype.close=function(){var t=this;this.alive=!1,this.myIFrame&&(this.myIFrame.doc.body.innerHTML="",setTimeout((function(){null!==t.myIFrame&&(document.body.removeChild(t.myIFrame),t.myIFrame=null)}),Math.floor(0)));var e=this.onDisconnect;e&&(this.onDisconnect=null,e())},t.prototype.startLongPoll=function(t,e){for(this.myID=t,this.myPW=e,this.alive=!0;this.newRequest_(););},t.prototype.newRequest_=function(){if(this.alive&&this.sendNewPolls&&this.outstandingRequests.size<(this.pendingSegs.length>0?2:1)){this.currentSerial++;var t={};t.id=this.myID,t.pw=this.myPW,t.ser=this.currentSerial;for(var e=this.urlFn(t),n="",r=0;this.pendingSegs.length>0;){if(!(this.pendingSegs[0].d.length+30+n.length<=1870))break;var i=this.pendingSegs.shift();n=n+"&seg"+r+"="+i.seg+"&ts"+r+"="+i.ts+"&d"+r+"="+i.d,r++}return e+=n,this.addLongPollTag_(e,this.currentSerial),!0}return!1},t.prototype.enqueueSegment=function(t,e,n){this.pendingSegs.push({seg:t,ts:e,d:n}),this.alive&&this.newRequest_()},t.prototype.addLongPollTag_=function(t,e){var n=this;this.outstandingRequests.add(e);var r=function(){n.outstandingRequests.delete(e),n.newRequest_()},i=setTimeout(r,Math.floor(25e3));this.addTag(t,(function(){clearTimeout(i),r()}))},t.prototype.addTag=function(t,e){var n=this;Object(a.w)()?this.doNodeLongPoll(t,e):setTimeout((function(){try{if(!n.sendNewPolls)return;var r=n.myIFrame.doc.createElement("script");r.type="text/javascript",r.async=!0,r.src=t,r.onload=r.onreadystatechange=function(){var t=r.readyState;t&&"loaded"!==t&&"complete"!==t||(r.onload=r.onreadystatechange=null,r.parentNode&&r.parentNode.removeChild(r),e())},r.onerror=function(){T("Long-poll script failed to load: "+t),n.sendNewPolls=!1,n.close()},n.myIFrame.doc.body.appendChild(r)}catch(t){}}),Math.floor(1))},t}(),Ue="";
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var qe=null;"undefined"!=typeof MozWebSocket?qe=MozWebSocket:"undefined"!=typeof WebSocket&&(qe=WebSocket);var Ve=function(){function e(t,n,r,i){this.connId=t,this.keepaliveTimer=null,this.frames=null,this.totalFrames=0,this.bytesSent=0,this.bytesReceived=0,this.log_=_(this.connId),this.stats_=De.getCollection(n),this.connURL=e.connectionURL_(n,r,i)}return e.connectionURL_=function(t,e,n){var r={v:"5"};return!Object(a.w)()&&"undefined"!=typeof location&&location.href&&-1!==location.href.indexOf("firebaseio.com")&&(r.r="f"),e&&(r.s=e),n&&(r.ls=n),t.connectionURL("websocket",r)},e.prototype.open=function(e,n){var r=this;this.onDisconnect=n,this.onMessage=e,this.log_("Websocket connecting to "+this.connURL),this.everConnected_=!1,f.set("previous_websocket_failure",!0);try{if(Object(a.w)()){var i=a.a.NODE_ADMIN?"AdminNode":"Node",o={headers:{"User-Agent":"Firebase/5/"+Ue+"/"+t.platform+"/"+i}},s=t.env,u=0===this.connURL.indexOf("wss://")?s.HTTPS_PROXY||s.https_proxy:s.HTTP_PROXY||s.http_proxy;u&&(o.proxy={origin:u}),this.mySock=new qe(this.connURL,[],o)}else this.mySock=new qe(this.connURL)}catch(t){this.log_("Error instantiating WebSocket.");var c=t.message||t.data;return c&&this.log_(c),void this.onClosed_()}this.mySock.onopen=function(){r.log_("Websocket connected."),r.everConnected_=!0},this.mySock.onclose=function(){r.log_("Websocket connection was disconnected."),r.mySock=null,r.onClosed_()},this.mySock.onmessage=function(t){r.handleIncomingFrame(t)},this.mySock.onerror=function(t){r.log_("WebSocket error.  Closing connection.");var e=t.message||t.data;e&&r.log_(e),r.onClosed_()}},e.prototype.start=function(){},e.forceDisallow=function(){e.forceDisallow_=!0},e.isAvailable=function(){var t=!1;if("undefined"!=typeof navigator&&navigator.userAgent){var n=navigator.userAgent.match(/Android ([0-9]{0,}\.[0-9]{0,})/);n&&n.length>1&&parseFloat(n[1])<4.4&&(t=!0)}return!t&&null!==qe&&!e.forceDisallow_},e.previouslyFailed=function(){return f.isInMemoryStorage||!0===f.get("previous_websocket_failure")},e.prototype.markConnectionHealthy=function(){f.remove("previous_websocket_failure")},e.prototype.appendFrame_=function(t){if(this.frames.push(t),this.frames.length===this.totalFrames){var e=this.frames.join("");this.frames=null;var n=Object(a.A)(e);this.onMessage(n)}},e.prototype.handleNewFrameCount_=function(t){this.totalFrames=t,this.frames=[]},e.prototype.extractFrameCount_=function(t){if(Object(a.f)(null===this.frames,"We already have a frame buffer"),t.length<=6){var e=Number(t);if(!isNaN(e))return this.handleNewFrameCount_(e),null}return this.handleNewFrameCount_(1),t},e.prototype.handleIncomingFrame=function(t){if(null!==this.mySock){var e=t.data;if(this.bytesReceived+=e.length,this.stats_.incrementCounter("bytes_received",e.length),this.resetKeepAlive(),null!==this.frames)this.appendFrame_(e);else{var n=this.extractFrameCount_(e);null!==n&&this.appendFrame_(n)}}},e.prototype.send=function(t){this.resetKeepAlive();var e=Object(a.G)(t);this.bytesSent+=e.length,this.stats_.incrementCounter("bytes_sent",e.length);var n=P(e,16384);n.length>1&&this.sendString_(String(n.length));for(var r=0;r<n.length;r++)this.sendString_(n[r])},e.prototype.shutdown_=function(){this.isClosed_=!0,this.keepaliveTimer&&(clearInterval(this.keepaliveTimer),this.keepaliveTimer=null),this.mySock&&(this.mySock.close(),this.mySock=null)},e.prototype.onClosed_=function(){this.isClosed_||(this.log_("WebSocket is closing itself"),this.shutdown_(),this.onDisconnect&&(this.onDisconnect(this.everConnected_),this.onDisconnect=null))},e.prototype.close=function(){this.isClosed_||(this.log_("WebSocket is being closed"),this.shutdown_())},e.prototype.resetKeepAlive=function(){var t=this;clearInterval(this.keepaliveTimer),this.keepaliveTimer=setInterval((function(){t.mySock&&t.sendString_("0"),t.resetKeepAlive()}),Math.floor(45e3))},e.prototype.sendString_=function(t){try{this.mySock.send(t)}catch(t){this.log_("Exception thrown from WebSocket.send():",t.message||t.data,"Closing connection."),setTimeout(this.onClosed_.bind(this),0)}},e.responsesRequiredToBeHealthy=2,e.healthyTimeout=3e4,e}(),Be=function(){function t(t){this.initTransports_(t)}return Object.defineProperty(t,"ALL_TRANSPORTS",{get:function(){return[Fe,Ve]},enumerable:!0,configurable:!0}),t.prototype.initTransports_=function(e){var n,r,i=Ve&&Ve.isAvailable(),a=i&&!Ve.previouslyFailed();if(e.webSocketOnly&&(i||I("wss:// URL used, but browser isn't known to support websockets.  Trying anyway."),a=!0),a)this.transports_=[Ve];else{var s=this.transports_=[];try{for(var u=Object(o.h)(t.ALL_TRANSPORTS),c=u.next();!c.done;c=u.next()){var h=c.value;h&&h.isAvailable()&&s.push(h)}}catch(t){n={error:t}}finally{try{c&&!c.done&&(r=u.return)&&r.call(u)}finally{if(n)throw n.error}}}},t.prototype.initialTransport=function(){if(this.transports_.length>0)return this.transports_[0];throw new Error("No transports available")},t.prototype.upgradeTransport=function(){return this.transports_.length>1?this.transports_[1]:null},t}(),We=function(){function t(t,e,n,r,i,o,a){this.id=t,this.repoInfo_=e,this.onMessage_=n,this.onReady_=r,this.onDisconnect_=i,this.onKill_=o,this.lastSessionId=a,this.connectionCount=0,this.pendingDataMessages=[],this.state_=0,this.log_=_("c:"+this.id+":"),this.transportManager_=new Be(e),this.log_("Connection created"),this.start_()}return t.prototype.start_=function(){var t=this,e=this.transportManager_.initialTransport();this.conn_=new e(this.nextTransportId_(),this.repoInfo_,void 0,this.lastSessionId),this.primaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;var n=this.connReceiver_(this.conn_),r=this.disconnReceiver_(this.conn_);this.tx_=this.conn_,this.rx_=this.conn_,this.secondaryConn_=null,this.isHealthy_=!1,setTimeout((function(){t.conn_&&t.conn_.open(n,r)}),Math.floor(0));var i=e.healthyTimeout||0;i>0&&(this.healthyTimeout_=U((function(){t.healthyTimeout_=null,t.isHealthy_||(t.conn_&&t.conn_.bytesReceived>102400?(t.log_("Connection exceeded healthy timeout but has received "+t.conn_.bytesReceived+" bytes.  Marking connection healthy."),t.isHealthy_=!0,t.conn_.markConnectionHealthy()):t.conn_&&t.conn_.bytesSent>10240?t.log_("Connection exceeded healthy timeout but has sent "+t.conn_.bytesSent+" bytes.  Leaving connection alive."):(t.log_("Closing unhealthy connection after timeout."),t.close()))}),Math.floor(i)))},t.prototype.nextTransportId_=function(){return"c:"+this.id+":"+this.connectionCount++},t.prototype.disconnReceiver_=function(t){var e=this;return function(n){t===e.conn_?e.onConnectionLost_(n):t===e.secondaryConn_?(e.log_("Secondary connection lost."),e.onSecondaryConnectionLost_()):e.log_("closing an old connection")}},t.prototype.connReceiver_=function(t){var e=this;return function(n){2!==e.state_&&(t===e.rx_?e.onPrimaryMessageReceived_(n):t===e.secondaryConn_?e.onSecondaryMessageReceived_(n):e.log_("message on old connection"))}},t.prototype.sendRequest=function(t){var e={t:"d",d:t};this.sendData_(e)},t.prototype.tryCleanupConnection=function(){this.tx_===this.secondaryConn_&&this.rx_===this.secondaryConn_&&(this.log_("cleaning up and promoting a connection: "+this.secondaryConn_.connId),this.conn_=this.secondaryConn_,this.secondaryConn_=null)},t.prototype.onSecondaryControl_=function(t){if("t"in t){var e=t.t;"a"===e?this.upgradeIfSecondaryHealthy_():"r"===e?(this.log_("Got a reset on secondary, closing it"),this.secondaryConn_.close(),this.tx_!==this.secondaryConn_&&this.rx_!==this.secondaryConn_||this.close()):"o"===e&&(this.log_("got pong on secondary."),this.secondaryResponsesRequired_--,this.upgradeIfSecondaryHealthy_())}},t.prototype.onSecondaryMessageReceived_=function(t){var e=k("t",t),n=k("d",t);if("c"===e)this.onSecondaryControl_(n);else{if("d"!==e)throw new Error("Unknown protocol layer: "+e);this.pendingDataMessages.push(n)}},t.prototype.upgradeIfSecondaryHealthy_=function(){this.secondaryResponsesRequired_<=0?(this.log_("Secondary connection is healthy."),this.isHealthy_=!0,this.secondaryConn_.markConnectionHealthy(),this.proceedWithUpgrade_()):(this.log_("sending ping on secondary."),this.secondaryConn_.send({t:"c",d:{t:"p",d:{}}}))},t.prototype.proceedWithUpgrade_=function(){this.secondaryConn_.start(),this.log_("sending client ack on secondary"),this.secondaryConn_.send({t:"c",d:{t:"a",d:{}}}),this.log_("Ending transmission on primary"),this.conn_.send({t:"c",d:{t:"n",d:{}}}),this.tx_=this.secondaryConn_,this.tryCleanupConnection()},t.prototype.onPrimaryMessageReceived_=function(t){var e=k("t",t),n=k("d",t);"c"===e?this.onControl_(n):"d"===e&&this.onDataMessage_(n)},t.prototype.onDataMessage_=function(t){this.onPrimaryResponse_(),this.onMessage_(t)},t.prototype.onPrimaryResponse_=function(){this.isHealthy_||(this.primaryResponsesRequired_--,this.primaryResponsesRequired_<=0&&(this.log_("Primary connection is healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()))},t.prototype.onControl_=function(t){var e=k("t",t);if("d"in t){var n=t.d;if("h"===e)this.onHandshake_(n);else if("n"===e){this.log_("recvd end transmission on primary"),this.rx_=this.secondaryConn_;for(var r=0;r<this.pendingDataMessages.length;++r)this.onDataMessage_(this.pendingDataMessages[r]);this.pendingDataMessages=[],this.tryCleanupConnection()}else"s"===e?this.onConnectionShutdown_(n):"r"===e?this.onReset_(n):"e"===e?E("Server Error: "+n):"o"===e?(this.log_("got pong on primary."),this.onPrimaryResponse_(),this.sendPingOnPrimaryIfNecessary_()):E("Unknown control packet command: "+e)}},t.prototype.onHandshake_=function(t){var e=t.ts,n=t.v,r=t.h;this.sessionId=t.s,this.repoInfo_.updateHost(r),0===this.state_&&(this.conn_.start(),this.onConnectionEstablished_(this.conn_,e),"5"!==n&&I("Protocol version mismatch detected"),this.tryStartUpgrade_())},t.prototype.tryStartUpgrade_=function(){var t=this.transportManager_.upgradeTransport();t&&this.startUpgrade_(t)},t.prototype.startUpgrade_=function(t){var e=this;this.secondaryConn_=new t(this.nextTransportId_(),this.repoInfo_,this.sessionId),this.secondaryResponsesRequired_=t.responsesRequiredToBeHealthy||0;var n=this.connReceiver_(this.secondaryConn_),r=this.disconnReceiver_(this.secondaryConn_);this.secondaryConn_.open(n,r),U((function(){e.secondaryConn_&&(e.log_("Timed out trying to upgrade."),e.secondaryConn_.close())}),Math.floor(6e4))},t.prototype.onReset_=function(t){this.log_("Reset packet received.  New host: "+t),this.repoInfo_.updateHost(t),1===this.state_?this.close():(this.closeConnections_(),this.start_())},t.prototype.onConnectionEstablished_=function(t,e){var n=this;this.log_("Realtime connection established."),this.conn_=t,this.state_=1,this.onReady_&&(this.onReady_(e,this.sessionId),this.onReady_=null),0===this.primaryResponsesRequired_?(this.log_("Primary connection is healthy."),this.isHealthy_=!0):U((function(){n.sendPingOnPrimaryIfNecessary_()}),Math.floor(5e3))},t.prototype.sendPingOnPrimaryIfNecessary_=function(){this.isHealthy_||1!==this.state_||(this.log_("sending ping on primary."),this.sendData_({t:"c",d:{t:"p",d:{}}}))},t.prototype.onSecondaryConnectionLost_=function(){var t=this.secondaryConn_;this.secondaryConn_=null,this.tx_!==t&&this.rx_!==t||this.close()},t.prototype.onConnectionLost_=function(t){this.conn_=null,t||0!==this.state_?1===this.state_&&this.log_("Realtime connection lost."):(this.log_("Realtime connection failed."),this.repoInfo_.isCacheableHost()&&(f.remove("host:"+this.repoInfo_.host),this.repoInfo_.internalHost=this.repoInfo_.host)),this.close()},t.prototype.onConnectionShutdown_=function(t){this.log_("Connection shutdown command received. Shutting down..."),this.onKill_&&(this.onKill_(t),this.onKill_=null),this.onDisconnect_=null,this.close()},t.prototype.sendData_=function(t){if(1!==this.state_)throw"Connection is not connected";this.tx_.send(t)},t.prototype.close=function(){2!==this.state_&&(this.log_("Closing realtime connection."),this.state_=2,this.closeConnections_(),this.onDisconnect_&&(this.onDisconnect_(),this.onDisconnect_=null))},t.prototype.closeConnections_=function(){this.log_("Shutting down all connections"),this.conn_&&(this.conn_.close(),this.conn_=null),this.secondaryConn_&&(this.secondaryConn_.close(),this.secondaryConn_=null),this.healthyTimeout_&&(clearTimeout(this.healthyTimeout_),this.healthyTimeout_=null)},t}(),Ke=function(){function t(){}return t.prototype.put=function(t,e,n,r){},t.prototype.merge=function(t,e,n,r){},t.prototype.refreshAuthToken=function(t){},t.prototype.onDisconnectPut=function(t,e,n){},t.prototype.onDisconnectMerge=function(t,e,n){},t.prototype.onDisconnectCancel=function(t,e){},t.prototype.reportStats=function(t){},t}(),Qe=function(t){function e(n,r,i,o,s,u){var c=t.call(this)||this;if(c.repoInfo_=n,c.onDataUpdate_=r,c.onConnectStatus_=i,c.onServerInfoUpdate_=o,c.authTokenProvider_=s,c.authOverride_=u,c.id=e.nextPersistentConnectionId_++,c.log_=_("p:"+c.id+":"),c.interruptReasons_={},c.listens=new Map,c.outstandingPuts_=[],c.outstandingPutCount_=0,c.onDisconnectRequestQueue_=[],c.connected_=!1,c.reconnectDelay_=1e3,c.maxReconnectDelay_=3e5,c.securityDebugCallback_=null,c.lastSessionId=null,c.establishConnectionTimer_=null,c.visible_=!1,c.requestCBHash_={},c.requestNumber_=0,c.realtime_=null,c.authToken_=null,c.forceTokenRefresh_=!1,c.invalidAuthTokenCount_=0,c.firstConnection_=!0,c.lastConnectionAttemptTime_=null,c.lastConnectionEstablishedTime_=null,u&&!Object(a.w)())throw new Error("Auth override specified in options, but not supported on non Node.js platforms");return c.scheduleConnect_(0),Me.getInstance().on("visible",c.onVisible_,c),-1===n.host.indexOf("fblocal")&&Le.getInstance().on("online",c.onOnline_,c),c}return Object(o.c)(e,t),e.prototype.sendRequest=function(t,e,n){var r=++this.requestNumber_,i={r:r,a:t,b:e};this.log_(Object(a.G)(i)),Object(a.f)(this.connected_,"sendRequest call when we're not connected not allowed."),this.realtime_.sendRequest(i),n&&(this.requestCBHash_[r]=n)},e.prototype.listen=function(t,e,n,r){var i=t.queryIdentifier(),o=t.path.toString();this.log_("Listen called for "+o+" "+i),this.listens.has(o)||this.listens.set(o,new Map),Object(a.f)(t.getQueryParams().isDefault()||!t.getQueryParams().loadsAllData(),"listen() called for non-default but complete query"),Object(a.f)(!this.listens.get(o).has(i),"listen() called twice for same path/queryId.");var s={onComplete:r,hashFn:e,query:t,tag:n};this.listens.get(o).set(i,s),this.connected_&&this.sendListen_(s)},e.prototype.sendListen_=function(t){var n=this,r=t.query,i=r.path.toString(),o=r.queryIdentifier();this.log_("Listen on "+i+" for "+o);var a={p:i};t.tag&&(a.q=r.queryObject(),a.t=t.tag),a.h=t.hashFn(),this.sendRequest("q",a,(function(a){var s=a.d,u=a.s;e.warnOnListenWarnings_(s,r),(n.listens.get(i)&&n.listens.get(i).get(o))===t&&(n.log_("listen response",a),"ok"!==u&&n.removeListen_(i,o),t.onComplete&&t.onComplete(u,s))}))},e.warnOnListenWarnings_=function(t,e){if(t&&"object"==typeof t&&Object(a.j)(t,"w")){var n=Object(a.D)(t,"w");if(Array.isArray(n)&&~n.indexOf("no_index")){var r='".indexOn": "'+e.getQueryParams().getIndex().toString()+'"',i=e.path.toString();I("Using an unspecified index. Your data will be downloaded and filtered on the client. Consider adding "+r+" at "+i+" to your security rules for better performance.")}}},e.prototype.refreshAuthToken=function(t){this.authToken_=t,this.log_("Auth token refreshed"),this.authToken_?this.tryAuth():this.connected_&&this.sendRequest("unauth",{},(function(){})),this.reduceReconnectDelayIfAdminCredential_(t)},e.prototype.reduceReconnectDelayIfAdminCredential_=function(t){(t&&40===t.length||Object(a.p)(t))&&(this.log_("Admin auth credential detected.  Reducing max reconnect time."),this.maxReconnectDelay_=3e4)},e.prototype.tryAuth=function(){var t=this;if(this.connected_&&this.authToken_){var e=this.authToken_,n=Object(a.z)(e)?"auth":"gauth",r={cred:e};null===this.authOverride_?r.noauth=!0:"object"==typeof this.authOverride_&&(r.authvar=this.authOverride_),this.sendRequest(n,r,(function(n){var r=n.s,i=n.d||"error";t.authToken_===e&&("ok"===r?t.invalidAuthTokenCount_=0:t.onAuthRevoked_(r,i))}))}},e.prototype.unlisten=function(t,e){var n=t.path.toString(),r=t.queryIdentifier();this.log_("Unlisten called for "+n+" "+r),Object(a.f)(t.getQueryParams().isDefault()||!t.getQueryParams().loadsAllData(),"unlisten() called for non-default but complete query"),this.removeListen_(n,r)&&this.connected_&&this.sendUnlisten_(n,r,t.queryObject(),e)},e.prototype.sendUnlisten_=function(t,e,n,r){this.log_("Unlisten on "+t+" for "+e);var i={p:t};r&&(i.q=n,i.t=r),this.sendRequest("n",i)},e.prototype.onDisconnectPut=function(t,e,n){this.connected_?this.sendOnDisconnect_("o",t,e,n):this.onDisconnectRequestQueue_.push({pathString:t,action:"o",data:e,onComplete:n})},e.prototype.onDisconnectMerge=function(t,e,n){this.connected_?this.sendOnDisconnect_("om",t,e,n):this.onDisconnectRequestQueue_.push({pathString:t,action:"om",data:e,onComplete:n})},e.prototype.onDisconnectCancel=function(t,e){this.connected_?this.sendOnDisconnect_("oc",t,null,e):this.onDisconnectRequestQueue_.push({pathString:t,action:"oc",data:null,onComplete:e})},e.prototype.sendOnDisconnect_=function(t,e,n,r){var i={p:e,d:n};this.log_("onDisconnect "+t,i),this.sendRequest(t,i,(function(t){r&&setTimeout((function(){r(t.s,t.d)}),Math.floor(0))}))},e.prototype.put=function(t,e,n,r){this.putInternal("p",t,e,n,r)},e.prototype.merge=function(t,e,n,r){this.putInternal("m",t,e,n,r)},e.prototype.putInternal=function(t,e,n,r,i){var o={p:e,d:n};void 0!==i&&(o.h=i),this.outstandingPuts_.push({action:t,request:o,onComplete:r}),this.outstandingPutCount_++;var a=this.outstandingPuts_.length-1;this.connected_?this.sendPut_(a):this.log_("Buffering put: "+e)},e.prototype.sendPut_=function(t){var e=this,n=this.outstandingPuts_[t].action,r=this.outstandingPuts_[t].request,i=this.outstandingPuts_[t].onComplete;this.outstandingPuts_[t].queued=this.connected_,this.sendRequest(n,r,(function(r){e.log_(n+" response",r),delete e.outstandingPuts_[t],e.outstandingPutCount_--,0===e.outstandingPutCount_&&(e.outstandingPuts_=[]),i&&i(r.s,r.d)}))},e.prototype.reportStats=function(t){var e=this;if(this.connected_){var n={c:t};this.log_("reportStats",n),this.sendRequest("s",n,(function(t){if("ok"!==t.s){var n=t.d;e.log_("reportStats","Error sending stats: "+n)}}))}},e.prototype.onDataMessage_=function(t){if("r"in t){this.log_("from server: "+Object(a.G)(t));var e=t.r,n=this.requestCBHash_[e];n&&(delete this.requestCBHash_[e],n(t.b))}else{if("error"in t)throw"A server-side error has occurred: "+t.error;"a"in t&&this.onDataPush_(t.a,t.b)}},e.prototype.onDataPush_=function(t,e){this.log_("handleServerMessage",t,e),"d"===t?this.onDataUpdate_(e.p,e.d,!1,e.t):"m"===t?this.onDataUpdate_(e.p,e.d,!0,e.t):"c"===t?this.onListenRevoked_(e.p,e.q):"ac"===t?this.onAuthRevoked_(e.s,e.d):"sd"===t?this.onSecurityDebugPacket_(e):E("Unrecognized action received from server: "+Object(a.G)(t)+"\nAre you using the latest client?")},e.prototype.onReady_=function(t,e){this.log_("connection ready"),this.connected_=!0,this.lastConnectionEstablishedTime_=(new Date).getTime(),this.handleTimestamp_(t),this.lastSessionId=e,this.firstConnection_&&this.sendConnectStats_(),this.restoreState_(),this.firstConnection_=!1,this.onConnectStatus_(!0)},e.prototype.scheduleConnect_=function(t){var e=this;Object(a.f)(!this.realtime_,"Scheduling a connect when we're already connected/ing?"),this.establishConnectionTimer_&&clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=setTimeout((function(){e.establishConnectionTimer_=null,e.establishConnection_()}),Math.floor(t))},e.prototype.onVisible_=function(t){t&&!this.visible_&&this.reconnectDelay_===this.maxReconnectDelay_&&(this.log_("Window became visible.  Reducing delay."),this.reconnectDelay_=1e3,this.realtime_||this.scheduleConnect_(0)),this.visible_=t},e.prototype.onOnline_=function(t){t?(this.log_("Browser went online."),this.reconnectDelay_=1e3,this.realtime_||this.scheduleConnect_(0)):(this.log_("Browser went offline.  Killing connection."),this.realtime_&&this.realtime_.close())},e.prototype.onRealtimeDisconnect_=function(){if(this.log_("data client disconnected"),this.connected_=!1,this.realtime_=null,this.cancelSentTransactions_(),this.requestCBHash_={},this.shouldReconnect_()){if(this.visible_){if(this.lastConnectionEstablishedTime_){(new Date).getTime()-this.lastConnectionEstablishedTime_>3e4&&(this.reconnectDelay_=1e3),this.lastConnectionEstablishedTime_=null}}else this.log_("Window isn't visible.  Delaying reconnect."),this.reconnectDelay_=this.maxReconnectDelay_,this.lastConnectionAttemptTime_=(new Date).getTime();var t=(new Date).getTime()-this.lastConnectionAttemptTime_,e=Math.max(0,this.reconnectDelay_-t);e=Math.random()*e,this.log_("Trying to reconnect in "+e+"ms"),this.scheduleConnect_(e),this.reconnectDelay_=Math.min(this.maxReconnectDelay_,1.3*this.reconnectDelay_)}this.onConnectStatus_(!1)},e.prototype.establishConnection_=function(){if(this.shouldReconnect_()){this.log_("Making a connection attempt"),this.lastConnectionAttemptTime_=(new Date).getTime(),this.lastConnectionEstablishedTime_=null;var t=this.onDataMessage_.bind(this),n=this.onReady_.bind(this),r=this.onRealtimeDisconnect_.bind(this),i=this.id+":"+e.nextConnectionId_++,o=this,s=this.lastSessionId,u=!1,c=null,h=function(){c?c.close():(u=!0,r())};this.realtime_={close:h,sendRequest:function(t){Object(a.f)(c,"sendRequest call when we're not connected not allowed."),c.sendRequest(t)}};var l=this.forceTokenRefresh_;this.forceTokenRefresh_=!1,this.authTokenProvider_.getToken(l).then((function(e){u?T("getToken() completed but was canceled"):(T("getToken() completed. Creating connection."),o.authToken_=e&&e.accessToken,c=new We(i,o.repoInfo_,t,n,r,(function(t){I(t+" ("+o.repoInfo_.toString()+")"),o.interrupt("server_kill")}),s))})).then(null,(function(t){o.log_("Failed to get token: "+t),u||(a.a.NODE_ADMIN&&I(t),h())}))}},e.prototype.interrupt=function(t){T("Interrupting connection for reason: "+t),this.interruptReasons_[t]=!0,this.realtime_?this.realtime_.close():(this.establishConnectionTimer_&&(clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=null),this.connected_&&this.onRealtimeDisconnect_())},e.prototype.resume=function(t){T("Resuming connection for reason: "+t),delete this.interruptReasons_[t],Object(a.s)(this.interruptReasons_)&&(this.reconnectDelay_=1e3,this.realtime_||this.scheduleConnect_(0))},e.prototype.handleTimestamp_=function(t){var e=t-(new Date).getTime();this.onServerInfoUpdate_({serverTimeOffset:e})},e.prototype.cancelSentTransactions_=function(){for(var t=0;t<this.outstandingPuts_.length;t++){var e=this.outstandingPuts_[t];e&&"h"in e.request&&e.queued&&(e.onComplete&&e.onComplete("disconnect"),delete this.outstandingPuts_[t],this.outstandingPutCount_--)}0===this.outstandingPutCount_&&(this.outstandingPuts_=[])},e.prototype.onListenRevoked_=function(t,e){var n;n=e?e.map((function(t){return R(t)})).join("$"):"default";var r=this.removeListen_(t,n);r&&r.onComplete&&r.onComplete("permission_denied")},e.prototype.removeListen_=function(t,e){var n,r=new q(t).toString();if(this.listens.has(r)){var i=this.listens.get(r);n=i.get(e),i.delete(e),0===i.size&&this.listens.delete(r)}else n=void 0;return n},e.prototype.onAuthRevoked_=function(t,e){T("Auth token revoked: "+t+"/"+e),this.authToken_=null,this.forceTokenRefresh_=!0,this.realtime_.close(),"invalid_token"!==t&&"permission_denied"!==t||(this.invalidAuthTokenCount_++,this.invalidAuthTokenCount_>=3&&(this.reconnectDelay_=3e4,this.authTokenProvider_.notifyForInvalidToken()))},e.prototype.onSecurityDebugPacket_=function(t){this.securityDebugCallback_?this.securityDebugCallback_(t):"msg"in t&&console.log("FIREBASE: "+t.msg.replace("\n","\nFIREBASE: "))},e.prototype.restoreState_=function(){var t,e,n,r;this.tryAuth();try{for(var i=Object(o.h)(this.listens.values()),a=i.next();!a.done;a=i.next()){var s=a.value;try{for(var u=(n=void 0,Object(o.h)(s.values())),c=u.next();!c.done;c=u.next()){var h=c.value;this.sendListen_(h)}}catch(t){n={error:t}}finally{try{c&&!c.done&&(r=u.return)&&r.call(u)}finally{if(n)throw n.error}}}}catch(e){t={error:e}}finally{try{a&&!a.done&&(e=i.return)&&e.call(i)}finally{if(t)throw t.error}}for(var l=0;l<this.outstandingPuts_.length;l++)this.outstandingPuts_[l]&&this.sendPut_(l);for(;this.onDisconnectRequestQueue_.length;){var f=this.onDisconnectRequestQueue_.shift();this.sendOnDisconnect_(f.action,f.pathString,f.data,f.onComplete)}},e.prototype.sendConnectStats_=function(){var t={},e="js";a.a.NODE_ADMIN?e="admin_node":a.a.NODE_CLIENT&&(e="node"),t["sdk."+e+"."+Ue.replace(/\./g,"-")]=1,Object(a.u)()?t["framework.cordova"]=1:Object(a.x)()&&(t["framework.reactnative"]=1),this.reportStats(t)},e.prototype.shouldReconnect_=function(){var t=Le.getInstance().currentlyOnline();return Object(a.s)(this.interruptReasons_)&&t},e.nextPersistentConnectionId_=0,e.nextConnectionId_=0,e}(Ke),Ge=function(t){function e(e,n,r){var i=t.call(this)||this;return i.repoInfo_=e,i.onDataUpdate_=n,i.authTokenProvider_=r,i.log_=_("p:rest:"),i.listens_={},i}return Object(o.c)(e,t),e.prototype.reportStats=function(t){throw new Error("Method not implemented.")},e.getListenId_=function(t,e){return void 0!==e?"tag$"+e:(Object(a.f)(t.getQueryParams().isDefault(),"should have a tag if it's not a default query."),t.path.toString())},e.prototype.listen=function(t,n,r,i){var o=this,s=t.path.toString();this.log_("Listen called for "+s+" "+t.queryIdentifier());var u=e.getListenId_(t,r),c={};this.listens_[u]=c;var h=t.getQueryParams().toRestQueryStringParameters();this.restRequest_(s+".json",h,(function(t,e){var n=e;(404===t&&(n=null,t=null),null===t&&o.onDataUpdate_(s,n,!1,r),Object(a.D)(o.listens_,u)===c)&&i(t?401===t?"permission_denied":"rest_error:"+t:"ok",null)}))},e.prototype.unlisten=function(t,n){var r=e.getListenId_(t,n);delete this.listens_[r]},e.prototype.refreshAuthToken=function(t){},e.prototype.restRequest_=function(t,e,n){var r=this;void 0===e&&(e={}),e.format="export",this.authTokenProvider_.getToken(!1).then((function(i){var o=i&&i.accessToken;o&&(e.auth=o);var s=(r.repoInfo_.secure?"https://":"http://")+r.repoInfo_.host+t+"?ns="+r.repoInfo_.namespace+Object(a.C)(e);r.log_("Sending REST request for "+s);var u=new XMLHttpRequest;u.onreadystatechange=function(){if(n&&4===u.readyState){r.log_("REST Response for "+s+" received. status:",u.status,"response:",u.responseText);var t=null;if(u.status>=200&&u.status<300){try{t=Object(a.A)(u.responseText)}catch(t){I("Failed to parse JSON response for "+s+": "+u.responseText)}n(null,t)}else 401!==u.status&&404!==u.status&&I("Got unsuccessful REST response for "+s+" Status: "+u.status),n(u.status);n=null}},u.open("GET",s,!0),u.send()}))},e}(Ke),He=function(){function t(t,e,n,r){var i=this;this.repoInfo_=t,this.app=n,this.dataUpdateCount=0,this.statsListener_=null,this.eventQueue_=new ke,this.nextWriteId_=1,this.interceptServerDataCallback_=null,this.onDisconnect_=new $t,this.persistentConnection_=null;var o=new Ce(n,r);if(this.stats_=De.getCollection(t),e||("object"==typeof window&&window.navigator&&window.navigator.userAgent||"").search(/googlebot|google webmaster tools|bingbot|yahoo! slurp|baiduspider|yandexbot|duckduckbot/i)>=0)this.server_=new Ge(this.repoInfo_,this.onDataUpdate_.bind(this),o),setTimeout(this.onConnectStatus_.bind(this,!0),0);else{var s=n.options.databaseAuthVariableOverride;if(null!=s){if("object"!=typeof s)throw new Error("Only objects are supported for option databaseAuthVariableOverride");try{Object(a.G)(s)}catch(t){throw new Error("Invalid authOverride provided: "+t)}}this.persistentConnection_=new Qe(this.repoInfo_,this.onDataUpdate_.bind(this),this.onConnectStatus_.bind(this),this.onServerInfoUpdate_.bind(this),o,s),this.server_=this.persistentConnection_}o.addTokenChangeListener((function(t){i.server_.refreshAuthToken(t)})),this.statsReporter_=De.getOrCreateReporter(t,(function(){return new Oe(i.stats_,i.server_)})),this.transactionsInit_(),this.infoData_=new Ie,this.infoSyncTree_=new Se({startListening:function(t,e,n,r){var o=[],a=i.infoData_.getNode(t.path);return a.isEmpty()||(o=i.infoSyncTree_.applyServerOverwrite(t.path,a),setTimeout((function(){r("ok")}),0)),o},stopListening:function(){}}),this.updateInfo_("connected",!1),this.serverSyncTree_=new Se({startListening:function(t,e,n,r){return i.server_.listen(t,n,e,(function(e,n){var o=r(e,n);i.eventQueue_.raiseEventsForChangedPath(t.path,o)})),[]},stopListening:function(t,e){i.server_.unlisten(t,e)}})}return t.prototype.toString=function(){return(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host},t.prototype.name=function(){return this.repoInfo_.namespace},t.prototype.serverTime=function(){var t=this.infoData_.getNode(new q(".info/serverTimeOffset")).val()||0;return(new Date).getTime()+t},t.prototype.generateServerValues=function(){return(t=(t={timestamp:this.serverTime()})||{}).timestamp=t.timestamp||(new Date).getTime(),t;var t},t.prototype.onDataUpdate_=function(t,e,n,r){this.dataUpdateCount++;var i=new q(t);e=this.interceptServerDataCallback_?this.interceptServerDataCallback_(t,e):e;var o=[];if(r)if(n){var s=Object(a.B)(e,(function(t){return Vt(t)}));o=this.serverSyncTree_.applyTaggedQueryMerge(i,s,r)}else{var u=Vt(e);o=this.serverSyncTree_.applyTaggedQueryOverwrite(i,u,r)}else if(n){var c=Object(a.B)(e,(function(t){return Vt(t)}));o=this.serverSyncTree_.applyServerMerge(i,c)}else{var h=Vt(e);o=this.serverSyncTree_.applyServerOverwrite(i,h)}var l=i;o.length>0&&(l=this.rerunTransactions_(i)),this.eventQueue_.raiseEventsForChangedPath(l,o)},t.prototype.interceptServerData_=function(t){this.interceptServerDataCallback_=t},t.prototype.onConnectStatus_=function(t){this.updateInfo_("connected",t),!1===t&&this.runOnDisconnectEvents_()},t.prototype.onServerInfoUpdate_=function(t){var e=this;M(t,(function(t,n){e.updateInfo_(t,n)}))},t.prototype.updateInfo_=function(t,e){var n=new q("/.info/"+t),r=Vt(e);this.infoData_.updateSnapshot(n,r);var i=this.infoSyncTree_.applyServerOverwrite(n,r);this.eventQueue_.raiseEventsForChangedPath(n,i)},t.prototype.getNextWriteId_=function(){return this.nextWriteId_++},t.prototype.setWithPriority=function(t,e,n,r){var i=this;this.log_("set",{path:t.toString(),value:e,priority:n});var o=this.generateServerValues(),a=Vt(e,n),s=te(a,o),u=this.getNextWriteId_(),c=this.serverSyncTree_.applyUserOverwrite(t,s,u,!0);this.eventQueue_.queueEvents(c),this.server_.put(t.toString(),a.val(!0),(function(e,n){var o="ok"===e;o||I("set at "+t+" failed: "+e);var a=i.serverSyncTree_.ackUserWrite(u,!o);i.eventQueue_.raiseEventsForChangedPath(t,a),i.callOnCompleteCallback(r,e,n)}));var h=this.abortTransactions_(t);this.rerunTransactions_(h),this.eventQueue_.raiseEventsForChangedPath(h,[])},t.prototype.update=function(t,e,n){var r=this;this.log_("update",{path:t.toString(),value:e});var i=!0,o=this.generateServerValues(),a={};if(M(e,(function(t,e){i=!1;var n=Vt(e);a[t]=te(n,o)})),i)T("update() called with empty data.  Don't do anything."),this.callOnCompleteCallback(n,"ok");else{var s=this.getNextWriteId_(),u=this.serverSyncTree_.applyUserMerge(t,a,s);this.eventQueue_.queueEvents(u),this.server_.merge(t.toString(),e,(function(e,i){var o="ok"===e;o||I("update at "+t+" failed: "+e);var a=r.serverSyncTree_.ackUserWrite(s,!o),u=a.length>0?r.rerunTransactions_(t):t;r.eventQueue_.raiseEventsForChangedPath(u,a),r.callOnCompleteCallback(n,e,i)})),M(e,(function(e){var n=r.abortTransactions_(t.child(e));r.rerunTransactions_(n)})),this.eventQueue_.raiseEventsForChangedPath(t,[])}},t.prototype.runOnDisconnectEvents_=function(){var t=this;this.log_("onDisconnectEvents");var e=this.generateServerValues(),n=function(t,e){var n=new $t;return t.forEachTree(new q(""),(function(t,r){n.remember(t,te(r,e))})),n}(this.onDisconnect_,e),r=[];n.forEachTree(q.Empty,(function(e,n){r=r.concat(t.serverSyncTree_.applyServerOverwrite(e,n));var i=t.abortTransactions_(e);t.rerunTransactions_(i)})),this.onDisconnect_=new $t,this.eventQueue_.raiseEventsForChangedPath(q.Empty,r)},t.prototype.onDisconnectCancel=function(t,e){var n=this;this.server_.onDisconnectCancel(t.toString(),(function(r,i){"ok"===r&&n.onDisconnect_.forget(t),n.callOnCompleteCallback(e,r,i)}))},t.prototype.onDisconnectSet=function(t,e,n){var r=this,i=Vt(e);this.server_.onDisconnectPut(t.toString(),i.val(!0),(function(e,o){"ok"===e&&r.onDisconnect_.remember(t,i),r.callOnCompleteCallback(n,e,o)}))},t.prototype.onDisconnectSetWithPriority=function(t,e,n,r){var i=this,o=Vt(e,n);this.server_.onDisconnectPut(t.toString(),o.val(!0),(function(e,n){"ok"===e&&i.onDisconnect_.remember(t,o),i.callOnCompleteCallback(r,e,n)}))},t.prototype.onDisconnectUpdate=function(t,e,n){var r=this;if(Object(a.s)(e))return T("onDisconnect().update() called with empty data.  Don't do anything."),void this.callOnCompleteCallback(n,"ok");this.server_.onDisconnectMerge(t.toString(),e,(function(i,o){"ok"===i&&M(e,(function(e,n){var i=Vt(n);r.onDisconnect_.remember(t.child(e),i)})),r.callOnCompleteCallback(n,i,o)}))},t.prototype.addEventCallbackForQuery=function(t,e){var n;n=".info"===t.path.getFront()?this.infoSyncTree_.addEventRegistration(t,e):this.serverSyncTree_.addEventRegistration(t,e),this.eventQueue_.raiseEventsAtPath(t.path,n)},t.prototype.removeEventCallbackForQuery=function(t,e){var n;n=".info"===t.path.getFront()?this.infoSyncTree_.removeEventRegistration(t,e):this.serverSyncTree_.removeEventRegistration(t,e),this.eventQueue_.raiseEventsAtPath(t.path,n)},t.prototype.interrupt=function(){this.persistentConnection_&&this.persistentConnection_.interrupt("repo_interrupt")},t.prototype.resume=function(){this.persistentConnection_&&this.persistentConnection_.resume("repo_interrupt")},t.prototype.stats=function(t){if(void 0===t&&(t=!1),"undefined"!=typeof console){var e;t?(this.statsListener_||(this.statsListener_=new Ae(this.stats_)),e=this.statsListener_.get()):e=this.stats_.get();var n=Object.keys(e).reduce((function(t,e){return Math.max(e.length,t)}),0);M(e,(function(t,e){for(var r=t,i=t.length;i<n+2;i++)r+=" ";console.log(r+e)}))}},t.prototype.statsIncrementCounter=function(t){this.stats_.incrementCounter(t),this.statsReporter_.includeStat(t)},t.prototype.log_=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n="";this.persistentConnection_&&(n=this.persistentConnection_.id+":"),T.apply(void 0,Object(o.f)([n],t))},t.prototype.callOnCompleteCallback=function(t,e,n){t&&j((function(){if("ok"===e)t(null);else{var r=(e||"error").toUpperCase(),i=r;n&&(i+=": "+n);var o=new Error(i);o.code=r,t(o)}}))},Object.defineProperty(t.prototype,"database",{get:function(){return this.__database||(this.__database=new rn(this))},enumerable:!0,configurable:!0}),t}(),ze=function(){function t(e){this.indexedFilter_=new fe(e.getIndex()),this.index_=e.getIndex(),this.startPost_=t.getStartPost_(e),this.endPost_=t.getEndPost_(e)}return t.prototype.getStartPost=function(){return this.startPost_},t.prototype.getEndPost=function(){return this.endPost_},t.prototype.matches=function(t){return this.index_.compare(this.getStartPost(),t)<=0&&this.index_.compare(t,this.getEndPost())<=0},t.prototype.updateChild=function(t,e,n,r,i,o){return this.matches(new mt(e,n))||(n=Ut.EMPTY_NODE),this.indexedFilter_.updateChild(t,e,n,r,i,o)},t.prototype.updateFullNode=function(t,e,n){e.isLeafNode()&&(e=Ut.EMPTY_NODE);var r=e.withIndex(this.index_);r=r.updatePriority(Ut.EMPTY_NODE);var i=this;return e.forEachChild(Nt,(function(t,e){i.matches(new mt(t,e))||(r=r.updateImmediateChild(t,Ut.EMPTY_NODE))})),this.indexedFilter_.updateFullNode(t,r,n)},t.prototype.updatePriority=function(t,e){return t},t.prototype.filtersNodes=function(){return!0},t.prototype.getIndexedFilter=function(){return this.indexedFilter_},t.prototype.getIndex=function(){return this.index_},t.getStartPost_=function(t){if(t.hasStart()){var e=t.getIndexStartName();return t.getIndex().makePost(t.getIndexStartValue(),e)}return t.getIndex().minPost()},t.getEndPost_=function(t){if(t.hasEnd()){var e=t.getIndexEndName();return t.getIndex().makePost(t.getIndexEndValue(),e)}return t.getIndex().maxPost()},t}(),Ye=function(){function t(t){this.rangedFilter_=new ze(t),this.index_=t.getIndex(),this.limit_=t.getLimit(),this.reverse_=!t.isViewFromLeft()}return t.prototype.updateChild=function(t,e,n,r,i,o){return this.rangedFilter_.matches(new mt(e,n))||(n=Ut.EMPTY_NODE),t.getImmediateChild(e).equals(n)?t:t.numChildren()<this.limit_?this.rangedFilter_.getIndexedFilter().updateChild(t,e,n,r,i,o):this.fullLimitUpdateChild_(t,e,n,i,o)},t.prototype.updateFullNode=function(t,e,n){var r;if(e.isLeafNode()||e.isEmpty())r=Ut.EMPTY_NODE.withIndex(this.index_);else if(2*this.limit_<e.numChildren()&&e.isIndexed(this.index_)){r=Ut.EMPTY_NODE.withIndex(this.index_);var i=void 0;i=this.reverse_?e.getReverseIteratorFrom(this.rangedFilter_.getEndPost(),this.index_):e.getIteratorFrom(this.rangedFilter_.getStartPost(),this.index_);for(var o=0;i.hasNext()&&o<this.limit_;){var a=i.getNext();if(!(this.reverse_?this.index_.compare(this.rangedFilter_.getStartPost(),a)<=0:this.index_.compare(a,this.rangedFilter_.getEndPost())<=0))break;r=r.updateImmediateChild(a.name,a.node),o++}}else{r=(r=e.withIndex(this.index_)).updatePriority(Ut.EMPTY_NODE);var s=void 0,u=void 0,c=void 0;i=void 0;if(this.reverse_){i=r.getReverseIterator(this.index_),s=this.rangedFilter_.getEndPost(),u=this.rangedFilter_.getStartPost();var h=this.index_.getCompare();c=function(t,e){return h(e,t)}}else i=r.getIterator(this.index_),s=this.rangedFilter_.getStartPost(),u=this.rangedFilter_.getEndPost(),c=this.index_.getCompare();o=0;for(var l=!1;i.hasNext();){a=i.getNext();!l&&c(s,a)<=0&&(l=!0),l&&o<this.limit_&&c(a,u)<=0?o++:r=r.updateImmediateChild(a.name,Ut.EMPTY_NODE)}}return this.rangedFilter_.getIndexedFilter().updateFullNode(t,r,n)},t.prototype.updatePriority=function(t,e){return t},t.prototype.filtersNodes=function(){return!0},t.prototype.getIndexedFilter=function(){return this.rangedFilter_.getIndexedFilter()},t.prototype.getIndex=function(){return this.index_},t.prototype.fullLimitUpdateChild_=function(t,e,n,r,i){var o;if(this.reverse_){var s=this.index_.getCompare();o=function(t,e){return s(e,t)}}else o=this.index_.getCompare();var u=t;Object(a.f)(u.numChildren()===this.limit_,"");var c=new mt(e,n),h=this.reverse_?u.getFirstChild(this.index_):u.getLastChild(this.index_),l=this.rangedFilter_.matches(c);if(u.hasChild(e)){for(var f=u.getImmediateChild(e),p=r.getChildAfterChild(this.index_,h,this.reverse_);null!=p&&(p.name===e||u.hasChild(p.name));)p=r.getChildAfterChild(this.index_,p,this.reverse_);var d=null==p?1:o(p,c);if(l&&!n.isEmpty()&&d>=0)return null!=i&&i.trackChildChange(le.childChangedChange(e,n,f)),u.updateImmediateChild(e,n);null!=i&&i.trackChildChange(le.childRemovedChange(e,f));var m=u.updateImmediateChild(e,Ut.EMPTY_NODE);return null!=p&&this.rangedFilter_.matches(p)?(null!=i&&i.trackChildChange(le.childAddedChange(p.name,p.node)),m.updateImmediateChild(p.name,p.node)):m}return n.isEmpty()?t:l&&o(h,c)>=0?(null!=i&&(i.trackChildChange(le.childRemovedChange(h.name,h.node)),i.trackChildChange(le.childAddedChange(e,n))),u.updateImmediateChild(e,n).updateImmediateChild(h.name,Ut.EMPTY_NODE)):t},t}(),Xe=function(){function t(){this.limitSet_=!1,this.startSet_=!1,this.startNameSet_=!1,this.endSet_=!1,this.endNameSet_=!1,this.limit_=0,this.viewFrom_="",this.indexStartValue_=null,this.indexStartName_="",this.indexEndValue_=null,this.indexEndName_="",this.index_=Nt}return t.prototype.hasStart=function(){return this.startSet_},t.prototype.isViewFromLeft=function(){return""===this.viewFrom_?this.startSet_:this.viewFrom_===t.WIRE_PROTOCOL_CONSTANTS_.VIEW_FROM_LEFT},t.prototype.getIndexStartValue=function(){return Object(a.f)(this.startSet_,"Only valid if start has been set"),this.indexStartValue_},t.prototype.getIndexStartName=function(){return Object(a.f)(this.startSet_,"Only valid if start has been set"),this.startNameSet_?this.indexStartName_:N},t.prototype.hasEnd=function(){return this.endSet_},t.prototype.getIndexEndValue=function(){return Object(a.f)(this.endSet_,"Only valid if end has been set"),this.indexEndValue_},t.prototype.getIndexEndName=function(){return Object(a.f)(this.endSet_,"Only valid if end has been set"),this.endNameSet_?this.indexEndName_:D},t.prototype.hasLimit=function(){return this.limitSet_},t.prototype.hasAnchoredLimit=function(){return this.limitSet_&&""!==this.viewFrom_},t.prototype.getLimit=function(){return Object(a.f)(this.limitSet_,"Only valid if limit has been set"),this.limit_},t.prototype.getIndex=function(){return this.index_},t.prototype.copy_=function(){var e=new t;return e.limitSet_=this.limitSet_,e.limit_=this.limit_,e.startSet_=this.startSet_,e.indexStartValue_=this.indexStartValue_,e.startNameSet_=this.startNameSet_,e.indexStartName_=this.indexStartName_,e.endSet_=this.endSet_,e.indexEndValue_=this.indexEndValue_,e.endNameSet_=this.endNameSet_,e.indexEndName_=this.indexEndName_,e.index_=this.index_,e.viewFrom_=this.viewFrom_,e},t.prototype.limit=function(t){var e=this.copy_();return e.limitSet_=!0,e.limit_=t,e.viewFrom_="",e},t.prototype.limitToFirst=function(e){var n=this.copy_();return n.limitSet_=!0,n.limit_=e,n.viewFrom_=t.WIRE_PROTOCOL_CONSTANTS_.VIEW_FROM_LEFT,n},t.prototype.limitToLast=function(e){var n=this.copy_();return n.limitSet_=!0,n.limit_=e,n.viewFrom_=t.WIRE_PROTOCOL_CONSTANTS_.VIEW_FROM_RIGHT,n},t.prototype.startAt=function(t,e){var n=this.copy_();return n.startSet_=!0,void 0===t&&(t=null),n.indexStartValue_=t,null!=e?(n.startNameSet_=!0,n.indexStartName_=e):(n.startNameSet_=!1,n.indexStartName_=""),n},t.prototype.endAt=function(t,e){var n=this.copy_();return n.endSet_=!0,void 0===t&&(t=null),n.indexEndValue_=t,void 0!==e?(n.endNameSet_=!0,n.indexEndName_=e):(n.endNameSet_=!1,n.indexEndName_=""),n},t.prototype.orderBy=function(t){var e=this.copy_();return e.index_=t,e},t.prototype.getQueryObject=function(){var e=t.WIRE_PROTOCOL_CONSTANTS_,n={};if(this.startSet_&&(n[e.INDEX_START_VALUE]=this.indexStartValue_,this.startNameSet_&&(n[e.INDEX_START_NAME]=this.indexStartName_)),this.endSet_&&(n[e.INDEX_END_VALUE]=this.indexEndValue_,this.endNameSet_&&(n[e.INDEX_END_NAME]=this.indexEndName_)),this.limitSet_){n[e.LIMIT]=this.limit_;var r=this.viewFrom_;""===r&&(r=this.isViewFromLeft()?e.VIEW_FROM_LEFT:e.VIEW_FROM_RIGHT),n[e.VIEW_FROM]=r}return this.index_!==Nt&&(n[e.INDEX]=this.index_.toString()),n},t.prototype.loadsAllData=function(){return!(this.startSet_||this.endSet_||this.limitSet_)},t.prototype.isDefault=function(){return this.loadsAllData()&&this.index_===Nt},t.prototype.getNodeFilter=function(){return this.loadsAllData()?new fe(this.getIndex()):this.hasLimit()?new Ye(this):new ze(this)},t.prototype.toRestQueryStringParameters=function(){var e,n=t.REST_QUERY_CONSTANTS_,r={};return this.isDefault()?r:(this.index_===Nt?e=n.PRIORITY_INDEX:this.index_===Kt?e=n.VALUE_INDEX:this.index_===vt?e=n.KEY_INDEX:(Object(a.f)(this.index_ instanceof Qt,"Unrecognized index type!"),e=this.index_.toString()),r[n.ORDER_BY]=Object(a.G)(e),this.startSet_&&(r[n.START_AT]=Object(a.G)(this.indexStartValue_),this.startNameSet_&&(r[n.START_AT]+=","+Object(a.G)(this.indexStartName_))),this.endSet_&&(r[n.END_AT]=Object(a.G)(this.indexEndValue_),this.endNameSet_&&(r[n.END_AT]+=","+Object(a.G)(this.indexEndName_))),this.limitSet_&&(this.isViewFromLeft()?r[n.LIMIT_TO_FIRST]=this.limit_:r[n.LIMIT_TO_LAST]=this.limit_),r)},t.WIRE_PROTOCOL_CONSTANTS_={INDEX_START_VALUE:"sp",INDEX_START_NAME:"sn",INDEX_END_VALUE:"ep",INDEX_END_NAME:"en",LIMIT:"l",VIEW_FROM:"vf",VIEW_FROM_LEFT:"l",VIEW_FROM_RIGHT:"r",INDEX:"i"},t.REST_QUERY_CONSTANTS_={ORDER_BY:"orderBy",PRIORITY_INDEX:"$priority",VALUE_INDEX:"$value",KEY_INDEX:"$key",START_AT:"startAt",END_AT:"endAt",LIMIT_TO_FIRST:"limitToFirst",LIMIT_TO_LAST:"limitToLast"},t.DEFAULT=new t,t}(),Je=function(t){function e(e,n){if(!(e instanceof He))throw new Error("new Reference() no longer supported - use app.database().");return t.call(this,e,n,Xe.DEFAULT,!1)||this}return Object(o.c)(e,t),e.prototype.getKey=function(){return Object(a.H)("Reference.key",0,0,arguments.length),this.path.isEmpty()?null:this.path.getBack()},e.prototype.child=function(t){return Object(a.H)("Reference.child",1,1,arguments.length),"number"==typeof t?t=String(t):t instanceof q||(null===this.path.getFront()?ut("Reference.child",1,t,!1):st("Reference.child",1,t,!1)),new e(this.repo,this.path.child(t))},e.prototype.getParent=function(){Object(a.H)("Reference.parent",0,0,arguments.length);var t=this.path.parent();return null===t?null:new e(this.repo,t)},e.prototype.getRoot=function(){Object(a.H)("Reference.root",0,0,arguments.length);for(var t=this;null!==t.getParent();)t=t.getParent();return t},e.prototype.databaseProp=function(){return this.repo.database},e.prototype.set=function(t,e){Object(a.H)("Reference.set",1,2,arguments.length),ct("Reference.set",this.path),et("Reference.set",1,t,this.path,!1),Object(a.I)("Reference.set",2,e,!0);var n=new a.b;return this.repo.setWithPriority(this.path,t,null,n.wrapCallback(e)),n.promise},e.prototype.update=function(t,e){if(Object(a.H)("Reference.update",1,2,arguments.length),ct("Reference.update",this.path),Array.isArray(t)){for(var n={},r=0;r<t.length;++r)n[""+r]=t[r];t=n,I("Passing an Array to Firebase.update() is deprecated. Use set() if you want to overwrite the existing data, or an Object with integer keys if you really do want to only update some of the children.")}rt("Reference.update",1,t,this.path,!1),Object(a.I)("Reference.update",2,e,!0);var i=new a.b;return this.repo.update(this.path,t,i.wrapCallback(e)),i.promise},e.prototype.setWithPriority=function(t,e,n){if(Object(a.H)("Reference.setWithPriority",2,3,arguments.length),ct("Reference.setWithPriority",this.path),et("Reference.setWithPriority",1,t,this.path,!1),it("Reference.setWithPriority",2,e,!1),Object(a.I)("Reference.setWithPriority",3,n,!0),".length"===this.getKey()||".keys"===this.getKey())throw"Reference.setWithPriority failed: "+this.getKey()+" is a read-only object.";var r=new a.b;return this.repo.setWithPriority(this.path,t,e,r.wrapCallback(n)),r.promise},e.prototype.remove=function(t){return Object(a.H)("Reference.remove",0,1,arguments.length),ct("Reference.remove",this.path),Object(a.I)("Reference.remove",1,t,!0),this.set(null,t)},e.prototype.transaction=function(t,e,n){if(Object(a.H)("Reference.transaction",1,3,arguments.length),ct("Reference.transaction",this.path),Object(a.I)("Reference.transaction",1,t,!1),Object(a.I)("Reference.transaction",2,e,!0),lt("Reference.transaction",3,n,!0),".length"===this.getKey()||".keys"===this.getKey())throw"Reference.transaction failed: "+this.getKey()+" is a read-only object.";void 0===n&&(n=!0);var r=new a.b;"function"==typeof e&&r.promise.catch((function(){}));var i=function(t,n,i){t?r.reject(t):r.resolve(new pt(n,i)),"function"==typeof e&&e(t,n,i)};return this.repo.startTransaction(this.path,t,i,n),r.promise},e.prototype.setPriority=function(t,e){Object(a.H)("Reference.setPriority",1,2,arguments.length),ct("Reference.setPriority",this.path),it("Reference.setPriority",1,t,!1),Object(a.I)("Reference.setPriority",2,e,!0);var n=new a.b;return this.repo.setWithPriority(this.path.child(".priority"),t,null,n.wrapCallback(e)),n.promise},e.prototype.push=function(t,e){Object(a.H)("Reference.push",0,2,arguments.length),ct("Reference.push",this.path),et("Reference.push",1,t,this.path,!0),Object(a.I)("Reference.push",2,e,!0);var n,r=this.repo.serverTime(),i=dt(r),o=this.child(i),s=this.child(i);return n=null!=t?o.set(t,e).then((function(){return s})):Promise.resolve(s),o.then=n.then.bind(n),o.catch=n.then.bind(n,void 0),"function"==typeof e&&n.catch((function(){})),o},e.prototype.onDisconnect=function(){return ct("Reference.onDisconnect",this.path),new ft(this.repo,this.path)},Object.defineProperty(e.prototype,"database",{get:function(){return this.databaseProp()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"key",{get:function(){return this.getKey()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"parent",{get:function(){return this.getParent()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"root",{get:function(){return this.getRoot()},enumerable:!0,configurable:!0}),e}(Jt);
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */Jt.__referenceConstructor=Je,we.__referenceConstructor=Je;
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var $e,Ze=function(){this.children={},this.childCount=0,this.value=null},tn=function(){function t(t,e,n){void 0===t&&(t=""),void 0===e&&(e=null),void 0===n&&(n=new Ze),this.name_=t,this.parent_=e,this.node_=n}return t.prototype.subTree=function(e){for(var n=e instanceof q?e:new q(e),r=this,i=n.getFront();null!==i;){r=new t(i,r,Object(a.D)(r.node_.children,i)||new Ze),i=(n=n.popFront()).getFront()}return r},t.prototype.getValue=function(){return this.node_.value},t.prototype.setValue=function(t){Object(a.f)(void 0!==t,"Cannot set value to undefined"),this.node_.value=t,this.updateParents_()},t.prototype.clear=function(){this.node_.value=null,this.node_.children={},this.node_.childCount=0,this.updateParents_()},t.prototype.hasChildren=function(){return this.node_.childCount>0},t.prototype.isEmpty=function(){return null===this.getValue()&&!this.hasChildren()},t.prototype.forEachChild=function(e){var n=this;M(this.node_.children,(function(r,i){e(new t(r,n,i))}))},t.prototype.forEachDescendant=function(t,e,n){e&&!n&&t(this),this.forEachChild((function(e){e.forEachDescendant(t,!0,n)})),e&&n&&t(this)},t.prototype.forEachAncestor=function(t,e){for(var n=e?this:this.parent();null!==n;){if(t(n))return!0;n=n.parent()}return!1},t.prototype.forEachImmediateDescendantWithValue=function(t){this.forEachChild((function(e){null!==e.getValue()?t(e):e.forEachImmediateDescendantWithValue(t)}))},t.prototype.path=function(){return new q(null===this.parent_?this.name_:this.parent_.path()+"/"+this.name_)},t.prototype.name=function(){return this.name_},t.prototype.parent=function(){return this.parent_},t.prototype.updateParents_=function(){null!==this.parent_&&this.parent_.updateChild_(this.name_,this)},t.prototype.updateChild_=function(t,e){var n=e.isEmpty(),r=Object(a.j)(this.node_.children,t);n&&r?(delete this.node_.children[t],this.node_.childCount--,this.updateParents_()):n||r||(this.node_.children[t]=e.node_,this.node_.childCount++,this.updateParents_())},t}();!function(t){t[t.RUN=0]="RUN",t[t.SENT=1]="SENT",t[t.COMPLETED=2]="COMPLETED",t[t.SENT_NEEDS_ABORT=3]="SENT_NEEDS_ABORT",t[t.NEEDS_ABORT=4]="NEEDS_ABORT"}($e||($e={})),He.MAX_TRANSACTION_RETRIES_=25,He.prototype.transactionsInit_=function(){this.transactionQueueTree_=new tn},He.prototype.startTransaction=function(t,e,n,r){this.log_("transaction on "+t);var i=function(){},o=new Je(this,t);o.on("value",i);var s={path:t,update:e,onComplete:n,status:null,order:m(),applyLocally:r,retryCount:0,unwatcher:function(){o.off("value",i)},abortReason:null,currentWriteId:null,currentInputSnapshot:null,currentOutputSnapshotRaw:null,currentOutputSnapshotResolved:null},u=this.getLatestState_(t);s.currentInputSnapshot=u;var c=s.update(u.val());if(void 0===c){if(s.unwatcher(),s.currentOutputSnapshotRaw=null,s.currentOutputSnapshotResolved=null,s.onComplete){var h=new Gt(s.currentInputSnapshot,new Je(this,s.path),Nt);s.onComplete(null,!1,h)}}else{nt("transaction failed: Data returned ",c,s.path),s.status=$e.RUN;var l=this.transactionQueueTree_.subTree(t),f=l.getValue()||[];f.push(s),l.setValue(f);var p=void 0;if("object"==typeof c&&null!==c&&Object(a.j)(c,".priority"))p=Object(a.D)(c,".priority"),Object(a.f)(tt(p),"Invalid priority returned by transaction. Priority must be a valid string, finite number, server value, or null.");else p=(this.serverSyncTree_.calcCompleteEventCache(t)||Ut.EMPTY_NODE).getPriority().val();p=p;var d=this.generateServerValues(),y=Vt(c,p),g=te(y,d);s.currentOutputSnapshotRaw=y,s.currentOutputSnapshotResolved=g,s.currentWriteId=this.getNextWriteId_();var v=this.serverSyncTree_.applyUserOverwrite(t,g,s.currentWriteId,s.applyLocally);this.eventQueue_.raiseEventsForChangedPath(t,v),this.sendReadyTransactions_()}},He.prototype.getLatestState_=function(t,e){return this.serverSyncTree_.calcCompleteEventCache(t,e)||Ut.EMPTY_NODE},He.prototype.sendReadyTransactions_=function(t){var e=this;if(void 0===t&&(t=this.transactionQueueTree_),t||this.pruneCompletedTransactionsBelowNode_(t),null!==t.getValue()){var n=this.buildTransactionQueue_(t);Object(a.f)(n.length>0,"Sending zero length transaction queue"),n.every((function(t){return t.status===$e.RUN}))&&this.sendTransactionQueue_(t.path(),n)}else t.hasChildren()&&t.forEachChild((function(t){e.sendReadyTransactions_(t)}))},He.prototype.sendTransactionQueue_=function(t,e){for(var n=this,r=e.map((function(t){return t.currentWriteId})),i=this.getLatestState_(t,r),o=i,s=i.hash(),u=0;u<e.length;u++){var c=e[u];Object(a.f)(c.status===$e.RUN,"tryToSendTransactionQueue_: items in queue should all be run."),c.status=$e.SENT,c.retryCount++;var h=q.relativePath(t,c.path);o=o.updateChild(h,c.currentOutputSnapshotRaw)}var l=o.val(!0),f=t;this.server_.put(f.toString(),l,(function(r){n.log_("transaction put response",{path:f.toString(),status:r});var i=[];if("ok"===r){for(var o=[],a=0;a<e.length;a++){if(e[a].status=$e.COMPLETED,i=i.concat(n.serverSyncTree_.ackUserWrite(e[a].currentWriteId)),e[a].onComplete){var s=e[a].currentOutputSnapshotResolved,u=new Je(n,e[a].path),c=new Gt(s,u,Nt);o.push(e[a].onComplete.bind(null,null,!0,c))}e[a].unwatcher()}n.pruneCompletedTransactionsBelowNode_(n.transactionQueueTree_.subTree(t)),n.sendReadyTransactions_(),n.eventQueue_.raiseEventsForChangedPath(t,i);for(a=0;a<o.length;a++)j(o[a])}else{if("datastale"===r)for(a=0;a<e.length;a++)e[a].status===$e.SENT_NEEDS_ABORT?e[a].status=$e.NEEDS_ABORT:e[a].status=$e.RUN;else{I("transaction at "+f.toString()+" failed: "+r);for(a=0;a<e.length;a++)e[a].status=$e.NEEDS_ABORT,e[a].abortReason=r}n.rerunTransactions_(t)}}),s)},He.prototype.rerunTransactions_=function(t){var e=this.getAncestorTransactionNode_(t),n=e.path(),r=this.buildTransactionQueue_(e);return this.rerunTransactionQueue_(r,n),n},He.prototype.rerunTransactionQueue_=function(t,e){if(0!==t.length){for(var n,r=[],i=[],o=t.filter((function(t){return t.status===$e.RUN})).map((function(t){return t.currentWriteId})),s=0;s<t.length;s++){var u=t[s],c=q.relativePath(e,u.path),h=!1,l=void 0;if(Object(a.f)(null!==c,"rerunTransactionsUnderNode_: relativePath should not be null."),u.status===$e.NEEDS_ABORT)h=!0,l=u.abortReason,i=i.concat(this.serverSyncTree_.ackUserWrite(u.currentWriteId,!0));else if(u.status===$e.RUN)if(u.retryCount>=He.MAX_TRANSACTION_RETRIES_)h=!0,l="maxretry",i=i.concat(this.serverSyncTree_.ackUserWrite(u.currentWriteId,!0));else{var f=this.getLatestState_(u.path,o);u.currentInputSnapshot=f;var p=t[s].update(f.val());if(void 0!==p){nt("transaction failed: Data returned ",p,u.path);var d=Vt(p);"object"==typeof p&&null!=p&&Object(a.j)(p,".priority")||(d=d.updatePriority(f.getPriority()));var m=u.currentWriteId,y=this.generateServerValues(),g=te(d,y);u.currentOutputSnapshotRaw=d,u.currentOutputSnapshotResolved=g,u.currentWriteId=this.getNextWriteId_(),o.splice(o.indexOf(m),1),i=(i=i.concat(this.serverSyncTree_.applyUserOverwrite(u.path,g,u.currentWriteId,u.applyLocally))).concat(this.serverSyncTree_.ackUserWrite(m,!0))}else h=!0,l="nodata",i=i.concat(this.serverSyncTree_.ackUserWrite(u.currentWriteId,!0))}if(this.eventQueue_.raiseEventsForChangedPath(e,i),i=[],h&&(t[s].status=$e.COMPLETED,n=t[s].unwatcher,setTimeout(n,Math.floor(0)),t[s].onComplete))if("nodata"===l){var v=new Je(this,t[s].path),b=t[s].currentInputSnapshot,w=new Gt(b,v,Nt);r.push(t[s].onComplete.bind(null,null,!1,w))}else r.push(t[s].onComplete.bind(null,new Error(l),!1,null))}this.pruneCompletedTransactionsBelowNode_(this.transactionQueueTree_);for(s=0;s<r.length;s++)j(r[s]);this.sendReadyTransactions_()}},He.prototype.getAncestorTransactionNode_=function(t){var e,n=this.transactionQueueTree_;for(e=t.getFront();null!==e&&null===n.getValue();)n=n.subTree(e),e=(t=t.popFront()).getFront();return n},He.prototype.buildTransactionQueue_=function(t){var e=[];return this.aggregateTransactionQueuesForNode_(t,e),e.sort((function(t,e){return t.order-e.order})),e},He.prototype.aggregateTransactionQueuesForNode_=function(t,e){var n=this,r=t.getValue();if(null!==r)for(var i=0;i<r.length;i++)e.push(r[i]);t.forEachChild((function(t){n.aggregateTransactionQueuesForNode_(t,e)}))},He.prototype.pruneCompletedTransactionsBelowNode_=function(t){var e=this,n=t.getValue();if(n){for(var r=0,i=0;i<n.length;i++)n[i].status!==$e.COMPLETED&&(n[r]=n[i],r++);n.length=r,t.setValue(n.length>0?n:null)}t.forEachChild((function(t){e.pruneCompletedTransactionsBelowNode_(t)}))},He.prototype.abortTransactions_=function(t){var e=this,n=this.getAncestorTransactionNode_(t).path(),r=this.transactionQueueTree_.subTree(t);return r.forEachAncestor((function(t){e.abortTransactionsOnNode_(t)})),this.abortTransactionsOnNode_(r),r.forEachDescendant((function(t){e.abortTransactionsOnNode_(t)})),n},He.prototype.abortTransactionsOnNode_=function(t){var e=t.getValue();if(null!==e){for(var n=[],r=[],i=-1,o=0;o<e.length;o++)if(e[o].status===$e.SENT_NEEDS_ABORT);else if(e[o].status===$e.SENT)Object(a.f)(i===o-1,"All SENT items should be at beginning of queue."),i=o,e[o].status=$e.SENT_NEEDS_ABORT,e[o].abortReason="set";else if(Object(a.f)(e[o].status===$e.RUN,"Unexpected transaction status in abort"),e[o].unwatcher(),r=r.concat(this.serverSyncTree_.ackUserWrite(e[o].currentWriteId,!0)),e[o].onComplete){n.push(e[o].onComplete.bind(null,new Error("set"),!1,null))}-1===i?t.setValue(null):e.length=i+1,this.eventQueue_.raiseEventsForChangedPath(t.path(),r);for(o=0;o<n.length;o++)j(n[o])}};
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var en,nn=function(){function e(){this.repos_={},this.useRestClient_=!1}return e.getInstance=function(){return en||(en=new e),en},e.prototype.interrupt=function(){var t,e,n,r;try{for(var i=Object(o.h)(Object.keys(this.repos_)),a=i.next();!a.done;a=i.next()){var s=a.value;try{for(var u=(n=void 0,Object(o.h)(Object.keys(this.repos_[s]))),c=u.next();!c.done;c=u.next()){var h=c.value;this.repos_[s][h].interrupt()}}catch(t){n={error:t}}finally{try{c&&!c.done&&(r=u.return)&&r.call(u)}finally{if(n)throw n.error}}}}catch(e){t={error:e}}finally{try{a&&!a.done&&(e=i.return)&&e.call(i)}finally{if(t)throw t.error}}},e.prototype.resume=function(){var t,e,n,r;try{for(var i=Object(o.h)(Object.keys(this.repos_)),a=i.next();!a.done;a=i.next()){var s=a.value;try{for(var u=(n=void 0,Object(o.h)(Object.keys(this.repos_[s]))),c=u.next();!c.done;c=u.next()){var h=c.value;this.repos_[s][h].resume()}}catch(t){n={error:t}}finally{try{c&&!c.done&&(r=u.return)&&r.call(u)}finally{if(n)throw n.error}}}}catch(e){t={error:e}}finally{try{a&&!a.done&&(e=i.return)&&e.call(i)}finally{if(t)throw t.error}}},e.prototype.databaseFromApp=function(e,n,r){var i=r||e.options.databaseURL;void 0===i&&S("Can't determine Firebase Database URL.  Be sure to include databaseURL option when calling firebase.initializeApp().");var o=z(i),a=o.repoInfo,s=void 0;return void 0!==t&&(s=t.env.FIREBASE_DATABASE_EMULATOR_HOST),s&&(i="http://"+s+"?ns="+a.namespace,a=(o=z(i)).repoInfo),ht("Invalid Firebase Database URL",1,o),o.path.isEmpty()||S("Database URL must point to the root of a Firebase Database (not including a child path)."),this.createRepo(a,e,n).database},e.prototype.deleteRepo=function(t){var e=Object(a.D)(this.repos_,t.app.name);e&&Object(a.D)(e,t.repoInfo_.toURLString())===t||S("Database "+t.app.name+"("+t.repoInfo_+") has already been deleted."),t.interrupt(),delete e[t.repoInfo_.toURLString()]},e.prototype.createRepo=function(t,e,n){var r=Object(a.D)(this.repos_,e.name);r||(r={},this.repos_[e.name]=r);var i=Object(a.D)(r,t.toURLString());return i&&S("Database initialized multiple times. Please make sure the format of the database URL matches with each database() call."),i=new He(t,this.useRestClient_,e,n),r[t.toURLString()]=i,i},e.prototype.forceRestClient=function(t){this.useRestClient_=t},e}(),rn=function(){function t(t){this.repo_=t,t instanceof He||S("Don't call new Database() directly - please use firebase.database()."),this.root_=new Je(t,q.Empty),this.INTERNAL=new on(this)}return Object.defineProperty(t.prototype,"app",{get:function(){return this.repo_.app},enumerable:!0,configurable:!0}),t.prototype.ref=function(t){return this.checkDeleted_("ref"),Object(a.H)("database.ref",0,1,arguments.length),t instanceof Je?this.refFromURL(t.toString()):void 0!==t?this.root_.child(t):this.root_},t.prototype.refFromURL=function(t){var e="database.refFromURL";this.checkDeleted_(e),Object(a.H)(e,1,1,arguments.length);var n=z(t);ht(e,1,n);var r=n.repoInfo;return r.host!==this.repo_.repoInfo_.host&&S(e+": Host name does not match the current database: (found "+r.host+" but expected "+this.repo_.repoInfo_.host+")"),this.ref(n.path.toString())},t.prototype.checkDeleted_=function(t){null===this.repo_&&S("Cannot call "+t+" on a deleted database.")},t.prototype.goOffline=function(){Object(a.H)("database.goOffline",0,0,arguments.length),this.checkDeleted_("goOffline"),this.repo_.interrupt()},t.prototype.goOnline=function(){Object(a.H)("database.goOnline",0,0,arguments.length),this.checkDeleted_("goOnline"),this.repo_.resume()},t.ServerValue={TIMESTAMP:{".sv":"timestamp"}},t}(),on=function(){function t(t){this.database=t}return t.prototype.delete=function(){return Object(o.b)(this,void 0,void 0,(function(){return Object(o.d)(this,(function(t){return this.database.checkDeleted_("delete"),nn.getInstance().deleteRepo(this.database.repo_),this.database.repo_=null,this.database.root_=null,this.database.INTERNAL=null,this.database=null,[2]}))}))},t}(),an=Object.freeze({__proto__:null,forceLongPolling:function(){Ve.forceDisallow(),Fe.forceAllow()},forceWebSockets:function(){Fe.forceDisallow()},isWebSocketsAvailable:function(){return Ve.isAvailable()},setSecurityDebugCallback:function(t,e){t.repo.persistentConnection_.securityDebugCallback_=e},stats:function(t,e){t.repo.stats(e)},statsIncrementCounter:function(t,e){t.repo.statsIncrementCounter(e)},dataUpdateCount:function(t){return t.repo.dataUpdateCount},interceptServerData:function(t,e){return t.repo.interceptServerData_(e)}}),sn=Qe;Qe.prototype.simpleListen=function(t,e){this.sendRequest("q",{p:t},e)},Qe.prototype.echo=function(t,e){this.sendRequest("echo",{d:t},e)};var un=We,cn=B,hn=Object.freeze({__proto__:null,DataConnection:sn,RealTimeConnection:un,hijackHash:function(t){var e=Qe.prototype.put;return Qe.prototype.put=function(n,r,i,o){void 0!==o&&(o=t()),e.call(this,n,r,i,o)},function(){Qe.prototype.put=e}},ConnectionTarget:cn,queryIdentifier:function(t){return t.queryIdentifier()},forceRestClient:function(t){nn.getInstance().forceRestClient(t)}}),ln=rn.ServerValue;!function(t){!function(t){Ue=t}(t.SDK_VERSION);var n=t.INTERNAL.registerComponent(new u.a("database",(function(t,e){var n=t.getProvider("app").getImmediate(),r=t.getProvider("auth-internal");return nn.getInstance().databaseFromApp(n,r,e)}),"PUBLIC").setServiceProps({Reference:Je,Query:Jt,Database:rn,DataSnapshot:Gt,enableLogging:w,INTERNAL:an,ServerValue:ln,TEST_ACCESS:hn}).setMultipleInstances(!0));t.registerVersion("@firebase/database","0.5.18"),Object(a.w)()&&(e.exports=n)}(i.default)}).call(this,n(4),n(22)(t))},function(t,e){t.exports=function(t){if(!t.webpackPolyfill){var e=Object.create(t);e.children||(e.children=[]),Object.defineProperty(e,"loaded",{enumerable:!0,get:function(){return e.l}}),Object.defineProperty(e,"id",{enumerable:!0,get:function(){return e.i}}),Object.defineProperty(e,"exports",{enumerable:!0}),e.webpackPolyfill=1}return e}},function(t,e,n){"use strict";(function(t){var e,r=n(11),i=n(12),o=n(16),a=n(14),s=n(13),u=n(24),c=r.default.SDK_VERSION,h=new o.b("@firebase/firestore");function l(){return h.logLevel===o.a.DEBUG?e.DEBUG:h.logLevel===o.a.SILENT?e.SILENT:e.ERROR}function f(t){switch(t){case e.DEBUG:h.logLevel=o.a.DEBUG;break;case e.ERROR:h.logLevel=o.a.ERROR;break;case e.SILENT:h.logLevel=o.a.SILENT;break;default:h.error("Firestore ("+c+"): Invalid value passed to `setLogLevel`")}}function p(t,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];if(h.logLevel<=o.a.DEBUG){var a=n.map(m);h.debug.apply(h,Object(i.g)(["Firestore ("+c+") ["+t+"]: "+e],a))}}function d(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];if(h.logLevel<=o.a.ERROR){var r=e.map(m);h.error.apply(h,Object(i.g)(["Firestore ("+c+"): "+t],r))}}function m(t){if("string"==typeof t)return t;var e=v.getPlatform();try{return e.formatJSON(t)}catch(e){return t}}
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function y(t){var e="FIRESTORE ("+c+") INTERNAL ASSERTION FAILED: "+t;throw d(e),new Error(e)}function g(t,e){t||y(e)}
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */!function(t){t[t.DEBUG=0]="DEBUG",t[t.ERROR=1]="ERROR",t[t.SILENT=2]="SILENT"}(e||(e={}));var v=function(){function t(){}return t.setPlatform=function(e){t.platform&&y("Platform already defined"),t.platform=e},t.getPlatform=function(){return t.platform||y("Platform not set"),t.platform},t}();function b(){return v.getPlatform().emptyByteString}
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var w={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},T=function(t){function e(e,n){var r=t.call(this,n)||this;return r.code=e,r.message=n,r.name="FirebaseError",r.toString=function(){return r.name+": [code="+r.code+"]: "+r.message},r}return Object(i.c)(e,t),e}(Error);
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function _(t,e){function n(){var t="This constructor is private.";throw e&&(t+=" ",t+=e),new T(w.INVALID_ARGUMENT,t)}for(var r in n.prototype=t.prototype,t)t.hasOwnProperty(r)&&(n[r]=t[r]);return n}
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function E(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function S(t,e){return void 0!==t?t:e}function I(t,e){for(var n in t)if(Object.prototype.hasOwnProperty.call(t,n)){var r=Number(n);isNaN(r)||e(r,t[n])}}function C(t,e){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e(n,t[n])}function N(t){for(var e in g(null!=t&&"object"==typeof t,"isEmpty() expects object parameter."),t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function D(t,e){if(0!==e.length)throw new T(w.INVALID_ARGUMENT,"Function "+t+"() does not support arguments, but was called with "+z(e.length,"argument")+".")}function A(t,e,n){if(e.length!==n)throw new T(w.INVALID_ARGUMENT,"Function "+t+"() requires "+z(n,"argument")+", but was called with "+z(e.length,"argument")+".")}function O(t,e,n){if(e.length<n)throw new T(w.INVALID_ARGUMENT,"Function "+t+"() requires at least "+z(n,"argument")+", but was called with "+z(e.length,"argument")+".")}function k(t,e,n,r){if(e.length<n||e.length>r)throw new T(w.INVALID_ARGUMENT,"Function "+t+"() requires between "+n+" and "+r+" arguments, but was called with "+z(e.length,"argument")+".")}function R(t,e,n,r){if(!(e instanceof Array)||e.length<r)throw new T(w.INVALID_ARGUMENT,"Function "+t+"() requires its "+n+" argument to be an array with at least "+z(r,"element")+".")}function P(t,e,n,r){q(t,e,H(n)+" argument",r)}function M(t,e,n,r){void 0!==r&&P(t,e,n,r)}function L(t,e,n,r){q(t,e,n+" option",r)}function x(t,e,n,r){void 0!==r&&L(t,e,n,r)}function F(t,e,n,r,i){void 0!==r&&function(t,e,n,r,i){if(!(r instanceof Array))throw new T(w.INVALID_ARGUMENT,"Function "+t+"() requires its "+e+" option to be an array, but it was: "+B(r));for(var o=0;o<r.length;++o)if(!i(r[o]))throw new T(w.INVALID_ARGUMENT,"Function "+t+"() requires all "+e+" elements to be "+n+", but the value at index "+o+" was: "+B(r[o]))}(t,e,n,r,i)}function j(t,e,n,r,i){void 0!==r&&function(t,e,n,r,i){for(var o=[],a=0,s=i;a<s.length;a++){var u=s[a];if(u===r)return;o.push(B(u))}var c=B(r);throw new T(w.INVALID_ARGUMENT,"Invalid value "+c+" provided to function "+t+'() for option "'+n+'". Acceptable values: '+o.join(", "))}(t,0,n,r,i)}function U(t,e,n,r){if(!e.some((function(t){return t===r})))throw new T(w.INVALID_ARGUMENT,"Invalid value "+B(r)+" provided to function "+t+"() for its "+H(n)+" argument. Acceptable values: "+e.join(", "))}function q(t,e,n,r){if(!("object"===e?V(r):"non-empty string"===e?"string"==typeof r&&""!==r:typeof r===e)){var i=B(r);throw new T(w.INVALID_ARGUMENT,"Function "+t+"() requires its "+n+" to be of type "+e+", but it was: "+i)}}function V(t){return"object"==typeof t&&null!==t&&(Object.getPrototypeOf(t)===Object.prototype||null===Object.getPrototypeOf(t))}function B(t){if(void 0===t)return"undefined";if(null===t)return"null";if("string"==typeof t)return t.length>20&&(t=t.substring(0,20)+"..."),JSON.stringify(t);if("number"==typeof t||"boolean"==typeof t)return""+t;if("object"==typeof t){if(t instanceof Array)return"an array";var e=function(t){if(t.constructor){var e=/function\s+([^\s(]+)\s*\(/.exec(t.constructor.toString());if(e&&e.length>1)return e[1]}return null}(t);return e?"a custom "+e+" object":"an object"}return"function"==typeof t?"a function":y("Unknown wrong type: "+typeof t)}function W(t,e,n){if(void 0===n)throw new T(w.INVALID_ARGUMENT,"Function "+t+"() requires a valid "+H(e)+" argument, but it was undefined.")}function K(t,e,n){C(e,(function(e,r){if(n.indexOf(e)<0)throw new T(w.INVALID_ARGUMENT,"Unknown option '"+e+"' passed to function "+t+"(). Available options: "+n.join(", "))}))}function Q(t,e,n,r){var i=B(r);return new T(w.INVALID_ARGUMENT,"Function "+t+"() requires its "+H(n)+" argument to be a "+e+", but it was: "+i)}function G(t,e,n){if(n<=0)throw new T(w.INVALID_ARGUMENT,'Function "'+t+'()" requires its '+H(e)+" argument to be a positive number, but it was: "+n+".")}function H(t){switch(t){case 1:return"first";case 2:return"second";case 3:return"third";default:return t+"th"}}function z(t,e){return t+" "+e+(1===t?"":"s")}
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Y=function(){function t(){}return t.newId=function(){for(var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",e="",n=0;n<20;n++)e+=t.charAt(Math.floor(Math.random()*t.length));return g(20===e.length,"Invalid auto ID: "+e),e},t}();function X(t,e){return t<e?-1:t>e?1:0}function J(t,e){if(t.length!==e.length)return!1;for(var n=0;n<t.length;n++)if(!t[n].isEqual(e[n]))return!1;return!0}function $(t){return t+"\0"}
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Z(){if("undefined"==typeof Uint8Array)throw new T(w.UNIMPLEMENTED,"Uint8Arrays are not available in this environment.")}function tt(){if(!v.getPlatform().base64Available)throw new T(w.UNIMPLEMENTED,"Blobs are unavailable in Firestore in this environment.")}var et,nt=function(){function t(t){tt(),this._binaryString=t}return t.fromBase64String=function(e){A("Blob.fromBase64String",arguments,1),P("Blob.fromBase64String","string",1,e),tt();try{var n=v.getPlatform().atob(e);return new t(n)}catch(t){throw new T(w.INVALID_ARGUMENT,"Failed to construct Blob from Base64 string: "+t)}},t.fromUint8Array=function(e){if(A("Blob.fromUint8Array",arguments,1),Z(),!(e instanceof Uint8Array))throw Q("Blob.fromUint8Array","Uint8Array",1,e);var n=Array.prototype.map.call(e,(function(t){return String.fromCharCode(t)})).join("");return new t(n)},t.prototype.toBase64=function(){return A("Blob.toBase64",arguments,0),tt(),v.getPlatform().btoa(this._binaryString)},t.prototype.toUint8Array=function(){A("Blob.toUint8Array",arguments,0),Z();for(var t=new Uint8Array(this._binaryString.length),e=0;e<this._binaryString.length;e++)t[e]=this._binaryString.charCodeAt(e);return t},t.prototype.toString=function(){return"Blob(base64: "+this.toBase64()+")"},t.prototype.isEqual=function(t){return this._binaryString===t._binaryString},t.prototype._compareTo=function(t){return X(this._binaryString,t._binaryString)},t}(),rt=_(nt,"Use Blob.fromUint8Array() or Blob.fromBase64String() instead."),it=function(t,e,n,r,i){this.databaseId=t,this.persistenceKey=e,this.host=n,this.ssl=r,this.forceLongPolling=i},ot=function(){function t(t,e){this.projectId=t,this.database=e||"(default)"}return Object.defineProperty(t.prototype,"isDefaultDatabase",{get:function(){return"(default)"===this.database},enumerable:!0,configurable:!0}),t.prototype.isEqual=function(e){return e instanceof t&&e.projectId===this.projectId&&e.database===this.database},t.prototype.compareTo=function(t){return X(this.projectId,t.projectId)||X(this.database,t.database)},t}(),at=function(){function t(t,e){var n=this;this.previousValue=t,e&&(e.sequenceNumberHandler=function(t){return n.setPreviousValue(t)},this.writeNewSequenceNumber=function(t){return e.writeSequenceNumber(t)})}return t.prototype.setPreviousValue=function(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue},t.prototype.next=function(){var t=++this.previousValue;return this.writeNewSequenceNumber&&this.writeNewSequenceNumber(t),t},t.INVALID=-1,t}(),st=function(){function t(t,e,n){void 0===e?e=0:e>t.length&&y("offset "+e+" out of range "+t.length),void 0===n?n=t.length-e:n>t.length-e&&y("length "+n+" out of range "+(t.length-e)),this.segments=t,this.offset=e,this.len=n}return Object.defineProperty(t.prototype,"length",{get:function(){return this.len},enumerable:!0,configurable:!0}),t.prototype.isEqual=function(e){return 0===t.comparator(this,e)},t.prototype.child=function(e){var n=this.segments.slice(this.offset,this.limit());return e instanceof t?e.forEach((function(t){n.push(t)})):n.push(e),this.construct(n)},t.prototype.limit=function(){return this.offset+this.length},t.prototype.popFirst=function(t){return t=void 0===t?1:t,g(this.length>=t,"Can't call popFirst() with less segments"),this.construct(this.segments,this.offset+t,this.length-t)},t.prototype.popLast=function(){return g(!this.isEmpty(),"Can't call popLast() on empty path"),this.construct(this.segments,this.offset,this.length-1)},t.prototype.firstSegment=function(){return g(!this.isEmpty(),"Can't call firstSegment() on empty path"),this.segments[this.offset]},t.prototype.lastSegment=function(){return this.get(this.length-1)},t.prototype.get=function(t){return g(t<this.length,"Index out of range"),this.segments[this.offset+t]},t.prototype.isEmpty=function(){return 0===this.length},t.prototype.isPrefixOf=function(t){if(t.length<this.length)return!1;for(var e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0},t.prototype.isImmediateParentOf=function(t){if(this.length+1!==t.length)return!1;for(var e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0},t.prototype.forEach=function(t){for(var e=this.offset,n=this.limit();e<n;e++)t(this.segments[e])},t.prototype.toArray=function(){return this.segments.slice(this.offset,this.limit())},t.comparator=function(t,e){for(var n=Math.min(t.length,e.length),r=0;r<n;r++){var i=t.get(r),o=e.get(r);if(i<o)return-1;if(i>o)return 1}return t.length<e.length?-1:t.length>e.length?1:0},t}(),ut=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(i.c)(e,t),e.prototype.construct=function(t,n,r){return new e(t,n,r)},e.prototype.canonicalString=function(){return this.toArray().join("/")},e.prototype.toString=function(){return this.canonicalString()},e.fromString=function(t){if(t.indexOf("//")>=0)throw new T(w.INVALID_ARGUMENT,"Invalid path ("+t+"). Paths must not contain // in them.");return new e(t.split("/").filter((function(t){return t.length>0})))},e.EMPTY_PATH=new e([]),e}(st),ct=/^[_a-zA-Z][_a-zA-Z0-9]*$/,ht=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(i.c)(e,t),e.prototype.construct=function(t,n,r){return new e(t,n,r)},e.isValidIdentifier=function(t){return ct.test(t)},e.prototype.canonicalString=function(){return this.toArray().map((function(t){return t=t.replace("\\","\\\\").replace("`","\\`"),e.isValidIdentifier(t)||(t="`"+t+"`"),t})).join(".")},e.prototype.toString=function(){return this.canonicalString()},e.prototype.isKeyField=function(){return 1===this.length&&"__name__"===this.get(0)},e.keyField=function(){return new e(["__name__"])},e.fromServerFormat=function(t){for(var n=[],r="",i=0,o=function(){if(0===r.length)throw new T(w.INVALID_ARGUMENT,"Invalid field path ("+t+"). Paths must not be empty, begin with '.', end with '.', or contain '..'");n.push(r),r=""},a=!1;i<t.length;){var s=t[i];if("\\"===s){if(i+1===t.length)throw new T(w.INVALID_ARGUMENT,"Path has trailing escape character: "+t);var u=t[i+1];if("\\"!==u&&"."!==u&&"`"!==u)throw new T(w.INVALID_ARGUMENT,"Path has invalid escape sequence: "+t);r+=u,i+=2}else"`"===s?(a=!a,i++):"."!==s||a?(r+=s,i++):(o(),i++)}if(o(),a)throw new T(w.INVALID_ARGUMENT,"Unterminated ` in path: "+t);return new e(n)},e.EMPTY_PATH=new e([]),e}(st),lt=function(){function t(e){this.path=e,g(t.isDocumentKey(e),"Invalid DocumentKey with an odd number of segments: "+e.toArray().join("/"))}return t.prototype.hasCollectionId=function(t){return this.path.length>=2&&this.path.get(this.path.length-2)===t},t.prototype.isEqual=function(t){return null!==t&&0===ut.comparator(this.path,t.path)},t.prototype.toString=function(){return this.path.toString()},t.comparator=function(t,e){return ut.comparator(t.path,e.path)},t.isDocumentKey=function(t){return t.length%2==0},t.fromSegments=function(e){return new t(new ut(e.slice()))},t.fromPathString=function(e){return new t(ut.fromString(e))},t.EMPTY=new t(new ut([])),t}(),ft=function(){var t=this;this.promise=new Promise((function(e,n){t.resolve=e,t.reject=n}))};!function(t){t.All="all",t.ListenStreamIdle="listen_stream_idle",t.ListenStreamConnectionBackoff="listen_stream_connection_backoff",t.WriteStreamIdle="write_stream_idle",t.WriteStreamConnectionBackoff="write_stream_connection_backoff",t.OnlineStateTimeout="online_state_timeout",t.ClientMetadataRefresh="client_metadata_refresh",t.LruGarbageCollection="lru_garbage_collection",t.RetryTransaction="retry_transaction"}(et||(et={}));var pt=function(){function t(t,e,n,r,i){this.asyncQueue=t,this.timerId=e,this.targetTimeMs=n,this.op=r,this.removalCallback=i,this.deferred=new ft,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.catch=this.deferred.promise.catch.bind(this.deferred.promise),this.deferred.promise.catch((function(t){}))}return t.createAndSchedule=function(e,n,r,i,o){var a=new t(e,n,Date.now()+r,i,o);return a.start(r),a},t.prototype.start=function(t){var e=this;this.timerHandle=setTimeout((function(){return e.handleDelayElapsed()}),t)},t.prototype.skipDelay=function(){return this.handleDelayElapsed()},t.prototype.cancel=function(t){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new T(w.CANCELLED,"Operation cancelled"+(t?": "+t:""))))},t.prototype.handleDelayElapsed=function(){var t=this;this.asyncQueue.enqueueAndForget((function(){return null!==t.timerHandle?(t.clearTimeout(),t.op().then((function(e){return t.deferred.resolve(e)}))):Promise.resolve()}))},t.prototype.clearTimeout=function(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)},t}(),dt=function(){function t(){this.tail=Promise.resolve(),this._isShuttingDown=!1,this.delayedOperations=[],this.failure=null,this.operationInProgress=!1,this.timerIdsToSkip=[]}return Object.defineProperty(t.prototype,"isShuttingDown",{get:function(){return this._isShuttingDown},enumerable:!0,configurable:!0}),t.prototype.enqueueAndForget=function(t){this.enqueue(t)},t.prototype.enqueueAndForgetEvenAfterShutdown=function(t){this.verifyNotFailed(),this.enqueueInternal(t)},t.prototype.enqueueEvenAfterShutdown=function(t){return this.verifyNotFailed(),this.enqueueInternal(t)},t.prototype.enqueueAndInitiateShutdown=function(t){return Object(i.b)(this,void 0,void 0,(function(){return Object(i.d)(this,(function(e){switch(e.label){case 0:return this.verifyNotFailed(),this._isShuttingDown?[3,2]:(this._isShuttingDown=!0,[4,this.enqueueEvenAfterShutdown(t)]);case 1:e.sent(),e.label=2;case 2:return[2]}}))}))},t.prototype.enqueue=function(t){return this.verifyNotFailed(),this._isShuttingDown?new Promise((function(t){})):this.enqueueInternal(t)},t.prototype.enqueueInternal=function(t){var e=this,n=this.tail.then((function(){return e.operationInProgress=!0,t().catch((function(t){e.failure=t,e.operationInProgress=!1;var n=t.stack||t.message||"";throw d("INTERNAL UNHANDLED ERROR: ",n),n.indexOf("Firestore Test Simulated Error")<0&&setTimeout((function(){throw t}),0),t})).then((function(t){return e.operationInProgress=!1,t}))}));return this.tail=n,n},t.prototype.enqueueAfterDelay=function(t,e,n){var r=this;this.verifyNotFailed(),g(e>=0,"Attempted to schedule an operation with a negative delay of "+e),this.timerIdsToSkip.indexOf(t)>-1&&(e=0);var i=pt.createAndSchedule(this,t,e,n,(function(t){return r.removeDelayedOperation(t)}));return this.delayedOperations.push(i),i},t.prototype.verifyNotFailed=function(){this.failure&&y("AsyncQueue is already failed: "+(this.failure.stack||this.failure.message))},t.prototype.verifyOperationInProgress=function(){g(this.operationInProgress,"verifyOpInProgress() called when no op in progress on this queue.")},t.prototype.drain=function(){return this.enqueueEvenAfterShutdown((function(){return Promise.resolve()}))},t.prototype.containsDelayedOperation=function(t){for(var e=0,n=this.delayedOperations;e<n.length;e++){if(n[e].timerId===t)return!0}return!1},t.prototype.runDelayedOperationsEarly=function(t){var e=this;return this.drain().then((function(){g(t===et.All||e.containsDelayedOperation(t),"Attempted to drain to missing operation "+t),e.delayedOperations.sort((function(t,e){return t.targetTimeMs-e.targetTimeMs}));for(var n=0,r=e.delayedOperations;n<r.length;n++){var i=r[n];if(i.skipDelay(),t!==et.All&&i.timerId===t)break}return e.drain()}))},t.prototype.skipDelaysForTimerId=function(t){this.timerIdsToSkip.push(t)},t.prototype.removeDelayedOperation=function(t){var e=this.delayedOperations.indexOf(t);g(e>=0,"Delayed operation not found."),this.delayedOperations.splice(e,1)},t}();function mt(t){for(var e="",n=0;n<t.length;n++)e.length>0&&(e=gt(e)),e=yt(t.get(n),e);return gt(e)}function yt(t,e){for(var n=e,r=t.length,i=0;i<r;i++){var o=t.charAt(i);switch(o){case"\0":n+="";break;case"":n+="";break;default:n+=o}}return n}function gt(t){return t+""}function vt(t){var e=t.length;if(g(e>=2,"Invalid path "+t),2===e)return g(""===t.charAt(0)&&""===t.charAt(1),"Non-empty path "+t+" had length 2"),ut.EMPTY_PATH;for(var n=e-2,r=[],i="",o=0;o<e;){var a=t.indexOf("",o);switch((a<0||a>n)&&y('Invalid encoded resource path: "'+t+'"'),t.charAt(a+1)){case"":var s=t.substring(o,a),u=void 0;0===i.length?u=s:(u=i+=s,i=""),r.push(u);break;case"":i+=t.substring(o,a),i+="\0";break;case"":i+=t.substring(o,a+1);break;default:y('Invalid encoded resource path: "'+t+'"')}o=a+2}return new ut(r)}
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var bt=function(){function t(t,e){if(this.seconds=t,this.nanoseconds=e,e<0)throw new T(w.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(e>=1e9)throw new T(w.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(t<-62135596800)throw new T(w.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t);if(t>=253402300800)throw new T(w.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t)}return t.now=function(){return t.fromMillis(Date.now())},t.fromDate=function(e){return t.fromMillis(e.getTime())},t.fromMillis=function(e){var n=Math.floor(e/1e3);return new t(n,1e6*(e-1e3*n))},t.prototype.toDate=function(){return new Date(this.toMillis())},t.prototype.toMillis=function(){return 1e3*this.seconds+this.nanoseconds/1e6},t.prototype._compareTo=function(t){return this.seconds===t.seconds?X(this.nanoseconds,t.nanoseconds):X(this.seconds,t.seconds)},t.prototype.isEqual=function(t){return t.seconds===this.seconds&&t.nanoseconds===this.nanoseconds},t.prototype.toString=function(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"},t}(),wt=function(){function t(t){this.timestamp=t}return t.fromMicroseconds=function(e){var n=Math.floor(e/1e6);return new t(new bt(n,e%1e6*1e3))},t.fromTimestamp=function(e){return new t(e)},t.forDeletedDoc=function(){return t.MIN},t.prototype.compareTo=function(t){return this.timestamp._compareTo(t.timestamp)},t.prototype.isEqual=function(t){return this.timestamp.isEqual(t.timestamp)},t.prototype.toMicroseconds=function(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3},t.prototype.toString=function(){return"SnapshotVersion("+this.timestamp.toString()+")"},t.prototype.toTimestamp=function(){return this.timestamp},t.MIN=new t(new bt(0,0)),t}(),Tt=function(){function t(t,e){this.comparator=t,this.root=e||Et.EMPTY}return t.prototype.insert=function(e,n){return new t(this.comparator,this.root.insert(e,n,this.comparator).copy(null,null,Et.BLACK,null,null))},t.prototype.remove=function(e){return new t(this.comparator,this.root.remove(e,this.comparator).copy(null,null,Et.BLACK,null,null))},t.prototype.get=function(t){for(var e=this.root;!e.isEmpty();){var n=this.comparator(t,e.key);if(0===n)return e.value;n<0?e=e.left:n>0&&(e=e.right)}return null},t.prototype.indexOf=function(t){for(var e=0,n=this.root;!n.isEmpty();){var r=this.comparator(t,n.key);if(0===r)return e+n.left.size;r<0?n=n.left:(e+=n.left.size+1,n=n.right)}return-1},t.prototype.isEmpty=function(){return this.root.isEmpty()},Object.defineProperty(t.prototype,"size",{get:function(){return this.root.size},enumerable:!0,configurable:!0}),t.prototype.minKey=function(){return this.root.minKey()},t.prototype.maxKey=function(){return this.root.maxKey()},t.prototype.inorderTraversal=function(t){return this.root.inorderTraversal(t)},t.prototype.forEach=function(t){this.inorderTraversal((function(e,n){return t(e,n),!1}))},t.prototype.toString=function(){var t=[];return this.inorderTraversal((function(e,n){return t.push(e+":"+n),!1})),"{"+t.join(", ")+"}"},t.prototype.reverseTraversal=function(t){return this.root.reverseTraversal(t)},t.prototype.getIterator=function(){return new _t(this.root,null,this.comparator,!1)},t.prototype.getIteratorFrom=function(t){return new _t(this.root,t,this.comparator,!1)},t.prototype.getReverseIterator=function(){return new _t(this.root,null,this.comparator,!0)},t.prototype.getReverseIteratorFrom=function(t){return new _t(this.root,t,this.comparator,!0)},t}(),_t=function(){function t(t,e,n,r){this.isReverse=r,this.nodeStack=[];for(var i=1;!t.isEmpty();)if(i=e?n(t.key,e):1,r&&(i*=-1),i<0)t=this.isReverse?t.left:t.right;else{if(0===i){this.nodeStack.push(t);break}this.nodeStack.push(t),t=this.isReverse?t.right:t.left}}return t.prototype.getNext=function(){g(this.nodeStack.length>0,"getNext() called on iterator when hasNext() is false.");var t=this.nodeStack.pop(),e={key:t.key,value:t.value};if(this.isReverse)for(t=t.left;!t.isEmpty();)this.nodeStack.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack.push(t),t=t.left;return e},t.prototype.hasNext=function(){return this.nodeStack.length>0},t.prototype.peek=function(){if(0===this.nodeStack.length)return null;var t=this.nodeStack[this.nodeStack.length-1];return{key:t.key,value:t.value}},t}(),Et=function(){function t(e,n,r,i,o){this.key=e,this.value=n,this.color=null!=r?r:t.RED,this.left=null!=i?i:t.EMPTY,this.right=null!=o?o:t.EMPTY,this.size=this.left.size+1+this.right.size}return t.prototype.copy=function(e,n,r,i,o){return new t(null!=e?e:this.key,null!=n?n:this.value,null!=r?r:this.color,null!=i?i:this.left,null!=o?o:this.right)},t.prototype.isEmpty=function(){return!1},t.prototype.inorderTraversal=function(t){return this.left.inorderTraversal(t)||t(this.key,this.value)||this.right.inorderTraversal(t)},t.prototype.reverseTraversal=function(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)},t.prototype.min=function(){return this.left.isEmpty()?this:this.left.min()},t.prototype.minKey=function(){return this.min().key},t.prototype.maxKey=function(){return this.right.isEmpty()?this.key:this.right.maxKey()},t.prototype.insert=function(t,e,n){var r=this,i=n(t,r.key);return(r=i<0?r.copy(null,null,null,r.left.insert(t,e,n),null):0===i?r.copy(null,e,null,null,null):r.copy(null,null,null,null,r.right.insert(t,e,n))).fixUp()},t.prototype.removeMin=function(){if(this.left.isEmpty())return t.EMPTY;var e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),(e=e.copy(null,null,null,e.left.removeMin(),null)).fixUp()},t.prototype.remove=function(e,n){var r,i=this;if(n(e,i.key)<0)i.left.isEmpty()||i.left.isRed()||i.left.left.isRed()||(i=i.moveRedLeft()),i=i.copy(null,null,null,i.left.remove(e,n),null);else{if(i.left.isRed()&&(i=i.rotateRight()),i.right.isEmpty()||i.right.isRed()||i.right.left.isRed()||(i=i.moveRedRight()),0===n(e,i.key)){if(i.right.isEmpty())return t.EMPTY;r=i.right.min(),i=i.copy(r.key,r.value,null,null,i.right.removeMin())}i=i.copy(null,null,null,null,i.right.remove(e,n))}return i.fixUp()},t.prototype.isRed=function(){return this.color},t.prototype.fixUp=function(){var t=this;return t.right.isRed()&&!t.left.isRed()&&(t=t.rotateLeft()),t.left.isRed()&&t.left.left.isRed()&&(t=t.rotateRight()),t.left.isRed()&&t.right.isRed()&&(t=t.colorFlip()),t},t.prototype.moveRedLeft=function(){var t=this.colorFlip();return t.right.left.isRed()&&(t=(t=(t=t.copy(null,null,null,null,t.right.rotateRight())).rotateLeft()).colorFlip()),t},t.prototype.moveRedRight=function(){var t=this.colorFlip();return t.left.left.isRed()&&(t=(t=t.rotateRight()).colorFlip()),t},t.prototype.rotateLeft=function(){var e=this.copy(null,null,t.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)},t.prototype.rotateRight=function(){var e=this.copy(null,null,t.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)},t.prototype.colorFlip=function(){var t=this.left.copy(null,null,!this.left.color,null,null),e=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,e)},t.prototype.checkMaxDepth=function(){var t=this.check();return Math.pow(2,t)<=this.size+1},t.prototype.check=function(){if(this.isRed()&&this.left.isRed())throw y("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed())throw y("Right child of ("+this.key+","+this.value+") is red");var t=this.left.check();if(t!==this.right.check())throw y("Black depths differ");return t+(this.isRed()?0:1)},t.EMPTY=null,t.RED=!0,t.BLACK=!1,t}(),St=function(){function t(){this.size=0}return Object.defineProperty(t.prototype,"key",{get:function(){throw y("LLRBEmptyNode has no key.")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"value",{get:function(){throw y("LLRBEmptyNode has no value.")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"color",{get:function(){throw y("LLRBEmptyNode has no color.")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"left",{get:function(){throw y("LLRBEmptyNode has no left child.")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"right",{get:function(){throw y("LLRBEmptyNode has no right child.")},enumerable:!0,configurable:!0}),t.prototype.copy=function(t,e,n,r,i){return this},t.prototype.insert=function(t,e,n){return new Et(t,e)},t.prototype.remove=function(t,e){return this},t.prototype.isEmpty=function(){return!0},t.prototype.inorderTraversal=function(t){return!1},t.prototype.reverseTraversal=function(t){return!1},t.prototype.minKey=function(){return null},t.prototype.maxKey=function(){return null},t.prototype.isRed=function(){return!1},t.prototype.checkMaxDepth=function(){return!0},t.prototype.check=function(){return 0},t}();
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */Et.EMPTY=new St;
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var It=function(){function t(t){this.comparator=t,this.data=new Tt(this.comparator)}return t.fromMapKeys=function(e){var n=new t(e.comparator);return e.forEach((function(t){n=n.add(t)})),n},t.prototype.has=function(t){return null!==this.data.get(t)},t.prototype.first=function(){return this.data.minKey()},t.prototype.last=function(){return this.data.maxKey()},Object.defineProperty(t.prototype,"size",{get:function(){return this.data.size},enumerable:!0,configurable:!0}),t.prototype.indexOf=function(t){return this.data.indexOf(t)},t.prototype.forEach=function(t){this.data.inorderTraversal((function(e,n){return t(e),!1}))},t.prototype.forEachInRange=function(t,e){for(var n=this.data.getIteratorFrom(t[0]);n.hasNext();){var r=n.getNext();if(this.comparator(r.key,t[1])>=0)return;e(r.key)}},t.prototype.forEachWhile=function(t,e){var n;for(n=void 0!==e?this.data.getIteratorFrom(e):this.data.getIterator();n.hasNext();){if(!t(n.getNext().key))return}},t.prototype.firstAfterOrEqual=function(t){var e=this.data.getIteratorFrom(t);return e.hasNext()?e.getNext().key:null},t.prototype.getIterator=function(){return new Ct(this.data.getIterator())},t.prototype.getIteratorFrom=function(t){return new Ct(this.data.getIteratorFrom(t))},t.prototype.add=function(t){return this.copy(this.data.remove(t).insert(t,!0))},t.prototype.delete=function(t){return this.has(t)?this.copy(this.data.remove(t)):this},t.prototype.isEmpty=function(){return this.data.isEmpty()},t.prototype.unionWith=function(t){var e=this;return t.forEach((function(t){e=e.add(t)})),e},t.prototype.isEqual=function(e){if(!(e instanceof t))return!1;if(this.size!==e.size)return!1;for(var n=this.data.getIterator(),r=e.data.getIterator();n.hasNext();){var i=n.getNext().key,o=r.getNext().key;if(0!==this.comparator(i,o))return!1}return!0},t.prototype.toArray=function(){var t=[];return this.forEach((function(e){t.push(e)})),t},t.prototype.toString=function(){var t=[];return this.forEach((function(e){return t.push(e)})),"SortedSet("+t.toString()+")"},t.prototype.copy=function(e){var n=new t(this.comparator);return n.data=e,n},t}(),Ct=function(){function t(t){this.iter=t}return t.prototype.getNext=function(){return this.iter.getNext().key},t.prototype.hasNext=function(){return this.iter.hasNext()},t}(),Nt=new Tt(lt.comparator);function Dt(){return Nt}function At(){return Dt()}var Ot=new Tt(lt.comparator);function kt(){return Ot}var Rt=new Tt(lt.comparator);function Pt(){return Rt}var Mt=new It(lt.comparator);function Lt(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var n=Mt,r=0,i=t;r<i.length;r++){var o=i[r];n=n.add(o)}return n}var xt=new It(X);function Ft(){return xt}
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var jt=function(){function t(t,e,n,r){this.batchId=t,this.localWriteTime=e,this.baseMutations=n,this.mutations=r,g(r.length>0,"Cannot create an empty mutation batch")}return t.prototype.applyToRemoteDocument=function(t,e,n){e&&g(e.key.isEqual(t),"applyToRemoteDocument: key "+t+" should match maybeDoc key\n        "+e.key);var r=n.mutationResults;g(r.length===this.mutations.length,"Mismatch between mutations length\n      ("+this.mutations.length+") and mutation results length\n      ("+r.length+").");for(var i=0;i<this.mutations.length;i++){var o=this.mutations[i];if(o.key.isEqual(t)){var a=r[i];e=o.applyToRemoteDocument(e,a)}}return e},t.prototype.applyToLocalView=function(t,e){e&&g(e.key.isEqual(t),"applyToLocalDocument: key "+t+" should match maybeDoc key\n        "+e.key);for(var n=0,r=this.baseMutations;n<r.length;n++){(s=r[n]).key.isEqual(t)&&(e=s.applyToLocalView(e,e,this.localWriteTime))}for(var i=e,o=0,a=this.mutations;o<a.length;o++){var s;(s=a[o]).key.isEqual(t)&&(e=s.applyToLocalView(e,i,this.localWriteTime))}return e},t.prototype.applyToLocalDocumentSet=function(t){var e=this,n=t;return this.mutations.forEach((function(r){var i=e.applyToLocalView(r.key,t.get(r.key));i&&(n=n.insert(r.key,i))})),n},t.prototype.keys=function(){return this.mutations.reduce((function(t,e){return t.add(e.key)}),Lt())},t.prototype.isEqual=function(t){return this.batchId===t.batchId&&J(this.mutations,t.mutations)&&J(this.baseMutations,t.baseMutations)},t}(),Ut=function(){function t(t,e,n,r,i){this.batch=t,this.commitVersion=e,this.mutationResults=n,this.streamToken=r,this.docVersions=i}return t.from=function(e,n,r,i){g(e.mutations.length===r.length,"Mutations sent "+e.mutations.length+" must equal results received "+r.length);for(var o=Pt(),a=e.mutations,s=0;s<a.length;s++)o=o.insert(a[s].key,r[s].version);return new t(e,n,r,i,o)},t}(),qt=function(){function t(t){var e=this;this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,t((function(t){e.isDone=!0,e.result=t,e.nextCallback&&e.nextCallback(t)}),(function(t){e.isDone=!0,e.error=t,e.catchCallback&&e.catchCallback(t)}))}return t.prototype.catch=function(t){return this.next(void 0,t)},t.prototype.next=function(e,n){var r=this;return this.callbackAttached&&y("Called next() or catch() twice for PersistencePromise"),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(n,this.error):this.wrapSuccess(e,this.result):new t((function(t,i){r.nextCallback=function(n){r.wrapSuccess(e,n).next(t,i)},r.catchCallback=function(e){r.wrapFailure(n,e).next(t,i)}}))},t.prototype.toPromise=function(){var t=this;return new Promise((function(e,n){t.next(e,n)}))},t.prototype.wrapUserFunction=function(e){try{var n=e();return n instanceof t?n:t.resolve(n)}catch(e){return t.reject(e)}},t.prototype.wrapSuccess=function(e,n){return e?this.wrapUserFunction((function(){return e(n)})):t.resolve(n)},t.prototype.wrapFailure=function(e,n){return e?this.wrapUserFunction((function(){return e(n)})):t.reject(n)},t.resolve=function(e){return new t((function(t,n){t(e)}))},t.reject=function(e){return new t((function(t,n){n(e)}))},t.waitFor=function(e){return new t((function(t,n){var r=0,i=0,o=!1;e.forEach((function(e){++r,e.next((function(){++i,o&&i===r&&t()}),(function(t){return n(t)}))})),o=!0,i===r&&t()}))},t.or=function(e){for(var n=t.resolve(!1),r=function(e){n=n.next((function(n){return n?t.resolve(n):e()}))},i=0,o=e;i<o.length;i++){r(o[i])}return n},t.forEach=function(t,e){var n=this,r=[];return t.forEach((function(t,i){r.push(e.call(n,t,i))})),this.waitFor(r)},t}(),Vt="SimpleDb",Bt=function(){function e(t){this.db=t,12.2===e.getIOSVersion(Object(a.o)())&&d("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}return e.openOrCreate=function(t,n,r){return g(e.isAvailable(),"IndexedDB not supported in current environment."),p(Vt,"Opening database:",t),new qt((function(i,o){var a=window.indexedDB.open(t,n);a.onsuccess=function(t){var n=t.target.result;i(new e(n))},a.onblocked=function(){o(new T(w.FAILED_PRECONDITION,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},a.onerror=function(t){var e=t.target.error;"VersionError"===e.name?o(new T(w.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):o(e)},a.onupgradeneeded=function(e){p(Vt,'Database "'+t+'" requires upgrade from version:',e.oldVersion);var n=e.target.result;r.createOrUpgrade(n,a.transaction,e.oldVersion,Xe).next((function(){p(Vt,"Database upgrade to version "+Xe+" complete")}))}})).toPromise()},e.delete=function(t){return p(Vt,"Removing database:",t),Gt(window.indexedDB.deleteDatabase(t)).toPromise()},e.isAvailable=function(){if("undefined"==typeof window||null==window.indexedDB)return!1;if(e.isMockPersistence())return!0;if(void 0===window.navigator)return!1;var t=Object(a.o)(),n=e.getIOSVersion(t),r=0<n&&n<10,i=e.getAndroidVersion(t),o=0<i&&i<4.5;return!(t.indexOf("MSIE ")>0||t.indexOf("Trident/")>0||t.indexOf("Edge/")>0||r||o)},e.isMockPersistence=function(){var e;return void 0!==t&&"YES"===(null===(e=t.env)||void 0===e?void 0:e.USE_MOCK_PERSISTENCE)},e.getStore=function(t,e){return t.store(e)},e.getIOSVersion=function(t){var e=t.match(/i(?:phone|pad|pod) os ([\d_]+)/i),n=e?e[1].split("_").slice(0,2).join("."):"-1";return Number(n)},e.getAndroidVersion=function(t){var e=t.match(/Android ([\d.]+)/i),n=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(n)},e.prototype.setVersionChangeListener=function(t){this.db.onversionchange=function(e){return t(e)}},e.prototype.runTransaction=function(t,e,n){return Object(i.b)(this,void 0,void 0,(function(){var r,o,a,s,u,c;return Object(i.d)(this,(function(h){switch(h.label){case 0:r=t.startsWith("readonly"),o=t.endsWith("idempotent"),a=0,s=function(){var t,s,c,h;return Object(i.d)(this,(function(i){switch(i.label){case 0:++a,t=Kt.open(u.db,r?"readonly":"readwrite",e),i.label=1;case 1:return i.trys.push([1,3,,4]),(s=n(t).catch((function(e){return t.abort(e),qt.reject(e)})).toPromise()).catch((function(){})),[4,t.completionPromise];case 2:return i.sent(),[2,{value:s}];case 3:return c=i.sent(),h=o&&"FirebaseError"!==c.name&&a<3,p(Vt,"Transaction failed with error: %s. Retrying: %s.",c.message,h),h?[3,4]:[2,{value:Promise.reject(c)}];case 4:return[2]}}))},u=this,h.label=1;case 1:return[5,s()];case 2:return"object"==typeof(c=h.sent())?[2,c.value]:[3,1];case 3:return[2]}}))}))},e.prototype.close=function(){this.db.close()},e}(),Wt=function(){function t(t){this.dbCursor=t,this.shouldStop=!1,this.nextKey=null}return Object.defineProperty(t.prototype,"isDone",{get:function(){return this.shouldStop},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"skipToKey",{get:function(){return this.nextKey},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"cursor",{set:function(t){this.dbCursor=t},enumerable:!0,configurable:!0}),t.prototype.done=function(){this.shouldStop=!0},t.prototype.skip=function(t){this.nextKey=t},t.prototype.delete=function(){return Gt(this.dbCursor.delete())},t}(),Kt=function(){function t(t){var e=this;this.transaction=t,this.aborted=!1,this.completionDeferred=new ft,this.transaction.oncomplete=function(){e.completionDeferred.resolve()},this.transaction.onabort=function(){t.error?e.completionDeferred.reject(t.error):e.completionDeferred.resolve()},this.transaction.onerror=function(t){var n=zt(t.target.error);e.completionDeferred.reject(n)}}return t.open=function(e,n,r){return new t(e.transaction(r,n))},Object.defineProperty(t.prototype,"completionPromise",{get:function(){return this.completionDeferred.promise},enumerable:!0,configurable:!0}),t.prototype.abort=function(t){t&&this.completionDeferred.reject(t),this.aborted||(p(Vt,"Aborting transaction:",t?t.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())},t.prototype.store=function(t){var e=this.transaction.objectStore(t);return g(!!e,"Object store not part of transaction: "+t),new Qt(e)},t}(),Qt=function(){function t(t){this.store=t}return t.prototype.put=function(t,e){var n;return void 0!==e?(p(Vt,"PUT",this.store.name,t,e),n=this.store.put(e,t)):(p(Vt,"PUT",this.store.name,"<auto-key>",t),n=this.store.put(t)),Gt(n)},t.prototype.add=function(t){return p(Vt,"ADD",this.store.name,t,t),Gt(this.store.add(t))},t.prototype.get=function(t){var e=this;return Gt(this.store.get(t)).next((function(n){return void 0===n&&(n=null),p(Vt,"GET",e.store.name,t,n),n}))},t.prototype.delete=function(t){return p(Vt,"DELETE",this.store.name,t),Gt(this.store.delete(t))},t.prototype.count=function(){return p(Vt,"COUNT",this.store.name),Gt(this.store.count())},t.prototype.loadAll=function(t,e){var n=this.cursor(this.options(t,e)),r=[];return this.iterateCursor(n,(function(t,e){r.push(e)})).next((function(){return r}))},t.prototype.deleteAll=function(t,e){p(Vt,"DELETE ALL",this.store.name);var n=this.options(t,e);n.keysOnly=!1;var r=this.cursor(n);return this.iterateCursor(r,(function(t,e,n){return n.delete()}))},t.prototype.iterate=function(t,e){var n;e?n=t:(n={},e=t);var r=this.cursor(n);return this.iterateCursor(r,e)},t.prototype.iterateSerial=function(t){var e=this.cursor({});return new qt((function(n,r){e.onerror=function(t){var e=zt(t.target.error);r(e)},e.onsuccess=function(e){var r=e.target.result;r?t(r.primaryKey,r.value).next((function(t){t?r.continue():n()})):n()}}))},t.prototype.iterateCursor=function(t,e){var n=[];return new qt((function(r,i){t.onerror=function(t){i(t.target.error)},t.onsuccess=function(t){var i=t.target.result;if(i){var o=new Wt(i),a=e(i.primaryKey,i.value,o);if(a instanceof qt){var s=a.catch((function(t){return o.done(),qt.reject(t)}));n.push(s)}o.isDone?r():null===o.skipToKey?i.continue():i.continue(o.skipToKey)}else r()}})).next((function(){return qt.waitFor(n)}))},t.prototype.options=function(t,e){var n=void 0;return void 0!==t&&("string"==typeof t?n=t:(g(void 0===e,"3rd argument must not be defined if 2nd is a range."),e=t)),{index:n,range:e}},t.prototype.cursor=function(t){var e="next";if(t.reverse&&(e="prev"),t.index){var n=this.store.index(t.index);return t.keysOnly?n.openKeyCursor(t.range,e):n.openCursor(t.range,e)}return this.store.openCursor(t.range,e)},t}();function Gt(t){return new qt((function(e,n){t.onsuccess=function(t){var n=t.target.result;e(n)},t.onerror=function(t){var e=zt(t.target.error);n(e)}}))}var Ht=!1;function zt(t){var e=Bt.getIOSVersion(Object(a.o)());if(e>=12.2&&e<13){var n="An internal error was encountered in the Indexed Database server";if(t.message.indexOf(n)>=0){var r=new T("internal","IOS_INDEXEDDB_BUG1: IndexedDb has thrown '"+n+"'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.");return Ht||(Ht=!0,setTimeout((function(){throw r}),0)),r}}return t}
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Yt=function(){function t(t,e,n,r){this.userId=t,this.serializer=e,this.indexManager=n,this.referenceDelegate=r,this.documentKeysByBatchId={}}return t.forUser=function(e,n,r,i){return g(""!==e.uid,"UserID must not be an empty string."),new t(e.isAuthenticated()?e.uid:"",n,r,i)},t.prototype.checkEmpty=function(t){var e=!0,n=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return Zt(t).iterate({index:en.userMutationsIndex,range:n},(function(t,n,r){e=!1,r.done()})).next((function(){return e}))},t.prototype.acknowledgeBatch=function(t,e,n){return this.getMutationQueueMetadata(t).next((function(e){return e.lastStreamToken=$t(n),ee(t).put(e)}))},t.prototype.getLastStreamToken=function(t){return this.getMutationQueueMetadata(t).next((function(t){return t.lastStreamToken}))},t.prototype.setLastStreamToken=function(t,e){return this.getMutationQueueMetadata(t).next((function(n){return n.lastStreamToken=$t(e),ee(t).put(n)}))},t.prototype.addMutationBatch=function(t,e,n,r){var i=this,o=te(t),a=Zt(t);return a.add({}).next((function(s){g("number"==typeof s,"Auto-generated key is not a number");for(var u=new jt(s,e,n,r),c=i.serializer.toDbMutationBatch(i.userId,u),h=[],l=new It((function(t,e){return X(t.canonicalString(),e.canonicalString())})),f=0,p=r;f<p.length;f++){var d=p[f],m=nn.key(i.userId,d.key.path,s);l=l.add(d.key.path.popLast()),h.push(a.put(c)),h.push(o.put(m,nn.PLACEHOLDER))}return l.forEach((function(e){h.push(i.indexManager.addToCollectionParentIndex(t,e))})),t.addOnCommittedListener((function(){i.documentKeysByBatchId[s]=u.keys()})),qt.waitFor(h).next((function(){return u}))}))},t.prototype.lookupMutationBatch=function(t,e){var n=this;return Zt(t).get(e).next((function(t){return t?(g(t.userId===n.userId,"Unexpected user '"+t.userId+"' for mutation batch "+e),n.serializer.fromDbMutationBatch(t)):null}))},t.prototype.lookupMutationKeys=function(t,e){var n=this;return this.documentKeysByBatchId[e]?qt.resolve(this.documentKeysByBatchId[e]):this.lookupMutationBatch(t,e).next((function(t){if(t){var r=t.keys();return n.documentKeysByBatchId[e]=r,r}return null}))},t.prototype.getNextMutationBatchAfterBatchId=function(t,e){var n=this,r=e+1,i=IDBKeyRange.lowerBound([this.userId,r]),o=null;return Zt(t).iterate({index:en.userMutationsIndex,range:i},(function(t,e,i){e.userId===n.userId&&(g(e.batchId>=r,"Should have found mutation after "+r),o=n.serializer.fromDbMutationBatch(e)),i.done()})).next((function(){return o}))},t.prototype.getHighestUnacknowledgedBatchId=function(t){var e=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]),n=-1;return Zt(t).iterate({index:en.userMutationsIndex,range:e,reverse:!0},(function(t,e,r){n=e.batchId,r.done()})).next((function(){return n}))},t.prototype.getAllMutationBatches=function(t){var e=this,n=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return Zt(t).loadAll(en.userMutationsIndex,n).next((function(t){return t.map((function(t){return e.serializer.fromDbMutationBatch(t)}))}))},t.prototype.getAllMutationBatchesAffectingDocumentKey=function(t,e){var n=this,r=nn.prefixForPath(this.userId,e.path),i=IDBKeyRange.lowerBound(r),o=[];return te(t).iterate({range:i},(function(r,i,a){var s=r[0],u=r[1],c=r[2],h=vt(u);if(s===n.userId&&e.path.isEqual(h))return Zt(t).get(c).next((function(t){if(!t)throw y("Dangling document-mutation reference found: "+r+" which points to "+c);g(t.userId===n.userId,"Unexpected user '"+t.userId+"' for mutation batch "+c),o.push(n.serializer.fromDbMutationBatch(t))}));a.done()})).next((function(){return o}))},t.prototype.getAllMutationBatchesAffectingDocumentKeys=function(t,e){var n=this,r=new It(X),i=[];return e.forEach((function(e){var o=nn.prefixForPath(n.userId,e.path),a=IDBKeyRange.lowerBound(o),s=te(t).iterate({range:a},(function(t,i,o){var a=t[0],s=t[1],u=t[2],c=vt(s);a===n.userId&&e.path.isEqual(c)?r=r.add(u):o.done()}));i.push(s)})),qt.waitFor(i).next((function(){return n.lookupMutationBatches(t,r)}))},t.prototype.getAllMutationBatchesAffectingQuery=function(t,e){var n=this;g(!e.isDocumentQuery(),"Document queries shouldn't go down this path"),g(!e.isCollectionGroupQuery(),"CollectionGroup queries should be handled in LocalDocumentsView");var r=e.path,i=r.length+1,o=nn.prefixForPath(this.userId,r),a=IDBKeyRange.lowerBound(o),s=new It(X);return te(t).iterate({range:a},(function(t,e,o){var a=t[0],u=t[1],c=t[2],h=vt(u);a===n.userId&&r.isPrefixOf(h)?h.length===i&&(s=s.add(c)):o.done()})).next((function(){return n.lookupMutationBatches(t,s)}))},t.prototype.lookupMutationBatches=function(t,e){var n=this,r=[],i=[];return e.forEach((function(e){i.push(Zt(t).get(e).next((function(t){if(null===t)throw y("Dangling document-mutation reference found, which points to "+e);g(t.userId===n.userId,"Unexpected user '"+t.userId+"' for mutation batch "+e),r.push(n.serializer.fromDbMutationBatch(t))})))})),qt.waitFor(i).next((function(){return r}))},t.prototype.removeMutationBatch=function(t,e){var n=this;return Jt(t.simpleDbTransaction,this.userId,e).next((function(r){return t.addOnCommittedListener((function(){n.removeCachedMutationKeys(e.batchId)})),qt.forEach(r,(function(e){return n.referenceDelegate.removeMutationReference(t,e)}))}))},t.prototype.removeCachedMutationKeys=function(t){delete this.documentKeysByBatchId[t]},t.prototype.performConsistencyCheck=function(t){var e=this;return this.checkEmpty(t).next((function(n){if(!n)return qt.resolve();var r=IDBKeyRange.lowerBound(nn.prefixForUser(e.userId)),i=[];return te(t).iterate({range:r},(function(t,n,r){if(t[0]===e.userId){var o=vt(t[1]);i.push(o)}else r.done()})).next((function(){g(0===i.length,"Document leak -- detected dangling mutation references when queue is empty. Dangling keys: "+i.map((function(t){return t.canonicalString()})))}))}))},t.prototype.containsKey=function(t,e){return Xt(t,this.userId,e)},t.prototype.getMutationQueueMetadata=function(t){var e=this;return ee(t).get(this.userId).next((function(t){return t||new tn(e.userId,-1,"")}))},t}();function Xt(t,e,n){var r=nn.prefixForPath(e,n.path),i=r[1],o=IDBKeyRange.lowerBound(r),a=!1;return te(t).iterate({range:o,keysOnly:!0},(function(t,n,r){var o=t[0],s=t[1];t[2];o===e&&s===i&&(a=!0),r.done()})).next((function(){return a}))}function Jt(t,e,n){var r=t.store(en.store),i=t.store(nn.store),o=[],a=IDBKeyRange.only(n.batchId),s=0,u=r.iterate({range:a},(function(t,e,n){return s++,n.delete()}));o.push(u.next((function(){g(1===s,"Dangling document-mutation reference found: Missing batch "+n.batchId)})));for(var c=[],h=0,l=n.mutations;h<l.length;h++){var f=l[h],p=nn.key(e,f.key.path,n.batchId);o.push(i.delete(p)),c.push(f.key)}return qt.waitFor(o).next((function(){return c}))}function $t(t){return t instanceof Uint8Array?(g(Bt.isMockPersistence(),"Persisting non-string stream tokens is only supported with mock persistence."),t.toString()):t}function Zt(t){return Mn.getStore(t,en.store)}function te(t){return Mn.getStore(t,nn.store)}function ee(t){return Mn.getStore(t,tn.store)}
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var ne;!function(t){t[t.QueryCache=0]="QueryCache",t[t.SyncEngine=1]="SyncEngine"}(ne||(ne={}));var re=function(){function t(t,e){this.generatorId=t,g((1&t)===t,"Generator ID "+t+" contains more than 1 reserved bits"),this.seek(void 0!==e?e:this.generatorId)}return t.prototype.next=function(){var t=this.nextId;return this.nextId+=2,t},t.prototype.after=function(t){return this.seek(t+2),this.next()},t.prototype.seek=function(t){g((1&t)===this.generatorId,"Cannot supply target ID from different generator ID"),this.nextId=t},t.forTargetCache=function(){return new t(ne.QueryCache,2)},t.forSyncEngine=function(){return new t(ne.SyncEngine)},t}(),ie=function(){function t(t,e){this.referenceDelegate=t,this.serializer=e,this.targetIdGenerator=re.forTargetCache()}return t.prototype.allocateTargetId=function(t){var e=this;return this.retrieveMetadata(t).next((function(n){return n.highestTargetId=e.targetIdGenerator.after(n.highestTargetId),e.saveMetadata(t,n).next((function(){return n.highestTargetId}))}))},t.prototype.getLastRemoteSnapshotVersion=function(t){return this.retrieveMetadata(t).next((function(t){return wt.fromTimestamp(new bt(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds))}))},t.prototype.getHighestSequenceNumber=function(t){return se(t.simpleDbTransaction)},t.prototype.setTargetsMetadata=function(t,e,n){var r=this;return this.retrieveMetadata(t).next((function(i){return i.highestListenSequenceNumber=e,n&&(i.lastRemoteSnapshotVersion=n.toTimestamp()),e>i.highestListenSequenceNumber&&(i.highestListenSequenceNumber=e),r.saveMetadata(t,i)}))},t.prototype.addTargetData=function(t,e){var n=this;return this.saveTargetData(t,e).next((function(){return n.retrieveMetadata(t).next((function(r){return r.targetCount+=1,n.updateMetadataFromTargetData(e,r),n.saveMetadata(t,r)}))}))},t.prototype.updateTargetData=function(t,e){return this.saveTargetData(t,e)},t.prototype.removeTargetData=function(t,e){var n=this;return this.removeMatchingKeysForTargetId(t,e.targetId).next((function(){return oe(t).delete(e.targetId)})).next((function(){return n.retrieveMetadata(t)})).next((function(e){return g(e.targetCount>0,"Removing from an empty target cache"),e.targetCount-=1,n.saveMetadata(t,e)}))},t.prototype.removeTargets=function(t,e,n){var r=this,i=0,o=[];return oe(t).iterate((function(a,s){var u=r.serializer.fromDbTarget(s);u.sequenceNumber<=e&&null===n.get(u.targetId)&&(i++,o.push(r.removeTargetData(t,u)))})).next((function(){return qt.waitFor(o)})).next((function(){return i}))},t.prototype.forEachTarget=function(t,e){var n=this;return oe(t).iterate((function(t,r){var i=n.serializer.fromDbTarget(r);e(i)}))},t.prototype.retrieveMetadata=function(t){return ae(t.simpleDbTransaction)},t.prototype.saveMetadata=function(t,e){return(n=t,Mn.getStore(n,hn.store)).put(hn.key,e);var n},t.prototype.saveTargetData=function(t,e){return oe(t).put(this.serializer.toDbTarget(e))},t.prototype.updateMetadataFromTargetData=function(t,e){var n=!1;return t.targetId>e.highestTargetId&&(e.highestTargetId=t.targetId,n=!0),t.sequenceNumber>e.highestListenSequenceNumber&&(e.highestListenSequenceNumber=t.sequenceNumber,n=!0),n},t.prototype.getTargetCount=function(t){return this.retrieveMetadata(t).next((function(t){return t.targetCount}))},t.prototype.getTargetData=function(t,e){var n=this,r=e.canonicalId(),i=IDBKeyRange.bound([r,Number.NEGATIVE_INFINITY],[r,Number.POSITIVE_INFINITY]),o=null;return oe(t).iterate({range:i,index:un.queryTargetsIndexName},(function(t,r,i){var a=n.serializer.fromDbTarget(r);e.isEqual(a.target)&&(o=a,i.done())})).next((function(){return o}))},t.prototype.addMatchingKeys=function(t,e,n){var r=this,i=[],o=ue(t);return e.forEach((function(e){var a=mt(e.path);i.push(o.put(new cn(n,a))),i.push(r.referenceDelegate.addReference(t,e))})),qt.waitFor(i)},t.prototype.removeMatchingKeys=function(t,e,n){var r=this,i=ue(t);return qt.forEach(e,(function(e){var o=mt(e.path);return qt.waitFor([i.delete([n,o]),r.referenceDelegate.removeReference(t,e)])}))},t.prototype.removeMatchingKeysForTargetId=function(t,e){var n=ue(t),r=IDBKeyRange.bound([e],[e+1],!1,!0);return n.delete(r)},t.prototype.getMatchingKeysForTargetId=function(t,e){var n=IDBKeyRange.bound([e],[e+1],!1,!0),r=ue(t),i=Lt();return r.iterate({range:n,keysOnly:!0},(function(t,e,n){var r=vt(t[1]),o=new lt(r);i=i.add(o)})).next((function(){return i}))},t.prototype.containsKey=function(t,e){var n=mt(e.path),r=IDBKeyRange.bound([n],[$(n)],!1,!0),i=0;return ue(t).iterate({index:cn.documentTargetsIndex,keysOnly:!0,range:r},(function(t,e,n){var r=t[0];t[1];0!==r&&(i++,n.done())})).next((function(){return i>0}))},t.prototype.getTargetDataForTarget=function(t,e){var n=this;return oe(t).get(e).next((function(t){return t?n.serializer.fromDbTarget(t):null}))},t}();
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function oe(t){return Mn.getStore(t,un.store)}function ae(t){return Bt.getStore(t,hn.store).get(hn.key).next((function(t){return g(null!==t,"Missing metadata row."),t}))}function se(t){return ae(t).next((function(t){return t.highestListenSequenceNumber}))}function ue(t){return Mn.getStore(t,cn.store)}
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var ce,he=function(){function t(t){this.fields=t}return t.fromSet=function(e){return new t(e)},t.fromArray=function(e){var n=new It(ht.comparator);return e.forEach((function(t){return n=n.add(t)})),new t(n)},t.prototype.covers=function(t){var e=!1;return this.fields.forEach((function(n){n.isPrefixOf(t)&&(e=!0)})),e},t.prototype.isEqual=function(t){return this.fields.isEqual(t.fields)},t}(),le=function(){function t(t,e){this.field=t,this.transform=e}return t.prototype.isEqual=function(t){return this.field.isEqual(t.field)&&this.transform.isEqual(t.transform)},t}(),fe=function(t,e){this.version=t,this.transformResults=e};!function(t){t[t.Set=0]="Set",t[t.Patch=1]="Patch",t[t.Transform=2]="Transform",t[t.Delete=3]="Delete"}(ce||(ce={}));var pe,de,me=function(){function t(t,e){this.updateTime=t,this.exists=e,g(void 0===t||void 0===e,'Precondition can specify "exists" or "updateTime" but not both')}return t.exists=function(e){return new t(void 0,e)},t.updateTime=function(e){return new t(e)},Object.defineProperty(t.prototype,"isNone",{get:function(){return void 0===this.updateTime&&void 0===this.exists},enumerable:!0,configurable:!0}),t.prototype.isValidFor=function(t){return void 0!==this.updateTime?t instanceof je&&t.version.isEqual(this.updateTime):void 0!==this.exists?this.exists===t instanceof je:(g(this.isNone,"Precondition should be empty"),!0)},t.prototype.isEqual=function(t){return e=this.updateTime,n=t.updateTime,(null!=e?!(!n||!e.isEqual(n)):e===n)&&this.exists===t.exists;var e,n},t.NONE=new t,t}(),ye=function(){function t(){}return t.prototype.verifyKeyMatches=function(t){null!=t&&g(t.key.isEqual(this.key),"Can only apply a mutation to a document with the same key")},t.getPostMutationVersion=function(t){return t instanceof je?t.version:wt.MIN},t}(),ge=function(t){function e(e,n,r){var i=t.call(this)||this;return i.key=e,i.value=n,i.precondition=r,i.type=ce.Set,i}return Object(i.c)(e,t),e.prototype.applyToRemoteDocument=function(t,e){this.verifyKeyMatches(t),g(null==e.transformResults,"Transform results received by SetMutation.");var n=e.version;return new je(this.key,n,{hasCommittedMutations:!0},this.value)},e.prototype.applyToLocalView=function(t,e,n){if(this.verifyKeyMatches(t),!this.precondition.isValidFor(t))return t;var r=ye.getPostMutationVersion(t);return new je(this.key,r,{hasLocalMutations:!0},this.value)},e.prototype.extractBaseValue=function(t){return null},e.prototype.isEqual=function(t){return t instanceof e&&this.key.isEqual(t.key)&&this.value.isEqual(t.value)&&this.precondition.isEqual(t.precondition)},e}(ye),ve=function(t){function e(e,n,r,i){var o=t.call(this)||this;return o.key=e,o.data=n,o.fieldMask=r,o.precondition=i,o.type=ce.Patch,o}return Object(i.c)(e,t),e.prototype.applyToRemoteDocument=function(t,e){if(this.verifyKeyMatches(t),g(null==e.transformResults,"Transform results received by PatchMutation."),!this.precondition.isValidFor(t))return new qe(this.key,e.version);var n=this.patchDocument(t);return new je(this.key,e.version,{hasCommittedMutations:!0},n)},e.prototype.applyToLocalView=function(t,e,n){if(this.verifyKeyMatches(t),!this.precondition.isValidFor(t))return t;var r=ye.getPostMutationVersion(t),i=this.patchDocument(t);return new je(this.key,r,{hasLocalMutations:!0},i)},e.prototype.extractBaseValue=function(t){return null},e.prototype.isEqual=function(t){return t instanceof e&&this.key.isEqual(t.key)&&this.fieldMask.isEqual(t.fieldMask)&&this.precondition.isEqual(t.precondition)},e.prototype.patchDocument=function(t){var e;return e=t instanceof je?t.data():Le.EMPTY,this.patchObject(e)},e.prototype.patchObject=function(t){var e=this;return this.fieldMask.fields.forEach((function(n){if(!n.isEmpty()){var r=e.data.field(n);t=null!==r?t.set(n,r):t.delete(n)}})),t},e}(ye),be=function(t){function e(e,n){var r=t.call(this)||this;return r.key=e,r.fieldTransforms=n,r.type=ce.Transform,r.precondition=me.exists(!0),r}return Object(i.c)(e,t),e.prototype.applyToRemoteDocument=function(t,e){if(this.verifyKeyMatches(t),g(null!=e.transformResults,"Transform results missing for TransformMutation."),!this.precondition.isValidFor(t))return new qe(this.key,e.version);var n=this.requireDocument(t),r=this.serverTransformResults(t,e.transformResults),i=e.version,o=this.transformObject(n.data(),r);return new je(this.key,i,{hasCommittedMutations:!0},o)},e.prototype.applyToLocalView=function(t,e,n){if(this.verifyKeyMatches(t),!this.precondition.isValidFor(t))return t;var r=this.requireDocument(t),i=this.localTransformResults(n,t,e),o=this.transformObject(r.data(),i);return new je(this.key,r.version,{hasLocalMutations:!0},o)},e.prototype.extractBaseValue=function(t){for(var e=null,n=0,r=this.fieldTransforms;n<r.length;n++){var i=r[n],o=t instanceof je?t.field(i.field):void 0,a=i.transform.computeBaseValue(o||null);null!=a&&(e=null==e?Le.EMPTY.set(i.field,a):e.set(i.field,a))}return e},e.prototype.isEqual=function(t){return t instanceof e&&this.key.isEqual(t.key)&&J(this.fieldTransforms,t.fieldTransforms)&&this.precondition.isEqual(t.precondition)},e.prototype.requireDocument=function(t){return g(t instanceof je,"Unknown MaybeDocument type "+t),g(t.key.isEqual(this.key),"Can only transform a document with the same key"),t},e.prototype.serverTransformResults=function(t,e){var n=[];g(this.fieldTransforms.length===e.length,"server transform result count ("+e.length+") should match field transform count ("+this.fieldTransforms.length+")");for(var r=0;r<e.length;r++){var i=this.fieldTransforms[r],o=i.transform,a=null;t instanceof je&&(a=t.field(i.field)),n.push(o.applyToRemoteDocument(a,e[r]))}return n},e.prototype.localTransformResults=function(t,e,n){for(var r=[],i=0,o=this.fieldTransforms;i<o.length;i++){var a=o[i],s=a.transform,u=null;e instanceof je&&(u=e.field(a.field)),null===u&&n instanceof je&&(u=n.field(a.field)),r.push(s.applyToLocalView(u,t))}return r},e.prototype.transformObject=function(t,e){g(e.length===this.fieldTransforms.length,"TransformResults length mismatch.");for(var n=0;n<this.fieldTransforms.length;n++){var r=this.fieldTransforms[n].field;t=t.set(r,e[n])}return t},e}(ye),we=function(t){function e(e,n){var r=t.call(this)||this;return r.key=e,r.precondition=n,r.type=ce.Delete,r}return Object(i.c)(e,t),e.prototype.applyToRemoteDocument=function(t,e){return this.verifyKeyMatches(t),g(null==e.transformResults,"Transform results received by DeleteMutation."),new Ue(this.key,e.version,{hasCommittedMutations:!0})},e.prototype.applyToLocalView=function(t,e,n){return this.verifyKeyMatches(t),this.precondition.isValidFor(t)?(t&&g(t.key.isEqual(this.key),"Can only apply mutation to document with same key"),new Ue(this.key,wt.forDeletedDoc())):t},e.prototype.extractBaseValue=function(t){return null},e.prototype.isEqual=function(t){return t instanceof e&&this.key.isEqual(t.key)&&this.precondition.isEqual(t.precondition)},e}(ye);!function(t){t[t.NullValue=0]="NullValue",t[t.BooleanValue=1]="BooleanValue",t[t.NumberValue=2]="NumberValue",t[t.TimestampValue=3]="TimestampValue",t[t.StringValue=4]="StringValue",t[t.BlobValue=5]="BlobValue",t[t.RefValue=6]="RefValue",t[t.GeoPointValue=7]="GeoPointValue",t[t.ArrayValue=8]="ArrayValue",t[t.ObjectValue=9]="ObjectValue"}(pe||(pe={})),function(t){t[t.Default=0]="Default",t[t.Estimate=1]="Estimate",t[t.Previous=2]="Previous"}(de||(de={}));var Te=function(){function t(t,e){this.serverTimestampBehavior=t,this.timestampsInSnapshots=e}return t.fromSnapshotOptions=function(e,n){switch(e.serverTimestamps){case"estimate":return new t(de.Estimate,n);case"previous":return new t(de.Previous,n);case"none":case void 0:return new t(de.Default,n);default:return y("fromSnapshotOptions() called with invalid options.")}},t}(),_e=function(){function t(){}return t.prototype.toString=function(){var t=this.value();return null===t?"null":t.toString()},t.prototype.defaultCompareTo=function(t){return g(this.typeOrder!==t.typeOrder,"Default compareTo should not be used for values of same type."),X(this.typeOrder,t.typeOrder)},t}(),Ee=function(t){function e(){var e=t.call(this)||this;return e.typeOrder=pe.NullValue,e.internalValue=null,e}return Object(i.c)(e,t),e.prototype.value=function(t){return null},e.prototype.isEqual=function(t){return t instanceof e},e.prototype.compareTo=function(t){return t instanceof e?0:this.defaultCompareTo(t)},e.INSTANCE=new e,e}(_e),Se=function(t){function e(e){var n=t.call(this)||this;return n.internalValue=e,n.typeOrder=pe.BooleanValue,n}return Object(i.c)(e,t),e.prototype.value=function(t){return this.internalValue},e.prototype.isEqual=function(t){return t instanceof e&&this.internalValue===t.internalValue},e.prototype.compareTo=function(t){return t instanceof e?X(this,t):this.defaultCompareTo(t)},e.of=function(t){return t?e.TRUE:e.FALSE},e.TRUE=new e(!0),e.FALSE=new e(!1),e}(_e),Ie=function(t){function e(e){var n=t.call(this)||this;return n.internalValue=e,n.typeOrder=pe.NumberValue,n}return Object(i.c)(e,t),e.prototype.value=function(t){return this.internalValue},e.prototype.compareTo=function(t){return t instanceof e?(n=this.internalValue,r=t.internalValue,n<r?-1:n>r?1:n===r?0:isNaN(n)?isNaN(r)?0:-1:1):this.defaultCompareTo(t);var n,r},e}(_e);function Ce(t,e){return t===e?0!==t||1/t==1/e:t!=t&&e!=e}var Ne=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(i.c)(e,t),e.prototype.isEqual=function(t){return t instanceof e&&Ce(this.internalValue,t.internalValue)},e}(Ie),De=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(i.c)(e,t),e.prototype.isEqual=function(t){return t instanceof e&&Ce(this.internalValue,t.internalValue)},e.NAN=new e(NaN),e.POSITIVE_INFINITY=new e(1/0),e.NEGATIVE_INFINITY=new e(-1/0),e}(Ie),Ae=function(t){function e(e){var n=t.call(this)||this;return n.internalValue=e,n.typeOrder=pe.StringValue,n}return Object(i.c)(e,t),e.prototype.value=function(t){return this.internalValue},e.prototype.isEqual=function(t){return t instanceof e&&this.internalValue===t.internalValue},e.prototype.compareTo=function(t){return t instanceof e?X(this.internalValue,t.internalValue):this.defaultCompareTo(t)},e}(_e),Oe=function(t){function e(e){var n=t.call(this)||this;return n.internalValue=e,n.typeOrder=pe.TimestampValue,n}return Object(i.c)(e,t),e.prototype.value=function(t){return!t||t.timestampsInSnapshots?this.internalValue:this.internalValue.toDate()},e.prototype.isEqual=function(t){return t instanceof e&&this.internalValue.isEqual(t.internalValue)},e.prototype.compareTo=function(t){return t instanceof e?this.internalValue._compareTo(t.internalValue):t instanceof ke?-1:this.defaultCompareTo(t)},e}(_e),ke=function(t){function e(e,n){var r=t.call(this)||this;return r.localWriteTime=e,r.previousValue=n,r.typeOrder=pe.TimestampValue,r}return Object(i.c)(e,t),e.prototype.value=function(t){return t&&t.serverTimestampBehavior===de.Estimate?new Oe(this.localWriteTime).value(t):t&&t.serverTimestampBehavior===de.Previous&&this.previousValue?this.previousValue.value(t):null},e.prototype.isEqual=function(t){return t instanceof e&&this.localWriteTime.isEqual(t.localWriteTime)},e.prototype.compareTo=function(t){return t instanceof e?this.localWriteTime._compareTo(t.localWriteTime):t instanceof Oe?1:this.defaultCompareTo(t)},e.prototype.toString=function(){return"<ServerTimestamp localTime="+this.localWriteTime.toString()+">"},e}(_e),Re=function(t){function e(e){var n=t.call(this)||this;return n.internalValue=e,n.typeOrder=pe.BlobValue,n}return Object(i.c)(e,t),e.prototype.value=function(t){return this.internalValue},e.prototype.isEqual=function(t){return t instanceof e&&this.internalValue.isEqual(t.internalValue)},e.prototype.compareTo=function(t){return t instanceof e?this.internalValue._compareTo(t.internalValue):this.defaultCompareTo(t)},e}(_e),Pe=function(t){function e(e,n){var r=t.call(this)||this;return r.databaseId=e,r.key=n,r.typeOrder=pe.RefValue,r}return Object(i.c)(e,t),e.prototype.value=function(t){return this.key},e.prototype.isEqual=function(t){return t instanceof e&&(this.key.isEqual(t.key)&&this.databaseId.isEqual(t.databaseId))},e.prototype.compareTo=function(t){if(t instanceof e){var n=this.databaseId.compareTo(t.databaseId);return 0!==n?n:lt.comparator(this.key,t.key)}return this.defaultCompareTo(t)},e}(_e),Me=function(t){function e(e){var n=t.call(this)||this;return n.internalValue=e,n.typeOrder=pe.GeoPointValue,n}return Object(i.c)(e,t),e.prototype.value=function(t){return this.internalValue},e.prototype.isEqual=function(t){return t instanceof e&&this.internalValue.isEqual(t.internalValue)},e.prototype.compareTo=function(t){return t instanceof e?this.internalValue._compareTo(t.internalValue):this.defaultCompareTo(t)},e}(_e),Le=function(t){function e(e){var n=t.call(this)||this;return n.internalValue=e,n.typeOrder=pe.ObjectValue,n}return Object(i.c)(e,t),e.prototype.value=function(t){var e={};return this.internalValue.inorderTraversal((function(n,r){e[n]=r.value(t)})),e},e.prototype.forEach=function(t){this.internalValue.inorderTraversal(t)},e.prototype.isEqual=function(t){if(t instanceof e){for(var n=this.internalValue.getIterator(),r=t.internalValue.getIterator();n.hasNext()&&r.hasNext();){var i=n.getNext(),o=r.getNext();if(i.key!==o.key||!i.value.isEqual(o.value))return!1}return!n.hasNext()&&!r.hasNext()}return!1},e.prototype.compareTo=function(t){if(t instanceof e){for(var n=this.internalValue.getIterator(),r=t.internalValue.getIterator();n.hasNext()&&r.hasNext();){var i=n.getNext(),o=r.getNext(),a=X(i.key,o.key)||i.value.compareTo(o.value);if(a)return a}return X(n.hasNext(),r.hasNext())}return this.defaultCompareTo(t)},e.prototype.set=function(t,n){if(g(!t.isEmpty(),"Cannot set field for empty path on ObjectValue"),1===t.length)return this.setChild(t.firstSegment(),n);var r=this.child(t.firstSegment());r instanceof e||(r=e.EMPTY);var i=r.set(t.popFirst(),n);return this.setChild(t.firstSegment(),i)},e.prototype.delete=function(t){if(g(!t.isEmpty(),"Cannot delete field for empty path on ObjectValue"),1===t.length)return new e(this.internalValue.remove(t.firstSegment()));var n=this.child(t.firstSegment());if(n instanceof e){var r=n.delete(t.popFirst());return new e(this.internalValue.insert(t.firstSegment(),r))}return this},e.prototype.contains=function(t){return null!==this.field(t)},e.prototype.field=function(t){g(!t.isEmpty(),"Can't get field of empty path");var n=this;return t.forEach((function(t){n=n instanceof e?n.internalValue.get(t):null})),n},e.prototype.fieldMask=function(){var t=new It(ht.comparator);return this.internalValue.forEach((function(n,r){var i=new ht([n]);if(r instanceof e){var o=r.fieldMask().fields;o.isEmpty()?t=t.add(i):o.forEach((function(e){t=t.add(i.child(e))}))}else t=t.add(i)})),he.fromSet(t)},e.prototype.toString=function(){return this.internalValue.toString()},e.prototype.child=function(t){return this.internalValue.get(t)||void 0},e.prototype.setChild=function(t,n){return new e(this.internalValue.insert(t,n))},e.EMPTY=new e(new Tt(X)),e}(_e),xe=function(t){function e(e){var n=t.call(this)||this;return n.internalValue=e,n.typeOrder=pe.ArrayValue,n}return Object(i.c)(e,t),e.prototype.value=function(t){return this.internalValue.map((function(e){return e.value(t)}))},e.prototype.contains=function(t){for(var e=0,n=this.internalValue;e<n.length;e++){if(n[e].isEqual(t))return!0}return!1},e.prototype.forEach=function(t){this.internalValue.forEach(t)},e.prototype.isEqual=function(t){if(t instanceof e){if(this.internalValue.length!==t.internalValue.length)return!1;for(var n=0;n<this.internalValue.length;n++)if(!this.internalValue[n].isEqual(t.internalValue[n]))return!1;return!0}return!1},e.prototype.compareTo=function(t){if(t instanceof e){for(var n=Math.min(this.internalValue.length,t.internalValue.length),r=0;r<n;r++){var i=this.internalValue[r].compareTo(t.internalValue[r]);if(i)return i}return X(this.internalValue.length,t.internalValue.length)}return this.defaultCompareTo(t)},e.prototype.toString=function(){return"["+this.internalValue.map((function(t){return t.toString()})).join(",")+"]"},e}(_e),Fe=function(){function t(t,e){this.key=t,this.version=e}return t.compareByKey=function(t,e){return lt.comparator(t.key,e.key)},t}(),je=function(t){function e(e,n,r,i,o,a){var s=t.call(this,e,n)||this;return s.objectValue=i,s.proto=o,s.converter=a,g(void 0!==s.objectValue||void 0!==s.proto&&void 0!==s.converter,"If objectValue is not defined, proto and converter need to be set."),s.hasLocalMutations=!!r.hasLocalMutations,s.hasCommittedMutations=!!r.hasCommittedMutations,s}return Object(i.c)(e,t),e.prototype.field=function(t){if(this.objectValue)return this.objectValue.field(t);this.fieldValueCache||(this.fieldValueCache=new Map);var e=t.canonicalString(),n=this.fieldValueCache.get(e);if(void 0===n){var r=this.getProtoField(t);n=void 0===r?null:this.converter(r),this.fieldValueCache.set(e,n)}return n},e.prototype.data=function(){var t=this;if(!this.objectValue){var e=Le.EMPTY;C(this.proto.fields||{},(function(n,r){e=e.set(new ht([n]),t.converter(r))})),this.objectValue=e,this.fieldValueCache=void 0}return this.objectValue},e.prototype.value=function(){return this.data().value()},e.prototype.isEqual=function(t){return t instanceof e&&this.key.isEqual(t.key)&&this.version.isEqual(t.version)&&this.hasLocalMutations===t.hasLocalMutations&&this.hasCommittedMutations===t.hasCommittedMutations&&this.data().isEqual(t.data())},e.prototype.toString=function(){return"Document("+this.key+", "+this.version+", "+this.data().toString()+", {hasLocalMutations: "+this.hasLocalMutations+"}), {hasCommittedMutations: "+this.hasCommittedMutations+"})"},Object.defineProperty(e.prototype,"hasPendingWrites",{get:function(){return this.hasLocalMutations||this.hasCommittedMutations},enumerable:!0,configurable:!0}),e.prototype.getProtoField=function(t){g(void 0!==this.proto,"Can only call getProtoField() when proto is defined");for(var e=this.proto.fields?this.proto.fields[t.firstSegment()]:void 0,n=1;n<t.length;++n){if(!e||!e.mapValue||!e.mapValue.fields)return;e=e.mapValue.fields[t.get(n)]}return e},e.compareByField=function(t,e,n){var r=e.field(t),i=n.field(t);return null!==r&&null!==i?r.compareTo(i):y("Trying to compare documents on fields that don't exist")},e}(Fe),Ue=function(t){function e(e,n,r){var i=t.call(this,e,n)||this;return i.hasCommittedMutations=!(!r||!r.hasCommittedMutations),i}return Object(i.c)(e,t),e.prototype.toString=function(){return"NoDocument("+this.key+", "+this.version+")"},Object.defineProperty(e.prototype,"hasPendingWrites",{get:function(){return this.hasCommittedMutations},enumerable:!0,configurable:!0}),e.prototype.isEqual=function(t){return t instanceof e&&t.hasCommittedMutations===this.hasCommittedMutations&&t.version.isEqual(this.version)&&t.key.isEqual(this.key)},e}(Fe),qe=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(i.c)(e,t),e.prototype.toString=function(){return"UnknownDocument("+this.key+", "+this.version+")"},Object.defineProperty(e.prototype,"hasPendingWrites",{get:function(){return!0},enumerable:!0,configurable:!0}),e.prototype.isEqual=function(t){return t instanceof e&&t.version.isEqual(this.version)&&t.key.isEqual(this.key)},e}(Fe),Ve=function(){function t(t){this.mapKeyFn=t,this.inner={}}return t.prototype.get=function(t){var e=this.mapKeyFn(t),n=this.inner[e];if(void 0!==n)for(var r=0,i=n;r<i.length;r++){var o=i[r],a=o[0],s=o[1];if(a.isEqual(t))return s}},t.prototype.has=function(t){return void 0!==this.get(t)},t.prototype.set=function(t,e){var n=this.mapKeyFn(t),r=this.inner[n];if(void 0!==r){for(var i=0;i<r.length;i++)if(r[i][0].isEqual(t))return void(r[i]=[t,e]);r.push([t,e])}else this.inner[n]=[[t,e]]},t.prototype.delete=function(t){var e=this.mapKeyFn(t),n=this.inner[e];if(void 0===n)return!1;for(var r=0;r<n.length;r++)if(n[r][0].isEqual(t))return 1===n.length?delete this.inner[e]:n.splice(r,1),!0;return!1},t.prototype.forEach=function(t){C(this.inner,(function(e,n){for(var r=0,i=n;r<i.length;r++){var o=i[r],a=o[0],s=o[1];t(a,s)}}))},t.prototype.isEmpty=function(){return N(this.inner)},t}(),Be=function(){function t(){this.changes=new Ve((function(t){return t.toString()})),this.changesApplied=!1}return Object.defineProperty(t.prototype,"readTime",{get:function(){return g(void 0!==this._readTime,"Read time is not set. All removeEntry() calls must include a readTime if `trackRemovals` is used."),this._readTime},set:function(t){g(void 0===this._readTime||this._readTime.isEqual(t),"All changes in a RemoteDocumentChangeBuffer must have the same read time"),this._readTime=t},enumerable:!0,configurable:!0}),t.prototype.addEntry=function(t,e){this.assertNotApplied(),this.readTime=e,this.changes.set(t.key,t)},t.prototype.removeEntry=function(t,e){this.assertNotApplied(),e&&(this.readTime=e),this.changes.set(t,null)},t.prototype.getEntry=function(t,e){this.assertNotApplied();var n=this.changes.get(e);return void 0!==n?qt.resolve(n):this.getFromCache(t,e)},t.prototype.getEntries=function(t,e){return this.getAllFromCache(t,e)},t.prototype.apply=function(t){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(t)},t.prototype.assertNotApplied=function(){g(!this.changesApplied,"Changes have already been applied.")},t}(),We=function(){function t(t,e){this.serializer=t,this.indexManager=e}return t.prototype.addEntry=function(t,e,n){return Qe(t).put(Ge(e),n)},t.prototype.removeEntry=function(t,e){var n=Qe(t),r=Ge(e);return n.delete(r)},t.prototype.updateMetadata=function(t,e){var n=this;return this.getMetadata(t).next((function(r){return r.byteSize+=e,n.setMetadata(t,r)}))},t.prototype.getEntry=function(t,e){var n=this;return Qe(t).get(Ge(e)).next((function(t){return n.maybeDecodeDocument(t)}))},t.prototype.getSizedEntry=function(t,e){var n=this;return Qe(t).get(Ge(e)).next((function(t){var e=n.maybeDecodeDocument(t);return e?{maybeDocument:e,size:He(t)}:null}))},t.prototype.getEntries=function(t,e){var n=this,r=At();return this.forEachDbEntry(t,e,(function(t,e){var i=n.maybeDecodeDocument(e);r=r.insert(t,i)})).next((function(){return r}))},t.prototype.getSizedEntries=function(t,e){var n=this,r=At(),i=new Tt(lt.comparator);return this.forEachDbEntry(t,e,(function(t,e){var o=n.maybeDecodeDocument(e);o?(r=r.insert(t,o),i=i.insert(t,He(e))):(r=r.insert(t,null),i=i.insert(t,0))})).next((function(){return{maybeDocuments:r,sizeMap:i}}))},t.prototype.forEachDbEntry=function(t,e,n){if(e.isEmpty())return qt.resolve();var r=IDBKeyRange.bound(e.first().path.toArray(),e.last().path.toArray()),i=e.getIterator(),o=i.getNext();return Qe(t).iterate({range:r},(function(t,e,r){for(var a=lt.fromSegments(t);o&&lt.comparator(o,a)<0;)n(o,null),o=i.getNext();o&&o.isEqual(a)&&(n(o,e),o=i.hasNext()?i.getNext():null),o?r.skip(o.path.toArray()):r.done()})).next((function(){for(;o;)n(o,null),o=i.hasNext()?i.getNext():null}))},t.prototype.getDocumentsMatchingQuery=function(t,e,n){var r=this;g(!e.isCollectionGroupQuery(),"CollectionGroup queries should be handled in LocalDocumentsView");var i=kt(),o=e.path.length+1,a={};if(n.isEqual(wt.MIN)){var s=e.path.toArray();a.range=IDBKeyRange.lowerBound(s)}else{var u=e.path.toArray(),c=this.serializer.toDbTimestampKey(n);a.range=IDBKeyRange.lowerBound([u,c],!0),a.index=an.collectionReadTimeIndex}return Qe(t).iterate(a,(function(t,n,a){if(t.length===o){var s=r.serializer.fromDbRemoteDocument(n);e.path.isPrefixOf(s.key.path)?s instanceof je&&e.matches(s)&&(i=i.insert(s.key,s)):a.done()}})).next((function(){return i}))},t.prototype.getNewDocumentChanges=function(t,e){var n=this,r=Dt(),i=this.serializer.toDbTimestampKey(e),o=Qe(t),a=IDBKeyRange.lowerBound(i,!0);return o.iterate({index:an.readTimeIndex,range:a},(function(t,e){var o=n.serializer.fromDbRemoteDocument(e);r=r.insert(o.key,o),i=e.readTime})).next((function(){return{changedDocs:r,readTime:n.serializer.fromDbTimestampKey(i)}}))},t.prototype.getLastDocumentChange=function(t){var e,n=this,r=Qe(t),i=wt.MIN;return r.iterate({index:an.readTimeIndex,reverse:!0},(function(t,r,o){e=n.serializer.fromDbRemoteDocument(r),r.readTime&&(i=n.serializer.fromDbTimestampKey(r.readTime)),o.done()})).next((function(){return{changedDoc:e,readTime:i}}))},t.prototype.newChangeBuffer=function(e){return new t.RemoteDocumentChangeBuffer(this,!!e&&e.trackRemovals)},t.prototype.getSize=function(t){return this.getMetadata(t).next((function(t){return t.byteSize}))},t.prototype.getMetadata=function(t){return Ke(t).get(sn.key).next((function(t){return g(!!t,"Missing document cache metadata"),t}))},t.prototype.setMetadata=function(t,e){return Ke(t).put(sn.key,e)},t.prototype.maybeDecodeDocument=function(t){if(t){var e=this.serializer.fromDbRemoteDocument(t);return e instanceof Ue&&e.version.isEqual(wt.forDeletedDoc())?null:e}return null},t.RemoteDocumentChangeBuffer=function(t){function e(e,n){var r=t.call(this)||this;return r.documentCache=e,r.trackRemovals=n,r.documentSizes=new Ve((function(t){return t.toString()})),r}return Object(i.c)(e,t),e.prototype.applyChanges=function(t){var e=this,n=[],r=0,i=new It((function(t,e){return X(t.canonicalString(),e.canonicalString())}));return this.changes.forEach((function(o,a){var s=e.documentSizes.get(o);if(g(void 0!==s,"Cannot modify a document that wasn't read (for "+o+")"),a){g(!e.readTime.isEqual(wt.MIN),"Cannot add a document with a read time of zero");var u=e.documentCache.serializer.toDbRemoteDocument(a,e.readTime);i=i.add(o.path.popLast());var c=He(u);r+=c-s,n.push(e.documentCache.addEntry(t,o,u))}else if(r-=s,e.trackRemovals){var h=e.documentCache.serializer.toDbRemoteDocument(new Ue(o,wt.forDeletedDoc()),e.readTime);n.push(e.documentCache.addEntry(t,o,h))}else n.push(e.documentCache.removeEntry(t,o))})),i.forEach((function(r){n.push(e.documentCache.indexManager.addToCollectionParentIndex(t,r))})),n.push(this.documentCache.updateMetadata(t,r)),qt.waitFor(n)},e.prototype.getFromCache=function(t,e){var n=this;return this.documentCache.getSizedEntry(t,e).next((function(t){return null===t?(n.documentSizes.set(e,0),null):(n.documentSizes.set(e,t.size),t.maybeDocument)}))},e.prototype.getAllFromCache=function(t,e){var n=this;return this.documentCache.getSizedEntries(t,e).next((function(t){var e=t.maybeDocuments;return t.sizeMap.forEach((function(t,e){n.documentSizes.set(t,e)})),e}))},e}(Be),t}();function Ke(t){return Mn.getStore(t,sn.store)}function Qe(t){return Mn.getStore(t,an.store)}function Ge(t){return t.path.toArray()}function He(t){var e;if(t.document)e=t.document;else if(t.unknownDocument)e=t.unknownDocument;else{if(!t.noDocument)throw y("Unknown remote document type");e=t.noDocument}return JSON.stringify(e).length}
/**
 * @license
 * Copyright 2019 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var ze=function(){function t(){this.collectionParentIndex=new Ye}return t.prototype.addToCollectionParentIndex=function(t,e){return this.collectionParentIndex.add(e),qt.resolve()},t.prototype.getCollectionParents=function(t,e){return qt.resolve(this.collectionParentIndex.getEntries(e))},t}(),Ye=function(){function t(){this.index={}}return t.prototype.add=function(t){g(t.length%2==1,"Expected a collection path.");var e=t.lastSegment(),n=t.popLast(),r=this.index[e]||new It(ut.comparator),i=!r.has(n);return this.index[e]=r.add(n),i},t.prototype.has=function(t){var e=t.lastSegment(),n=t.popLast(),r=this.index[e];return r&&r.has(n)},t.prototype.getEntries=function(t){return(this.index[t]||new It(ut.comparator)).toArray()},t}(),Xe=9,Je=function(){function t(t){this.serializer=t}return t.prototype.createOrUpgrade=function(t,e,n,r){var i=this;g(n<r&&n>=0&&r<=Xe,"Unexpected schema upgrade from v"+n+" to v{toVersion}.");var o=new Kt(e);n<1&&r>=1&&(function(t){t.createObjectStore(Ze.store)}(t),function(t){t.createObjectStore(tn.store,{keyPath:tn.keyPath}),t.createObjectStore(en.store,{keyPath:en.keyPath,autoIncrement:!0}).createIndex(en.userMutationsIndex,en.userMutationsKeyPath,{unique:!0}),t.createObjectStore(nn.store)}(t),fn(t),function(t){t.createObjectStore(an.store)}(t));var a=qt.resolve();return n<3&&r>=3&&(0!==n&&(!function(t){t.deleteObjectStore(cn.store),t.deleteObjectStore(un.store),t.deleteObjectStore(hn.store)}(t),fn(t)),a=a.next((function(){return function(t){var e=t.store(hn.store),n=new hn(0,0,wt.MIN.toTimestamp(),0);return e.put(hn.key,n)}(o)}))),n<4&&r>=4&&(0!==n&&(a=a.next((function(){return function(t,e){return e.store(en.store).loadAll().next((function(n){t.deleteObjectStore(en.store),t.createObjectStore(en.store,{keyPath:en.keyPath,autoIncrement:!0}).createIndex(en.userMutationsIndex,en.userMutationsKeyPath,{unique:!0});var r=e.store(en.store),i=n.map((function(t){return r.put(t)}));return qt.waitFor(i)}))}(t,o)}))),a=a.next((function(){!function(t){t.createObjectStore(pn.store,{keyPath:pn.keyPath})}(t)}))),n<5&&r>=5&&(a=a.next((function(){return i.removeAcknowledgedMutations(o)}))),n<6&&r>=6&&(a=a.next((function(){return function(t){t.createObjectStore(sn.store)}(t),i.addDocumentGlobal(o)}))),n<7&&r>=7&&(a=a.next((function(){return i.ensureSequenceNumbers(o)}))),n<8&&r>=8&&(a=a.next((function(){return i.createCollectionParentIndex(t,o)}))),n<9&&r>=9&&(a=a.next((function(){!function(t){t.objectStoreNames.contains("remoteDocumentChanges")&&t.deleteObjectStore("remoteDocumentChanges")}(t),function(t){var e=t.objectStore(an.store);e.createIndex(an.readTimeIndex,an.readTimeIndexPath,{unique:!1}),e.createIndex(an.collectionReadTimeIndex,an.collectionReadTimeIndexPath,{unique:!1})}(e)}))),a},t.prototype.addDocumentGlobal=function(t){var e=0;return t.store(an.store).iterate((function(t,n){e+=He(n)})).next((function(){var n=new sn(e);return t.store(sn.store).put(sn.key,n)}))},t.prototype.removeAcknowledgedMutations=function(t){var e=this,n=t.store(tn.store),r=t.store(en.store);return n.loadAll().next((function(n){return qt.forEach(n,(function(n){var i=IDBKeyRange.bound([n.userId,-1],[n.userId,n.lastAcknowledgedBatchId]);return r.loadAll(en.userMutationsIndex,i).next((function(r){return qt.forEach(r,(function(r){g(r.userId===n.userId,"Cannot process batch "+r.batchId+" from unexpected user");var i=e.serializer.fromDbMutationBatch(r);return Jt(t,n.userId,i).next((function(){}))}))}))}))}))},t.prototype.ensureSequenceNumbers=function(t){var e=t.store(cn.store),n=t.store(an.store);return se(t).next((function(t){var r=[];return n.iterate((function(n,i){var o=new ut(n),a=function(t){return[0,mt(t)]}(o);r.push(e.get(a).next((function(n){return n?qt.resolve():function(n){return e.put(new cn(0,mt(n),t))}(o)})))})).next((function(){return qt.waitFor(r)}))}))},t.prototype.createCollectionParentIndex=function(t,e){t.createObjectStore(ln.store,{keyPath:ln.keyPath});var n=e.store(ln.store),r=new Ye,i=function(t){if(r.add(t)){var e=t.lastSegment(),i=t.popLast();return n.put({collectionId:e,parent:mt(i)})}};return e.store(an.store).iterate({keysOnly:!0},(function(t,e){var n=new ut(t);return i(n.popLast())})).next((function(){return e.store(nn.store).iterate({keysOnly:!0},(function(t,e){t[0];var n=t[1],r=(t[2],vt(n));return i(r.popLast())}))}))},t}();var $e=function(t,e){this.seconds=t,this.nanoseconds=e},Ze=function(){function t(t,e,n){this.ownerId=t,this.allowTabSynchronization=e,this.leaseTimestampMs=n}return t.store="owner",t.key="owner",t}();var tn=function(){function t(t,e,n){this.userId=t,this.lastAcknowledgedBatchId=e,this.lastStreamToken=n}return t.store="mutationQueues",t.keyPath="userId",t}(),en=function(){function t(t,e,n,r,i){this.userId=t,this.batchId=e,this.localWriteTimeMs=n,this.baseMutations=r,this.mutations=i}return t.store="mutations",t.keyPath="batchId",t.userMutationsIndex="userMutationsIndex",t.userMutationsKeyPath=["userId","batchId"],t}();var nn=function(){function t(){}return t.prefixForUser=function(t){return[t]},t.prefixForPath=function(t,e){return[t,mt(e)]},t.key=function(t,e,n){return[t,mt(e),n]},t.store="documentMutations",t.PLACEHOLDER=new t,t}();var rn=function(t,e){this.path=t,this.readTime=e},on=function(t,e){this.path=t,this.version=e},an=function(){function t(t,e,n,r,i,o){this.unknownDocument=t,this.noDocument=e,this.document=n,this.hasCommittedMutations=r,this.readTime=i,this.parentPath=o}return t.store="remoteDocuments",t.readTimeIndex="readTimeIndex",t.readTimeIndexPath="readTime",t.collectionReadTimeIndex="collectionReadTimeIndex",t.collectionReadTimeIndexPath=["parentPath","readTime"],t}(),sn=function(){function t(t){this.byteSize=t}return t.store="remoteDocumentGlobal",t.key="remoteDocumentGlobalKey",t}();var un=function(){function t(t,e,n,r,i,o,a){this.targetId=t,this.canonicalId=e,this.readTime=n,this.resumeToken=r,this.lastListenSequenceNumber=i,this.lastLimboFreeSnapshotVersion=o,this.query=a}return t.store="targets",t.keyPath="targetId",t.queryTargetsIndexName="queryTargetsIndex",t.queryTargetsKeyPath=["canonicalId","targetId"],t}(),cn=function(){function t(t,e,n){this.targetId=t,this.path=e,this.sequenceNumber=n,g(0===t==(void 0!==n),"A target-document row must either have targetId == 0 and a defined sequence number, or a non-zero targetId and no sequence number")}return t.store="targetDocuments",t.keyPath=["targetId","path"],t.documentTargetsIndex="documentTargetsIndex",t.documentTargetsKeyPath=["path","targetId"],t}(),hn=function(){function t(t,e,n,r){this.highestTargetId=t,this.highestListenSequenceNumber=e,this.lastRemoteSnapshotVersion=n,this.targetCount=r}return t.key="targetGlobalKey",t.store="targetGlobal",t}(),ln=function(){function t(t,e){this.collectionId=t,this.parent=e}return t.store="collectionParents",t.keyPath=["collectionId","parent"],t}();function fn(t){t.createObjectStore(cn.store,{keyPath:cn.keyPath}).createIndex(cn.documentTargetsIndex,cn.documentTargetsKeyPath,{unique:!0}),t.createObjectStore(un.store,{keyPath:un.keyPath}).createIndex(un.queryTargetsIndexName,un.queryTargetsKeyPath,{unique:!0}),t.createObjectStore(hn.store)}var pn=function(){function t(t,e,n,r){this.clientId=t,this.updateTimeMs=e,this.networkEnabled=n,this.inForeground=r}return t.store="clientMetadata",t.keyPath="clientId",t}();var dn,mn=[tn.store,en.store,nn.store,an.store,un.store,Ze.store,hn.store,cn.store],yn=Object(i.g)(mn,[pn.store]),gn=Object(i.g)(yn,[sn.store]),vn=Object(i.g)(gn,[ln.store]),bn=function(){function t(){this.collectionParentsCache=new Ye}return t.prototype.addToCollectionParentIndex=function(t,e){var n=this;if(g(e.length%2==1,"Expected a collection path."),!this.collectionParentsCache.has(e)){var r=e.lastSegment(),i=e.popLast();t.addOnCommittedListener((function(){n.collectionParentsCache.add(e)}));var o={collectionId:r,parent:mt(i)};return wn(t).put(o)}return qt.resolve()},t.prototype.getCollectionParents=function(t,e){var n=[],r=IDBKeyRange.bound([e,""],[$(e),""],!1,!0);return wn(t).loadAll(r).next((function(t){for(var r=0,i=t;r<i.length;r++){var o=i[r];if(o.collectionId!==e)break;n.push(vt(o.parent))}return n}))},t}();function wn(t){return Mn.getStore(t,ln.store)}
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */!function(t){t[t.Listen=0]="Listen",t[t.ExistenceFilterMismatch=1]="ExistenceFilterMismatch",t[t.LimboResolution=2]="LimboResolution"}(dn||(dn={}));var Tn=function(){function t(t,e,n,r,i,o,a){void 0===i&&(i=wt.MIN),void 0===o&&(o=wt.MIN),void 0===a&&(a=b()),this.target=t,this.targetId=e,this.purpose=n,this.sequenceNumber=r,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=a}return t.prototype.withSequenceNumber=function(e){return new t(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken)},t.prototype.withResumeToken=function(e,n){return new t(this.target,this.targetId,this.purpose,this.sequenceNumber,n,this.lastLimboFreeSnapshotVersion,e)},t.prototype.withLastLimboFreeSnapshotVersion=function(e){return new t(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken)},t.prototype.isEqual=function(t){return this.targetId===t.targetId&&this.purpose===t.purpose&&this.sequenceNumber===t.sequenceNumber&&this.snapshotVersion.isEqual(t.snapshotVersion)&&this.lastLimboFreeSnapshotVersion.isEqual(t.lastLimboFreeSnapshotVersion)&&this.resumeToken===t.resumeToken&&this.target.isEqual(t.target)},t}(),_n=function(){function t(t){this.remoteSerializer=t}return t.prototype.fromDbRemoteDocument=function(t){if(t.document)return this.remoteSerializer.fromDocument(t.document,!!t.hasCommittedMutations);if(t.noDocument){var e=lt.fromSegments(t.noDocument.path),n=this.fromDbTimestamp(t.noDocument.readTime);return new Ue(e,n,{hasCommittedMutations:!!t.hasCommittedMutations})}if(t.unknownDocument){e=lt.fromSegments(t.unknownDocument.path),n=this.fromDbTimestamp(t.unknownDocument.version);return new qe(e,n)}return y("Unexpected DbRemoteDocument")},t.prototype.toDbRemoteDocument=function(t,e){var n=this.toDbTimestampKey(e),r=t.key.path.popLast().toArray();if(t instanceof je){var i=t.proto?t.proto:this.remoteSerializer.toDocument(t),o=t.hasCommittedMutations;return new an(null,null,i,o,n,r)}if(t instanceof Ue){var a=t.key.path.toArray(),s=this.toDbTimestamp(t.version);o=t.hasCommittedMutations;return new an(null,new rn(a,s),null,o,n,r)}if(t instanceof qe){a=t.key.path.toArray();var u=this.toDbTimestamp(t.version);return new an(new on(a,u),null,null,!0,n,r)}return y("Unexpected MaybeDocument")},t.prototype.toDbTimestampKey=function(t){var e=t.toTimestamp();return[e.seconds,e.nanoseconds]},t.prototype.fromDbTimestampKey=function(t){var e=new bt(t[0],t[1]);return wt.fromTimestamp(e)},t.prototype.toDbTimestamp=function(t){var e=t.toTimestamp();return new $e(e.seconds,e.nanoseconds)},t.prototype.fromDbTimestamp=function(t){var e=new bt(t.seconds,t.nanoseconds);return wt.fromTimestamp(e)},t.prototype.toDbMutationBatch=function(t,e){var n=this,r=e.baseMutations.map((function(t){return n.remoteSerializer.toMutation(t)})),i=e.mutations.map((function(t){return n.remoteSerializer.toMutation(t)}));return new en(t,e.batchId,e.localWriteTime.toMillis(),r,i)},t.prototype.fromDbMutationBatch=function(t){var e=this,n=(t.baseMutations||[]).map((function(t){return e.remoteSerializer.fromMutation(t)})),r=t.mutations.map((function(t){return e.remoteSerializer.fromMutation(t)})),i=bt.fromMillis(t.localWriteTimeMs);return new jt(t.batchId,i,n,r)},t.prototype.toDbResourcePaths=function(t){var e=[];return t.forEach((function(t){e.push(mt(t.path))})),e},t.prototype.fromDbResourcePaths=function(t){for(var e=Lt(),n=0,r=t;n<r.length;n++){var i=r[n];e=e.add(new lt(vt(i)))}return e},t.prototype.fromDbTarget=function(t){var e,n=this.fromDbTimestamp(t.readTime),r=void 0!==t.lastLimboFreeSnapshotVersion?this.fromDbTimestamp(t.lastLimboFreeSnapshotVersion):wt.MIN,i=t.resumeToken;return e=void 0!==t.query.documents?this.remoteSerializer.fromDocumentsTarget(t.query):this.remoteSerializer.fromQueryTarget(t.query),new Tn(e,t.targetId,dn.Listen,t.lastListenSequenceNumber,n,r,i)},t.prototype.toDbTarget=function(t){g(dn.Listen===t.purpose,"Only queries with purpose "+dn.Listen+" may be stored, got "+t.purpose);var e,n,r=this.toDbTimestamp(t.snapshotVersion),i=this.toDbTimestamp(t.lastLimboFreeSnapshotVersion);return e=t.target.isDocumentQuery()?this.remoteSerializer.toDocumentsTarget(t.target):this.remoteSerializer.toQueryTarget(t.target),t.resumeToken instanceof Uint8Array?(g(Bt.isMockPersistence(),"Persisting non-string stream tokens is only supported with mock persistence ."),n=t.resumeToken.toString()):n=t.resumeToken,new un(t.targetId,t.target.canonicalId(),r,n,t.sequenceNumber,i,e)},t}();
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
/**
 * @license
 * Copyright 2018 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function En(t,e){var n=t[0],r=t[1],i=e[0],o=e[1],a=X(n,i);return 0===a?X(r,o):a}var Sn=function(){function t(t){this.maxElements=t,this.buffer=new It(En),this.previousIndex=0}return t.prototype.nextIndex=function(){return++this.previousIndex},t.prototype.addElement=function(t){var e=[t,this.nextIndex()];if(this.buffer.size<this.maxElements)this.buffer=this.buffer.add(e);else{var n=this.buffer.last();En(e,n)<0&&(this.buffer=this.buffer.delete(n).add(e))}},Object.defineProperty(t.prototype,"maxValue",{get:function(){return this.buffer.last()[0]},enumerable:!0,configurable:!0}),t}(),In={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},Cn=function(){function t(t,e,n){this.cacheSizeCollectionThreshold=t,this.percentileToCollect=e,this.maximumSequenceNumbersToCollect=n}return t.withCacheSize=function(e){return new t(e,t.DEFAULT_COLLECTION_PERCENTILE,t.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)},t.COLLECTION_DISABLED=-1,t.MINIMUM_CACHE_SIZE_BYTES=1048576,t.DEFAULT_CACHE_SIZE_BYTES=41943040,t.DEFAULT_COLLECTION_PERCENTILE=10,t.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,t.DEFAULT=new t(t.DEFAULT_CACHE_SIZE_BYTES,t.DEFAULT_COLLECTION_PERCENTILE,t.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),t.DISABLED=new t(t.COLLECTION_DISABLED,0,0),t}(),Nn=function(){function t(t,e,n){this.garbageCollector=t,this.asyncQueue=e,this.localStore=n,this.hasRun=!1,this.gcTask=null}return t.prototype.start=function(){g(null===this.gcTask,"Cannot start an already started LruScheduler"),this.garbageCollector.params.cacheSizeCollectionThreshold!==Cn.COLLECTION_DISABLED&&this.scheduleGC()},t.prototype.stop=function(){this.gcTask&&(this.gcTask.cancel(),this.gcTask=null)},Object.defineProperty(t.prototype,"started",{get:function(){return null!==this.gcTask},enumerable:!0,configurable:!0}),t.prototype.scheduleGC=function(){var t=this;g(null===this.gcTask,"Cannot schedule GC while a task is pending");var e=this.hasRun?3e5:6e4;p("LruGarbageCollector","Garbage collection scheduled in "+e+"ms"),this.gcTask=this.asyncQueue.enqueueAfterDelay(et.LruGarbageCollection,e,(function(){return t.gcTask=null,t.hasRun=!0,t.localStore.collectGarbage(t.garbageCollector).then((function(){return t.scheduleGC()})).catch(Ln)}))},t}(),Dn=function(){function t(t,e){this.delegate=t,this.params=e}return t.prototype.calculateTargetCount=function(t,e){return this.delegate.getSequenceNumberCount(t).next((function(t){return Math.floor(e/100*t)}))},t.prototype.nthSequenceNumber=function(t,e){var n=this;if(0===e)return qt.resolve(at.INVALID);var r=new Sn(e);return this.delegate.forEachTarget(t,(function(t){return r.addElement(t.sequenceNumber)})).next((function(){return n.delegate.forEachOrphanedDocumentSequenceNumber(t,(function(t){return r.addElement(t)}))})).next((function(){return r.maxValue}))},t.prototype.removeTargets=function(t,e,n){return this.delegate.removeTargets(t,e,n)},t.prototype.removeOrphanedDocuments=function(t,e){return this.delegate.removeOrphanedDocuments(t,e)},t.prototype.collect=function(t,e){var n=this;return this.params.cacheSizeCollectionThreshold===Cn.COLLECTION_DISABLED?(p("LruGarbageCollector","Garbage collection skipped; disabled"),qt.resolve(In)):this.getCacheSize(t).next((function(r){return r<n.params.cacheSizeCollectionThreshold?(p("LruGarbageCollector","Garbage collection skipped; Cache size "+r+" is lower than threshold "+n.params.cacheSizeCollectionThreshold),In):n.runGarbageCollection(t,e)}))},t.prototype.getCacheSize=function(t){return this.delegate.getCacheSize(t)},t.prototype.runGarbageCollection=function(t,n){var r,i,o,a,s,u,c,h=this,f=Date.now();return this.calculateTargetCount(t,this.params.percentileToCollect).next((function(e){return e>h.params.maximumSequenceNumbersToCollect?(p("LruGarbageCollector","Capping sequence numbers to collect down to the maximum of "+h.params.maximumSequenceNumbersToCollect+" from "+e),i=h.params.maximumSequenceNumbersToCollect):i=e,a=Date.now(),h.nthSequenceNumber(t,i)})).next((function(e){return r=e,s=Date.now(),h.removeTargets(t,r,n)})).next((function(e){return o=e,u=Date.now(),h.removeOrphanedDocuments(t,r)})).next((function(t){(c=Date.now(),l()<=e.DEBUG)&&p("LruGarbageCollector","LRU Garbage Collection\n\tCounted targets in "+(a-f)+"ms\n\tDetermined least recently used "+i+" in "+(s-a)+"ms\n\tRemoved "+o+" targets in "+(u-s)+"ms\n\tRemoved "+t+" documents in "+(c-u)+"ms\nTotal Duration: "+(c-f)+"ms");return qt.resolve({didRun:!0,sequenceNumbersCollected:i,targetsRemoved:o,documentsRemoved:t})}))},t}(),An=function(){function t(){this.onCommittedListeners=[]}return t.prototype.addOnCommittedListener=function(t){this.onCommittedListeners.push(t)},t.prototype.raiseOnCommittedEvent=function(){this.onCommittedListeners.forEach((function(t){return t()}))},t}(),On="IndexedDbPersistence",kn="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.",Rn="Another tab has exclusive access to the persistence layer. To allow shared access, make sure to invoke `enablePersistence()` with `synchronizeTabs:true` in all tabs.",Pn=function(t){function e(e,n){var r=t.call(this)||this;return r.simpleDbTransaction=e,r.currentSequenceNumber=n,r}return Object(i.c)(e,t),e}(An),Mn=function(){function t(e,n,r,i,o,a,s,u){if(this.allowTabSynchronization=e,this.persistenceKey=n,this.clientId=r,this.queue=a,this.sequenceNumberSyncer=u,this._started=!1,this.isPrimary=!1,this.networkEnabled=!0,this.windowUnloadHandler=null,this.inForeground=!1,this.documentVisibilityHandler=null,this.clientMetadataRefresher=null,this.lastGarbageCollectionTime=Number.NEGATIVE_INFINITY,this.primaryStateListener=function(t){return Promise.resolve()},this.referenceDelegate=new jn(this,o),this.dbName=n+t.MAIN_DATABASE,this.serializer=new _n(s),this.document=i.document,this.targetCache=new ie(this.referenceDelegate,this.serializer),this.indexManager=new bn,this.remoteDocumentCache=new We(this.serializer,this.indexManager),!i.window||!i.window.localStorage)throw new T(w.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");this.window=i.window,this.webStorage=this.window.localStorage}return t.getStore=function(t,e){if(t instanceof Pn)return Bt.getStore(t.simpleDbTransaction,e);throw y("IndexedDbPersistence must use instances of IndexedDbTransaction")},t.createIndexedDbPersistence=function(e){return Object(i.b)(this,void 0,void 0,(function(){var n;return Object(i.d)(this,(function(r){switch(r.label){case 0:if(!t.isAvailable())throw new T(w.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");return[4,(n=new t(e.allowTabSynchronization,e.persistenceKey,e.clientId,e.platform,e.lruParams,e.queue,e.serializer,e.sequenceNumberSyncer)).start()];case 1:return r.sent(),[2,n]}}))}))},t.prototype.start=function(){var t=this;return g(!this.started,"IndexedDbPersistence double-started!"),g(null!==this.window,"Expected 'window' to be defined"),Bt.openOrCreate(this.dbName,Xe,new Je(this.serializer)).then((function(e){return t.simpleDb=e,t.updateClientMetadataAndTryBecomePrimary()})).then((function(){return t.attachVisibilityHandler(),t.attachWindowUnloadHook(),t.scheduleClientMetadataAndPrimaryLeaseRefreshes(),t.simpleDb.runTransaction("readonly-idempotent",[hn.store],(function(t){return se(t)}))})).then((function(e){t.listenSequence=new at(e,t.sequenceNumberSyncer)})).then((function(){t._started=!0})).catch((function(e){return t.simpleDb&&t.simpleDb.close(),Promise.reject(e)}))},t.prototype.setPrimaryStateListener=function(t){var e=this;return this.primaryStateListener=function(n){return Object(i.b)(e,void 0,void 0,(function(){return Object(i.d)(this,(function(e){return this.started?[2,t(n)]:[2]}))}))},t(this.isPrimary)},t.prototype.setDatabaseDeletedListener=function(t){var e=this;this.simpleDb.setVersionChangeListener((function(n){return Object(i.b)(e,void 0,void 0,(function(){return Object(i.d)(this,(function(e){switch(e.label){case 0:return null!==n.newVersion?[3,2]:[4,t()];case 1:e.sent(),e.label=2;case 2:return[2]}}))}))}))},t.prototype.setNetworkEnabled=function(t){var e=this;this.networkEnabled!==t&&(this.networkEnabled=t,this.queue.enqueueAndForget((function(){return Object(i.b)(e,void 0,void 0,(function(){return Object(i.d)(this,(function(t){switch(t.label){case 0:return this.started?[4,this.updateClientMetadataAndTryBecomePrimary()]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}}))}))})))},t.prototype.updateClientMetadataAndTryBecomePrimary=function(){var t=this;return this.simpleDb.runTransaction("readwrite-idempotent",vn,(function(e){return Fn(e).put(new pn(t.clientId,Date.now(),t.networkEnabled,t.inForeground)).next((function(){if(t.isPrimary)return t.verifyPrimaryLease(e).next((function(e){e||(t.isPrimary=!1,t.queue.enqueueAndForget((function(){return t.primaryStateListener(!1)})))}))})).next((function(){return t.canActAsPrimary(e)})).next((function(n){return t.isPrimary&&!n?t.releasePrimaryLeaseIfHeld(e).next((function(){return!1})):!!n&&t.acquireOrExtendPrimaryLease(e).next((function(){return!0}))}))})).catch((function(e){if(!t.allowTabSynchronization)throw e;return p(On,"Releasing owner lease after error during lease refresh",e),!1})).then((function(e){t.isPrimary!==e&&t.queue.enqueueAndForget((function(){return t.primaryStateListener(e)})),t.isPrimary=e}))},t.prototype.verifyPrimaryLease=function(t){var e=this;return xn(t).get(Ze.key).next((function(t){return qt.resolve(e.isLocalClient(t))}))},t.prototype.removeClientMetadata=function(t){return Fn(t).delete(this.clientId)},t.prototype.maybeGarbageCollectMultiClientState=function(){return Object(i.b)(this,void 0,void 0,(function(){var e=this;return Object(i.d)(this,(function(n){switch(n.label){case 0:return!this.isPrimary||this.isWithinAge(this.lastGarbageCollectionTime,18e5)?[3,2]:(this.lastGarbageCollectionTime=Date.now(),[4,this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary-idempotent",(function(n){var r=t.getStore(n,pn.store);return r.loadAll().next((function(t){var n=e.filterActiveClients(t,18e5),i=t.filter((function(t){return-1===n.indexOf(t)}));return qt.forEach(i,(function(t){return r.delete(t.clientId)})).next((function(){return i}))}))}))]);case 1:n.sent().forEach((function(t){e.window.localStorage.removeItem(e.zombiedClientLocalStorageKey(t.clientId))})),n.label=2;case 2:return[2]}}))}))},t.prototype.scheduleClientMetadataAndPrimaryLeaseRefreshes=function(){var t=this;this.clientMetadataRefresher=this.queue.enqueueAfterDelay(et.ClientMetadataRefresh,4e3,(function(){return t.updateClientMetadataAndTryBecomePrimary().then((function(){return t.maybeGarbageCollectMultiClientState()})).then((function(){return t.scheduleClientMetadataAndPrimaryLeaseRefreshes()}))}))},t.prototype.isLocalClient=function(t){return!!t&&t.ownerId===this.clientId},t.prototype.canActAsPrimary=function(t){var e=this;return xn(t).get(Ze.key).next((function(n){if(null!==n&&e.isWithinAge(n.leaseTimestampMs,5e3)&&!e.isClientZombied(n.ownerId)){if(e.isLocalClient(n)&&e.networkEnabled)return!0;if(!e.isLocalClient(n)){if(!n.allowTabSynchronization)throw new T(w.FAILED_PRECONDITION,Rn);return!1}}return!(!e.networkEnabled||!e.inForeground)||Fn(t).loadAll().next((function(t){return void 0===e.filterActiveClients(t,5e3).find((function(t){if(e.clientId!==t.clientId){var n=!e.networkEnabled&&t.networkEnabled,r=!e.inForeground&&t.inForeground,i=e.networkEnabled===t.networkEnabled;if(n||r&&i)return!0}return!1}))}))})).next((function(t){return e.isPrimary!==t&&p(On,"Client "+(t?"is":"is not")+" eligible for a primary lease."),t}))},t.prototype.shutdown=function(){return Object(i.b)(this,void 0,void 0,(function(){var t=this;return Object(i.d)(this,(function(e){switch(e.label){case 0:return this._started=!1,this.markClientZombied(),this.clientMetadataRefresher&&(this.clientMetadataRefresher.cancel(),this.clientMetadataRefresher=null),this.detachVisibilityHandler(),this.detachWindowUnloadHook(),[4,this.simpleDb.runTransaction("readwrite-idempotent",[Ze.store,pn.store],(function(e){return t.releasePrimaryLeaseIfHeld(e).next((function(){return t.removeClientMetadata(e)}))}))];case 1:return e.sent(),this.simpleDb.close(),this.removeClientZombiedEntry(),[2]}}))}))},t.prototype.filterActiveClients=function(t,e){var n=this;return t.filter((function(t){return n.isWithinAge(t.updateTimeMs,e)&&!n.isClientZombied(t.clientId)}))},t.prototype.getActiveClients=function(){var t=this;return this.simpleDb.runTransaction("readonly-idempotent",[pn.store],(function(e){return Fn(e).loadAll().next((function(e){return t.filterActiveClients(e,18e5).map((function(t){return t.clientId}))}))}))},t.clearPersistence=function(e){return Object(i.b)(this,void 0,void 0,(function(){var n;return Object(i.d)(this,(function(r){switch(r.label){case 0:return t.isAvailable()?(n=e+t.MAIN_DATABASE,[4,Bt.delete(n)]):[2,Promise.resolve()];case 1:return r.sent(),[2]}}))}))},Object.defineProperty(t.prototype,"started",{get:function(){return this._started},enumerable:!0,configurable:!0}),t.prototype.getMutationQueue=function(t){return g(this.started,"Cannot initialize MutationQueue before persistence is started."),Yt.forUser(t,this.serializer,this.indexManager,this.referenceDelegate)},t.prototype.getTargetCache=function(){return g(this.started,"Cannot initialize TargetCache before persistence is started."),this.targetCache},t.prototype.getRemoteDocumentCache=function(){return g(this.started,"Cannot initialize RemoteDocumentCache before persistence is started."),this.remoteDocumentCache},t.prototype.getIndexManager=function(){return g(this.started,"Cannot initialize IndexManager before persistence is started."),this.indexManager},t.prototype.runTransaction=function(t,e,n){var r=this;p(On,"Starting transaction:",t);var i,o=e.endsWith("idempotent"),a=e.startsWith("readonly")?o?"readonly-idempotent":"readonly":o?"readwrite-idempotent":"readwrite";return this.simpleDb.runTransaction(a,vn,(function(o){return i=new Pn(o,r.listenSequence.next()),"readwrite-primary"===e||"readwrite-primary-idempotent"===e?r.verifyPrimaryLease(o).next((function(t){return!!t||r.canActAsPrimary(o)})).next((function(e){if(!e)throw d("Failed to obtain primary lease for action '"+t+"'."),r.isPrimary=!1,r.queue.enqueueAndForget((function(){return r.primaryStateListener(!1)})),new T(w.FAILED_PRECONDITION,kn);return n(i)})).next((function(t){return r.acquireOrExtendPrimaryLease(o).next((function(){return t}))})):r.verifyAllowTabSynchronization(o).next((function(){return n(i)}))})).then((function(t){return i.raiseOnCommittedEvent(),t}))},t.prototype.verifyAllowTabSynchronization=function(t){var e=this;return xn(t).get(Ze.key).next((function(t){if(null!==t&&e.isWithinAge(t.leaseTimestampMs,5e3)&&!e.isClientZombied(t.ownerId)&&!e.isLocalClient(t)&&!t.allowTabSynchronization)throw new T(w.FAILED_PRECONDITION,Rn)}))},t.prototype.acquireOrExtendPrimaryLease=function(t){var e=new Ze(this.clientId,this.allowTabSynchronization,Date.now());return xn(t).put(Ze.key,e)},t.isAvailable=function(){return Bt.isAvailable()},t.buildStoragePrefix=function(t){var e=t.databaseId.projectId;return t.databaseId.isDefaultDatabase||(e+="."+t.databaseId.database),"firestore/"+t.persistenceKey+"/"+e+"/"},t.prototype.releasePrimaryLeaseIfHeld=function(t){var e=this,n=xn(t);return n.get(Ze.key).next((function(t){return e.isLocalClient(t)?(p(On,"Releasing primary lease."),n.delete(Ze.key)):qt.resolve()}))},t.prototype.isWithinAge=function(t,e){var n=Date.now();return!(t<n-e)&&(!(t>n)||(d("Detected an update time that is in the future: "+t+" > "+n),!1))},t.prototype.attachVisibilityHandler=function(){var t=this;null!==this.document&&"function"==typeof this.document.addEventListener&&(this.documentVisibilityHandler=function(){t.queue.enqueueAndForget((function(){return t.inForeground="visible"===t.document.visibilityState,t.updateClientMetadataAndTryBecomePrimary()}))},this.document.addEventListener("visibilitychange",this.documentVisibilityHandler),this.inForeground="visible"===this.document.visibilityState)},t.prototype.detachVisibilityHandler=function(){this.documentVisibilityHandler&&(g(null!==this.document&&"function"==typeof this.document.addEventListener,"Expected 'document.addEventListener' to be a function"),this.document.removeEventListener("visibilitychange",this.documentVisibilityHandler),this.documentVisibilityHandler=null)},t.prototype.attachWindowUnloadHook=function(){var t=this;"function"==typeof this.window.addEventListener&&(this.windowUnloadHandler=function(){t.markClientZombied(),t.queue.enqueueAndForget((function(){return t.shutdown()}))},this.window.addEventListener("unload",this.windowUnloadHandler))},t.prototype.detachWindowUnloadHook=function(){this.windowUnloadHandler&&(g("function"==typeof this.window.removeEventListener,"Expected 'window.removeEventListener' to be a function"),this.window.removeEventListener("unload",this.windowUnloadHandler),this.windowUnloadHandler=null)},t.prototype.isClientZombied=function(t){try{var e=null!==this.webStorage.getItem(this.zombiedClientLocalStorageKey(t));return p(On,"Client '"+t+"' "+(e?"is":"is not")+" zombied in LocalStorage"),e}catch(t){return d(On,"Failed to get zombied client id.",t),!1}},t.prototype.markClientZombied=function(){try{this.webStorage.setItem(this.zombiedClientLocalStorageKey(this.clientId),String(Date.now()))}catch(t){d("Failed to set zombie client id.",t)}},t.prototype.removeClientZombiedEntry=function(){try{this.webStorage.removeItem(this.zombiedClientLocalStorageKey(this.clientId))}catch(t){}},t.prototype.zombiedClientLocalStorageKey=function(t){return"firestore_zombie_"+this.persistenceKey+"_"+t},t.MAIN_DATABASE="main",t}();function Ln(t){return Object(i.b)(this,void 0,void 0,(function(){return Object(i.d)(this,(function(e){if(!function(t){return t.code===w.FAILED_PRECONDITION&&t.message===kn}(t))throw t;return p(On,"Unexpectedly lost primary lease"),[2]}))}))}function xn(t){return t.store(Ze.store)}function Fn(t){return t.store(pn.store)}var jn=function(){function t(t,e){this.db=t,this.inMemoryPins=null,this.garbageCollector=new Dn(this,e)}return t.prototype.getSequenceNumberCount=function(t){var e=this.orphanedDocmentCount(t);return this.db.getTargetCache().getTargetCount(t).next((function(t){return e.next((function(e){return t+e}))}))},t.prototype.orphanedDocmentCount=function(t){var e=0;return this.forEachOrphanedDocumentSequenceNumber(t,(function(t){e++})).next((function(){return e}))},t.prototype.forEachTarget=function(t,e){return this.db.getTargetCache().forEachTarget(t,e)},t.prototype.forEachOrphanedDocumentSequenceNumber=function(t,e){return this.forEachOrphanedDocument(t,(function(t,n){return e(n)}))},t.prototype.setInMemoryPins=function(t){this.inMemoryPins=t},t.prototype.addReference=function(t,e){return Un(t,e)},t.prototype.removeReference=function(t,e){return Un(t,e)},t.prototype.removeTargets=function(t,e,n){return this.db.getTargetCache().removeTargets(t,e,n)},t.prototype.removeMutationReference=function(t,e){return Un(t,e)},t.prototype.isPinned=function(t,e){return this.inMemoryPins.containsKey(e)?qt.resolve(!0):function(t,e){var n=!1;return ee(t).iterateSerial((function(r){return Xt(t,r,e).next((function(t){return t&&(n=!0),qt.resolve(!t)}))})).next((function(){return n}))}(t,e)},t.prototype.removeOrphanedDocuments=function(t,e){var n=this,r=this.db.getRemoteDocumentCache().newChangeBuffer(),i=[],o=0;return this.forEachOrphanedDocument(t,(function(a,s){if(s<=e){var u=n.isPinned(t,a).next((function(e){if(!e)return o++,r.getEntry(t,a).next((function(){return r.removeEntry(a),ue(t).delete([0,mt(a.path)])}))}));i.push(u)}})).next((function(){return qt.waitFor(i)})).next((function(){return r.apply(t)})).next((function(){return o}))},t.prototype.removeTarget=function(t,e){var n=e.withSequenceNumber(t.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(t,n)},t.prototype.updateLimboDocument=function(t,e){return Un(t,e)},t.prototype.forEachOrphanedDocument=function(t,e){var n,r=ue(t),i=at.INVALID;return r.iterate({index:cn.documentTargetsIndex},(function(t,r){var o=t[0],a=(t[1],r.path),s=r.sequenceNumber;0===o?(i!==at.INVALID&&e(new lt(vt(n)),i),i=s,n=a):i=at.INVALID})).next((function(){i!==at.INVALID&&e(new lt(vt(n)),i)}))},t.prototype.getCacheSize=function(t){return this.db.getRemoteDocumentCache().getSize(t)},t}();function Un(t,e){return ue(t).put(function(t,e){return new cn(0,mt(t.path),e)}(e,t.currentSequenceNumber))}
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var qn=Number,Vn=qn.MIN_SAFE_INTEGER||-(Math.pow(2,53)-1),Bn=qn.MAX_SAFE_INTEGER||Math.pow(2,53)-1,Wn=qn.isInteger||function(t){return"number"==typeof t&&isFinite(t)&&Math.floor(t)===t};function Kn(t){return null==t}function Qn(t){return Wn(t)&&t<=Bn&&t>=Vn}
/**
 * @license
 * Copyright 2019 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Gn,Hn=function(){function t(t,e,n,r,i,o,a){void 0===e&&(e=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o=null),void 0===a&&(a=null),this.path=t,this.collectionGroup=e,this.orderBy=n,this.filters=r,this.limit=i,this.startAt=o,this.endAt=a,this.memoizedCanonicalId=null}return t.prototype.canonicalId=function(){if(null===this.memoizedCanonicalId){var t=this.path.canonicalString();null!==this.collectionGroup&&(t+="|cg:"+this.collectionGroup),t+="|f:";for(var e=0,n=this.filters;e<n.length;e++){t+=n[e].canonicalId(),t+=","}t+="|ob:";for(var r=0,i=this.orderBy;r<i.length;r++){t+=i[r].canonicalId(),t+=","}Kn(this.limit)||(t+="|l:",t+=this.limit),this.startAt&&(t+="|lb:",t+=this.startAt.canonicalId()),this.endAt&&(t+="|ub:",t+=this.endAt.canonicalId()),this.memoizedCanonicalId=t}return this.memoizedCanonicalId},t.prototype.toString=function(){var t=this.path.canonicalString();return null!==this.collectionGroup&&(t+=" collectionGroup="+this.collectionGroup),this.filters.length>0&&(t+=", filters: ["+this.filters.join(", ")+"]"),Kn(this.limit)||(t+=", limit: "+this.limit),this.orderBy.length>0&&(t+=", orderBy: ["+this.orderBy.join(", ")+"]"),this.startAt&&(t+=", startAt: "+this.startAt.canonicalId()),this.endAt&&(t+=", endAt: "+this.endAt.canonicalId()),"Target("+t+")"},t.prototype.isEqual=function(t){if(this.limit!==t.limit)return!1;if(this.orderBy.length!==t.orderBy.length)return!1;for(var e=0;e<this.orderBy.length;e++)if(!this.orderBy[e].isEqual(t.orderBy[e]))return!1;if(this.filters.length!==t.filters.length)return!1;for(e=0;e<this.filters.length;e++)if(!this.filters[e].isEqual(t.filters[e]))return!1;return this.collectionGroup===t.collectionGroup&&(!!this.path.isEqual(t.path)&&(!(null!==this.startAt?!this.startAt.isEqual(t.startAt):null!==t.startAt)&&(null!==this.endAt?this.endAt.isEqual(t.endAt):null===t.endAt)))},t.prototype.isDocumentQuery=function(){return lt.isDocumentKey(this.path)&&null===this.collectionGroup&&0===this.filters.length},t}();
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */!function(t){t.First="F",t.Last="L"}(Gn||(Gn={}));var zn=function(){function t(t,e,n,r,i,o,a,s){void 0===e&&(e=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o=Gn.First),void 0===a&&(a=null),void 0===s&&(s=null),this.path=t,this.collectionGroup=e,this.explicitOrderBy=n,this.filters=r,this.limit=i,this.limitType=o,this.startAt=a,this.endAt=s,this.memoizedOrderBy=null,this.memoizedTarget=null,this.startAt&&this.assertValidBound(this.startAt),this.endAt&&this.assertValidBound(this.endAt)}return t.atPath=function(e){return new t(e)},Object.defineProperty(t.prototype,"orderBy",{get:function(){if(null===this.memoizedOrderBy){var t=this.getInequalityFilterField(),e=this.getFirstOrderByField();if(null!==t&&null===e)t.isKeyField()?this.memoizedOrderBy=[ar]:this.memoizedOrderBy=[new or(t),ar];else{g(null===t||null!==e&&t.isEqual(e),"First orderBy should match inequality field."),this.memoizedOrderBy=[];for(var n=!1,r=0,i=this.explicitOrderBy;r<i.length;r++){var o=i[r];this.memoizedOrderBy.push(o),o.field.isKeyField()&&(n=!0)}if(!n){var a=this.explicitOrderBy.length>0?this.explicitOrderBy[this.explicitOrderBy.length-1].dir:rr.ASCENDING;this.memoizedOrderBy.push(a===rr.ASCENDING?ar:sr)}}}return this.memoizedOrderBy},enumerable:!0,configurable:!0}),t.prototype.addFilter=function(e){g(null==this.getInequalityFilterField()||!(e instanceof Jn)||!e.isInequality()||e.field.isEqual(this.getInequalityFilterField()),"Query must only have one inequality field."),g(!this.isDocumentQuery(),"No filtering allowed for document query");var n=this.filters.concat([e]);return new t(this.path,this.collectionGroup,this.explicitOrderBy.slice(),n,this.limit,this.limitType,this.startAt,this.endAt)},t.prototype.addOrderBy=function(e){g(!this.startAt&&!this.endAt,"Bounds must be set after orderBy");var n=this.explicitOrderBy.concat([e]);return new t(this.path,this.collectionGroup,n,this.filters.slice(),this.limit,this.limitType,this.startAt,this.endAt)},t.prototype.withLimitToFirst=function(e){return new t(this.path,this.collectionGroup,this.explicitOrderBy.slice(),this.filters.slice(),e,Gn.First,this.startAt,this.endAt)},t.prototype.withLimitToLast=function(e){return new t(this.path,this.collectionGroup,this.explicitOrderBy.slice(),this.filters.slice(),e,Gn.Last,this.startAt,this.endAt)},t.prototype.withStartAt=function(e){return new t(this.path,this.collectionGroup,this.explicitOrderBy.slice(),this.filters.slice(),this.limit,this.limitType,e,this.endAt)},t.prototype.withEndAt=function(e){return new t(this.path,this.collectionGroup,this.explicitOrderBy.slice(),this.filters.slice(),this.limit,this.limitType,this.startAt,e)},t.prototype.asCollectionQueryAtPath=function(e){return new t(e,null,this.explicitOrderBy.slice(),this.filters.slice(),this.limit,this.limitType,this.startAt,this.endAt)},t.prototype.matchesAllDocuments=function(){return 0===this.filters.length&&null===this.limit&&null==this.startAt&&null==this.endAt&&(0===this.explicitOrderBy.length||1===this.explicitOrderBy.length&&this.explicitOrderBy[0].field.isKeyField())},t.prototype.canonicalId=function(){return this.toTarget().canonicalId()+"|lt:"+this.limitType},t.prototype.toString=function(){return"Query(target="+this.toTarget().toString()+"; limitType="+this.limitType+")"},t.prototype.isEqual=function(t){return this.toTarget().isEqual(t.toTarget())&&this.limitType===t.limitType},t.prototype.docComparator=function(t,e){for(var n=!1,r=0,i=this.orderBy;r<i.length;r++){var o=i[r],a=o.compare(t,e);if(0!==a)return a;n=n||o.field.isKeyField()}return g(n,"orderBy used that doesn't compare on key field"),0},t.prototype.matches=function(t){return this.matchesPathAndCollectionGroup(t)&&this.matchesOrderBy(t)&&this.matchesFilters(t)&&this.matchesBounds(t)},t.prototype.hasLimitToFirst=function(){return!Kn(this.limit)&&this.limitType===Gn.First},t.prototype.hasLimitToLast=function(){return!Kn(this.limit)&&this.limitType===Gn.Last},t.prototype.getFirstOrderByField=function(){return this.explicitOrderBy.length>0?this.explicitOrderBy[0].field:null},t.prototype.getInequalityFilterField=function(){for(var t=0,e=this.filters;t<e.length;t++){var n=e[t];if(n instanceof Jn&&n.isInequality())return n.field}return null},t.prototype.findFilterOperator=function(t){for(var e=0,n=this.filters;e<n.length;e++){var r=n[e];if(r instanceof Jn&&t.indexOf(r.op)>=0)return r.op}return null},t.prototype.isDocumentQuery=function(){return this.toTarget().isDocumentQuery()},t.prototype.isCollectionGroupQuery=function(){return null!==this.collectionGroup},t.prototype.toTarget=function(){if(!this.memoizedTarget)if(this.limitType===Gn.First)this.memoizedTarget=new Hn(this.path,this.collectionGroup,this.orderBy,this.filters,this.limit,this.startAt,this.endAt);else{for(var t=[],e=0,n=this.orderBy;e<n.length;e++){var r=n[e],i=r.dir===rr.DESCENDING?rr.ASCENDING:rr.DESCENDING;t.push(new or(r.field,i))}var o=this.endAt?new ir(this.endAt.position,!this.endAt.before):null,a=this.startAt?new ir(this.startAt.position,!this.startAt.before):null;this.memoizedTarget=new Hn(this.path,this.collectionGroup,t,this.filters,this.limit,o,a)}return this.memoizedTarget},t.prototype.matchesPathAndCollectionGroup=function(t){var e=t.key.path;return null!==this.collectionGroup?t.key.hasCollectionId(this.collectionGroup)&&this.path.isPrefixOf(e):lt.isDocumentKey(this.path)?this.path.isEqual(e):this.path.isImmediateParentOf(e)},t.prototype.matchesOrderBy=function(t){for(var e=0,n=this.explicitOrderBy;e<n.length;e++){var r=n[e];if(!r.field.isKeyField()&&null===t.field(r.field))return!1}return!0},t.prototype.matchesFilters=function(t){for(var e=0,n=this.filters;e<n.length;e++){if(!n[e].matches(t))return!1}return!0},t.prototype.matchesBounds=function(t){return!(this.startAt&&!this.startAt.sortsBeforeDocument(this.orderBy,t))&&(!this.endAt||!this.endAt.sortsBeforeDocument(this.orderBy,t))},t.prototype.assertValidBound=function(t){g(t.position.length<=this.orderBy.length,"Bound is longer than orderBy")},t}(),Yn=function(){},Xn=function(){function t(t){this.name=t}return t.fromString=function(e){switch(e){case"<":return t.LESS_THAN;case"<=":return t.LESS_THAN_OR_EQUAL;case"==":return t.EQUAL;case">=":return t.GREATER_THAN_OR_EQUAL;case">":return t.GREATER_THAN;case"array-contains":return t.ARRAY_CONTAINS;case"in":return t.IN;case"array-contains-any":return t.ARRAY_CONTAINS_ANY;default:return y("Unknown FieldFilter operator: "+e)}},t.prototype.toString=function(){return this.name},t.prototype.isEqual=function(t){return this.name===t.name},t.LESS_THAN=new t("<"),t.LESS_THAN_OR_EQUAL=new t("<="),t.EQUAL=new t("=="),t.GREATER_THAN=new t(">"),t.GREATER_THAN_OR_EQUAL=new t(">="),t.ARRAY_CONTAINS=new t("array-contains"),t.IN=new t("in"),t.ARRAY_CONTAINS_ANY=new t("array-contains-any"),t}(),Jn=function(t){function e(e,n,r){var i=t.call(this)||this;return i.field=e,i.op=n,i.value=r,i}return Object(i.c)(e,t),e.create=function(t,n,r){if(t.isKeyField())return n===Xn.IN?(g(r instanceof xe,"Comparing on key with IN, but filter value not an ArrayValue"),g(r.internalValue.every((function(t){return t instanceof Pe})),"Comparing on key with IN, but an array value was not a RefValue"),new Zn(t,r)):(g(r instanceof Pe,"Comparing on key, but filter value not a RefValue"),g(n!==Xn.ARRAY_CONTAINS&&n!==Xn.ARRAY_CONTAINS_ANY,"'"+n.toString()+"' queries don't make sense on document keys."),new $n(t,n,r));if(r.isEqual(Ee.INSTANCE)){if(n!==Xn.EQUAL)throw new T(w.INVALID_ARGUMENT,"Invalid query. Null supports only equality comparisons.");return new e(t,n,r)}if(r.isEqual(De.NAN)){if(n!==Xn.EQUAL)throw new T(w.INVALID_ARGUMENT,"Invalid query. NaN supports only equality comparisons.");return new e(t,n,r)}return n===Xn.ARRAY_CONTAINS?new tr(t,r):n===Xn.IN?(g(r instanceof xe,"IN filter has invalid value: "+r.toString()),new er(t,r)):n===Xn.ARRAY_CONTAINS_ANY?(g(r instanceof xe,"ARRAY_CONTAINS_ANY filter has invalid value: "+r.toString()),new nr(t,r)):new e(t,n,r)},e.prototype.matches=function(t){var e=t.field(this.field);return null!==e&&this.value.typeOrder===e.typeOrder&&this.matchesComparison(e.compareTo(this.value))},e.prototype.matchesComparison=function(t){switch(this.op){case Xn.LESS_THAN:return t<0;case Xn.LESS_THAN_OR_EQUAL:return t<=0;case Xn.EQUAL:return 0===t;case Xn.GREATER_THAN:return t>0;case Xn.GREATER_THAN_OR_EQUAL:return t>=0;default:return y("Unknown FieldFilter operator: "+this.op)}},e.prototype.isInequality=function(){return[Xn.LESS_THAN,Xn.LESS_THAN_OR_EQUAL,Xn.GREATER_THAN,Xn.GREATER_THAN_OR_EQUAL].indexOf(this.op)>=0},e.prototype.canonicalId=function(){return this.field.canonicalString()+this.op.toString()+this.value.toString()},e.prototype.isEqual=function(t){return t instanceof e&&(this.op.isEqual(t.op)&&this.field.isEqual(t.field)&&this.value.isEqual(t.value))},e.prototype.toString=function(){return this.field.canonicalString()+" "+this.op+" "+this.value.value()},e}(Yn),$n=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(i.c)(e,t),e.prototype.matches=function(t){var e=this.value,n=lt.comparator(t.key,e.key);return this.matchesComparison(n)},e}(Jn),Zn=function(t){function e(e,n){var r=t.call(this,e,Xn.IN,n)||this;return r.value=n,r}return Object(i.c)(e,t),e.prototype.matches=function(t){return this.value.internalValue.some((function(e){return t.key.isEqual(e.key)}))},e}(Jn),tr=function(t){function e(e,n){return t.call(this,e,Xn.ARRAY_CONTAINS,n)||this}return Object(i.c)(e,t),e.prototype.matches=function(t){var e=t.field(this.field);return e instanceof xe&&e.contains(this.value)},e}(Jn),er=function(t){function e(e,n){var r=t.call(this,e,Xn.IN,n)||this;return r.value=n,r}return Object(i.c)(e,t),e.prototype.matches=function(t){var e=this.value,n=t.field(this.field);return null!==n&&e.contains(n)},e}(Jn),nr=function(t){function e(e,n){var r=t.call(this,e,Xn.ARRAY_CONTAINS_ANY,n)||this;return r.value=n,r}return Object(i.c)(e,t),e.prototype.matches=function(t){var e=this,n=t.field(this.field);return n instanceof xe&&n.internalValue.some((function(t){return e.value.contains(t)}))},e}(Jn),rr=function(){function t(t){this.name=t}return t.prototype.toString=function(){return this.name},t.ASCENDING=new t("asc"),t.DESCENDING=new t("desc"),t}(),ir=function(){function t(t,e){this.position=t,this.before=e}return t.prototype.canonicalId=function(){for(var t=this.before?"b:":"a:",e=0,n=this.position;e<n.length;e++){t+=n[e].toString()}return t},t.prototype.sortsBeforeDocument=function(t,e){g(this.position.length<=t.length,"Bound has more components than query's orderBy");for(var n=0,r=0;r<this.position.length;r++){var i=t[r],o=this.position[r];if(i.field.isKeyField())g(o instanceof Pe,"Bound has a non-key value where the key path is being used."),n=lt.comparator(o.key,e.key);else{var a=e.field(i.field);g(null!==a,"Field should exist since document matched the orderBy already."),n=o.compareTo(a)}if(i.dir===rr.DESCENDING&&(n*=-1),0!==n)break}return this.before?n<=0:n<0},t.prototype.isEqual=function(t){if(null===t)return!1;if(this.before!==t.before||this.position.length!==t.position.length)return!1;for(var e=0;e<this.position.length;e++){var n=this.position[e],r=t.position[e];if(!n.isEqual(r))return!1}return!0},t}(),or=function(){function t(t,e){this.field=t,void 0===e&&(e=rr.ASCENDING),this.dir=e,this.isKeyOrderBy=t.isKeyField()}return t.prototype.compare=function(t,e){var n=this.isKeyOrderBy?je.compareByKey(t,e):je.compareByField(this.field,t,e);switch(this.dir){case rr.ASCENDING:return n;case rr.DESCENDING:return-1*n;default:return y("Unknown direction: "+this.dir)}},t.prototype.canonicalId=function(){return this.field.canonicalString()+this.dir.toString()},t.prototype.toString=function(){return this.field.canonicalString()+" ("+this.dir+")"},t.prototype.isEqual=function(t){return this.dir===t.dir&&this.field.isEqual(t.field)},t}(),ar=new or(ht.keyField(),rr.ASCENDING),sr=new or(ht.keyField(),rr.DESCENDING),ur=function(){function t(){}return t.prototype.setLocalDocumentsView=function(t){this.localDocumentsView=t},t.prototype.getDocumentsMatchingQuery=function(t,n,r,i){var o=this;return g(void 0!==this.localDocumentsView,"setLocalDocumentsView() not called"),n.matchesAllDocuments()?this.executeFullCollectionScan(t,n):r.isEqual(wt.MIN)?this.executeFullCollectionScan(t,n):this.localDocumentsView.getDocuments(t,i).next((function(a){var s=o.applyQuery(n,a);return(n.hasLimitToFirst()||n.hasLimitToLast())&&o.needsRefill(n.limitType,s,i,r)?o.executeFullCollectionScan(t,n):(l()<=e.DEBUG&&p("IndexFreeQueryEngine","Re-using previous result from %s to execute query: %s",r.toString(),n.toString()),o.localDocumentsView.getDocumentsMatchingQuery(t,n,r).next((function(t){return s.forEach((function(e){t=t.insert(e.key,e)})),t})))}))},t.prototype.applyQuery=function(t,e){var n=new It((function(e,n){return t.docComparator(e,n)}));return e.forEach((function(e,r){r instanceof je&&t.matches(r)&&(n=n.add(r))})),n},t.prototype.needsRefill=function(t,e,n,r){if(n.size!==e.size)return!0;var i=t===Gn.First?e.last():e.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(r)>0)},t.prototype.executeFullCollectionScan=function(t,n){return l()<=e.DEBUG&&p("IndexFreeQueryEngine","Using full collection scan to execute query: %s",n.toString()),this.localDocumentsView.getDocumentsMatchingQuery(t,n,wt.MIN)},t}(),cr=function(){function t(t,e,n){this.remoteDocumentCache=t,this.mutationQueue=e,this.indexManager=n}return t.prototype.getDocument=function(t,e){var n=this;return this.mutationQueue.getAllMutationBatchesAffectingDocumentKey(t,e).next((function(r){return n.getDocumentInternal(t,e,r)}))},t.prototype.getDocumentInternal=function(t,e,n){return this.remoteDocumentCache.getEntry(t,e).next((function(t){for(var r=0,i=n;r<i.length;r++){t=i[r].applyToLocalView(e,t)}return t}))},t.prototype.applyLocalMutationsToDocuments=function(t,e,n){var r=At();return e.forEach((function(t,e){for(var i=0,o=n;i<o.length;i++){e=o[i].applyToLocalView(t,e)}r=r.insert(t,e)})),r},t.prototype.getDocuments=function(t,e){var n=this;return this.remoteDocumentCache.getEntries(t,e).next((function(e){return n.getLocalViewOfDocuments(t,e)}))},t.prototype.getLocalViewOfDocuments=function(t,e){var n=this;return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(t,e).next((function(r){var i=n.applyLocalMutationsToDocuments(t,e,r),o=Dt();return i.forEach((function(t,e){e||(e=new Ue(t,wt.forDeletedDoc())),o=o.insert(t,e)})),o}))},t.prototype.getDocumentsMatchingQuery=function(t,e,n){return e.isDocumentQuery()?this.getDocumentsMatchingDocumentQuery(t,e.path):e.isCollectionGroupQuery()?this.getDocumentsMatchingCollectionGroupQuery(t,e,n):this.getDocumentsMatchingCollectionQuery(t,e,n)},t.prototype.getDocumentsMatchingDocumentQuery=function(t,e){return this.getDocument(t,new lt(e)).next((function(t){var e=kt();return t instanceof je&&(e=e.insert(t.key,t)),e}))},t.prototype.getDocumentsMatchingCollectionGroupQuery=function(t,e,n){var r=this;g(e.path.isEmpty(),"Currently we only support collection group queries at the root.");var i=e.collectionGroup,o=kt();return this.indexManager.getCollectionParents(t,i).next((function(a){return qt.forEach(a,(function(a){var s=e.asCollectionQueryAtPath(a.child(i));return r.getDocumentsMatchingCollectionQuery(t,s,n).next((function(t){t.forEach((function(t,e){o=o.insert(t,e)}))}))})).next((function(){return o}))}))},t.prototype.getDocumentsMatchingCollectionQuery=function(t,e,n){var r,i,o=this;return this.remoteDocumentCache.getDocumentsMatchingQuery(t,e,n).next((function(n){return r=n,o.mutationQueue.getAllMutationBatchesAffectingQuery(t,e)})).next((function(e){return i=e,o.addMissingBaseDocuments(t,i,r).next((function(t){r=t;for(var e=0,n=i;e<n.length;e++)for(var o=n[e],a=0,s=o.mutations;a<s.length;a++){var u=s[a],c=u.key,h=r.get(c),l=u.applyToLocalView(h,h,o.localWriteTime);r=l instanceof je?r.insert(c,l):r.remove(c)}}))})).next((function(){return r.forEach((function(t,n){e.matches(n)||(r=r.remove(t))})),r}))},t.prototype.addMissingBaseDocuments=function(t,e,n){for(var r=Lt(),i=0,o=e;i<o.length;i++)for(var a=0,s=o[i].mutations;a<s.length;a++){var u=s[a];u instanceof ve&&null===n.get(u.key)&&(r=r.add(u.key))}var c=n;return this.remoteDocumentCache.getEntries(t,r).next((function(t){return t.forEach((function(t,e){null!==e&&e instanceof je&&(c=c.insert(t,e))})),c}))},t}(),hr=function(){function t(){this.refsByKey=new It(lr.compareByKey),this.refsByTarget=new It(lr.compareByTargetId)}return t.prototype.isEmpty=function(){return this.refsByKey.isEmpty()},t.prototype.addReference=function(t,e){var n=new lr(t,e);this.refsByKey=this.refsByKey.add(n),this.refsByTarget=this.refsByTarget.add(n)},t.prototype.addReferences=function(t,e){var n=this;t.forEach((function(t){return n.addReference(t,e)}))},t.prototype.removeReference=function(t,e){this.removeRef(new lr(t,e))},t.prototype.removeReferences=function(t,e){var n=this;t.forEach((function(t){return n.removeReference(t,e)}))},t.prototype.removeReferencesForId=function(t){var e=this,n=lt.EMPTY,r=new lr(n,t),i=new lr(n,t+1),o=[];return this.refsByTarget.forEachInRange([r,i],(function(t){e.removeRef(t),o.push(t.key)})),o},t.prototype.removeAllReferences=function(){var t=this;this.refsByKey.forEach((function(e){return t.removeRef(e)}))},t.prototype.removeRef=function(t){this.refsByKey=this.refsByKey.delete(t),this.refsByTarget=this.refsByTarget.delete(t)},t.prototype.referencesForId=function(t){var e=lt.EMPTY,n=new lr(e,t),r=new lr(e,t+1),i=Lt();return this.refsByTarget.forEachInRange([n,r],(function(t){i=i.add(t.key)})),i},t.prototype.containsKey=function(t){var e=new lr(t,0),n=this.refsByKey.firstAfterOrEqual(e);return null!==n&&t.isEqual(n.key)},t}(),lr=function(){function t(t,e){this.key=t,this.targetOrBatchId=e}return t.compareByKey=function(t,e){return lt.comparator(t.key,e.key)||X(t.targetOrBatchId,e.targetOrBatchId)},t.compareByTargetId=function(t,e){return X(t.targetOrBatchId,e.targetOrBatchId)||lt.comparator(t.key,e.key)},t}(),fr=function(){function t(t,e,n){this.persistence=t,this.queryEngine=e,this.localViewReferences=new hr,this.targetDataByTarget=new Tt(X),this.targetIdByTarget=new Ve((function(t){return t.canonicalId()})),this.lastDocumentChangeReadTime=wt.MIN,g(t.started,"LocalStore was passed an unstarted persistence implementation"),this.persistence.referenceDelegate.setInMemoryPins(this.localViewReferences),this.mutationQueue=t.getMutationQueue(n),this.remoteDocuments=t.getRemoteDocumentCache(),this.targetCache=t.getTargetCache(),this.localDocuments=new cr(this.remoteDocuments,this.mutationQueue,this.persistence.getIndexManager()),this.queryEngine.setLocalDocumentsView(this.localDocuments)}return t.prototype.start=function(){return this.synchronizeLastDocumentChangeReadTime()},t.prototype.handleUserChange=function(t){return Object(i.b)(this,void 0,void 0,(function(){var e,n,r,o=this;return Object(i.d)(this,(function(i){switch(i.label){case 0:return e=this.mutationQueue,n=this.localDocuments,[4,this.persistence.runTransaction("Handle user change","readonly-idempotent",(function(r){var i;return o.mutationQueue.getAllMutationBatches(r).next((function(a){return i=a,e=o.persistence.getMutationQueue(t),n=new cr(o.remoteDocuments,e,o.persistence.getIndexManager()),e.getAllMutationBatches(r)})).next((function(t){for(var e=[],o=[],a=Lt(),s=0,u=i;s<u.length;s++){var c=u[s];e.push(c.batchId);for(var h=0,l=c.mutations;h<l.length;h++){var f=l[h];a=a.add(f.key)}}for(var p=0,d=t;p<d.length;p++){c=d[p];o.push(c.batchId);for(var m=0,y=c.mutations;m<y.length;m++){f=y[m];a=a.add(f.key)}}return n.getDocuments(r,a).next((function(t){return{affectedDocuments:t,removedBatchIds:e,addedBatchIds:o}}))}))}))];case 1:return r=i.sent(),this.mutationQueue=e,this.localDocuments=n,this.queryEngine.setLocalDocumentsView(this.localDocuments),[2,r]}}))}))},t.prototype.localWrite=function(t){var e,n=this,r=bt.now(),i=t.reduce((function(t,e){return t.add(e.key)}),Lt());return this.persistence.runTransaction("Locally write mutations","readwrite-idempotent",(function(o){return n.localDocuments.getDocuments(o,i).next((function(i){e=i;for(var a=[],s=0,u=t;s<u.length;s++){var c=u[s],h=c.extractBaseValue(e.get(c.key));null!=h&&a.push(new ve(c.key,h,h.fieldMask(),me.exists(!0)))}return n.mutationQueue.addMutationBatch(o,r,a,t)}))})).then((function(t){var n=t.applyToLocalDocumentSet(e);return{batchId:t.batchId,changes:n}}))},t.prototype.lookupMutationDocuments=function(t){var e=this;return this.persistence.runTransaction("Lookup mutation documents","readonly-idempotent",(function(n){return e.mutationQueue.lookupMutationKeys(n,t).next((function(t){return t?e.localDocuments.getDocuments(n,t):qt.resolve(null)}))}))},t.prototype.acknowledgeBatch=function(t){var e=this;return this.persistence.runTransaction("Acknowledge batch","readwrite-primary-idempotent",(function(n){var r=t.batch.keys(),i=e.remoteDocuments.newChangeBuffer({trackRemovals:!0});return e.mutationQueue.acknowledgeBatch(n,t.batch,t.streamToken).next((function(){return e.applyWriteToRemoteDocuments(n,t,i)})).next((function(){return i.apply(n)})).next((function(){return e.mutationQueue.performConsistencyCheck(n)})).next((function(){return e.localDocuments.getDocuments(n,r)}))}))},t.prototype.rejectBatch=function(t){var e=this;return this.persistence.runTransaction("Reject batch","readwrite-primary-idempotent",(function(n){var r;return e.mutationQueue.lookupMutationBatch(n,t).next((function(t){return g(null!==t,"Attempt to reject nonexistent batch!"),r=t.keys(),e.mutationQueue.removeMutationBatch(n,t)})).next((function(){return e.mutationQueue.performConsistencyCheck(n)})).next((function(){return e.localDocuments.getDocuments(n,r)}))}))},t.prototype.getHighestUnacknowledgedBatchId=function(){var t=this;return this.persistence.runTransaction("Get highest unacknowledged batch id","readonly-idempotent",(function(e){return t.mutationQueue.getHighestUnacknowledgedBatchId(e)}))},t.prototype.getLastStreamToken=function(){var t=this;return this.persistence.runTransaction("Get last stream token","readonly-idempotent",(function(e){return t.mutationQueue.getLastStreamToken(e)}))},t.prototype.setLastStreamToken=function(t){var e=this;return this.persistence.runTransaction("Set last stream token","readwrite-primary-idempotent",(function(n){return e.mutationQueue.setLastStreamToken(n,t)}))},t.prototype.getLastRemoteSnapshotVersion=function(){var t=this;return this.persistence.runTransaction("Get last remote snapshot version","readonly-idempotent",(function(e){return t.targetCache.getLastRemoteSnapshotVersion(e)}))},t.prototype.applyRemoteEvent=function(e){var n=this,r=e.snapshotVersion,i=this.targetDataByTarget;return this.persistence.runTransaction("Apply remote event","readwrite-primary-idempotent",(function(o){var a=n.remoteDocuments.newChangeBuffer({trackRemovals:!0});i=n.targetDataByTarget;var s=[];I(e.targetChanges,(function(e,a){var u=i.get(e);if(u){s.push(n.targetCache.removeMatchingKeys(o,a.removedDocuments,e).next((function(){return n.targetCache.addMatchingKeys(o,a.addedDocuments,e)})));var c=a.resumeToken;if(c.length>0){var h=u.withResumeToken(c,r).withSequenceNumber(o.currentSequenceNumber);i=i.insert(e,h),t.shouldPersistTargetData(u,h,a)&&s.push(n.targetCache.updateTargetData(o,h))}}}));var u=Dt(),c=Lt();if(e.documentUpdates.forEach((function(t,e){c=c.add(t)})),s.push(a.getEntries(o,c).next((function(t){e.documentUpdates.forEach((function(i,c){var h=t.get(i);c instanceof Ue&&c.version.isEqual(wt.MIN)?(a.removeEntry(i,r),u=u.insert(i,c)):null==h||c.version.compareTo(h.version)>0||0===c.version.compareTo(h.version)&&h.hasPendingWrites?(g(!wt.MIN.isEqual(r),"Cannot add a document when the remote version is zero"),a.addEntry(c,r),u=u.insert(i,c)):p("LocalStore","Ignoring outdated watch update for ",i,". Current version:",h.version," Watch version:",c.version),e.resolvedLimboDocuments.has(i)&&s.push(n.persistence.referenceDelegate.updateLimboDocument(o,i))}))}))),!r.isEqual(wt.MIN)){var h=n.targetCache.getLastRemoteSnapshotVersion(o).next((function(t){return g(r.compareTo(t)>=0,"Watch stream reverted to previous snapshot?? "+r+" < "+t),n.targetCache.setTargetsMetadata(o,o.currentSequenceNumber,r)}));s.push(h)}return qt.waitFor(s).next((function(){return a.apply(o)})).next((function(){return n.localDocuments.getLocalViewOfDocuments(o,u)}))})).then((function(t){return n.targetDataByTarget=i,t}))},t.shouldPersistTargetData=function(t,e,n){return g(e.resumeToken.length>0,"Attempted to persist target data with no resume token"),0===t.resumeToken.length||(e.snapshotVersion.toMicroseconds()-t.snapshotVersion.toMicroseconds()>=this.RESUME_TOKEN_MAX_AGE_MICROS||n.addedDocuments.size+n.modifiedDocuments.size+n.removedDocuments.size>0)},t.prototype.notifyLocalViewChanges=function(t){for(var e=this,n=0,r=t;n<r.length;n++){var i=r[n],o=i.targetId;if(this.localViewReferences.addReferences(i.addedKeys,o),this.localViewReferences.removeReferences(i.removedKeys,o),!i.fromCache){var a=this.targetDataByTarget.get(o);g(null!==a,"Can't set limbo-free snapshot version for unknown target: "+o);var s=a.snapshotVersion,u=a.withLastLimboFreeSnapshotVersion(s);this.targetDataByTarget=this.targetDataByTarget.insert(o,u)}}return this.persistence.runTransaction("notifyLocalViewChanges","readwrite-idempotent",(function(n){return qt.forEach(t,(function(t){return qt.forEach(t.removedKeys,(function(t){return e.persistence.referenceDelegate.removeReference(n,t)}))}))}))},t.prototype.nextMutationBatch=function(t){var e=this;return this.persistence.runTransaction("Get next mutation batch","readonly-idempotent",(function(n){return void 0===t&&(t=-1),e.mutationQueue.getNextMutationBatchAfterBatchId(n,t)}))},t.prototype.readDocument=function(t){var e=this;return this.persistence.runTransaction("read document","readonly-idempotent",(function(n){return e.localDocuments.getDocument(n,t)}))},t.prototype.allocateTarget=function(t){var e=this;return this.persistence.runTransaction("Allocate target","readwrite-idempotent",(function(n){var r;return e.targetCache.getTargetData(n,t).next((function(i){return i?(r=i,qt.resolve(r)):e.targetCache.allocateTargetId(n).next((function(i){return r=new Tn(t,i,dn.Listen,n.currentSequenceNumber),e.targetCache.addTargetData(n,r).next((function(){return r}))}))}))})).then((function(n){return null===e.targetDataByTarget.get(n.targetId)&&(e.targetDataByTarget=e.targetDataByTarget.insert(n.targetId,n),e.targetIdByTarget.set(t,n.targetId)),n}))},t.prototype.getTargetData=function(t,e){var n=this.targetIdByTarget.get(e);return void 0!==n?qt.resolve(this.targetDataByTarget.get(n)):this.targetCache.getTargetData(t,e)},t.prototype.releaseTarget=function(t,e){var n=this,r=this.targetDataByTarget.get(t);g(null!==r,"Tried to release nonexistent target: "+t);var i=e?"readwrite-idempotent":"readwrite-primary-idempotent";return this.persistence.runTransaction("Release target",i,(function(i){var o=n.localViewReferences.removeReferencesForId(t);return e?qt.resolve():qt.forEach(o,(function(t){return n.persistence.referenceDelegate.removeReference(i,t)})).next((function(){n.persistence.referenceDelegate.removeTarget(i,r)}))})).then((function(){n.targetDataByTarget=n.targetDataByTarget.remove(t),n.targetIdByTarget.delete(r.target)}))},t.prototype.executeQuery=function(t,e){var n=this,r=wt.MIN,i=Lt();return this.persistence.runTransaction("Execute query","readonly-idempotent",(function(o){return n.getTargetData(o,t.toTarget()).next((function(t){if(t)return r=t.lastLimboFreeSnapshotVersion,n.targetCache.getMatchingKeysForTargetId(o,t.targetId).next((function(t){i=t}))})).next((function(){return n.queryEngine.getDocumentsMatchingQuery(o,t,e?r:wt.MIN,e?i:Lt())})).next((function(t){return{documents:t,remoteKeys:i}}))}))},t.prototype.remoteDocumentKeys=function(t){var e=this;return this.persistence.runTransaction("Remote document keys","readonly-idempotent",(function(n){return e.targetCache.getMatchingKeysForTargetId(n,t)}))},t.prototype.getActiveClients=function(){return this.persistence.getActiveClients()},t.prototype.removeCachedMutationBatchMetadata=function(t){this.mutationQueue.removeCachedMutationKeys(t)},t.prototype.setNetworkEnabled=function(t){this.persistence.setNetworkEnabled(t)},t.prototype.applyWriteToRemoteDocuments=function(t,e,n){var r=this,i=e.batch,o=i.keys(),a=qt.resolve();return o.forEach((function(r){a=a.next((function(){return n.getEntry(t,r)})).next((function(t){var o=t,a=e.docVersions.get(r);g(null!==a,"ackVersions should contain every doc in the write."),(!o||o.version.compareTo(a)<0)&&((o=i.applyToRemoteDocument(r,o,e))?n.addEntry(o,e.commitVersion):g(!t,"Mutation batch "+i+" applied to document "+t+" resulted in null"))}))})),a.next((function(){return r.mutationQueue.removeMutationBatch(t,i)}))},t.prototype.collectGarbage=function(t){var e=this;return this.persistence.runTransaction("Collect garbage","readwrite-primary-idempotent",(function(n){return t.collect(n,e.targetDataByTarget)}))},t.prototype.getTarget=function(t){var e=this,n=this.targetDataByTarget.get(t);return n?Promise.resolve(n.target):this.persistence.runTransaction("Get target data","readonly-idempotent",(function(n){return e.targetCache.getTargetDataForTarget(n,t).next((function(t){return t?t.target:null}))}))},t.prototype.getNewDocumentChanges=function(){var t=this;return this.persistence.runTransaction("Get new document changes","readonly-idempotent",(function(e){return t.remoteDocuments.getNewDocumentChanges(e,t.lastDocumentChangeReadTime)})).then((function(e){var n=e.changedDocs,r=e.readTime;return t.lastDocumentChangeReadTime=r,n}))},t.prototype.synchronizeLastDocumentChangeReadTime=function(){return Object(i.b)(this,void 0,void 0,(function(){var t,e=this;return Object(i.d)(this,(function(n){return this.remoteDocuments instanceof We?(t=this.remoteDocuments,[2,this.persistence.runTransaction("Synchronize last document change read time","readonly-idempotent",(function(e){return t.getLastDocumentChange(e)})).then((function(t){var n=t.readTime;e.lastDocumentChangeReadTime=n}))]):[2]}))}))},t.RESUME_TOKEN_MAX_AGE_MICROS=3e8,t}(),pr=function(){function t(t,e){this.indexManager=t,this.referenceDelegate=e,this.mutationQueue=[],this.nextBatchId=1,this.lastStreamToken=b(),this.batchesByDocumentKey=new It(lr.compareByKey)}return t.prototype.checkEmpty=function(t){return qt.resolve(0===this.mutationQueue.length)},t.prototype.acknowledgeBatch=function(t,e,n){var r=e.batchId,i=this.indexOfExistingBatchId(r,"acknowledged");g(0===i,"Can only acknowledge the first batch in the mutation queue");var o=this.mutationQueue[i];return g(r===o.batchId,"Queue ordering failure: expected batch "+r+", got batch "+o.batchId),this.lastStreamToken=n,qt.resolve()},t.prototype.getLastStreamToken=function(t){return qt.resolve(this.lastStreamToken)},t.prototype.setLastStreamToken=function(t,e){return this.lastStreamToken=e,qt.resolve()},t.prototype.addMutationBatch=function(t,e,n,r){g(0!==r.length,"Mutation batches should not be empty");var i=this.nextBatchId;(this.nextBatchId++,this.mutationQueue.length>0)&&g(this.mutationQueue[this.mutationQueue.length-1].batchId<i,"Mutation batchIDs must be monotonically increasing order");var o=new jt(i,e,n,r);this.mutationQueue.push(o);for(var a=0,s=r;a<s.length;a++){var u=s[a];this.batchesByDocumentKey=this.batchesByDocumentKey.add(new lr(u.key,i)),this.indexManager.addToCollectionParentIndex(t,u.key.path.popLast())}return qt.resolve(o)},t.prototype.lookupMutationBatch=function(t,e){return qt.resolve(this.findMutationBatch(e))},t.prototype.lookupMutationKeys=function(t,e){var n=this.findMutationBatch(e);return g(null!=n,"Failed to find local mutation batch."),qt.resolve(n.keys())},t.prototype.getNextMutationBatchAfterBatchId=function(t,e){var n=e+1,r=this.indexOfBatchId(n),i=r<0?0:r;return qt.resolve(this.mutationQueue.length>i?this.mutationQueue[i]:null)},t.prototype.getHighestUnacknowledgedBatchId=function(){return qt.resolve(0===this.mutationQueue.length?-1:this.nextBatchId-1)},t.prototype.getAllMutationBatches=function(t){return qt.resolve(this.mutationQueue.slice())},t.prototype.getAllMutationBatchesAffectingDocumentKey=function(t,e){var n=this,r=new lr(e,0),i=new lr(e,Number.POSITIVE_INFINITY),o=[];return this.batchesByDocumentKey.forEachInRange([r,i],(function(t){g(e.isEqual(t.key),"Should only iterate over a single key's batches");var r=n.findMutationBatch(t.targetOrBatchId);g(null!==r,"Batches in the index must exist in the main table"),o.push(r)})),qt.resolve(o)},t.prototype.getAllMutationBatchesAffectingDocumentKeys=function(t,e){var n=this,r=new It(X);return e.forEach((function(t){var e=new lr(t,0),i=new lr(t,Number.POSITIVE_INFINITY);n.batchesByDocumentKey.forEachInRange([e,i],(function(e){g(t.isEqual(e.key),"For each key, should only iterate over a single key's batches"),r=r.add(e.targetOrBatchId)}))})),qt.resolve(this.findMutationBatches(r))},t.prototype.getAllMutationBatchesAffectingQuery=function(t,e){g(!e.isCollectionGroupQuery(),"CollectionGroup queries should be handled in LocalDocumentsView");var n=e.path,r=n.length+1,i=n;lt.isDocumentKey(i)||(i=i.child(""));var o=new lr(new lt(i),0),a=new It(X);return this.batchesByDocumentKey.forEachWhile((function(t){var e=t.key.path;return!!n.isPrefixOf(e)&&(e.length===r&&(a=a.add(t.targetOrBatchId)),!0)}),o),qt.resolve(this.findMutationBatches(a))},t.prototype.findMutationBatches=function(t){var e=this,n=[];return t.forEach((function(t){var r=e.findMutationBatch(t);null!==r&&n.push(r)})),n},t.prototype.removeMutationBatch=function(t,e){var n=this;g(0===this.indexOfExistingBatchId(e.batchId,"removed"),"Can only remove the first entry of the mutation queue"),this.mutationQueue.shift();var r=this.batchesByDocumentKey;return qt.forEach(e.mutations,(function(i){var o=new lr(i.key,e.batchId);return r=r.delete(o),n.referenceDelegate.removeMutationReference(t,i.key)})).next((function(){n.batchesByDocumentKey=r}))},t.prototype.removeCachedMutationKeys=function(t){},t.prototype.containsKey=function(t,e){var n=new lr(e,0),r=this.batchesByDocumentKey.firstAfterOrEqual(n);return qt.resolve(e.isEqual(r&&r.key))},t.prototype.performConsistencyCheck=function(t){return 0===this.mutationQueue.length&&g(this.batchesByDocumentKey.isEmpty(),"Document leak -- detected dangling mutation references when queue is empty."),qt.resolve()},t.prototype.indexOfExistingBatchId=function(t,e){var n=this.indexOfBatchId(t);return g(n>=0&&n<this.mutationQueue.length,"Batches must exist to be "+e),n},t.prototype.indexOfBatchId=function(t){return 0===this.mutationQueue.length?0:t-this.mutationQueue[0].batchId},t.prototype.findMutationBatch=function(t){var e=this.indexOfBatchId(t);if(e<0||e>=this.mutationQueue.length)return null;var n=this.mutationQueue[e];return g(n.batchId===t,"If found batch must match"),n},t}();var dr,mr=function(){function t(t,e){this.indexManager=t,this.sizer=e,this.docs=new Tt(lt.comparator),this.size=0}return t.prototype.addEntry=function(t,e,n){g(!n.isEqual(wt.MIN),"Cannot add a document with a read time of zero");var r=e.key,i=this.docs.get(r),o=i?i.size:0,a=this.sizer(e);return this.docs=this.docs.insert(r,{maybeDocument:e,size:a,readTime:n}),this.size+=a-o,this.indexManager.addToCollectionParentIndex(t,r.path.popLast())},t.prototype.removeEntry=function(t){var e=this.docs.get(t);e&&(this.docs=this.docs.remove(t),this.size-=e.size)},t.prototype.getEntry=function(t,e){var n=this.docs.get(e);return qt.resolve(n?n.maybeDocument:null)},t.prototype.getEntries=function(t,e){var n=this,r=At();return e.forEach((function(t){var e=n.docs.get(t);r=r.insert(t,e?e.maybeDocument:null)})),qt.resolve(r)},t.prototype.getDocumentsMatchingQuery=function(t,e,n){g(!e.isCollectionGroupQuery(),"CollectionGroup queries should be handled in LocalDocumentsView");for(var r=kt(),i=new lt(e.path.child("")),o=this.docs.getIteratorFrom(i);o.hasNext();){var a=o.getNext(),s=a.key,u=a.value,c=u.maybeDocument,h=u.readTime;if(!e.path.isPrefixOf(s.path))break;h.compareTo(n)<=0||c instanceof je&&e.matches(c)&&(r=r.insert(c.key,c))}return qt.resolve(r)},t.prototype.forEachDocumentKey=function(t,e){return qt.forEach(this.docs,(function(t){return e(t)}))},t.prototype.getNewDocumentChanges=function(t,e){throw new Error("getNewDocumentChanges() is not supported with MemoryPersistence")},t.prototype.newChangeBuffer=function(e){return new t.RemoteDocumentChangeBuffer(this)},t.prototype.getSize=function(t){return qt.resolve(this.size)},t.RemoteDocumentChangeBuffer=function(t){function e(e){var n=t.call(this)||this;return n.documentCache=e,n}return Object(i.c)(e,t),e.prototype.applyChanges=function(t){var e=this,n=[];return this.changes.forEach((function(r,i){i?n.push(e.documentCache.addEntry(t,i,e.readTime)):e.documentCache.removeEntry(r)})),qt.waitFor(n)},e.prototype.getFromCache=function(t,e){return this.documentCache.getEntry(t,e)},e.prototype.getAllFromCache=function(t,e){return this.documentCache.getEntries(t,e)},e}(Be),t}(),yr=function(){function t(t){this.persistence=t,this.targets=new Ve((function(t){return t.canonicalId()})),this.lastRemoteSnapshotVersion=wt.MIN,this.highestTargetId=0,this.highestSequenceNumber=0,this.references=new hr,this.targetCount=0,this.targetIdGenerator=re.forTargetCache()}return t.prototype.forEachTarget=function(t,e){return this.targets.forEach((function(t,n){return e(n)})),qt.resolve()},t.prototype.getLastRemoteSnapshotVersion=function(t){return qt.resolve(this.lastRemoteSnapshotVersion)},t.prototype.getHighestSequenceNumber=function(t){return qt.resolve(this.highestSequenceNumber)},t.prototype.allocateTargetId=function(t){var e=this.targetIdGenerator.after(this.highestTargetId);return this.highestTargetId=e,qt.resolve(e)},t.prototype.setTargetsMetadata=function(t,e,n){return n&&(this.lastRemoteSnapshotVersion=n),e>this.highestSequenceNumber&&(this.highestSequenceNumber=e),qt.resolve()},t.prototype.saveTargetData=function(t){this.targets.set(t.target,t);var e=t.targetId;e>this.highestTargetId&&(this.highestTargetId=e),t.sequenceNumber>this.highestSequenceNumber&&(this.highestSequenceNumber=t.sequenceNumber)},t.prototype.addTargetData=function(t,e){return g(!this.targets.has(e.target),"Adding a target that already exists"),this.saveTargetData(e),this.targetCount+=1,qt.resolve()},t.prototype.updateTargetData=function(t,e){return g(this.targets.has(e.target),"Updating a non-existent target"),this.saveTargetData(e),qt.resolve()},t.prototype.removeTargetData=function(t,e){return g(this.targetCount>0,"Removing a target from an empty cache"),g(this.targets.has(e.target),"Removing a non-existent target from the cache"),this.targets.delete(e.target),this.references.removeReferencesForId(e.targetId),this.targetCount-=1,qt.resolve()},t.prototype.removeTargets=function(t,e,n){var r=this,i=0,o=[];return this.targets.forEach((function(a,s){s.sequenceNumber<=e&&null===n.get(s.targetId)&&(r.targets.delete(a),o.push(r.removeMatchingKeysForTargetId(t,s.targetId)),i++)})),qt.waitFor(o).next((function(){return i}))},t.prototype.getTargetCount=function(t){return qt.resolve(this.targetCount)},t.prototype.getTargetData=function(t,e){var n=this.targets.get(e)||null;return qt.resolve(n)},t.prototype.getTargetDataForTarget=function(t,e){return y("Not yet implemented.")},t.prototype.addMatchingKeys=function(t,e,n){this.references.addReferences(e,n);var r=this.persistence.referenceDelegate,i=[];return r&&e.forEach((function(e){i.push(r.addReference(t,e))})),qt.waitFor(i)},t.prototype.removeMatchingKeys=function(t,e,n){this.references.removeReferences(e,n);var r=this.persistence.referenceDelegate,i=[];return r&&e.forEach((function(e){i.push(r.removeReference(t,e))})),qt.waitFor(i)},t.prototype.removeMatchingKeysForTargetId=function(t,e){return this.references.removeReferencesForId(e),qt.resolve()},t.prototype.getMatchingKeysForTargetId=function(t,e){var n=this.references.referencesForId(e);return qt.resolve(n)},t.prototype.containsKey=function(t,e){return qt.resolve(this.references.containsKey(e))},t}(),gr=function(){function t(t,e){var n=this;this.clientId=t,this.mutationQueues={},this.listenSequence=new at(0),this._started=!1,this._started=!0,this.referenceDelegate=e(this),this.targetCache=new yr(this);this.indexManager=new ze,this.remoteDocumentCache=new mr(this.indexManager,(function(t){return n.referenceDelegate.documentSize(t)}))}return t.createLruPersistence=function(e,n,r){return new t(e,(function(t){return new wr(t,new _n(n),r)}))},t.createEagerPersistence=function(e){return new t(e,(function(t){return new br(t)}))},t.prototype.shutdown=function(){return this._started=!1,Promise.resolve()},Object.defineProperty(t.prototype,"started",{get:function(){return this._started},enumerable:!0,configurable:!0}),t.prototype.getActiveClients=function(){return Object(i.b)(this,void 0,void 0,(function(){return Object(i.d)(this,(function(t){return[2,[this.clientId]]}))}))},t.prototype.setPrimaryStateListener=function(t){return t(!0)},t.prototype.setDatabaseDeletedListener=function(){},t.prototype.setNetworkEnabled=function(t){},t.prototype.getIndexManager=function(){return this.indexManager},t.prototype.getMutationQueue=function(t){var e=this.mutationQueues[t.toKey()];return e||(e=new pr(this.indexManager,this.referenceDelegate),this.mutationQueues[t.toKey()]=e),e},t.prototype.getTargetCache=function(){return this.targetCache},t.prototype.getRemoteDocumentCache=function(){return this.remoteDocumentCache},t.prototype.runTransaction=function(t,e,n){var r=this;p("MemoryPersistence","Starting transaction:",t);var i=new vr(this.listenSequence.next());return this.referenceDelegate.onTransactionStarted(),n(i).next((function(t){return r.referenceDelegate.onTransactionCommitted(i).next((function(){return t}))})).toPromise().then((function(t){return i.raiseOnCommittedEvent(),t}))},t.prototype.mutationQueuesContainKey=function(t,e){return qt.or((n=this.mutationQueues,r=[],C(n,(function(t,e){return r.push(e)})),r).map((function(n){return function(){return n.containsKey(t,e)}})));var n,r},t}(),vr=function(t){function e(e){var n=t.call(this)||this;return n.currentSequenceNumber=e,n}return Object(i.c)(e,t),e}(An),br=function(){function t(t){this.persistence=t,this.inMemoryPins=null,this._orphanedDocuments=null}return Object.defineProperty(t.prototype,"orphanedDocuments",{get:function(){if(this._orphanedDocuments)return this._orphanedDocuments;throw y("orphanedDocuments is only valid during a transaction.")},enumerable:!0,configurable:!0}),t.prototype.setInMemoryPins=function(t){this.inMemoryPins=t},t.prototype.addReference=function(t,e){return this.orphanedDocuments.delete(e),qt.resolve()},t.prototype.removeReference=function(t,e){return this.orphanedDocuments.add(e),qt.resolve()},t.prototype.removeMutationReference=function(t,e){return this.orphanedDocuments.add(e),qt.resolve()},t.prototype.removeTarget=function(t,e){var n=this,r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(t,e.targetId).next((function(t){t.forEach((function(t){return n.orphanedDocuments.add(t)}))})).next((function(){return r.removeTargetData(t,e)}))},t.prototype.onTransactionStarted=function(){this._orphanedDocuments=new Set},t.prototype.onTransactionCommitted=function(t){var e=this,n=this.persistence.getRemoteDocumentCache().newChangeBuffer();return qt.forEach(this.orphanedDocuments,(function(r){return e.isReferenced(t,r).next((function(t){t||n.removeEntry(r)}))})).next((function(){return e._orphanedDocuments=null,n.apply(t)}))},t.prototype.updateLimboDocument=function(t,e){var n=this;return this.isReferenced(t,e).next((function(t){t?n.orphanedDocuments.delete(e):n.orphanedDocuments.add(e)}))},t.prototype.documentSize=function(t){return 0},t.prototype.isReferenced=function(t,e){var n=this;return qt.or([function(){return n.persistence.getTargetCache().containsKey(t,e)},function(){return n.persistence.mutationQueuesContainKey(t,e)},function(){return qt.resolve(n.inMemoryPins.containsKey(e))}])},t}(),wr=function(){function t(t,e,n){this.persistence=t,this.serializer=e,this.inMemoryPins=null,this.orphanedSequenceNumbers=new Ve((function(t){return mt(t.path)})),this.garbageCollector=new Dn(this,n)}return t.prototype.onTransactionStarted=function(){},t.prototype.onTransactionCommitted=function(t){return qt.resolve()},t.prototype.forEachTarget=function(t,e){return this.persistence.getTargetCache().forEachTarget(t,e)},t.prototype.getSequenceNumberCount=function(t){var e=this.orphanedDocumentCount(t);return this.persistence.getTargetCache().getTargetCount(t).next((function(t){return e.next((function(e){return t+e}))}))},t.prototype.orphanedDocumentCount=function(t){var e=0;return this.forEachOrphanedDocumentSequenceNumber(t,(function(t){e++})).next((function(){return e}))},t.prototype.forEachOrphanedDocumentSequenceNumber=function(t,e){var n=this;return qt.forEach(this.orphanedSequenceNumbers,(function(r,i){return n.isPinned(t,r,i).next((function(t){return t?qt.resolve():e(i)}))}))},t.prototype.setInMemoryPins=function(t){this.inMemoryPins=t},t.prototype.removeTargets=function(t,e,n){return this.persistence.getTargetCache().removeTargets(t,e,n)},t.prototype.removeOrphanedDocuments=function(t,e){var n=this,r=0,i=this.persistence.getRemoteDocumentCache(),o=i.newChangeBuffer();return i.forEachDocumentKey(t,(function(i){return n.isPinned(t,i,e).next((function(t){t||(r++,o.removeEntry(i))}))})).next((function(){return o.apply(t)})).next((function(){return r}))},t.prototype.removeMutationReference=function(t,e){return this.orphanedSequenceNumbers.set(e,t.currentSequenceNumber),qt.resolve()},t.prototype.removeTarget=function(t,e){var n=e.withSequenceNumber(t.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(t,n)},t.prototype.addReference=function(t,e){return this.orphanedSequenceNumbers.set(e,t.currentSequenceNumber),qt.resolve()},t.prototype.removeReference=function(t,e){return this.orphanedSequenceNumbers.set(e,t.currentSequenceNumber),qt.resolve()},t.prototype.updateLimboDocument=function(t,e){return this.orphanedSequenceNumbers.set(e,t.currentSequenceNumber),qt.resolve()},t.prototype.documentSize=function(t){var e,n=this.serializer.toDbRemoteDocument(t,t.version);if(n.document)e=n.document;else if(n.unknownDocument)e=n.unknownDocument;else{if(!n.noDocument)throw y("Unknown remote document type");e=n.noDocument}return JSON.stringify(e).length},t.prototype.isPinned=function(t,e,n){var r=this;return qt.or([function(){return r.persistence.mutationQueuesContainKey(t,e)},function(){return qt.resolve(r.inMemoryPins.containsKey(e))},function(){return r.persistence.getTargetCache().containsKey(t,e)},function(){var t=r.orphanedSequenceNumbers.get(e);return qt.resolve(void 0!==t&&t>n)}])},t.prototype.getCacheSize=function(t){return this.persistence.getRemoteDocumentCache().getSize(t)},t}(),Tr=function(){function t(t,e,n,r,i){void 0===n&&(n=1e3),void 0===r&&(r=1.5),void 0===i&&(i=6e4),this.queue=t,this.timerId=e,this.initialDelayMs=n,this.backoffFactor=r,this.maxDelayMs=i,this.currentBaseMs=0,this.timerPromise=null,this.lastAttemptTime=Date.now(),this.reset()}return t.prototype.reset=function(){this.currentBaseMs=0},t.prototype.resetToMax=function(){this.currentBaseMs=this.maxDelayMs},t.prototype.backoffAndRun=function(t){var e=this;this.cancel();var n=Math.floor(this.currentBaseMs+this.jitterDelayMs()),r=Math.max(0,Date.now()-this.lastAttemptTime),i=Math.max(0,n-r);this.currentBaseMs>0&&p("ExponentialBackoff","Backing off for "+i+" ms (base delay: "+this.currentBaseMs+" ms, delay with jitter: "+n+" ms, last attempt: "+r+" ms ago)"),this.timerPromise=this.queue.enqueueAfterDelay(this.timerId,i,(function(){return e.lastAttemptTime=Date.now(),t()})),this.currentBaseMs*=this.backoffFactor,this.currentBaseMs<this.initialDelayMs&&(this.currentBaseMs=this.initialDelayMs),this.currentBaseMs>this.maxDelayMs&&(this.currentBaseMs=this.maxDelayMs)},t.prototype.cancel=function(){null!==this.timerPromise&&(this.timerPromise.cancel(),this.timerPromise=null)},t.prototype.jitterDelayMs=function(){return(Math.random()-.5)*this.currentBaseMs},t}();
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */!function(t){t[t.Initial=0]="Initial",t[t.Starting=1]="Starting",t[t.Open=2]="Open",t[t.Error=3]="Error",t[t.Backoff=4]="Backoff"}(dr||(dr={}));var _r,Er,Sr=function(){function t(t,e,n,r,i,o){this.queue=t,this.idleTimerId=n,this.connection=r,this.credentialsProvider=i,this.listener=o,this.state=dr.Initial,this.closeCount=0,this.idleTimer=null,this.stream=null,this.backoff=new Tr(t,e)}return t.prototype.isStarted=function(){return this.state===dr.Starting||this.state===dr.Open||this.state===dr.Backoff},t.prototype.isOpen=function(){return this.state===dr.Open},t.prototype.start=function(){this.state!==dr.Error?(g(this.state===dr.Initial,"Already started"),this.auth()):this.performBackoff()},t.prototype.stop=function(){return Object(i.b)(this,void 0,void 0,(function(){return Object(i.d)(this,(function(t){switch(t.label){case 0:return this.isStarted()?[4,this.close(dr.Initial)]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}}))}))},t.prototype.inhibitBackoff=function(){g(!this.isStarted(),"Can only inhibit backoff in a stopped state"),this.state=dr.Initial,this.backoff.reset()},t.prototype.markIdle=function(){var t=this;this.isOpen()&&null===this.idleTimer&&(this.idleTimer=this.queue.enqueueAfterDelay(this.idleTimerId,6e4,(function(){return t.handleIdleCloseTimer()})))},t.prototype.sendRequest=function(t){this.cancelIdleCheck(),this.stream.send(t)},t.prototype.handleIdleCloseTimer=function(){return Object(i.b)(this,void 0,void 0,(function(){return Object(i.d)(this,(function(t){return this.isOpen()?[2,this.close(dr.Initial)]:[2]}))}))},t.prototype.cancelIdleCheck=function(){this.idleTimer&&(this.idleTimer.cancel(),this.idleTimer=null)},t.prototype.close=function(t,e){return Object(i.b)(this,void 0,void 0,(function(){return Object(i.d)(this,(function(n){switch(n.label){case 0:return g(this.isStarted(),"Only started streams should be closed."),g(t===dr.Error||Kn(e),"Can't provide an error when not in an error state."),this.cancelIdleCheck(),this.backoff.cancel(),this.closeCount++,t!==dr.Error?this.backoff.reset():e&&e.code===w.RESOURCE_EXHAUSTED?(d(e.toString()),d("Using maximum backoff delay to prevent overloading the backend."),this.backoff.resetToMax()):e&&e.code===w.UNAUTHENTICATED&&this.credentialsProvider.invalidateToken(),null!==this.stream&&(this.tearDown(),this.stream.close(),this.stream=null),this.state=t,[4,this.listener.onClose(e)];case 1:return n.sent(),[2]}}))}))},t.prototype.tearDown=function(){},t.prototype.auth=function(){var t=this;g(this.state===dr.Initial,"Must be in initial state to auth"),this.state=dr.Starting;var e=this.getCloseGuardedDispatcher(this.closeCount),n=this.closeCount;this.credentialsProvider.getToken().then((function(e){t.closeCount===n&&t.startStream(e)}),(function(n){e((function(){var e=new T(w.UNKNOWN,"Fetching auth token failed: "+n.message);return t.handleStreamClose(e)}))}))},t.prototype.startStream=function(t){var e=this;g(this.state===dr.Starting,"Trying to start stream in a non-starting state");var n=this.getCloseGuardedDispatcher(this.closeCount);this.stream=this.startRpc(t),this.stream.onOpen((function(){n((function(){return g(e.state===dr.Starting,"Expected stream to be in state Starting, but was "+e.state),e.state=dr.Open,e.listener.onOpen()}))})),this.stream.onClose((function(t){n((function(){return e.handleStreamClose(t)}))})),this.stream.onMessage((function(t){n((function(){return e.onMessage(t)}))}))},t.prototype.performBackoff=function(){var t=this;g(this.state===dr.Error,"Should only perform backoff when in Error state"),this.state=dr.Backoff,this.backoff.backoffAndRun((function(){return Object(i.b)(t,void 0,void 0,(function(){return Object(i.d)(this,(function(t){return g(this.state===dr.Backoff,"Backoff elapsed but state is now: "+this.state),this.state=dr.Initial,this.start(),g(this.isStarted(),"PersistentStream should have started"),[2]}))}))}))},t.prototype.handleStreamClose=function(t){return g(this.isStarted(),"Can't handle server close on non-started stream"),p("PersistentStream","close with error: "+t),this.stream=null,this.close(dr.Error,t)},t.prototype.getCloseGuardedDispatcher=function(t){var e=this;return function(n){e.queue.enqueueAndForget((function(){return e.closeCount===t?n():(p("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())}))}},t}(),Ir=function(t){function e(e,n,r,i,o){var a=t.call(this,e,et.ListenStreamConnectionBackoff,et.ListenStreamIdle,n,r,o)||this;return a.serializer=i,a}return Object(i.c)(e,t),e.prototype.startRpc=function(t){return this.connection.openStream("Listen",t)},e.prototype.onMessage=function(t){this.backoff.reset();var e=this.serializer.fromWatchChange(t),n=this.serializer.versionFromListenResponse(t);return this.listener.onWatchChange(e,n)},e.prototype.watch=function(t){var e={};e.database=this.serializer.encodedDatabaseId,e.addTarget=this.serializer.toTarget(t);var n=this.serializer.toListenRequestLabels(t);n&&(e.labels=n),this.sendRequest(e)},e.prototype.unwatch=function(t){var e={};e.database=this.serializer.encodedDatabaseId,e.removeTarget=t,this.sendRequest(e)},e}(Sr),Cr=function(t){function e(e,n,r,i,o){var a=t.call(this,e,et.WriteStreamConnectionBackoff,et.WriteStreamIdle,n,r,o)||this;return a.serializer=i,a.handshakeComplete_=!1,a.lastStreamToken=b(),a}return Object(i.c)(e,t),Object.defineProperty(e.prototype,"handshakeComplete",{get:function(){return this.handshakeComplete_},enumerable:!0,configurable:!0}),e.prototype.start=function(){this.handshakeComplete_=!1,t.prototype.start.call(this)},e.prototype.tearDown=function(){this.handshakeComplete_&&this.writeMutations([])},e.prototype.startRpc=function(t){return this.connection.openStream("Write",t)},e.prototype.onMessage=function(t){if(g(!!t.streamToken,"Got a write response without a stream token"),this.lastStreamToken=t.streamToken,this.handshakeComplete_){this.backoff.reset();var e=this.serializer.fromWriteResults(t.writeResults,t.commitTime),n=this.serializer.fromVersion(t.commitTime);return this.listener.onMutationResult(n,e)}return g(!t.writeResults||0===t.writeResults.length,"Got mutation results for handshake"),this.handshakeComplete_=!0,this.listener.onHandshakeComplete()},e.prototype.writeHandshake=function(){g(this.isOpen(),"Writing handshake requires an opened stream"),g(!this.handshakeComplete_,"Handshake already completed");var t={};t.database=this.serializer.encodedDatabaseId,this.sendRequest(t)},e.prototype.writeMutations=function(t){var e=this;g(this.isOpen(),"Writing mutations requires an opened stream"),g(this.handshakeComplete_,"Handshake must be complete before writing mutations"),g(this.lastStreamToken.length>0,"Trying to write mutation without a token");var n={streamToken:this.lastStreamToken,writes:t.map((function(t){return e.serializer.toMutation(t)}))};this.sendRequest(n)},e}(Sr),Nr=function(){function t(t,e,n,r){this.queue=t,this.connection=e,this.credentials=n,this.serializer=r}return t.prototype.newPersistentWriteStream=function(t){return new Cr(this.queue,this.connection,this.credentials,this.serializer,t)},t.prototype.newPersistentWatchStream=function(t){return new Ir(this.queue,this.connection,this.credentials,this.serializer,t)},t.prototype.commit=function(t){var e=this,n={database:this.serializer.encodedDatabaseId,writes:t.map((function(t){return e.serializer.toMutation(t)}))};return this.invokeRPC("Commit",n).then((function(t){return e.serializer.fromWriteResults(t.writeResults,t.commitTime)}))},t.prototype.lookup=function(t){var e=this,n={database:this.serializer.encodedDatabaseId,documents:t.map((function(t){return e.serializer.toName(t)}))};return this.invokeStreamingRPC("BatchGetDocuments",n).then((function(n){var r=Dt();n.forEach((function(t){var n=e.serializer.fromMaybeDocument(t);r=r.insert(n.key,n)}));var i=[];return t.forEach((function(t){var e=r.get(t);g(!!e,"Missing entity in write response for "+t),i.push(e)})),i}))},t.prototype.invokeRPC=function(t,e){var n=this;return this.credentials.getToken().then((function(r){return n.connection.invokeRPC(t,e,r)})).catch((function(t){throw t.code===w.UNAUTHENTICATED&&n.credentials.invalidateToken(),t}))},t.prototype.invokeStreamingRPC=function(t,e){var n=this;return this.credentials.getToken().then((function(r){return n.connection.invokeStreamingRPC(t,e,r)})).catch((function(t){throw t.code===w.UNAUTHENTICATED&&n.credentials.invalidateToken(),t}))},t}(),Dr=function(){function t(t){this.datastore=t,this.readVersions=Pt(),this.mutations=[],this.committed=!1,this.lastWriteError=null,this.writtenDocs=new Set}return t.prototype.lookup=function(t){return Object(i.b)(this,void 0,void 0,(function(){var e,n=this;return Object(i.d)(this,(function(r){switch(r.label){case 0:if(this.ensureCommitNotCalled(),this.mutations.length>0)throw new T(w.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes.");return[4,this.datastore.lookup(t)];case 1:return(e=r.sent()).forEach((function(t){t instanceof Ue||t instanceof je?n.recordVersion(t):y("Document in a transaction was a "+t.constructor.name)})),[2,e]}}))}))},t.prototype.set=function(t,e){this.write(e.toMutations(t,this.precondition(t))),this.writtenDocs.add(t)},t.prototype.update=function(t,e){try{this.write(e.toMutations(t,this.preconditionForUpdate(t)))}catch(t){this.lastWriteError=t}this.writtenDocs.add(t)},t.prototype.delete=function(t){this.write([new we(t,this.precondition(t))]),this.writtenDocs.add(t)},t.prototype.commit=function(){return Object(i.b)(this,void 0,void 0,(function(){var t;return Object(i.d)(this,(function(e){switch(e.label){case 0:if(this.ensureCommitNotCalled(),this.lastWriteError)throw this.lastWriteError;if(t=this.readVersions,this.mutations.forEach((function(e){t=t.remove(e.key)})),!t.isEmpty())throw new T(w.INVALID_ARGUMENT,"Every document read in a transaction must also be written.");return[4,this.datastore.commit(this.mutations)];case 1:return e.sent(),this.committed=!0,[2]}}))}))},t.prototype.recordVersion=function(t){var e;if(t instanceof je)e=t.version;else{if(!(t instanceof Ue))throw y("Document in a transaction was a "+t.constructor.name);e=wt.forDeletedDoc()}var n=this.readVersions.get(t.key);if(null!==n){if(!e.isEqual(n))throw new T(w.ABORTED,"Document version changed between two reads.")}else this.readVersions=this.readVersions.insert(t.key,e)},t.prototype.precondition=function(t){var e=this.readVersions.get(t);return!this.writtenDocs.has(t)&&e?me.updateTime(e):me.NONE},t.prototype.preconditionForUpdate=function(t){var e=this.readVersions.get(t);if(!this.writtenDocs.has(t)&&e){if(e.isEqual(wt.forDeletedDoc()))throw new T(w.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return me.updateTime(e)}return me.exists(!0)},t.prototype.write=function(t){this.ensureCommitNotCalled(),this.mutations=this.mutations.concat(t)},t.prototype.ensureCommitNotCalled=function(){g(!this.committed,"A transaction object cannot be used after its update callback has been invoked.")},t}();!function(t){t[t.Unknown=0]="Unknown",t[t.Online=1]="Online",t[t.Offline=2]="Offline"}(_r||(_r={})),function(t){t[t.RemoteStore=0]="RemoteStore",t[t.SharedClientState=1]="SharedClientState"}(Er||(Er={}));
/**
 * @license
 * Copyright 2018 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var Ar,Or=function(){function t(t,e){this.asyncQueue=t,this.onlineStateHandler=e,this.state=_r.Unknown,this.watchStreamFailures=0,this.onlineStateTimer=null,this.shouldWarnClientIsOffline=!0}return t.prototype.handleWatchStreamStart=function(){var t=this;0===this.watchStreamFailures&&(this.setAndBroadcast(_r.Unknown),g(null===this.onlineStateTimer,"onlineStateTimer shouldn't be started yet"),this.onlineStateTimer=this.asyncQueue.enqueueAfterDelay(et.OnlineStateTimeout,1e4,(function(){return t.onlineStateTimer=null,g(t.state===_r.Unknown,"Timer should be canceled if we transitioned to a different state."),t.logClientOfflineWarningIfNecessary("Backend didn't respond within 10 seconds."),t.setAndBroadcast(_r.Offline),Promise.resolve()})))},t.prototype.handleWatchStreamFailure=function(t){this.state===_r.Online?(this.setAndBroadcast(_r.Unknown),g(0===this.watchStreamFailures,"watchStreamFailures must be 0"),g(null===this.onlineStateTimer,"onlineStateTimer must be null")):(this.watchStreamFailures++,this.watchStreamFailures>=1&&(this.clearOnlineStateTimer(),this.logClientOfflineWarningIfNecessary("Connection failed 1 times. Most recent error: "+t.toString()),this.setAndBroadcast(_r.Offline)))},t.prototype.set=function(t){this.clearOnlineStateTimer(),this.watchStreamFailures=0,t===_r.Online&&(this.shouldWarnClientIsOffline=!1),this.setAndBroadcast(t)},t.prototype.setAndBroadcast=function(t){t!==this.state&&(this.state=t,this.onlineStateHandler(t))},t.prototype.logClientOfflineWarningIfNecessary=function(t){var e="Could not reach Cloud Firestore backend. "+t+"\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.";this.shouldWarnClientIsOffline?(d(e),this.shouldWarnClientIsOffline=!1):p("OnlineStateTracker",e)},t.prototype.clearOnlineStateTimer=function(){null!==this.onlineStateTimer&&(this.onlineStateTimer.cancel(),this.onlineStateTimer=null)},t}();function kr(t){switch(t){case w.OK:return y("Treated status OK as error");case w.CANCELLED:case w.UNKNOWN:case w.DEADLINE_EXCEEDED:case w.RESOURCE_EXHAUSTED:case w.INTERNAL:case w.UNAVAILABLE:case w.UNAUTHENTICATED:return!1;case w.INVALID_ARGUMENT:case w.NOT_FOUND:case w.ALREADY_EXISTS:case w.PERMISSION_DENIED:case w.FAILED_PRECONDITION:case w.ABORTED:case w.OUT_OF_RANGE:case w.UNIMPLEMENTED:case w.DATA_LOSS:return!0;default:return y("Unknown status code: "+t)}}function Rr(t){if(void 0===t)return d("GRPC error has no .code"),w.UNKNOWN;switch(t){case Ar.OK:return w.OK;case Ar.CANCELLED:return w.CANCELLED;case Ar.UNKNOWN:return w.UNKNOWN;case Ar.DEADLINE_EXCEEDED:return w.DEADLINE_EXCEEDED;case Ar.RESOURCE_EXHAUSTED:return w.RESOURCE_EXHAUSTED;case Ar.INTERNAL:return w.INTERNAL;case Ar.UNAVAILABLE:return w.UNAVAILABLE;case Ar.UNAUTHENTICATED:return w.UNAUTHENTICATED;case Ar.INVALID_ARGUMENT:return w.INVALID_ARGUMENT;case Ar.NOT_FOUND:return w.NOT_FOUND;case Ar.ALREADY_EXISTS:return w.ALREADY_EXISTS;case Ar.PERMISSION_DENIED:return w.PERMISSION_DENIED;case Ar.FAILED_PRECONDITION:return w.FAILED_PRECONDITION;case Ar.ABORTED:return w.ABORTED;case Ar.OUT_OF_RANGE:return w.OUT_OF_RANGE;case Ar.UNIMPLEMENTED:return w.UNIMPLEMENTED;case Ar.DATA_LOSS:return w.DATA_LOSS;default:return y("Unknown status code: "+t)}}function Pr(t){if(void 0===t)return Ar.OK;switch(t){case w.OK:return Ar.OK;case w.CANCELLED:return Ar.CANCELLED;case w.UNKNOWN:return Ar.UNKNOWN;case w.DEADLINE_EXCEEDED:return Ar.DEADLINE_EXCEEDED;case w.RESOURCE_EXHAUSTED:return Ar.RESOURCE_EXHAUSTED;case w.INTERNAL:return Ar.INTERNAL;case w.UNAVAILABLE:return Ar.UNAVAILABLE;case w.UNAUTHENTICATED:return Ar.UNAUTHENTICATED;case w.INVALID_ARGUMENT:return Ar.INVALID_ARGUMENT;case w.NOT_FOUND:return Ar.NOT_FOUND;case w.ALREADY_EXISTS:return Ar.ALREADY_EXISTS;case w.PERMISSION_DENIED:return Ar.PERMISSION_DENIED;case w.FAILED_PRECONDITION:return Ar.FAILED_PRECONDITION;case w.ABORTED:return Ar.ABORTED;case w.OUT_OF_RANGE:return Ar.OUT_OF_RANGE;case w.UNIMPLEMENTED:return Ar.UNIMPLEMENTED;case w.DATA_LOSS:return Ar.DATA_LOSS;default:return y("Unknown status code: "+t)}}!function(t){t[t.OK=0]="OK",t[t.CANCELLED=1]="CANCELLED",t[t.UNKNOWN=2]="UNKNOWN",t[t.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",t[t.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",t[t.NOT_FOUND=5]="NOT_FOUND",t[t.ALREADY_EXISTS=6]="ALREADY_EXISTS",t[t.PERMISSION_DENIED=7]="PERMISSION_DENIED",t[t.UNAUTHENTICATED=16]="UNAUTHENTICATED",t[t.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",t[t.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",t[t.ABORTED=10]="ABORTED",t[t.OUT_OF_RANGE=11]="OUT_OF_RANGE",t[t.UNIMPLEMENTED=12]="UNIMPLEMENTED",t[t.INTERNAL=13]="INTERNAL",t[t.UNAVAILABLE=14]="UNAVAILABLE",t[t.DATA_LOSS=15]="DATA_LOSS"}(Ar||(Ar={}));
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var Mr,Lr,xr=function(){function t(t){this.comparator=t?function(e,n){return t(e,n)||lt.comparator(e.key,n.key)}:function(t,e){return lt.comparator(t.key,e.key)},this.keyedMap=kt(),this.sortedSet=new Tt(this.comparator)}return t.emptySet=function(e){return new t(e.comparator)},t.prototype.has=function(t){return null!=this.keyedMap.get(t)},t.prototype.get=function(t){return this.keyedMap.get(t)},t.prototype.first=function(){return this.sortedSet.minKey()},t.prototype.last=function(){return this.sortedSet.maxKey()},t.prototype.isEmpty=function(){return this.sortedSet.isEmpty()},t.prototype.indexOf=function(t){var e=this.keyedMap.get(t);return e?this.sortedSet.indexOf(e):-1},Object.defineProperty(t.prototype,"size",{get:function(){return this.sortedSet.size},enumerable:!0,configurable:!0}),t.prototype.forEach=function(t){this.sortedSet.inorderTraversal((function(e,n){return t(e),!1}))},t.prototype.add=function(t){var e=this.delete(t.key);return e.copy(e.keyedMap.insert(t.key,t),e.sortedSet.insert(t,null))},t.prototype.delete=function(t){var e=this.get(t);return e?this.copy(this.keyedMap.remove(t),this.sortedSet.remove(e)):this},t.prototype.isEqual=function(e){if(!(e instanceof t))return!1;if(this.size!==e.size)return!1;for(var n=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();n.hasNext();){var i=n.getNext().key,o=r.getNext().key;if(!i.isEqual(o))return!1}return!0},t.prototype.toString=function(){var t=[];return this.forEach((function(e){t.push(e.toString())})),0===t.length?"DocumentSet ()":"DocumentSet (\n  "+t.join("  \n")+"\n)"},t.prototype.copy=function(e,n){var r=new t;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=n,r},t}();
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */!function(t){t[t.Added=0]="Added",t[t.Removed=1]="Removed",t[t.Modified=2]="Modified",t[t.Metadata=3]="Metadata"}(Mr||(Mr={})),function(t){t[t.Local=0]="Local",t[t.Synced=1]="Synced"}(Lr||(Lr={}));var Fr,jr=function(){function t(){this.changeMap=new Tt(lt.comparator)}return t.prototype.track=function(t){var e=t.doc.key,n=this.changeMap.get(e);n?t.type!==Mr.Added&&n.type===Mr.Metadata?this.changeMap=this.changeMap.insert(e,t):t.type===Mr.Metadata&&n.type!==Mr.Removed?this.changeMap=this.changeMap.insert(e,{type:n.type,doc:t.doc}):t.type===Mr.Modified&&n.type===Mr.Modified?this.changeMap=this.changeMap.insert(e,{type:Mr.Modified,doc:t.doc}):t.type===Mr.Modified&&n.type===Mr.Added?this.changeMap=this.changeMap.insert(e,{type:Mr.Added,doc:t.doc}):t.type===Mr.Removed&&n.type===Mr.Added?this.changeMap=this.changeMap.remove(e):t.type===Mr.Removed&&n.type===Mr.Modified?this.changeMap=this.changeMap.insert(e,{type:Mr.Removed,doc:n.doc}):t.type===Mr.Added&&n.type===Mr.Removed?this.changeMap=this.changeMap.insert(e,{type:Mr.Modified,doc:t.doc}):y("unsupported combination of changes: "+JSON.stringify(t)+" after "+JSON.stringify(n)):this.changeMap=this.changeMap.insert(e,t)},t.prototype.getChanges=function(){var t=[];return this.changeMap.inorderTraversal((function(e,n){t.push(n)})),t},t}(),Ur=function(){function t(t,e,n,r,i,o,a,s){this.query=t,this.docs=e,this.oldDocs=n,this.docChanges=r,this.mutatedKeys=i,this.fromCache=o,this.syncStateChanged=a,this.excludesMetadataChanges=s}return t.fromInitialDocuments=function(e,n,r,i){var o=[];return n.forEach((function(t){o.push({type:Mr.Added,doc:t})})),new t(e,n,xr.emptySet(n),o,r,i,!0,!1)},Object.defineProperty(t.prototype,"hasPendingWrites",{get:function(){return!this.mutatedKeys.isEmpty()},enumerable:!0,configurable:!0}),t.prototype.isEqual=function(t){if(!(this.fromCache===t.fromCache&&this.syncStateChanged===t.syncStateChanged&&this.mutatedKeys.isEqual(t.mutatedKeys)&&this.query.isEqual(t.query)&&this.docs.isEqual(t.docs)&&this.oldDocs.isEqual(t.oldDocs)))return!1;var e=this.docChanges,n=t.docChanges;if(e.length!==n.length)return!1;for(var r=0;r<e.length;r++)if(e[r].type!==n[r].type||!e[r].doc.isEqual(n[r].doc))return!1;return!0},t}(),qr=function(){function t(t,e,n,r,i){this.snapshotVersion=t,this.targetChanges=e,this.targetMismatches=n,this.documentUpdates=r,this.resolvedLimboDocuments=i}return t.createSynthesizedRemoteEventForCurrentChange=function(e,n){var r,i=((r={})[e]=Vr.createSynthesizedTargetChangeForCurrentChange(e,n),r);return new t(wt.MIN,i,Ft(),Dt(),Lt())},t}(),Vr=function(){function t(t,e,n,r,i){this.resumeToken=t,this.current=e,this.addedDocuments=n,this.modifiedDocuments=r,this.removedDocuments=i}return t.createSynthesizedTargetChangeForCurrentChange=function(e,n){return new t(b(),n,Lt(),Lt(),Lt())},t}(),Br=function(t,e,n,r){this.updatedTargetIds=t,this.removedTargetIds=e,this.key=n,this.newDoc=r},Wr=function(t,e){this.targetId=t,this.existenceFilter=e};!function(t){t[t.NoChange=0]="NoChange",t[t.Added=1]="Added",t[t.Removed=2]="Removed",t[t.Current=3]="Current",t[t.Reset=4]="Reset"}(Fr||(Fr={}));var Kr=function(t,e,n,r){void 0===n&&(n=b()),void 0===r&&(r=null),this.state=t,this.targetIds=e,this.resumeToken=n,this.cause=r},Qr=function(){function t(){this.pendingResponses=0,this.documentChanges=zr(),this._resumeToken=b(),this._current=!1,this._hasPendingChanges=!0}return Object.defineProperty(t.prototype,"current",{get:function(){return this._current},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"resumeToken",{get:function(){return this._resumeToken},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isPending",{get:function(){return 0!==this.pendingResponses},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"hasPendingChanges",{get:function(){return this._hasPendingChanges},enumerable:!0,configurable:!0}),t.prototype.updateResumeToken=function(t){t.length>0&&(this._hasPendingChanges=!0,this._resumeToken=t)},t.prototype.toTargetChange=function(){var t=Lt(),e=Lt(),n=Lt();return this.documentChanges.forEach((function(r,i){switch(i){case Mr.Added:t=t.add(r);break;case Mr.Modified:e=e.add(r);break;case Mr.Removed:n=n.add(r);break;default:y("Encountered invalid change type: "+i)}})),new Vr(this._resumeToken,this._current,t,e,n)},t.prototype.clearPendingChanges=function(){this._hasPendingChanges=!1,this.documentChanges=zr()},t.prototype.addDocumentChange=function(t,e){this._hasPendingChanges=!0,this.documentChanges=this.documentChanges.insert(t,e)},t.prototype.removeDocumentChange=function(t){this._hasPendingChanges=!0,this.documentChanges=this.documentChanges.remove(t)},t.prototype.recordPendingTargetRequest=function(){this.pendingResponses+=1},t.prototype.recordTargetResponse=function(){this.pendingResponses-=1},t.prototype.markCurrent=function(){this._hasPendingChanges=!0,this._current=!0},t}(),Gr=function(){function t(t){this.metadataProvider=t,this.targetStates={},this.pendingDocumentUpdates=Dt(),this.pendingDocumentTargetMapping=Hr(),this.pendingTargetResets=new It(X)}return t.prototype.handleDocumentChange=function(t){for(var e=0,n=t.updatedTargetIds;e<n.length;e++){var r=n[e];t.newDoc instanceof je?this.addDocumentToTarget(r,t.newDoc):t.newDoc instanceof Ue&&this.removeDocumentFromTarget(r,t.key,t.newDoc)}for(var i=0,o=t.removedTargetIds;i<o.length;i++){r=o[i];this.removeDocumentFromTarget(r,t.key,t.newDoc)}},t.prototype.handleTargetChange=function(t){var e=this;this.forEachTarget(t,(function(n){var r=e.ensureTargetState(n);switch(t.state){case Fr.NoChange:e.isActiveTarget(n)&&r.updateResumeToken(t.resumeToken);break;case Fr.Added:r.recordTargetResponse(),r.isPending||r.clearPendingChanges(),r.updateResumeToken(t.resumeToken);break;case Fr.Removed:r.recordTargetResponse(),r.isPending||e.removeTarget(n),g(!t.cause,"WatchChangeAggregator does not handle errored targets");break;case Fr.Current:e.isActiveTarget(n)&&(r.markCurrent(),r.updateResumeToken(t.resumeToken));break;case Fr.Reset:e.isActiveTarget(n)&&(e.resetTarget(n),r.updateResumeToken(t.resumeToken));break;default:y("Unknown target watch change state: "+t.state)}}))},t.prototype.forEachTarget=function(t,e){t.targetIds.length>0?t.targetIds.forEach(e):I(this.targetStates,e)},t.prototype.handleExistenceFilter=function(t){var e=t.targetId,n=t.existenceFilter.count,r=this.targetDataForActiveTarget(e);if(r){var i=r.target;if(i.isDocumentQuery())if(0===n){var o=new lt(i.path);this.removeDocumentFromTarget(e,o,new Ue(o,wt.forDeletedDoc()))}else g(1===n,"Single document existence filter with count: "+n);else this.getCurrentDocumentCountForTarget(e)!==n&&(this.resetTarget(e),this.pendingTargetResets=this.pendingTargetResets.add(e))}},t.prototype.createRemoteEvent=function(t){var e=this,n={};I(this.targetStates,(function(r,i){var o=e.targetDataForActiveTarget(r);if(o){if(i.current&&o.target.isDocumentQuery()){var a=new lt(o.target.path);null!==e.pendingDocumentUpdates.get(a)||e.targetContainsDocument(r,a)||e.removeDocumentFromTarget(r,a,new Ue(a,t))}i.hasPendingChanges&&(n[r]=i.toTargetChange(),i.clearPendingChanges())}}));var r=Lt();this.pendingDocumentTargetMapping.forEach((function(t,n){var i=!0;n.forEachWhile((function(t){var n=e.targetDataForActiveTarget(t);return!n||n.purpose===dn.LimboResolution||(i=!1,!1)})),i&&(r=r.add(t))}));var i=new qr(t,n,this.pendingTargetResets,this.pendingDocumentUpdates,r);return this.pendingDocumentUpdates=Dt(),this.pendingDocumentTargetMapping=Hr(),this.pendingTargetResets=new It(X),i},t.prototype.addDocumentToTarget=function(t,e){if(this.isActiveTarget(t)){var n=this.targetContainsDocument(t,e.key)?Mr.Modified:Mr.Added;this.ensureTargetState(t).addDocumentChange(e.key,n),this.pendingDocumentUpdates=this.pendingDocumentUpdates.insert(e.key,e),this.pendingDocumentTargetMapping=this.pendingDocumentTargetMapping.insert(e.key,this.ensureDocumentTargetMapping(e.key).add(t))}},t.prototype.removeDocumentFromTarget=function(t,e,n){if(this.isActiveTarget(t)){var r=this.ensureTargetState(t);this.targetContainsDocument(t,e)?r.addDocumentChange(e,Mr.Removed):r.removeDocumentChange(e),this.pendingDocumentTargetMapping=this.pendingDocumentTargetMapping.insert(e,this.ensureDocumentTargetMapping(e).delete(t)),n&&(this.pendingDocumentUpdates=this.pendingDocumentUpdates.insert(e,n))}},t.prototype.removeTarget=function(t){delete this.targetStates[t]},t.prototype.getCurrentDocumentCountForTarget=function(t){var e=this.ensureTargetState(t).toTargetChange();return this.metadataProvider.getRemoteKeysForTarget(t).size+e.addedDocuments.size-e.removedDocuments.size},t.prototype.recordPendingTargetRequest=function(t){this.ensureTargetState(t).recordPendingTargetRequest()},t.prototype.ensureTargetState=function(t){return this.targetStates[t]||(this.targetStates[t]=new Qr),this.targetStates[t]},t.prototype.ensureDocumentTargetMapping=function(t){var e=this.pendingDocumentTargetMapping.get(t);return e||(e=new It(X),this.pendingDocumentTargetMapping=this.pendingDocumentTargetMapping.insert(t,e)),e},t.prototype.isActiveTarget=function(t){var e=null!==this.targetDataForActiveTarget(t);return e||p("WatchChangeAggregator","Detected inactive target",t),e},t.prototype.targetDataForActiveTarget=function(t){var e=this.targetStates[t];return e&&e.isPending?null:this.metadataProvider.getTargetDataForTarget(t)},t.prototype.resetTarget=function(t){var e=this;g(!this.targetStates[t].isPending,"Should only reset active targets"),this.targetStates[t]=new Qr,this.metadataProvider.getRemoteKeysForTarget(t).forEach((function(n){e.removeDocumentFromTarget(t,n,null)}))},t.prototype.targetContainsDocument=function(t,e){return this.metadataProvider.getRemoteKeysForTarget(t).has(e)},t}();function Hr(){return new Tt(lt.comparator)}function zr(){return new Tt(lt.comparator)}
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Yr=function(){function t(t,e,n,r,o){var a=this;this.localStore=t,this.datastore=e,this.writePipeline=[],this.listenTargets={},this.watchChangeAggregator=null,this.networkEnabled=!1,this.isPrimary=!1,this.connectivityMonitor=o,this.connectivityMonitor.addCallback((function(t){n.enqueueAndForget((function(){return Object(i.b)(a,void 0,void 0,(function(){return Object(i.d)(this,(function(t){switch(t.label){case 0:return this.canUseNetwork()?(p("RemoteStore","Restarting streams for network reachability change."),[4,this.restartNetwork()]):[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}}))}))}))})),this.onlineStateTracker=new Or(n,r),this.watchStream=this.datastore.newPersistentWatchStream({onOpen:this.onWatchStreamOpen.bind(this),onClose:this.onWatchStreamClose.bind(this),onWatchChange:this.onWatchStreamChange.bind(this)}),this.writeStream=this.datastore.newPersistentWriteStream({onOpen:this.onWriteStreamOpen.bind(this),onClose:this.onWriteStreamClose.bind(this),onHandshakeComplete:this.onWriteHandshakeComplete.bind(this),onMutationResult:this.onMutationResult.bind(this)})}return t.prototype.start=function(){return this.enableNetwork()},t.prototype.enableNetwork=function(){return Object(i.b)(this,void 0,void 0,(function(){var t;return Object(i.d)(this,(function(e){switch(e.label){case 0:return this.networkEnabled=!0,this.canUseNetwork()?(t=this.writeStream,[4,this.localStore.getLastStreamToken()]):[3,3];case 1:return t.lastStreamToken=e.sent(),this.shouldStartWatchStream()?this.startWatchStream():this.onlineStateTracker.set(_r.Unknown),[4,this.fillWritePipeline()];case 2:e.sent(),e.label=3;case 3:return[2]}}))}))},t.prototype.disableNetwork=function(){return Object(i.b)(this,void 0,void 0,(function(){return Object(i.d)(this,(function(t){switch(t.label){case 0:return this.networkEnabled=!1,[4,this.disableNetworkInternal()];case 1:return t.sent(),this.onlineStateTracker.set(_r.Offline),[2]}}))}))},t.prototype.disableNetworkInternal=function(){return Object(i.b)(this,void 0,void 0,(function(){return Object(i.d)(this,(function(t){switch(t.label){case 0:return[4,this.writeStream.stop()];case 1:return t.sent(),[4,this.watchStream.stop()];case 2:return t.sent(),this.writePipeline.length>0&&(p("RemoteStore","Stopping write stream with "+this.writePipeline.length+" pending writes"),this.writePipeline=[]),this.cleanUpWatchStreamState(),[2]}}))}))},t.prototype.shutdown=function(){return Object(i.b)(this,void 0,void 0,(function(){return Object(i.d)(this,(function(t){switch(t.label){case 0:return p("RemoteStore","RemoteStore shutting down."),this.networkEnabled=!1,[4,this.disableNetworkInternal()];case 1:return t.sent(),this.connectivityMonitor.shutdown(),this.onlineStateTracker.set(_r.Unknown),[2]}}))}))},t.prototype.listen=function(t){E(this.listenTargets,t.targetId)||(this.listenTargets[t.targetId]=t,this.shouldStartWatchStream()?this.startWatchStream():this.watchStream.isOpen()&&this.sendWatchRequest(t))},t.prototype.unlisten=function(t){g(E(this.listenTargets,t),"unlisten called on target no currently watched: "+t),delete this.listenTargets[t],this.watchStream.isOpen()&&this.sendUnwatchRequest(t),N(this.listenTargets)&&(this.watchStream.isOpen()?this.watchStream.markIdle():this.canUseNetwork()&&this.onlineStateTracker.set(_r.Unknown))},t.prototype.getTargetDataForTarget=function(t){return this.listenTargets[t]||null},t.prototype.getRemoteKeysForTarget=function(t){return this.syncEngine.getRemoteKeysForTarget(t)},t.prototype.sendWatchRequest=function(t){this.watchChangeAggregator.recordPendingTargetRequest(t.targetId),this.watchStream.watch(t)},t.prototype.sendUnwatchRequest=function(t){this.watchChangeAggregator.recordPendingTargetRequest(t),this.watchStream.unwatch(t)},t.prototype.startWatchStream=function(){g(this.shouldStartWatchStream(),"startWatchStream() called when shouldStartWatchStream() is false."),this.watchChangeAggregator=new Gr(this),this.watchStream.start(),this.onlineStateTracker.handleWatchStreamStart()},t.prototype.shouldStartWatchStream=function(){return this.canUseNetwork()&&!this.watchStream.isStarted()&&!N(this.listenTargets)},t.prototype.canUseNetwork=function(){return this.isPrimary&&this.networkEnabled},t.prototype.cleanUpWatchStreamState=function(){this.watchChangeAggregator=null},t.prototype.onWatchStreamOpen=function(){return Object(i.b)(this,void 0,void 0,(function(){var t=this;return Object(i.d)(this,(function(e){return I(this.listenTargets,(function(e,n){t.sendWatchRequest(n)})),[2]}))}))},t.prototype.onWatchStreamClose=function(t){return Object(i.b)(this,void 0,void 0,(function(){return Object(i.d)(this,(function(e){return void 0===t&&g(!this.shouldStartWatchStream(),"Watch stream was stopped gracefully while still needed."),this.cleanUpWatchStreamState(),this.shouldStartWatchStream()?(this.onlineStateTracker.handleWatchStreamFailure(t),this.startWatchStream()):this.onlineStateTracker.set(_r.Unknown),[2]}))}))},t.prototype.onWatchStreamChange=function(t,e){return Object(i.b)(this,void 0,void 0,(function(){var n;return Object(i.d)(this,(function(r){switch(r.label){case 0:return this.onlineStateTracker.set(_r.Online),t instanceof Kr&&t.state===Fr.Removed&&t.cause?[2,this.handleTargetError(t)]:(t instanceof Br?this.watchChangeAggregator.handleDocumentChange(t):t instanceof Wr?this.watchChangeAggregator.handleExistenceFilter(t):(g(t instanceof Kr,"Expected watchChange to be an instance of WatchTargetChange"),this.watchChangeAggregator.handleTargetChange(t)),e.isEqual(wt.MIN)?[3,3]:[4,this.localStore.getLastRemoteSnapshotVersion()]);case 1:return n=r.sent(),e.compareTo(n)>=0?[4,this.raiseWatchSnapshot(e)]:[3,3];case 2:r.sent(),r.label=3;case 3:return[2]}}))}))},t.prototype.raiseWatchSnapshot=function(t){var e=this;g(!t.isEqual(wt.MIN),"Can't raise event for unknown SnapshotVersion");var n=this.watchChangeAggregator.createRemoteEvent(t);return I(n.targetChanges,(function(n,r){if(r.resumeToken.length>0){var i=e.listenTargets[n];i&&(e.listenTargets[n]=i.withResumeToken(r.resumeToken,t))}})),n.targetMismatches.forEach((function(t){var n=e.listenTargets[t];if(n){e.listenTargets[t]=n.withResumeToken(b(),n.snapshotVersion),e.sendUnwatchRequest(t);var r=new Tn(n.target,t,dn.ExistenceFilterMismatch,n.sequenceNumber);e.sendWatchRequest(r)}})),this.syncEngine.applyRemoteEvent(n)},t.prototype.handleTargetError=function(t){var e=this;g(!!t.cause,"Handling target error without a cause");var n=t.cause,r=Promise.resolve();return t.targetIds.forEach((function(t){r=r.then((function(){return Object(i.b)(e,void 0,void 0,(function(){return Object(i.d)(this,(function(e){return E(this.listenTargets,t)?(delete this.listenTargets[t],this.watchChangeAggregator.removeTarget(t),[2,this.syncEngine.rejectListen(t,n)]):[2]}))}))}))})),r},t.prototype.fillWritePipeline=function(){return Object(i.b)(this,void 0,void 0,(function(){var t,e;return Object(i.d)(this,(function(n){switch(n.label){case 0:return this.canAddToWritePipeline()?(t=this.writePipeline.length>0?this.writePipeline[this.writePipeline.length-1].batchId:-1,[4,this.localStore.nextMutationBatch(t)]):[3,4];case 1:return null!==(e=n.sent())?[3,2]:(0===this.writePipeline.length&&this.writeStream.markIdle(),[3,4]);case 2:return this.addToWritePipeline(e),[4,this.fillWritePipeline()];case 3:n.sent(),n.label=4;case 4:return this.shouldStartWriteStream()&&this.startWriteStream(),[2]}}))}))},t.prototype.canAddToWritePipeline=function(){return this.canUseNetwork()&&this.writePipeline.length<10},t.prototype.outstandingWrites=function(){return this.writePipeline.length},t.prototype.addToWritePipeline=function(t){g(this.canAddToWritePipeline(),"addToWritePipeline called when pipeline is full"),this.writePipeline.push(t),this.writeStream.isOpen()&&this.writeStream.handshakeComplete&&this.writeStream.writeMutations(t.mutations)},t.prototype.shouldStartWriteStream=function(){return this.canUseNetwork()&&!this.writeStream.isStarted()&&this.writePipeline.length>0},t.prototype.startWriteStream=function(){g(this.shouldStartWriteStream(),"startWriteStream() called when shouldStartWriteStream() is false."),this.writeStream.start()},t.prototype.onWriteStreamOpen=function(){return Object(i.b)(this,void 0,void 0,(function(){return Object(i.d)(this,(function(t){return this.writeStream.writeHandshake(),[2]}))}))},t.prototype.onWriteHandshakeComplete=function(){var t=this;return this.localStore.setLastStreamToken(this.writeStream.lastStreamToken).then((function(){for(var e=0,n=t.writePipeline;e<n.length;e++){var r=n[e];t.writeStream.writeMutations(r.mutations)}})).catch(Ln)},t.prototype.onMutationResult=function(t,e){var n=this;g(this.writePipeline.length>0,"Got result for empty write pipeline");var r=this.writePipeline.shift(),i=Ut.from(r,t,e,this.writeStream.lastStreamToken);return this.syncEngine.applySuccessfulWrite(i).then((function(){return n.fillWritePipeline()}))},t.prototype.onWriteStreamClose=function(t){return Object(i.b)(this,void 0,void 0,(function(){var e=this;return Object(i.d)(this,(function(n){return void 0===t&&g(!this.shouldStartWriteStream(),"Write stream was stopped gracefully while still needed."),t&&this.writePipeline.length>0?(void 0,[2,(this.writeStream.handshakeComplete?this.handleWriteError(t):this.handleHandshakeError(t)).then((function(){e.shouldStartWriteStream()&&e.startWriteStream()}))]):[2]}))}))},t.prototype.handleHandshakeError=function(t){return Object(i.b)(this,void 0,void 0,(function(){return Object(i.d)(this,(function(e){return kr(t.code)?(p("RemoteStore","RemoteStore error before completed handshake; resetting stream token: ",this.writeStream.lastStreamToken),this.writeStream.lastStreamToken=b(),[2,this.localStore.setLastStreamToken(b()).catch(Ln)]):[2]}))}))},t.prototype.handleWriteError=function(t){return Object(i.b)(this,void 0,void 0,(function(){var e,n=this;return Object(i.d)(this,(function(r){return kr(i=t.code)&&i!==w.ABORTED?(e=this.writePipeline.shift(),this.writeStream.inhibitBackoff(),[2,this.syncEngine.rejectFailedWrite(e.batchId,t).then((function(){return n.fillWritePipeline()}))]):[2];var i}))}))},t.prototype.createTransaction=function(){return new Dr(this.datastore)},t.prototype.restartNetwork=function(){return Object(i.b)(this,void 0,void 0,(function(){return Object(i.d)(this,(function(t){switch(t.label){case 0:return this.networkEnabled=!1,[4,this.disableNetworkInternal()];case 1:return t.sent(),this.onlineStateTracker.set(_r.Unknown),[4,this.enableNetwork()];case 2:return t.sent(),[2]}}))}))},t.prototype.handleCredentialChange=function(){return Object(i.b)(this,void 0,void 0,(function(){return Object(i.d)(this,(function(t){switch(t.label){case 0:return this.canUseNetwork()?(p("RemoteStore","RemoteStore restarting streams for new credential"),[4,this.restartNetwork()]):[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}}))}))},t.prototype.applyPrimaryState=function(t){return Object(i.b)(this,void 0,void 0,(function(){return Object(i.d)(this,(function(e){switch(e.label){case 0:return this.isPrimary=t,t&&this.networkEnabled?[4,this.enableNetwork()]:[3,2];case 1:return e.sent(),[3,4];case 2:return t?[3,4]:[4,this.disableNetworkInternal()];case 3:e.sent(),this.onlineStateTracker.set(_r.Unknown),e.label=4;case 4:return[2]}}))}))},t}(),Xr=function(){function t(t,e){if(A("GeoPoint",arguments,2),P("GeoPoint","number",1,t),P("GeoPoint","number",2,e),!isFinite(t)||t<-90||t>90)throw new T(w.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+t);if(!isFinite(e)||e<-180||e>180)throw new T(w.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+e);this._lat=t,this._long=e}return Object.defineProperty(t.prototype,"latitude",{get:function(){return this._lat},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"longitude",{get:function(){return this._long},enumerable:!0,configurable:!0}),t.prototype.isEqual=function(t){return this._lat===t._lat&&this._long===t._long},t.prototype._compareTo=function(t){return X(this._lat,t._lat)||X(this._long,t._long)},t}(),Jr=function(){function t(){}return t.prototype.applyToLocalView=function(t,e){return new ke(e,t)},t.prototype.applyToRemoteDocument=function(t,e){return e},t.prototype.computeBaseValue=function(t){return null},t.prototype.isEqual=function(e){return e instanceof t},t.instance=new t,t}(),$r=function(){function t(t){this.elements=t}return t.prototype.applyToLocalView=function(t,e){return this.apply(t)},t.prototype.applyToRemoteDocument=function(t,e){return this.apply(t)},t.prototype.apply=function(t){for(var e=ei(t),n=function(t){e.find((function(e){return e.isEqual(t)}))||e.push(t)},r=0,i=this.elements;r<i.length;r++){n(i[r])}return new xe(e)},t.prototype.computeBaseValue=function(t){return null},t.prototype.isEqual=function(e){return e instanceof t&&J(e.elements,this.elements)},t}(),Zr=function(){function t(t){this.elements=t}return t.prototype.applyToLocalView=function(t,e){return this.apply(t)},t.prototype.applyToRemoteDocument=function(t,e){return this.apply(t)},t.prototype.apply=function(t){for(var e=ei(t),n=function(t){e=e.filter((function(e){return!e.isEqual(t)}))},r=0,i=this.elements;r<i.length;r++){n(i[r])}return new xe(e)},t.prototype.computeBaseValue=function(t){return null},t.prototype.isEqual=function(e){return e instanceof t&&J(e.elements,this.elements)},t}(),ti=function(){function t(t){this.operand=t}return t.prototype.applyToLocalView=function(t,e){var n=this.computeBaseValue(t);if(n instanceof Ne&&this.operand instanceof Ne){var r=n.internalValue+this.operand.internalValue;return new Ne(r)}r=n.internalValue+this.operand.internalValue;return new De(r)},t.prototype.applyToRemoteDocument=function(t,e){return g(null!==e,"Didn't receive transformResult for NUMERIC_ADD transform"),e},t.prototype.computeBaseValue=function(t){return t instanceof Ie?t:new Ne(0)},t.prototype.isEqual=function(e){return e instanceof t&&this.operand.isEqual(e.operand)},t}();function ei(t){return t instanceof xe?t.internalValue.slice():[]}
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var ni,ri,ii=function(){function t(t){this.count=t}return t.prototype.isEqual=function(t){return t&&t.count===this.count},t}(),oi=((ni={})[rr.ASCENDING.name]="ASCENDING",ni[rr.DESCENDING.name]="DESCENDING",ni),ai=((ri={})[Xn.LESS_THAN.name]="LESS_THAN",ri[Xn.LESS_THAN_OR_EQUAL.name]="LESS_THAN_OR_EQUAL",ri[Xn.GREATER_THAN.name]="GREATER_THAN",ri[Xn.GREATER_THAN_OR_EQUAL.name]="GREATER_THAN_OR_EQUAL",ri[Xn.EQUAL.name]="EQUAL",ri[Xn.ARRAY_CONTAINS.name]="ARRAY_CONTAINS",ri[Xn.IN.name]="IN",ri[Xn.ARRAY_CONTAINS_ANY.name]="ARRAY_CONTAINS_ANY",ri),si=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ui(t,e){g(!Kn(t),e+" is missing")}function ci(t){return"number"==typeof t?t:"string"==typeof t?Number(t):y("can't parse "+t)}var hi=function(){function t(t,e){this.databaseId=t,this.options=e}return t.prototype.emptyByteString=function(){return this.options.useProto3Json?"":new Uint8Array(0)},t.prototype.unsafeCastProtoByteString=function(t){return t},t.prototype.fromRpcStatus=function(t){var e=void 0===t.code?w.UNKNOWN:Rr(t.code);return new T(e,t.message||"")},t.prototype.toInt32Value=function(t){return this.options.useProto3Json||Kn(t)?t:{value:t}},t.prototype.fromInt32Value=function(t){var e;return Kn(e="object"==typeof t?t.value:t)?null:e},t.prototype.toTimestamp=function(t){return this.options.useProto3Json?new Date(1e3*t.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")+"."+("000000000"+t.nanoseconds).slice(-9)+"Z":{seconds:""+t.seconds,nanos:t.nanoseconds}},t.prototype.fromTimestamp=function(t){if("string"==typeof t)return this.fromIso8601String(t);g(!!t,"Cannot deserialize null or undefined timestamp.");var e=ci(t.seconds||"0"),n=t.nanos||0;return new bt(e,n)},t.prototype.fromIso8601String=function(t){var e=0,n=si.exec(t);if(g(!!n,"invalid timestamp: "+t),n[1]){var r=n[1];r=(r+"000000000").substr(0,9),e=Number(r)}var i=new Date(t),o=Math.floor(i.getTime()/1e3);return new bt(o,e)},t.prototype.toBytes=function(t){return this.options.useProto3Json?t.toBase64():this.unsafeCastProtoByteString(t.toUint8Array())},t.prototype.fromBlob=function(t){return"string"==typeof t?(g(this.options.useProto3Json,"Expected bytes to be passed in as Uint8Array, but got a string instead."),nt.fromBase64String(t)):(g(!this.options.useProto3Json,"Expected bytes to be passed in as Uint8Array, but got a string instead."),nt.fromUint8Array(t))},t.prototype.toVersion=function(t){return this.toTimestamp(t.toTimestamp())},t.prototype.fromVersion=function(t){return g(!!t,"Trying to deserialize version that isn't set"),wt.fromTimestamp(this.fromTimestamp(t))},t.prototype.toResourceName=function(t,e){return this.fullyQualifiedPrefixPath(t).child("documents").child(e).canonicalString()},t.prototype.fromResourceName=function(t){var e=ut.fromString(t);return g(this.isValidResourceName(e),"Tried to deserialize invalid key "+e.toString()),e},t.prototype.toName=function(t){return this.toResourceName(this.databaseId,t.path)},t.prototype.fromName=function(t){var e=this.fromResourceName(t);return g(e.get(1)===this.databaseId.projectId,"Tried to deserialize key from different project: "+e.get(1)+" vs "+this.databaseId.projectId),g(!e.get(3)&&!this.databaseId.database||e.get(3)===this.databaseId.database,"Tried to deserialize key from different database: "+e.get(3)+" vs "+this.databaseId.database),new lt(this.extractLocalPathFromResourceName(e))},t.prototype.toQueryPath=function(t){return this.toResourceName(this.databaseId,t)},t.prototype.fromQueryPath=function(t){var e=this.fromResourceName(t);return 4===e.length?ut.EMPTY_PATH:this.extractLocalPathFromResourceName(e)},Object.defineProperty(t.prototype,"encodedDatabaseId",{get:function(){return new ut(["projects",this.databaseId.projectId,"databases",this.databaseId.database]).canonicalString()},enumerable:!0,configurable:!0}),t.prototype.fullyQualifiedPrefixPath=function(t){return new ut(["projects",t.projectId,"databases",t.database])},t.prototype.extractLocalPathFromResourceName=function(t){return g(t.length>4&&"documents"===t.get(4),"tried to deserialize invalid key "+t.toString()),t.popFirst(5)},t.prototype.isValidResourceName=function(t){return t.length>=4&&"projects"===t.get(0)&&"databases"===t.get(2)},t.prototype.toValue=function(t){if(t instanceof Ee)return{nullValue:"NULL_VALUE"};if(t instanceof Se)return{booleanValue:t.value()};if(t instanceof Ne)return{integerValue:""+t.value()};if(t instanceof De){var e=t.value();if(this.options.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:t.value()}}return t instanceof Ae?{stringValue:t.value()}:t instanceof Le?{mapValue:this.toMapValue(t)}:t instanceof xe?{arrayValue:this.toArrayValue(t)}:t instanceof Oe?{timestampValue:this.toTimestamp(t.internalValue)}:t instanceof Me?{geoPointValue:{latitude:t.value().latitude,longitude:t.value().longitude}}:t instanceof Re?{bytesValue:this.toBytes(t.value())}:t instanceof Pe?{referenceValue:this.toResourceName(t.databaseId,t.key.path)}:y("Unknown FieldValue "+JSON.stringify(t))},t.prototype.fromValue=function(t){var e=this;if("nullValue"in t)return Ee.INSTANCE;if("booleanValue"in t)return Se.of(t.booleanValue);if("integerValue"in t)return new Ne(ci(t.integerValue));if("doubleValue"in t){if(this.options.useProto3Json){if("NaN"===t.doubleValue)return De.NAN;if("Infinity"===t.doubleValue)return De.POSITIVE_INFINITY;if("-Infinity"===t.doubleValue)return De.NEGATIVE_INFINITY}return new De(t.doubleValue)}if("stringValue"in t)return new Ae(t.stringValue);if("mapValue"in t)return this.fromFields(t.mapValue.fields||{});if("arrayValue"in t){ui(t.arrayValue,"arrayValue");var n=t.arrayValue.values||[];return new xe(n.map((function(t){return e.fromValue(t)})))}if("timestampValue"in t)return ui(t.timestampValue,"timestampValue"),new Oe(this.fromTimestamp(t.timestampValue));if("geoPointValue"in t){ui(t.geoPointValue,"geoPointValue");var r=t.geoPointValue.latitude||0,i=t.geoPointValue.longitude||0;return new Me(new Xr(r,i))}if("bytesValue"in t){ui(t.bytesValue,"bytesValue");var o=this.fromBlob(t.bytesValue);return new Re(o)}if("referenceValue"in t){ui(t.referenceValue,"referenceValue");var a=this.fromResourceName(t.referenceValue),s=new ot(a.get(1),a.get(3)),u=new lt(this.extractLocalPathFromResourceName(a));return new Pe(s,u)}return y("Unknown Value proto "+JSON.stringify(t))},t.prototype.toMutationDocument=function(t,e){return{name:this.toName(t),fields:this.toFields(e)}},t.prototype.toDocument=function(t){return g(!t.hasLocalMutations,"Can't serialize documents with mutations."),{name:this.toName(t.key),fields:this.toFields(t.data()),updateTime:this.toTimestamp(t.version.toTimestamp())}},t.prototype.fromDocument=function(t,e){var n=this,r=this.fromName(t.name),i=this.fromVersion(t.updateTime);return new je(r,i,{hasCommittedMutations:!!e},void 0,t,(function(t){return n.fromValue(t)}))},t.prototype.toFields=function(t){var e=this,n={};return t.forEach((function(t,r){n[t]=e.toValue(r)})),n},t.prototype.fromFields=function(t){var e=this,n=t,r=Le.EMPTY;return C(n,(function(t,n){r=r.set(new ht([t]),e.fromValue(n))})),r},t.prototype.toMapValue=function(t){return{fields:this.toFields(t)}},t.prototype.toArrayValue=function(t){var e=this,n=[];return t.forEach((function(t){n.push(e.toValue(t))})),{values:n}},t.prototype.fromFound=function(t){var e=this;g(!!t.found,"Tried to deserialize a found document from a missing document."),ui(t.found.name,"doc.found.name"),ui(t.found.updateTime,"doc.found.updateTime");var n=this.fromName(t.found.name),r=this.fromVersion(t.found.updateTime);return new je(n,r,{},void 0,t.found,(function(t){return e.fromValue(t)}))},t.prototype.fromMissing=function(t){g(!!t.missing,"Tried to deserialize a missing document from a found document."),g(!!t.readTime,"Tried to deserialize a missing document without a read time.");var e=this.fromName(t.missing),n=this.fromVersion(t.readTime);return new Ue(e,n)},t.prototype.fromMaybeDocument=function(t){return"found"in t?this.fromFound(t):"missing"in t?this.fromMissing(t):y("invalid batch get response: "+JSON.stringify(t))},t.prototype.toWatchTargetChangeState=function(t){switch(t){case Fr.Added:return"ADD";case Fr.Current:return"CURRENT";case Fr.NoChange:return"NO_CHANGE";case Fr.Removed:return"REMOVE";case Fr.Reset:return"RESET";default:return y("Unknown WatchTargetChangeState: "+t)}},t.prototype.toTestWatchChange=function(t){if(t instanceof Wr)return{filter:{count:t.existenceFilter.count,targetId:t.targetId}};if(t instanceof Br){if(t.newDoc instanceof je){var e=t.newDoc;return{documentChange:{document:{name:this.toName(e.key),fields:this.toFields(e.data()),updateTime:this.toVersion(e.version)},targetIds:t.updatedTargetIds,removedTargetIds:t.removedTargetIds}}}if(t.newDoc instanceof Ue){e=t.newDoc;return{documentDelete:{document:this.toName(e.key),readTime:this.toVersion(e.version),removedTargetIds:t.removedTargetIds}}}if(null===t.newDoc)return{documentRemove:{document:this.toName(t.key),removedTargetIds:t.removedTargetIds}}}if(t instanceof Kr){var n=void 0;return t.cause&&(n={code:Pr(t.cause.code),message:t.cause.message}),{targetChange:{targetChangeType:this.toWatchTargetChangeState(t.state),targetIds:t.targetIds,resumeToken:this.unsafeCastProtoByteString(t.resumeToken),cause:n}}}return y("Unrecognized watch change: "+JSON.stringify(t))},t.prototype.fromWatchChange=function(t){var e,n=this;if("targetChange"in t){ui(t.targetChange,"targetChange");var r=this.fromWatchTargetChangeState(t.targetChange.targetChangeType||"NO_CHANGE"),i=t.targetChange.targetIds||[],o=t.targetChange.resumeToken||this.emptyByteString(),a=t.targetChange.cause,s=a&&this.fromRpcStatus(a);e=new Kr(r,i,o,s||null)}else if("documentChange"in t){ui(t.documentChange,"documentChange");var u=t.documentChange;ui(u.document,"documentChange.name"),ui(u.document.name,"documentChange.document.name"),ui(u.document.updateTime,"documentChange.document.updateTime");var c=this.fromName(u.document.name),h=this.fromVersion(u.document.updateTime),l=new je(c,h,{},void 0,u.document,(function(t){return n.fromValue(t)})),f=u.targetIds||[],p=u.removedTargetIds||[];e=new Br(f,p,l.key,l)}else if("documentDelete"in t){ui(t.documentDelete,"documentDelete");var d=t.documentDelete;ui(d.document,"documentDelete.document");c=this.fromName(d.document),h=d.readTime?this.fromVersion(d.readTime):wt.forDeletedDoc(),l=new Ue(c,h),p=d.removedTargetIds||[];e=new Br([],p,l.key,l)}else if("documentRemove"in t){ui(t.documentRemove,"documentRemove");var m=t.documentRemove;ui(m.document,"documentRemove");c=this.fromName(m.document),p=m.removedTargetIds||[];e=new Br([],p,c,null)}else{if(!("filter"in t))return y("Unknown change type "+JSON.stringify(t));ui(t.filter,"filter");var g=t.filter;ui(g.targetId,"filter.targetId");var v=g.count||0,b=new ii(v),w=g.targetId;e=new Wr(w,b)}return e},t.prototype.fromWatchTargetChangeState=function(t){return"NO_CHANGE"===t?Fr.NoChange:"ADD"===t?Fr.Added:"REMOVE"===t?Fr.Removed:"CURRENT"===t?Fr.Current:"RESET"===t?Fr.Reset:y("Got unexpected TargetChange.state: "+t)},t.prototype.versionFromListenResponse=function(t){if(!("targetChange"in t))return wt.MIN;var e=t.targetChange;return e.targetIds&&e.targetIds.length?wt.MIN:e.readTime?this.fromVersion(e.readTime):wt.MIN},t.prototype.toMutation=function(t){var e,n=this;if(t instanceof ge)e={update:this.toMutationDocument(t.key,t.value)};else if(t instanceof we)e={delete:this.toName(t.key)};else if(t instanceof ve)e={update:this.toMutationDocument(t.key,t.data),updateMask:this.toDocumentMask(t.fieldMask)};else{if(!(t instanceof be))return y("Unknown mutation type "+t.type);e={transform:{document:this.toName(t.key),fieldTransforms:t.fieldTransforms.map((function(t){return n.toFieldTransform(t)}))}}}return t.precondition.isNone||(e.currentDocument=this.toPrecondition(t.precondition)),e},t.prototype.fromMutation=function(t){var e=this,n=t.currentDocument?this.fromPrecondition(t.currentDocument):me.NONE;if(t.update){ui(t.update.name,"name");var r=this.fromName(t.update.name),i=this.fromFields(t.update.fields||{});if(t.updateMask){var o=this.fromDocumentMask(t.updateMask);return new ve(r,i,o,n)}return new ge(r,i,n)}if(t.delete){r=this.fromName(t.delete);return new we(r,n)}if(t.transform){r=this.fromName(t.transform.document);var a=t.transform.fieldTransforms.map((function(t){return e.fromFieldTransform(t)}));return g(!0===n.exists,'Transforms only support precondition "exists == true"'),new be(r,a)}return y("unknown mutation proto: "+JSON.stringify(t))},t.prototype.toPrecondition=function(t){return g(!t.isNone,"Can't serialize an empty precondition"),void 0!==t.updateTime?{updateTime:this.toVersion(t.updateTime)}:void 0!==t.exists?{exists:t.exists}:y("Unknown precondition")},t.prototype.fromPrecondition=function(t){return void 0!==t.updateTime?me.updateTime(this.fromVersion(t.updateTime)):void 0!==t.exists?me.exists(t.exists):me.NONE},t.prototype.fromWriteResult=function(t,e){var n=this,r=t.updateTime?this.fromVersion(t.updateTime):this.fromVersion(e);r.isEqual(wt.MIN)&&(r=this.fromVersion(e));var i=null;return t.transformResults&&t.transformResults.length>0&&(i=t.transformResults.map((function(t){return n.fromValue(t)}))),new fe(r,i)},t.prototype.fromWriteResults=function(t,e){var n=this;return t&&t.length>0?(g(void 0!==e,"Received a write result without a commit time"),t.map((function(t){return n.fromWriteResult(t,e)}))):[]},t.prototype.toFieldTransform=function(t){var e=this,n=t.transform;if(n instanceof Jr)return{fieldPath:t.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(n instanceof $r)return{fieldPath:t.field.canonicalString(),appendMissingElements:{values:n.elements.map((function(t){return e.toValue(t)}))}};if(n instanceof Zr)return{fieldPath:t.field.canonicalString(),removeAllFromArray:{values:n.elements.map((function(t){return e.toValue(t)}))}};if(n instanceof ti)return{fieldPath:t.field.canonicalString(),increment:this.toValue(n.operand)};throw y("Unknown transform: "+t.transform)},t.prototype.fromFieldTransform=function(t){var e=this,n=null;if("setToServerValue"in t)g("REQUEST_TIME"===t.setToServerValue,"Unknown server value transform proto: "+JSON.stringify(t)),n=Jr.instance;else if("appendMissingElements"in t){var r=t.appendMissingElements.values||[];n=new $r(r.map((function(t){return e.fromValue(t)})))}else if("removeAllFromArray"in t){r=t.removeAllFromArray.values||[];n=new Zr(r.map((function(t){return e.fromValue(t)})))}else if("increment"in t){var i=this.fromValue(t.increment);g(i instanceof Ie,"NUMERIC_ADD transform requires a NumberValue"),n=new ti(i)}else y("Unknown transform proto: "+JSON.stringify(t));var o=ht.fromServerFormat(t.fieldPath);return new le(o,n)},t.prototype.toDocumentsTarget=function(t){return{documents:[this.toQueryPath(t.path)]}},t.prototype.fromDocumentsTarget=function(t){var e=t.documents.length;g(1===e,"DocumentsTarget contained other than 1 document: "+e);var n=t.documents[0];return zn.atPath(this.fromQueryPath(n)).toTarget()},t.prototype.toQueryTarget=function(t){var e={structuredQuery:{}},n=t.path;null!==t.collectionGroup?(g(n.length%2==0,"Collection Group queries should be within a document path or root."),e.parent=this.toQueryPath(n),e.structuredQuery.from=[{collectionId:t.collectionGroup,allDescendants:!0}]):(g(n.length%2!=0,"Document queries with filters are not supported."),e.parent=this.toQueryPath(n.popLast()),e.structuredQuery.from=[{collectionId:n.lastSegment()}]);var r=this.toFilter(t.filters);r&&(e.structuredQuery.where=r);var i=this.toOrder(t.orderBy);i&&(e.structuredQuery.orderBy=i);var o=this.toInt32Value(t.limit);return null!==o&&(e.structuredQuery.limit=o),t.startAt&&(e.structuredQuery.startAt=this.toCursor(t.startAt)),t.endAt&&(e.structuredQuery.endAt=this.toCursor(t.endAt)),e},t.prototype.fromQueryTarget=function(t){var e=this.fromQueryPath(t.parent),n=t.structuredQuery,r=n.from?n.from.length:0,i=null;if(r>0){g(1===r,"StructuredQuery.from with more than one collection is not supported.");var o=n.from[0];o.allDescendants?i=o.collectionId:e=e.child(o.collectionId)}var a=[];n.where&&(a=this.fromFilter(n.where));var s=[];n.orderBy&&(s=this.fromOrder(n.orderBy));var u=null;n.limit&&(u=this.fromInt32Value(n.limit));var c=null;n.startAt&&(c=this.fromCursor(n.startAt));var h=null;return n.endAt&&(h=this.fromCursor(n.endAt)),new zn(e,i,s,a,u,Gn.First,c,h).toTarget()},t.prototype.toListenRequestLabels=function(t){var e=this.toLabel(t.purpose);return null==e?null:{"goog-listen-tags":e}},t.prototype.toLabel=function(t){switch(t){case dn.Listen:return null;case dn.ExistenceFilterMismatch:return"existence-filter-mismatch";case dn.LimboResolution:return"limbo-document";default:return y("Unrecognized query purpose: "+t)}},t.prototype.toTarget=function(t){var e,n=t.target;return(e=n.isDocumentQuery()?{documents:this.toDocumentsTarget(n)}:{query:this.toQueryTarget(n)}).targetId=t.targetId,t.resumeToken.length>0&&(e.resumeToken=this.unsafeCastProtoByteString(t.resumeToken)),e},t.prototype.toFilter=function(t){var e=this;if(0!==t.length){var n=t.map((function(t){return t instanceof Jn?e.toUnaryOrFieldFilter(t):y("Unrecognized filter: "+JSON.stringify(t))}));return 1===n.length?n[0]:{compositeFilter:{op:"AND",filters:n}}}},t.prototype.fromFilter=function(t){var e=this;return t?void 0!==t.unaryFilter?[this.fromUnaryFilter(t)]:void 0!==t.fieldFilter?[this.fromFieldFilter(t)]:void 0!==t.compositeFilter?t.compositeFilter.filters.map((function(t){return e.fromFilter(t)})).reduce((function(t,e){return t.concat(e)})):y("Unknown filter: "+JSON.stringify(t)):[]},t.prototype.toOrder=function(t){var e=this;if(0!==t.length)return t.map((function(t){return e.toPropertyOrder(t)}))},t.prototype.fromOrder=function(t){var e=this;return t.map((function(t){return e.fromPropertyOrder(t)}))},t.prototype.toCursor=function(t){var e=this;return{before:t.before,values:t.position.map((function(t){return e.toValue(t)}))}},t.prototype.fromCursor=function(t){var e=this,n=!!t.before,r=t.values.map((function(t){return e.fromValue(t)}));return new ir(r,n)},t.prototype.toDirection=function(t){return oi[t.name]},t.prototype.fromDirection=function(t){switch(t){case"ASCENDING":return rr.ASCENDING;case"DESCENDING":return rr.DESCENDING;default:return}},t.prototype.toOperatorName=function(t){return ai[t.name]},t.prototype.fromOperatorName=function(t){switch(t){case"EQUAL":return Xn.EQUAL;case"GREATER_THAN":return Xn.GREATER_THAN;case"GREATER_THAN_OR_EQUAL":return Xn.GREATER_THAN_OR_EQUAL;case"LESS_THAN":return Xn.LESS_THAN;case"LESS_THAN_OR_EQUAL":return Xn.LESS_THAN_OR_EQUAL;case"ARRAY_CONTAINS":return Xn.ARRAY_CONTAINS;case"IN":return Xn.IN;case"ARRAY_CONTAINS_ANY":return Xn.ARRAY_CONTAINS_ANY;case"OPERATOR_UNSPECIFIED":return y("Unspecified operator");default:return y("Unknown operator")}},t.prototype.toFieldPathReference=function(t){return{fieldPath:t.canonicalString()}},t.prototype.fromFieldPathReference=function(t){return ht.fromServerFormat(t.fieldPath)},t.prototype.toPropertyOrder=function(t){return{field:this.toFieldPathReference(t.field),direction:this.toDirection(t.dir)}},t.prototype.fromPropertyOrder=function(t){return new or(this.fromFieldPathReference(t.field),this.fromDirection(t.direction))},t.prototype.fromFieldFilter=function(t){return Jn.create(this.fromFieldPathReference(t.fieldFilter.field),this.fromOperatorName(t.fieldFilter.op),this.fromValue(t.fieldFilter.value))},t.prototype.toUnaryOrFieldFilter=function(t){if(t.op===Xn.EQUAL){if(t.value.isEqual(De.NAN))return{unaryFilter:{field:this.toFieldPathReference(t.field),op:"IS_NAN"}};if(t.value.isEqual(Ee.INSTANCE))return{unaryFilter:{field:this.toFieldPathReference(t.field),op:"IS_NULL"}}}return{fieldFilter:{field:this.toFieldPathReference(t.field),op:this.toOperatorName(t.op),value:this.toValue(t.value)}}},t.prototype.fromUnaryFilter=function(t){switch(t.unaryFilter.op){case"IS_NAN":var e=this.fromFieldPathReference(t.unaryFilter.field);return Jn.create(e,Xn.EQUAL,De.NAN);case"IS_NULL":var n=this.fromFieldPathReference(t.unaryFilter.field);return Jn.create(n,Xn.EQUAL,Ee.INSTANCE);case"OPERATOR_UNSPECIFIED":return y("Unspecified filter");default:return y("Unknown filter")}},t.prototype.toDocumentMask=function(t){var e=[];return t.fields.forEach((function(t){return e.push(t.canonicalString())})),{fieldPaths:e}},t.prototype.fromDocumentMask=function(t){var e=(t.fieldPaths||[]).map((function(t){return ht.fromServerFormat(t)}));return he.fromArray(e)},t}(),li=function(){this.viewSnap=null,this.targetId=0,this.listeners=[]},fi=function(){function t(t){this.syncEngine=t,this.queries=new Ve((function(t){return t.canonicalId()})),this.onlineState=_r.Unknown,this.snapshotsInSyncListeners=new Set,this.syncEngine.subscribe(this)}return t.prototype.listen=function(t){var e=t.query,n=!1,r=this.queries.get(e);(r||(n=!0,r=new li,this.queries.set(e,r)),r.listeners.push(t),g(!t.applyOnlineStateChange(this.onlineState),"applyOnlineStateChange() shouldn't raise an event for brand-new listeners."),r.viewSnap)&&(t.onViewSnapshot(r.viewSnap)&&this.raiseSnapshotsInSyncEvent());return n?this.syncEngine.listen(e).then((function(t){return r.targetId=t,t})):Promise.resolve(r.targetId)},t.prototype.unlisten=function(t){return Object(i.b)(this,void 0,void 0,(function(){var e,n,r,o;return Object(i.d)(this,(function(i){return e=t.query,n=!1,(r=this.queries.get(e))&&(o=r.listeners.indexOf(t))>=0&&(r.listeners.splice(o,1),n=0===r.listeners.length),n?(this.queries.delete(e),[2,this.syncEngine.unlisten(e)]):[2]}))}))},t.prototype.onWatchChange=function(t){for(var e=!1,n=0,r=t;n<r.length;n++){var i=r[n],o=i.query,a=this.queries.get(o);if(a){for(var s=0,u=a.listeners;s<u.length;s++){u[s].onViewSnapshot(i)&&(e=!0)}a.viewSnap=i}}e&&this.raiseSnapshotsInSyncEvent()},t.prototype.onWatchError=function(t,e){var n=this.queries.get(t);if(n)for(var r=0,i=n.listeners;r<i.length;r++){i[r].onError(e)}this.queries.delete(t)},t.prototype.onOnlineStateChange=function(t){this.onlineState=t;var e=!1;this.queries.forEach((function(n,r){for(var i=0,o=r.listeners;i<o.length;i++){o[i].applyOnlineStateChange(t)&&(e=!0)}})),e&&this.raiseSnapshotsInSyncEvent()},t.prototype.addSnapshotsInSyncListener=function(t){this.snapshotsInSyncListeners.add(t),t.next()},t.prototype.removeSnapshotsInSyncListener=function(t){this.snapshotsInSyncListeners.delete(t)},t.prototype.raiseSnapshotsInSyncEvent=function(){this.snapshotsInSyncListeners.forEach((function(t){t.next()}))},t}(),pi=function(){function t(t,e,n){this.query=t,this.queryObserver=e,this.raisedInitialEvent=!1,this.snap=null,this.onlineState=_r.Unknown,this.options=n||{}}return t.prototype.onViewSnapshot=function(t){if(g(t.docChanges.length>0||t.syncStateChanged,"We got a new snapshot with no changes?"),!this.options.includeMetadataChanges){for(var e=[],n=0,r=t.docChanges;n<r.length;n++){var i=r[n];i.type!==Mr.Metadata&&e.push(i)}t=new Ur(t.query,t.docs,t.oldDocs,e,t.mutatedKeys,t.fromCache,t.syncStateChanged,!0)}var o=!1;return this.raisedInitialEvent?this.shouldRaiseEvent(t)&&(this.queryObserver.next(t),o=!0):this.shouldRaiseInitialEvent(t,this.onlineState)&&(this.raiseInitialEvent(t),o=!0),this.snap=t,o},t.prototype.onError=function(t){this.queryObserver.error(t)},t.prototype.applyOnlineStateChange=function(t){this.onlineState=t;var e=!1;return this.snap&&!this.raisedInitialEvent&&this.shouldRaiseInitialEvent(this.snap,t)&&(this.raiseInitialEvent(this.snap),e=!0),e},t.prototype.shouldRaiseInitialEvent=function(t,e){if(g(!this.raisedInitialEvent,"Determining whether to raise first event but already had first event"),!t.fromCache)return!0;var n=e!==_r.Offline;return this.options.waitForSyncWhenOnline&&n?(g(t.fromCache,"Waiting for sync, but snapshot is not from cache"),!1):!t.docs.isEmpty()||e===_r.Offline},t.prototype.shouldRaiseEvent=function(t){if(t.docChanges.length>0)return!0;var e=this.snap&&this.snap.hasPendingWrites!==t.hasPendingWrites;return!(!t.syncStateChanged&&!e)&&!0===this.options.includeMetadataChanges},t.prototype.raiseInitialEvent=function(t){g(!this.raisedInitialEvent,"Trying to raise initial events for second time"),t=Ur.fromInitialDocuments(t.query,t.docs,t.mutatedKeys,t.fromCache),this.raisedInitialEvent=!0,this.queryObserver.next(t)},t}(),di=function(){function t(t,e,n,r){this.targetId=t,this.fromCache=e,this.addedKeys=n,this.removedKeys=r}return t.fromSnapshot=function(e,n){for(var r=Lt(),i=Lt(),o=0,a=n.docChanges;o<a.length;o++){var s=a[o];switch(s.type){case Mr.Added:r=r.add(s.doc.key);break;case Mr.Removed:i=i.add(s.doc.key)}}return new t(e,n.fromCache,r,i)},t}(),mi=function(t){this.key=t},yi=function(t){this.key=t},gi=function(){function t(t,e){this.query=t,this._syncedDocuments=e,this.syncState=null,this.current=!1,this.limboDocuments=Lt(),this.mutatedKeys=Lt(),this.documentSet=new xr(t.docComparator.bind(t))}return Object.defineProperty(t.prototype,"syncedDocuments",{get:function(){return this._syncedDocuments},enumerable:!0,configurable:!0}),t.prototype.computeDocChanges=function(t,e){var n=this,r=e?e.changeSet:new jr,i=e?e.documentSet:this.documentSet,o=e?e.mutatedKeys:this.mutatedKeys,a=i,s=!1,u=this.query.hasLimitToFirst()&&i.size===this.query.limit?i.last():null,c=this.query.hasLimitToLast()&&i.size===this.query.limit?i.first():null;if(t.inorderTraversal((function(t,e){var h=i.get(t),l=e instanceof je?e:null;l&&(g(t.isEqual(l.key),"Mismatching keys found in document changes: "+t+" != "+l.key),l=n.query.matches(l)?l:null);var f=!!h&&n.mutatedKeys.has(h.key),p=!!l&&(l.hasLocalMutations||n.mutatedKeys.has(l.key)&&l.hasCommittedMutations),d=!1;h&&l?h.data().isEqual(l.data())?f!==p&&(r.track({type:Mr.Metadata,doc:l}),d=!0):n.shouldWaitForSyncedDocument(h,l)||(r.track({type:Mr.Modified,doc:l}),d=!0,(u&&n.query.docComparator(l,u)>0||c&&n.query.docComparator(l,c)<0)&&(s=!0)):!h&&l?(r.track({type:Mr.Added,doc:l}),d=!0):h&&!l&&(r.track({type:Mr.Removed,doc:h}),d=!0,(u||c)&&(s=!0));d&&(l?(a=a.add(l),o=p?o.add(t):o.delete(t)):(a=a.delete(t),o=o.delete(t)))})),this.query.hasLimitToFirst()||this.query.hasLimitToLast())for(;a.size>this.query.limit;){var h=this.query.hasLimitToFirst()?a.last():a.first();a=a.delete(h.key),o=o.delete(h.key),r.track({type:Mr.Removed,doc:h})}return g(!s||!e,"View was refilled using docs that themselves needed refilling."),{documentSet:a,changeSet:r,needsRefill:s,mutatedKeys:o}},t.prototype.shouldWaitForSyncedDocument=function(t,e){return t.hasLocalMutations&&e.hasCommittedMutations&&!e.hasLocalMutations},t.prototype.applyChanges=function(t,e,n){var r=this;g(!t.needsRefill,"Cannot apply changes that need a refill");var i=this.documentSet;this.documentSet=t.documentSet,this.mutatedKeys=t.mutatedKeys;var o=t.changeSet.getChanges();o.sort((function(t,e){return function(t,e){var n=function(t){switch(t){case Mr.Added:return 1;case Mr.Modified:case Mr.Metadata:return 2;case Mr.Removed:return 0;default:return y("Unknown ChangeType: "+t)}};return n(t)-n(e)}
/**
 * @license
 * Copyright 2019 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */(t.type,e.type)||r.query.docComparator(t.doc,e.doc)})),this.applyTargetChange(n);var a=e?this.updateLimboDocuments():[],s=0===this.limboDocuments.size&&this.current?Lr.Synced:Lr.Local,u=s!==this.syncState;return this.syncState=s,0!==o.length||u?{snapshot:new Ur(this.query,t.documentSet,i,o,t.mutatedKeys,s===Lr.Local,u,!1),limboChanges:a}:{limboChanges:a}},t.prototype.applyOnlineStateChange=function(t){return this.current&&t===_r.Offline?(this.current=!1,this.applyChanges({documentSet:this.documentSet,changeSet:new jr,mutatedKeys:this.mutatedKeys,needsRefill:!1},!1)):{limboChanges:[]}},t.prototype.shouldBeInLimbo=function(t){return!this._syncedDocuments.has(t)&&(!!this.documentSet.has(t)&&!this.documentSet.get(t).hasLocalMutations)},t.prototype.applyTargetChange=function(t){var e=this;t&&(t.addedDocuments.forEach((function(t){return e._syncedDocuments=e._syncedDocuments.add(t)})),t.modifiedDocuments.forEach((function(t){return g(e._syncedDocuments.has(t),"Modified document "+t+" not found in view.")})),t.removedDocuments.forEach((function(t){return e._syncedDocuments=e._syncedDocuments.delete(t)})),this.current=t.current)},t.prototype.updateLimboDocuments=function(){var t=this;if(!this.current)return[];var e=this.limboDocuments;this.limboDocuments=Lt(),this.documentSet.forEach((function(e){t.shouldBeInLimbo(e.key)&&(t.limboDocuments=t.limboDocuments.add(e.key))}));var n=[];return e.forEach((function(e){t.limboDocuments.has(e)||n.push(new yi(e))})),this.limboDocuments.forEach((function(t){e.has(t)||n.push(new mi(t))})),n},t.prototype.synchronizeWithPersistedState=function(t){this._syncedDocuments=t.remoteKeys,this.limboDocuments=Lt();var e=this.computeDocChanges(t.documents);return this.applyChanges(e,!0)},t.prototype.computeInitialSnapshot=function(){return Ur.fromInitialDocuments(this.query,this.documentSet,this.mutatedKeys,this.syncState===Lr.Local)},t}();
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var vi=function(){function t(t,e,n,r){this.asyncQueue=t,this.remoteStore=e,this.updateFunction=n,this.deferred=r,this.retries=5,this.backoff=new Tr(this.asyncQueue,et.RetryTransaction)}return t.prototype.run=function(){this.runWithBackOff()},t.prototype.runWithBackOff=function(){var t=this;this.backoff.backoffAndRun((function(){return Object(i.b)(t,void 0,void 0,(function(){var t,e,n=this;return Object(i.d)(this,(function(r){return t=this.remoteStore.createTransaction(),(e=this.tryRunUpdateFunction(t))&&e.then((function(e){n.asyncQueue.enqueueAndForget((function(){return t.commit().then((function(){n.deferred.resolve(e)})).catch((function(t){n.handleTransactionError(t)}))}))})).catch((function(t){n.handleTransactionError(t)})),[2]}))}))}))},t.prototype.tryRunUpdateFunction=function(t){try{var e=this.updateFunction(t);return!Kn(e)&&e.catch&&e.then?e:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(t){return this.deferred.reject(t),null}},t.prototype.handleTransactionError=function(t){var e=this;this.retries>0&&this.isRetryableTransactionError(t)?(this.retries-=1,this.asyncQueue.enqueueAndForget((function(){return e.runWithBackOff(),Promise.resolve()}))):this.deferred.reject(t)},t.prototype.isRetryableTransactionError=function(t){if("FirebaseError"===t.name){var e=t.code;return"aborted"===e||"failed-precondition"===e||!kr(e)}return!1},t}(),bi=function(t,e,n){this.query=t,this.targetId=e,this.view=n},wi=function(t){this.key=t,this.receivedDocument=!1},Ti=function(){function t(t,e,n,r){this.localStore=t,this.remoteStore=e,this.sharedClientState=n,this.currentUser=r,this.syncEngineListener=null,this.queryViewsByQuery=new Ve((function(t){return t.canonicalId()})),this.queriesByTarget={},this.limboTargetsByKey=new Tt(lt.comparator),this.limboResolutionsByTarget={},this.limboDocumentRefs=new hr,this.mutationUserCallbacks={},this.pendingWritesCallbacks=new Map,this.limboTargetIdGenerator=re.forSyncEngine(),this.isPrimary=void 0,this.onlineState=_r.Unknown}return Object.defineProperty(t.prototype,"isPrimaryClient",{get:function(){return!0===this.isPrimary},enumerable:!0,configurable:!0}),t.prototype.subscribe=function(t){g(null!==t,"SyncEngine listener cannot be null"),g(null===this.syncEngineListener,"SyncEngine already has a subscriber."),this.syncEngineListener=t},t.prototype.listen=function(t){return Object(i.b)(this,void 0,void 0,(function(){var e,n,r,o,a;return Object(i.d)(this,(function(i){switch(i.label){case 0:return this.assertSubscribed("listen()"),(r=this.queryViewsByQuery.get(t))?(e=r.targetId,this.sharedClientState.addLocalQueryTarget(e),n=r.view.computeInitialSnapshot(),[3,4]):[3,1];case 1:return[4,this.localStore.allocateTarget(t.toTarget())];case 2:return o=i.sent(),a=this.sharedClientState.addLocalQueryTarget(o.targetId),e=o.targetId,[4,this.initializeViewAndComputeSnapshot(t,e,"current"===a)];case 3:n=i.sent(),this.isPrimary&&this.remoteStore.listen(o),i.label=4;case 4:return this.syncEngineListener.onWatchChange([n]),[2,e]}}))}))},t.prototype.initializeViewAndComputeSnapshot=function(t,e,n){return Object(i.b)(this,void 0,void 0,(function(){var r,o,a,s,u,c;return Object(i.d)(this,(function(i){switch(i.label){case 0:return[4,this.localStore.executeQuery(t,!0)];case 1:return r=i.sent(),o=new gi(t,r.remoteKeys),a=o.computeDocChanges(r.documents),s=Vr.createSynthesizedTargetChangeForCurrentChange(e,n&&this.onlineState!==_r.Offline),g(0===(u=o.applyChanges(a,!0===this.isPrimary,s)).limboChanges.length,"View returned limbo docs before target ack from the server."),g(!!u.snapshot,"applyChanges for new view should always return a snapshot"),c=new bi(t,e,o),this.queryViewsByQuery.set(t,c),this.queriesByTarget[e]||(this.queriesByTarget[e]=[]),this.queriesByTarget[e].push(t),[2,u.snapshot]}}))}))},t.prototype.synchronizeViewAndComputeSnapshot=function(t){return Object(i.b)(this,void 0,void 0,(function(){var e,n;return Object(i.d)(this,(function(r){switch(r.label){case 0:return[4,this.localStore.executeQuery(t.query,!0)];case 1:return e=r.sent(),n=t.view.synchronizeWithPersistedState(e),this.isPrimary&&this.updateTrackedLimbos(t.targetId,n.limboChanges),[2,n]}}))}))},t.prototype.unlisten=function(t){return Object(i.b)(this,void 0,void 0,(function(){var e,n,r=this;return Object(i.d)(this,(function(i){switch(i.label){case 0:return this.assertSubscribed("unlisten()"),g(!!(e=this.queryViewsByQuery.get(t)),"Trying to unlisten on query not found:"+t),(n=this.queriesByTarget[e.targetId]).length>1?(this.queriesByTarget[e.targetId]=n.filter((function(e){return!e.isEqual(t)})),this.queryViewsByQuery.delete(t),[2]):this.isPrimary?(this.sharedClientState.removeLocalQueryTarget(e.targetId),this.sharedClientState.isActiveQueryTarget(e.targetId)?[3,2]:[4,this.localStore.releaseTarget(e.targetId,!1).then((function(){r.sharedClientState.clearQueryState(e.targetId),r.remoteStore.unlisten(e.targetId),r.removeAndCleanupTarget(e.targetId)})).catch(Ln)]):[3,3];case 1:i.sent(),i.label=2;case 2:return[3,5];case 3:return this.removeAndCleanupTarget(e.targetId),[4,this.localStore.releaseTarget(e.targetId,!0)];case 4:i.sent(),i.label=5;case 5:return[2]}}))}))},t.prototype.write=function(t,e){return Object(i.b)(this,void 0,void 0,(function(){var n;return Object(i.d)(this,(function(r){switch(r.label){case 0:return this.assertSubscribed("write()"),[4,this.localStore.localWrite(t)];case 1:return n=r.sent(),this.sharedClientState.addPendingMutation(n.batchId),this.addMutationCallback(n.batchId,e),[4,this.emitNewSnapsAndNotifyLocalStore(n.changes)];case 2:return r.sent(),[4,this.remoteStore.fillWritePipeline()];case 3:return r.sent(),[2]}}))}))},t.prototype.runTransaction=function(t,e,n){new vi(t,this.remoteStore,e,n).run()},t.prototype.applyRemoteEvent=function(t){return Object(i.b)(this,void 0,void 0,(function(){var e,n=this;return Object(i.d)(this,(function(r){switch(r.label){case 0:this.assertSubscribed("applyRemoteEvent()"),r.label=1;case 1:return r.trys.push([1,4,,6]),[4,this.localStore.applyRemoteEvent(t)];case 2:return e=r.sent(),C(t.targetChanges,(function(t,e){var r=n.limboResolutionsByTarget[Number(t)];r&&(g(e.addedDocuments.size+e.modifiedDocuments.size+e.removedDocuments.size<=1,"Limbo resolution for single document contains multiple changes."),e.addedDocuments.size>0?r.receivedDocument=!0:e.modifiedDocuments.size>0?g(r.receivedDocument,"Received change for limbo target document without add."):e.removedDocuments.size>0&&(g(r.receivedDocument,"Received remove for limbo target document without add."),r.receivedDocument=!1))})),[4,this.emitNewSnapsAndNotifyLocalStore(e,t)];case 3:return r.sent(),[3,6];case 4:return[4,Ln(r.sent())];case 5:return r.sent(),[3,6];case 6:return[2]}}))}))},t.prototype.applyOnlineStateChange=function(t,e){if(this.isPrimary&&e===Er.RemoteStore||!this.isPrimary&&e===Er.SharedClientState){this.assertSubscribed("applyOnlineStateChange()");var n=[];this.queryViewsByQuery.forEach((function(e,r){var i=r.view.applyOnlineStateChange(t);g(0===i.limboChanges.length,"OnlineState should not affect limbo documents."),i.snapshot&&n.push(i.snapshot)})),this.syncEngineListener.onOnlineStateChange(t),this.syncEngineListener.onWatchChange(n),this.onlineState=t,this.isPrimary&&this.sharedClientState.setOnlineState(t)}},t.prototype.rejectListen=function(t,e){return Object(i.b)(this,void 0,void 0,(function(){var n,r,o,a,s,u=this;return Object(i.d)(this,(function(i){switch(i.label){case 0:return this.assertSubscribed("rejectListens()"),this.sharedClientState.updateQueryState(t,"rejected",e),n=this.limboResolutionsByTarget[t],(r=n&&n.key)?(this.limboTargetsByKey=this.limboTargetsByKey.remove(r),delete this.limboResolutionsByTarget[t],o=(o=new Tt(lt.comparator)).insert(r,new Ue(r,wt.forDeletedDoc())),a=Lt().add(r),s=new qr(wt.MIN,{},new It(X),o,a),[2,this.applyRemoteEvent(s)]):[3,1];case 1:return[4,this.localStore.releaseTarget(t,!1).then((function(){return u.removeAndCleanupTarget(t,e)})).catch(Ln)];case 2:i.sent(),i.label=3;case 3:return[2]}}))}))},t.prototype.applyBatchState=function(t,e,n){return Object(i.b)(this,void 0,void 0,(function(){var r;return Object(i.d)(this,(function(i){switch(i.label){case 0:return this.assertSubscribed("applyBatchState()"),[4,this.localStore.lookupMutationDocuments(t)];case 1:return null===(r=i.sent())?(p("SyncEngine","Cannot apply mutation batch with id: "+t),[2]):"pending"!==e?[3,3]:[4,this.remoteStore.fillWritePipeline()];case 2:return i.sent(),[3,4];case 3:"acknowledged"===e||"rejected"===e?(this.processUserCallback(t,n||null),this.localStore.removeCachedMutationBatchMetadata(t)):y("Unknown batchState: "+e),i.label=4;case 4:return[4,this.emitNewSnapsAndNotifyLocalStore(r)];case 5:return i.sent(),[2]}}))}))},t.prototype.applySuccessfulWrite=function(t){return Object(i.b)(this,void 0,void 0,(function(){var e,n;return Object(i.d)(this,(function(r){switch(r.label){case 0:this.assertSubscribed("applySuccessfulWrite()"),e=t.batch.batchId,this.processUserCallback(e,null),this.triggerPendingWritesCallbacks(e),r.label=1;case 1:return r.trys.push([1,4,,6]),[4,this.localStore.acknowledgeBatch(t)];case 2:return n=r.sent(),this.sharedClientState.updateMutationState(e,"acknowledged"),[4,this.emitNewSnapsAndNotifyLocalStore(n)];case 3:return r.sent(),[3,6];case 4:return[4,Ln(r.sent())];case 5:return r.sent(),[3,6];case 6:return[2]}}))}))},t.prototype.rejectFailedWrite=function(t,e){return Object(i.b)(this,void 0,void 0,(function(){var n;return Object(i.d)(this,(function(r){switch(r.label){case 0:this.assertSubscribed("rejectFailedWrite()"),this.processUserCallback(t,e),this.triggerPendingWritesCallbacks(t),r.label=1;case 1:return r.trys.push([1,4,,6]),[4,this.localStore.rejectBatch(t)];case 2:return n=r.sent(),this.sharedClientState.updateMutationState(t,"rejected",e),[4,this.emitNewSnapsAndNotifyLocalStore(n)];case 3:return r.sent(),[3,6];case 4:return[4,Ln(r.sent())];case 5:return r.sent(),[3,6];case 6:return[2]}}))}))},t.prototype.registerPendingWritesCallback=function(t){return Object(i.b)(this,void 0,void 0,(function(){var e,n;return Object(i.d)(this,(function(r){switch(r.label){case 0:return this.remoteStore.canUseNetwork()||p("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled."),[4,this.localStore.getHighestUnacknowledgedBatchId()];case 1:return-1===(e=r.sent())?(t.resolve(),[2]):((n=this.pendingWritesCallbacks.get(e)||[]).push(t),this.pendingWritesCallbacks.set(e,n),[2])}}))}))},t.prototype.triggerPendingWritesCallbacks=function(t){(this.pendingWritesCallbacks.get(t)||[]).forEach((function(t){t.resolve()})),this.pendingWritesCallbacks.delete(t)},t.prototype.rejectOutstandingPendingWritesCallbacks=function(t){this.pendingWritesCallbacks.forEach((function(e){e.forEach((function(e){e.reject(new T(w.CANCELLED,t))}))})),this.pendingWritesCallbacks.clear()},t.prototype.addMutationCallback=function(t,e){var n=this.mutationUserCallbacks[this.currentUser.toKey()];n||(n=new Tt(X)),n=n.insert(t,e),this.mutationUserCallbacks[this.currentUser.toKey()]=n},t.prototype.processUserCallback=function(t,e){var n=this.mutationUserCallbacks[this.currentUser.toKey()];if(n){var r=n.get(t);r&&(g(t===n.minKey(),"Mutation callbacks processed out-of-order?"),e?r.reject(e):r.resolve(),n=n.remove(t)),this.mutationUserCallbacks[this.currentUser.toKey()]=n}},t.prototype.removeAndCleanupTarget=function(t,e){var n=this;void 0===e&&(e=null),this.sharedClientState.removeLocalQueryTarget(t),g(this.queriesByTarget[t]&&0!==this.queriesByTarget[t].length,"There are no queries mapped to target id "+t);for(var r=0,i=this.queriesByTarget[t];r<i.length;r++){var o=i[r];this.queryViewsByQuery.delete(o),e&&this.syncEngineListener.onWatchError(o,e)}if(delete this.queriesByTarget[t],this.isPrimary){var a=this.limboDocumentRefs.referencesForId(t);this.limboDocumentRefs.removeReferencesForId(t),a.forEach((function(t){n.limboDocumentRefs.containsKey(t)||n.removeLimboTarget(t)}))}},t.prototype.removeLimboTarget=function(t){var e=this.limboTargetsByKey.get(t);null!==e&&(this.remoteStore.unlisten(e),this.limboTargetsByKey=this.limboTargetsByKey.remove(t),delete this.limboResolutionsByTarget[e])},t.prototype.updateTrackedLimbos=function(t,e){for(var n=0,r=e;n<r.length;n++){var i=r[n];if(i instanceof mi)this.limboDocumentRefs.addReference(i.key,t),this.trackLimboChange(i);else if(i instanceof yi){p("SyncEngine","Document no longer in limbo: "+i.key),this.limboDocumentRefs.removeReference(i.key,t),this.limboDocumentRefs.containsKey(i.key)||this.removeLimboTarget(i.key)}else y("Unknown limbo change: "+JSON.stringify(i))}},t.prototype.trackLimboChange=function(t){var e=t.key;if(!this.limboTargetsByKey.get(e)){p("SyncEngine","New document in limbo: "+e);var n=this.limboTargetIdGenerator.next(),r=zn.atPath(e.path);this.limboResolutionsByTarget[n]=new wi(e),this.remoteStore.listen(new Tn(r.toTarget(),n,dn.LimboResolution,at.INVALID)),this.limboTargetsByKey=this.limboTargetsByKey.insert(e,n)}},t.prototype.currentLimboDocs=function(){return this.limboTargetsByKey},t.prototype.emitNewSnapsAndNotifyLocalStore=function(t,e){return Object(i.b)(this,void 0,void 0,(function(){var n,r,o,a=this;return Object(i.d)(this,(function(i){switch(i.label){case 0:return n=[],r=[],o=[],this.queryViewsByQuery.forEach((function(i,s){o.push(Promise.resolve().then((function(){var e=s.view.computeDocChanges(t);return e.needsRefill?a.localStore.executeQuery(s.query,!1).then((function(t){var n=t.documents;return s.view.computeDocChanges(n,e)})):e})).then((function(t){var i=e&&e.targetChanges[s.targetId],o=s.view.applyChanges(t,!0===a.isPrimary,i);if(a.updateTrackedLimbos(s.targetId,o.limboChanges),o.snapshot){a.isPrimary&&a.sharedClientState.updateQueryState(s.targetId,o.snapshot.fromCache?"not-current":"current"),n.push(o.snapshot);var u=di.fromSnapshot(s.targetId,o.snapshot);r.push(u)}})))})),[4,Promise.all(o)];case 1:return i.sent(),this.syncEngineListener.onWatchChange(n),[4,this.localStore.notifyLocalViewChanges(r)];case 2:return i.sent(),[2]}}))}))},t.prototype.assertSubscribed=function(t){g(null!==this.syncEngineListener,"Trying to call "+t+" before calling subscribe().")},t.prototype.handleCredentialChange=function(t){return Object(i.b)(this,void 0,void 0,(function(){var e,n;return Object(i.d)(this,(function(r){switch(r.label){case 0:return e=!this.currentUser.isEqual(t),this.currentUser=t,e?(this.rejectOutstandingPendingWritesCallbacks("'waitForPendingWrites' promise is rejected due to a user change."),[4,this.localStore.handleUserChange(t)]):[3,3];case 1:return n=r.sent(),this.sharedClientState.handleUserChange(t,n.removedBatchIds,n.addedBatchIds),[4,this.emitNewSnapsAndNotifyLocalStore(n.affectedDocuments)];case 2:r.sent(),r.label=3;case 3:return[4,this.remoteStore.handleCredentialChange()];case 4:return r.sent(),[2]}}))}))},t.prototype.applyPrimaryState=function(t){return Object(i.b)(this,void 0,void 0,(function(){var e,n,r,o,a,s,u,c=this;return Object(i.d)(this,(function(i){switch(i.label){case 0:return!0!==t||!0===this.isPrimary?[3,3]:(this.isPrimary=!0,[4,this.remoteStore.applyPrimaryState(!0)]);case 1:return i.sent(),e=this.sharedClientState.getAllActiveQueryTargets(),[4,this.synchronizeQueryViewsAndRaiseSnapshots(e.toArray())];case 2:for(n=i.sent(),r=0,o=n;r<o.length;r++)a=o[r],this.remoteStore.listen(a);return[3,7];case 3:return!1!==t||!1===this.isPrimary?[3,7]:(this.isPrimary=!1,s=[],u=Promise.resolve(),I(this.queriesByTarget,(function(t,e){c.sharedClientState.isLocalQueryTarget(t)?s.push(t):u=u.then((function(){return c.removeAndCleanupTarget(t),c.localStore.releaseTarget(t,!0)})),c.remoteStore.unlisten(t)})),[4,u]);case 4:return i.sent(),[4,this.synchronizeQueryViewsAndRaiseSnapshots(s)];case 5:return i.sent(),this.resetLimboDocuments(),[4,this.remoteStore.applyPrimaryState(!1)];case 6:i.sent(),i.label=7;case 7:return[2]}}))}))},t.prototype.resetLimboDocuments=function(){var t=this;I(this.limboResolutionsByTarget,(function(e){t.remoteStore.unlisten(e)})),this.limboDocumentRefs.removeAllReferences(),this.limboResolutionsByTarget=[],this.limboTargetsByKey=new Tt(lt.comparator)},t.prototype.synchronizeQueryViewsAndRaiseSnapshots=function(t){return Object(i.b)(this,void 0,void 0,(function(){var e,n,r,o,a,s,u,c,h,l,f,p,d;return Object(i.d)(this,(function(i){switch(i.label){case 0:e=[],n=[],r=0,o=t,i.label=1;case 1:return r<o.length?(a=o[r],s=void 0,(u=this.queriesByTarget[a])&&0!==u.length?[4,this.localStore.releaseTarget(a,!0)]:[3,8]):[3,14];case 2:return i.sent(),[4,this.localStore.allocateTarget(u[0].toTarget())];case 3:s=i.sent(),c=0,h=u,i.label=4;case 4:return c<h.length?(l=h[c],g(!!(f=this.queryViewsByQuery.get(l)),"No query view found for "+l),[4,this.synchronizeViewAndComputeSnapshot(f)]):[3,7];case 5:(p=i.sent()).snapshot&&n.push(p.snapshot),i.label=6;case 6:return c++,[3,4];case 7:return[3,12];case 8:return g(!0===this.isPrimary,"A secondary tab should never have an active target without an active query."),[4,this.localStore.getTarget(a)];case 9:return g(!!(d=i.sent()),"Target for id "+a+" not found"),[4,this.localStore.allocateTarget(d)];case 10:return s=i.sent(),[4,this.initializeViewAndComputeSnapshot(this.synthesizeTargetToQuery(d),a,!1)];case 11:i.sent(),i.label=12;case 12:e.push(s),i.label=13;case 13:return r++,[3,1];case 14:return this.syncEngineListener.onWatchChange(n),[2,e]}}))}))},t.prototype.synthesizeTargetToQuery=function(t){return new zn(t.path,t.collectionGroup,t.orderBy,t.filters,t.limit,Gn.First,t.startAt,t.endAt)},t.prototype.getActiveClients=function(){return this.localStore.getActiveClients()},t.prototype.applyTargetState=function(t,e,n){return Object(i.b)(this,void 0,void 0,(function(){var r,o;return Object(i.d)(this,(function(i){switch(i.label){case 0:if(this.isPrimary)return p("SyncEngine","Ignoring unexpected query state notification."),[2];if(!this.queriesByTarget[t])return[3,7];switch(e){case"current":case"not-current":return[3,1];case"rejected":return[3,4]}return[3,6];case 1:return[4,this.localStore.getNewDocumentChanges()];case 2:return r=i.sent(),o=qr.createSynthesizedRemoteEventForCurrentChange(t,"current"===e),[4,this.emitNewSnapsAndNotifyLocalStore(r,o)];case 3:return i.sent(),[3,7];case 4:return[4,this.localStore.releaseTarget(t,!0)];case 5:return i.sent(),this.removeAndCleanupTarget(t,n),[3,7];case 6:y("Unexpected target state: "+e),i.label=7;case 7:return[2]}}))}))},t.prototype.applyActiveTargetsChange=function(t,e){return Object(i.b)(this,void 0,void 0,(function(){var n,r,o,a,s,u,c,h,l,f=this;return Object(i.d)(this,(function(p){switch(p.label){case 0:if(!this.isPrimary)return[2];n=0,r=t,p.label=1;case 1:return n<r.length?(l=r[n],g(!this.queriesByTarget[l],"Trying to add an already active target"),[4,this.localStore.getTarget(l)]):[3,6];case 2:return g(!!(o=p.sent()),"Query data for active target "+l+" not found"),[4,this.localStore.allocateTarget(o)];case 3:return a=p.sent(),[4,this.initializeViewAndComputeSnapshot(this.synthesizeTargetToQuery(o),a.targetId,!1)];case 4:p.sent(),this.remoteStore.listen(a),p.label=5;case 5:return n++,[3,1];case 6:s=function(t){return Object(i.d)(this,(function(e){switch(e.label){case 0:return u.queriesByTarget[t]?[4,u.localStore.releaseTarget(t,!1).then((function(){f.remoteStore.unlisten(t),f.removeAndCleanupTarget(t)})).catch(Ln)]:[2,"continue"];case 1:return e.sent(),[2]}}))},u=this,c=0,h=e,p.label=7;case 7:return c<h.length?(l=h[c],[5,s(l)]):[3,10];case 8:p.sent(),p.label=9;case 9:return c++,[3,7];case 10:return[2]}}))}))},t.prototype.enableNetwork=function(){return this.localStore.setNetworkEnabled(!0),this.remoteStore.enableNetwork()},t.prototype.disableNetwork=function(){return this.localStore.setNetworkEnabled(!1),this.remoteStore.disableNetwork()},t.prototype.getRemoteKeysForTarget=function(t){var e=this.limboResolutionsByTarget[t];if(e&&e.receivedDocument)return Lt().add(e.key);var n=Lt(),r=this.queriesByTarget[t];if(!r)return n;for(var i=0,o=r;i<o.length;i++){var a=o[i],s=this.queryViewsByQuery.get(a);g(!!s,"No query view found for "+a),n=n.unionWith(s.view.syncedDocuments)}return n},t}(),_i=function(){function t(t){this.uid=t}return t.prototype.isAuthenticated=function(){return null!=this.uid},t.prototype.toKey=function(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"},t.prototype.isEqual=function(t){return t.uid===this.uid},t.UNAUTHENTICATED=new t(null),t.GOOGLE_CREDENTIALS=new t("google-credentials-uid"),t.FIRST_PARTY=new t("first-party-uid"),t}();function Ei(t,e){return g(-1===e.indexOf("_"),"Client key cannot contain '_', but was '"+e+"'"),"firestore_clients_"+t+"_"+e}function Si(t,e,n){var r="firestore_mutations_"+t+"_"+n;return e.isAuthenticated()&&(r+="_"+e.uid),r}function Ii(t,e){return"firestore_targets_"+t+"_"+e}
/**
 * @license
 * Copyright 2018 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var Ci="SharedClientState",Ni=function(){function t(t,e,n,r){this.user=t,this.batchId=e,this.state=n,this.error=r,g(void 0!==r==("rejected"===n),"MutationMetadata must contain an error iff state is 'rejected'")}return t.fromWebStorageEntry=function(e,n,r){var i=JSON.parse(r),o="object"==typeof i&&-1!==["pending","acknowledged","rejected"].indexOf(i.state)&&(void 0===i.error||"object"==typeof i.error),a=void 0;return o&&i.error&&(o="string"==typeof i.error.message&&"string"==typeof i.error.code)&&(a=new T(i.error.code,i.error.message)),o?new t(e,n,i.state,a):(d(Ci,"Failed to parse mutation state for ID '"+n+"': "+r),null)},t.prototype.toWebStorageJSON=function(){var t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)},t}(),Di=function(){function t(t,e,n){this.targetId=t,this.state=e,this.error=n,g(void 0!==n==("rejected"===e),"QueryTargetMetadata must contain an error iff state is 'rejected'")}return t.fromWebStorageEntry=function(e,n){var r=JSON.parse(n),i="object"==typeof r&&-1!==["not-current","current","rejected"].indexOf(r.state)&&(void 0===r.error||"object"==typeof r.error),o=void 0;return i&&r.error&&(i="string"==typeof r.error.message&&"string"==typeof r.error.code)&&(o=new T(r.error.code,r.error.message)),i?new t(e,r.state,o):(d(Ci,"Failed to parse target state for ID '"+e+"': "+n),null)},t.prototype.toWebStorageJSON=function(){var t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)},t}(),Ai=function(){function t(t,e){this.clientId=t,this.activeTargetIds=e}return t.fromWebStorageEntry=function(e,n){for(var r=JSON.parse(n),i="object"==typeof r&&r.activeTargetIds instanceof Array,o=Ft(),a=0;i&&a<r.activeTargetIds.length;++a)i=Qn(r.activeTargetIds[a]),o=o.add(r.activeTargetIds[a]);return i?new t(e,o):(d(Ci,"Failed to parse client data for instance '"+e+"': "+n),null)},t}(),Oi=function(){function t(t,e){this.clientId=t,this.onlineState=e}return t.fromWebStorageEntry=function(e){var n=JSON.parse(e);return"object"==typeof n&&n.onlineState in _r&&"string"==typeof n.clientId?new t(n.clientId,_r[n.onlineState]):(d(Ci,"Failed to parse online state: "+e),null)},t}(),ki=function(){function t(){this.activeTargetIds=Ft()}return t.prototype.addQueryTarget=function(t){this.activeTargetIds=this.activeTargetIds.add(t)},t.prototype.removeQueryTarget=function(t){this.activeTargetIds=this.activeTargetIds.delete(t)},t.prototype.toWebStorageJSON=function(){var t={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(t)},t}(),Ri=function(){function t(e,n,r,i,o){if(this.queue=e,this.platform=n,this.persistenceKey=r,this.localClientId=i,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.activeClients={},this.storageListener=this.handleWebStorageEvent.bind(this),this.started=!1,this.earlyEvents=[],!t.isAvailable(this.platform))throw new T(w.UNIMPLEMENTED,"LocalStorage is not available on this platform.");var a=r.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.platform.window.localStorage,this.currentUser=o,this.localClientStorageKey=Ei(this.persistenceKey,this.localClientId),this.sequenceNumberKey=function(t){return"firestore_sequence_number_"+t}(this.persistenceKey),this.activeClients[this.localClientId]=new ki,this.clientStateKeyRe=new RegExp("^firestore_clients_"+a+"_([^_]*)$"),this.mutationBatchKeyRe=new RegExp("^firestore_mutations_"+a+"_(\\d+)(?:_(.*))?$"),this.queryTargetKeyRe=new RegExp("^firestore_targets_"+a+"_(\\d+)$"),this.onlineStateKey=function(t){return"firestore_online_state_"+t}(this.persistenceKey),this.platform.window.addEventListener("storage",this.storageListener)}return t.isAvailable=function(t){return!(!t.window||null==t.window.localStorage)},t.prototype.start=function(){return Object(i.b)(this,void 0,void 0,(function(){var t,e,n,r,o,a,s,u,c,h,l,f=this;return Object(i.d)(this,(function(i){switch(i.label){case 0:return g(!this.started,"WebStorageSharedClientState already started"),g(null!==this.syncEngine,"syncEngine property must be set before calling start()"),g(null!==this.onlineStateHandler,"onlineStateHandler property must be set before calling start()"),[4,this.syncEngine.getActiveClients()];case 1:for(t=i.sent(),e=0,n=t;e<n.length;e++)(r=n[e])!==this.localClientId&&(o=this.getItem(Ei(this.persistenceKey,r)))&&(a=Ai.fromWebStorageEntry(r,o))&&(this.activeClients[a.clientId]=a);for(this.persistClientState(),(s=this.storage.getItem(this.onlineStateKey))&&(u=this.fromWebStorageOnlineState(s))&&this.handleOnlineStateEvent(u),c=0,h=this.earlyEvents;c<h.length;c++)l=h[c],this.handleWebStorageEvent(l);return this.earlyEvents=[],this.platform.window.addEventListener("unload",(function(){return f.shutdown()})),this.started=!0,[2]}}))}))},t.prototype.writeSequenceNumber=function(t){this.setItem(this.sequenceNumberKey,JSON.stringify(t))},t.prototype.getAllActiveQueryTargets=function(){var t=Ft();return C(this.activeClients,(function(e,n){t=t.unionWith(n.activeTargetIds)})),t},t.prototype.isActiveQueryTarget=function(t){for(var e in this.activeClients)if(this.activeClients.hasOwnProperty(e)&&this.activeClients[e].activeTargetIds.has(t))return!0;return!1},t.prototype.addPendingMutation=function(t){this.persistMutationState(t,"pending")},t.prototype.updateMutationState=function(t,e,n){this.persistMutationState(t,e,n),this.removeMutationState(t)},t.prototype.addLocalQueryTarget=function(t){var e="not-current";if(this.isActiveQueryTarget(t)){var n=this.storage.getItem(Ii(this.persistenceKey,t));if(n){var r=Di.fromWebStorageEntry(t,n);r&&(e=r.state)}}return this.localClientState.addQueryTarget(t),this.persistClientState(),e},t.prototype.removeLocalQueryTarget=function(t){this.localClientState.removeQueryTarget(t),this.persistClientState()},t.prototype.isLocalQueryTarget=function(t){return this.localClientState.activeTargetIds.has(t)},t.prototype.clearQueryState=function(t){this.removeItem(Ii(this.persistenceKey,t))},t.prototype.updateQueryState=function(t,e,n){this.persistQueryTargetState(t,e,n)},t.prototype.handleUserChange=function(t,e,n){var r=this;e.forEach((function(t){r.removeMutationState(t)})),this.currentUser=t,n.forEach((function(t){r.addPendingMutation(t)}))},t.prototype.setOnlineState=function(t){this.persistOnlineState(t)},t.prototype.shutdown=function(){this.started&&(this.platform.window.removeEventListener("storage",this.storageListener),this.removeItem(this.localClientStorageKey),this.started=!1)},t.prototype.getItem=function(t){var e=this.storage.getItem(t);return p(Ci,"READ",t,e),e},t.prototype.setItem=function(t,e){p(Ci,"SET",t,e),this.storage.setItem(t,e)},t.prototype.removeItem=function(t){p(Ci,"REMOVE",t),this.storage.removeItem(t)},t.prototype.handleWebStorageEvent=function(t){var e=this;if(t.storageArea===this.storage){if(p(Ci,"EVENT",t.key,t.newValue),t.key===this.localClientStorageKey)return void d("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.queue.enqueueAndForget((function(){return Object(i.b)(e,void 0,void 0,(function(){var e,n,r,o,a,s;return Object(i.d)(this,(function(i){if(!this.started)return this.earlyEvents.push(t),[2];if(null===t.key)return[2];if(this.clientStateKeyRe.test(t.key)){if(null==t.newValue)return n=this.fromWebStorageClientStateKey(t.key),[2,this.handleClientStateEvent(n,null)];if(e=this.fromWebStorageClientState(t.key,t.newValue))return[2,this.handleClientStateEvent(e.clientId,e)]}else if(this.mutationBatchKeyRe.test(t.key)){if(null!==t.newValue&&(r=this.fromWebStorageMutationMetadata(t.key,t.newValue)))return[2,this.handleMutationBatchEvent(r)]}else if(this.queryTargetKeyRe.test(t.key)){if(null!==t.newValue&&(o=this.fromWebStorageQueryTargetMetadata(t.key,t.newValue)))return[2,this.handleQueryTargetEvent(o)]}else if(t.key===this.onlineStateKey){if(null!==t.newValue&&(a=this.fromWebStorageOnlineState(t.newValue)))return[2,this.handleOnlineStateEvent(a)]}else t.key===this.sequenceNumberKey&&(g(!!this.sequenceNumberHandler,"Missing sequenceNumberHandler"),(s=function(t){var e=at.INVALID;if(null!=t)try{var n=JSON.parse(t);g("number"==typeof n,"Found non-numeric sequence number"),e=n}catch(t){d(Ci,"Failed to read sequence number from WebStorage",t)}return e}(t.newValue))!==at.INVALID&&this.sequenceNumberHandler(s));return[2]}))}))}))}},Object.defineProperty(t.prototype,"localClientState",{get:function(){return this.activeClients[this.localClientId]},enumerable:!0,configurable:!0}),t.prototype.persistClientState=function(){this.setItem(this.localClientStorageKey,this.localClientState.toWebStorageJSON())},t.prototype.persistMutationState=function(t,e,n){var r=new Ni(this.currentUser,t,e,n),i=Si(this.persistenceKey,this.currentUser,t);this.setItem(i,r.toWebStorageJSON())},t.prototype.removeMutationState=function(t){var e=Si(this.persistenceKey,this.currentUser,t);this.removeItem(e)},t.prototype.persistOnlineState=function(t){var e={clientId:this.localClientId,onlineState:_r[t]};this.storage.setItem(this.onlineStateKey,JSON.stringify(e))},t.prototype.persistQueryTargetState=function(t,e,n){var r=Ii(this.persistenceKey,t),i=new Di(t,e,n);this.setItem(r,i.toWebStorageJSON())},t.prototype.fromWebStorageClientStateKey=function(t){var e=this.clientStateKeyRe.exec(t);return e?e[1]:null},t.prototype.fromWebStorageClientState=function(t,e){var n=this.fromWebStorageClientStateKey(t);return g(null!==n,"Cannot parse client state key '"+t+"'"),Ai.fromWebStorageEntry(n,e)},t.prototype.fromWebStorageMutationMetadata=function(t,e){var n=this.mutationBatchKeyRe.exec(t);g(null!==n,"Cannot parse mutation batch key '"+t+"'");var r=Number(n[1]),i=void 0!==n[2]?n[2]:null;return Ni.fromWebStorageEntry(new _i(i),r,e)},t.prototype.fromWebStorageQueryTargetMetadata=function(t,e){var n=this.queryTargetKeyRe.exec(t);g(null!==n,"Cannot parse query target key '"+t+"'");var r=Number(n[1]);return Di.fromWebStorageEntry(r,e)},t.prototype.fromWebStorageOnlineState=function(t){return Oi.fromWebStorageEntry(t)},t.prototype.handleMutationBatchEvent=function(t){return Object(i.b)(this,void 0,void 0,(function(){return Object(i.d)(this,(function(e){return t.user.uid!==this.currentUser.uid?(p(Ci,"Ignoring mutation for non-active user "+t.user.uid),[2]):[2,this.syncEngine.applyBatchState(t.batchId,t.state,t.error)]}))}))},t.prototype.handleQueryTargetEvent=function(t){return this.syncEngine.applyTargetState(t.targetId,t.state,t.error)},t.prototype.handleClientStateEvent=function(t,e){var n=this,r=this.getAllActiveQueryTargets();e?this.activeClients[t]=e:delete this.activeClients[t];var o=this.getAllActiveQueryTargets(),a=[],s=[];return o.forEach((function(t){return Object(i.b)(n,void 0,void 0,(function(){return Object(i.d)(this,(function(e){return r.has(t)||a.push(t),[2]}))}))})),r.forEach((function(t){return Object(i.b)(n,void 0,void 0,(function(){return Object(i.d)(this,(function(e){return o.has(t)||s.push(t),[2]}))}))})),this.syncEngine.applyActiveTargetsChange(a,s)},t.prototype.handleOnlineStateEvent=function(t){this.activeClients[t.clientId]&&this.onlineStateHandler(t.onlineState)},t}();var Pi=function(){function t(){this.localState=new ki,this.queryState={},this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null}return t.prototype.addPendingMutation=function(t){},t.prototype.updateMutationState=function(t,e,n){},t.prototype.addLocalQueryTarget=function(t){return this.localState.addQueryTarget(t),this.queryState[t]||"not-current"},t.prototype.updateQueryState=function(t,e,n){this.queryState[t]=e},t.prototype.removeLocalQueryTarget=function(t){this.localState.removeQueryTarget(t)},t.prototype.isLocalQueryTarget=function(t){return this.localState.activeTargetIds.has(t)},t.prototype.clearQueryState=function(t){delete this.queryState[t]},t.prototype.getAllActiveQueryTargets=function(){return this.localState.activeTargetIds},t.prototype.isActiveQueryTarget=function(t){return this.localState.activeTargetIds.has(t)},t.prototype.start=function(){return this.localState=new ki,Promise.resolve()},t.prototype.handleUserChange=function(t,e,n){},t.prototype.setOnlineState=function(t){},t.prototype.shutdown=function(){},t.prototype.writeSequenceNumber=function(t){},t}(),Mi=function(){function t(t,e){this.cacheSizeBytes=t,this.synchronizeTabs=e}return t.prototype.lruParams=function(){return Cn.withCacheSize(this.cacheSizeBytes)},t}(),Li=function(){},xi=function(){function t(t,e,n,r){this.platform=t,this.databaseInfo=e,this.credentials=n,this.asyncQueue=r,this.clientId=Y.newId()}return t.prototype.start=function(t){var e=this;this.verifyNotTerminated();var n=new ft,r=new ft,i=!1;return this.credentials.setChangeListener((function(o){i?e.asyncQueue.enqueueAndForget((function(){return e.handleCredentialChange(o)})):(i=!0,e.initializePersistence(t,r,o).then((function(t){return e.initializeRest(o,t)})).then(n.resolve,n.reject))})),this.asyncQueue.enqueueAndForget((function(){return n.promise})),r.promise},t.prototype.enableNetwork=function(){var t=this;return this.verifyNotTerminated(),this.asyncQueue.enqueue((function(){return t.syncEngine.enableNetwork()}))},t.prototype.initializePersistence=function(t,e,n){var r=this;return t instanceof Mi?this.startIndexedDbPersistence(n,t).then((function(t){return e.resolve(),t})).catch((function(t){if(e.reject(t),!r.canFallback(t))throw t;return console.warn("Error enabling offline persistence. Falling back to persistence disabled: "+t),r.startMemoryPersistence()})):(e.resolve(),this.startMemoryPersistence())},t.prototype.canFallback=function(t){return t instanceof T?t.code===w.FAILED_PRECONDITION||t.code===w.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&t instanceof DOMException)||(22===t.code||20===t.code||11===t.code)},t.prototype.verifyNotTerminated=function(){if(this.asyncQueue.isShuttingDown)throw new T(w.FAILED_PRECONDITION,"The client has already been terminated.")},t.prototype.startIndexedDbPersistence=function(t,e){var n=this,r=Mn.buildStoragePrefix(this.databaseInfo),o=new hi(this.databaseInfo.databaseId,{useProto3Json:!0});return Promise.resolve().then((function(){return Object(i.b)(n,void 0,void 0,(function(){var n,a;return Object(i.d)(this,(function(i){switch(i.label){case 0:if(e.synchronizeTabs&&!Ri.isAvailable(this.platform))throw new T(w.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");return n=e.lruParams(),this.sharedClientState=e.synchronizeTabs?new Ri(this.asyncQueue,this.platform,r,this.clientId,t):new Pi,[4,Mn.createIndexedDbPersistence({allowTabSynchronization:e.synchronizeTabs,persistenceKey:r,clientId:this.clientId,platform:this.platform,queue:this.asyncQueue,serializer:o,lruParams:n,sequenceNumberSyncer:this.sharedClientState})];case 1:return a=i.sent(),this.persistence=a,[2,a.referenceDelegate.garbageCollector]}}))}))}))},t.prototype.startMemoryPersistence=function(){return this.persistence=gr.createEagerPersistence(this.clientId),this.sharedClientState=new Pi,Promise.resolve(null)},t.prototype.initializeRest=function(t,e){var n=this;return p("FirestoreClient","Initializing. user=",t.uid),this.platform.loadConnection(this.databaseInfo).then((function(r){return Object(i.b)(n,void 0,void 0,(function(){var n,o,a,s,u,c,h=this;return Object(i.d)(this,(function(l){switch(l.label){case 0:return n=new ur,this.localStore=new fr(this.persistence,n,t),[4,this.localStore.start()];case 1:return l.sent(),e&&(this.lruScheduler=new Nn(e,this.asyncQueue,this.localStore)),o=this.platform.newConnectivityMonitor(),a=this.platform.newSerializer(this.databaseInfo.databaseId),s=new Nr(this.asyncQueue,r,this.credentials,a),u=function(t){return h.syncEngine.applyOnlineStateChange(t,Er.RemoteStore)},c=function(t){return h.syncEngine.applyOnlineStateChange(t,Er.SharedClientState)},this.remoteStore=new Yr(this.localStore,s,this.asyncQueue,u,o),this.syncEngine=new Ti(this.localStore,this.remoteStore,this.sharedClientState,t),this.sharedClientState.onlineStateHandler=c,this.remoteStore.syncEngine=this.syncEngine,this.sharedClientState.syncEngine=this.syncEngine,this.eventMgr=new fi(this.syncEngine),[4,this.sharedClientState.start()];case 2:return l.sent(),[4,this.remoteStore.start()];case 3:return l.sent(),[4,this.persistence.setPrimaryStateListener((function(t){return Object(i.b)(h,void 0,void 0,(function(){return Object(i.d)(this,(function(e){switch(e.label){case 0:return[4,this.syncEngine.applyPrimaryState(t)];case 1:return e.sent(),this.lruScheduler&&(t&&!this.lruScheduler.started?this.lruScheduler.start():t||this.lruScheduler.stop()),[2]}}))}))}))];case 4:return l.sent(),[4,this.persistence.setDatabaseDeletedListener((function(){return Object(i.b)(h,void 0,void 0,(function(){return Object(i.d)(this,(function(t){switch(t.label){case 0:return[4,this.terminate()];case 1:return t.sent(),[2]}}))}))}))];case 5:return l.sent(),[2]}}))}))}))},t.prototype.handleCredentialChange=function(t){return this.asyncQueue.verifyOperationInProgress(),p("FirestoreClient","Credential Changed. Current user: "+t.uid),this.syncEngine.handleCredentialChange(t)},t.prototype.disableNetwork=function(){var t=this;return this.verifyNotTerminated(),this.asyncQueue.enqueue((function(){return t.syncEngine.disableNetwork()}))},t.prototype.terminate=function(){var t=this;return this.asyncQueue.enqueueAndInitiateShutdown((function(){return Object(i.b)(t,void 0,void 0,(function(){return Object(i.d)(this,(function(t){switch(t.label){case 0:return this.lruScheduler&&this.lruScheduler.stop(),[4,this.remoteStore.shutdown()];case 1:return t.sent(),[4,this.sharedClientState.shutdown()];case 2:return t.sent(),[4,this.persistence.shutdown()];case 3:return t.sent(),this.credentials.removeChangeListener(),[2]}}))}))}))},t.prototype.waitForPendingWrites=function(){var t=this;this.verifyNotTerminated();var e=new ft;return this.asyncQueue.enqueueAndForget((function(){return t.syncEngine.registerPendingWritesCallback(e)})),e.promise},t.prototype.listen=function(t,e,n){var r=this;this.verifyNotTerminated();var i=new pi(t,e,n);return this.asyncQueue.enqueueAndForget((function(){return r.eventMgr.listen(i)})),i},t.prototype.unlisten=function(t){var e=this;this.clientTerminated||this.asyncQueue.enqueueAndForget((function(){return e.eventMgr.unlisten(t)}))},t.prototype.getDocumentFromLocalCache=function(t){var e=this;return this.verifyNotTerminated(),this.asyncQueue.enqueue((function(){return e.localStore.readDocument(t)})).then((function(t){if(t instanceof je)return t;if(t instanceof Ue)return null;throw new T(w.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)")}))},t.prototype.getDocumentsFromLocalCache=function(t){var e=this;return this.verifyNotTerminated(),this.asyncQueue.enqueue((function(){return Object(i.b)(e,void 0,void 0,(function(){var e,n,r;return Object(i.d)(this,(function(i){switch(i.label){case 0:return[4,this.localStore.executeQuery(t,!0)];case 1:return e=i.sent(),n=new gi(t,e.remoteKeys),r=n.computeDocChanges(e.documents),[2,n.applyChanges(r,!1).snapshot]}}))}))}))},t.prototype.write=function(t){var e=this;this.verifyNotTerminated();var n=new ft;return this.asyncQueue.enqueueAndForget((function(){return e.syncEngine.write(t,n)})),n.promise},t.prototype.databaseId=function(){return this.databaseInfo.databaseId},t.prototype.addSnapshotsInSyncListener=function(t){var e=this;this.verifyNotTerminated(),this.asyncQueue.enqueueAndForget((function(){return e.eventMgr.addSnapshotsInSyncListener(t),Promise.resolve()}))},t.prototype.removeSnapshotsInSyncListener=function(t){this.clientTerminated||this.eventMgr.removeSnapshotsInSyncListener(t)},Object.defineProperty(t.prototype,"clientTerminated",{get:function(){return this.asyncQueue.isShuttingDown},enumerable:!0,configurable:!0}),t.prototype.transaction=function(t){var e=this;this.verifyNotTerminated();var n=new ft;return this.asyncQueue.enqueueAndForget((function(){return e.syncEngine.runTransaction(e.asyncQueue,t,n),Promise.resolve()})),n.promise},t}(),Fi=function(){function t(t){this.observer=t,this.muted=!1}return t.prototype.next=function(t){this.scheduleEvent(this.observer.next,t)},t.prototype.error=function(t){this.scheduleEvent(this.observer.error,t)},t.prototype.mute=function(){this.muted=!0},t.prototype.scheduleEvent=function(t,e){var n=this;this.muted||setTimeout((function(){n.muted||t(e)}),0)},t}(),ji=function(){function t(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];R("FieldPath",t,"fieldNames",1);for(var n=0;n<t.length;++n)if(P("FieldPath","string",n,t[n]),0===t[n].length)throw new T(w.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new ht(t)}return t.documentId=function(){return t._DOCUMENT_ID},t.prototype.isEqual=function(e){if(!(e instanceof t))throw Q("isEqual","FieldPath",1,e);return this._internalPath.isEqual(e._internalPath)},t._DOCUMENT_ID=new t(ht.keyField().canonicalString()),t}(),Ui=new RegExp("[~\\*/\\[\\]]");
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var qi=function(t,e){this.user=e,this.type="OAuth",this.authHeaders={},this.authHeaders.Authorization="Bearer "+t},Vi=function(){function t(){this.changeListener=null}return t.prototype.getToken=function(){return Promise.resolve(null)},t.prototype.invalidateToken=function(){},t.prototype.setChangeListener=function(t){g(!this.changeListener,"Can only call setChangeListener() once."),this.changeListener=t,t(_i.UNAUTHENTICATED)},t.prototype.removeChangeListener=function(){g(null!==this.changeListener,"removeChangeListener() when no listener registered"),this.changeListener=null},t}(),Bi=function(){function t(t){var e=this;this.tokenListener=null,this.currentUser=_i.UNAUTHENTICATED,this.receivedInitialUser=!1,this.tokenCounter=0,this.changeListener=null,this.forceRefresh=!1,this.tokenListener=function(){e.tokenCounter++,e.currentUser=e.getUser(),e.receivedInitialUser=!0,e.changeListener&&e.changeListener(e.currentUser)},this.tokenCounter=0,this.auth=t.getImmediate({optional:!0}),this.auth?this.auth.addAuthTokenListener(this.tokenListener):(this.tokenListener(null),t.get().then((function(t){e.auth=t,e.tokenListener&&e.auth.addAuthTokenListener(e.tokenListener)}),(function(){})))}return t.prototype.getToken=function(){var t=this;g(null!=this.tokenListener,"getToken cannot be called after listener removed.");var e=this.tokenCounter,n=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(n).then((function(n){if(t.tokenCounter!==e)throw new T(w.ABORTED,"getToken aborted due to token change.");return n?(g("string"==typeof n.accessToken,"Invalid tokenData returned from getToken():"+n),new qi(n.accessToken,t.currentUser)):null})):Promise.resolve(null)},t.prototype.invalidateToken=function(){this.forceRefresh=!0},t.prototype.setChangeListener=function(t){g(!this.changeListener,"Can only call setChangeListener() once."),this.changeListener=t,this.receivedInitialUser&&t(this.currentUser)},t.prototype.removeChangeListener=function(){g(null!=this.tokenListener,"removeChangeListener() called twice"),g(null!==this.changeListener,"removeChangeListener() called when no listener registered"),this.auth&&this.auth.removeAuthTokenListener(this.tokenListener),this.tokenListener=null,this.changeListener=null},t.prototype.getUser=function(){var t=this.auth&&this.auth.getUid();return g(null===t||"string"==typeof t,"Received invalid UID: "+t),new _i(t)},t}(),Wi=function(){function t(t,e){this.gapi=t,this.sessionIndex=e,this.type="FirstParty",this.user=_i.FIRST_PARTY}return Object.defineProperty(t.prototype,"authHeaders",{get:function(){var t={"X-Goog-AuthUser":this.sessionIndex},e=this.gapi.auth.getAuthHeaderValueForFirstParty([]);return e&&(t.Authorization=e),t},enumerable:!0,configurable:!0}),t}(),Ki=function(){function t(t,e){this.gapi=t,this.sessionIndex=e}return t.prototype.getToken=function(){return Promise.resolve(new Wi(this.gapi,this.sessionIndex))},t.prototype.setChangeListener=function(t){t(_i.FIRST_PARTY)},t.prototype.removeChangeListener=function(){},t.prototype.invalidateToken=function(){},t}();function Qi(t){if(!t)return new Vi;switch(t.type){case"gapi":var e=t.client;return g(!("object"!=typeof e||null===e||!e.auth||!e.auth.getAuthHeaderValueForFirstParty),"unexpected gapi interface"),new Ki(e,t.sessionIndex||"0");case"provider":return t.client;default:throw new T(w.INVALID_ARGUMENT,"makeCredentialsProvider failed due to invalid credential type")}}
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Gi(t){return function(t,e){if("object"!=typeof t||null===t)return!1;for(var n=t,r=0,i=e;r<i.length;r++){var o=i[r];if(o in n&&"function"==typeof n[o])return!0}return!1}
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */(t,["next","error","complete"])}var Hi,zi=function(){function t(t){this._methodName=t}return t.delete=function(){return D("FieldValue.delete",arguments),Yi.instance},t.serverTimestamp=function(){return D("FieldValue.serverTimestamp",arguments),Xi.instance},t.arrayUnion=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return O("FieldValue.arrayUnion",arguments,1),new Ji(t)},t.arrayRemove=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return O("FieldValue.arrayRemove",arguments,1),new $i(t)},t.increment=function(t){return P("FieldValue.increment","number",1,t),A("FieldValue.increment",arguments,1),new Zi(t)},t.prototype.isEqual=function(t){return this===t},t}(),Yi=function(t){function e(){return t.call(this,"FieldValue.delete")||this}return Object(i.c)(e,t),e.instance=new e,e}(zi),Xi=function(t){function e(){return t.call(this,"FieldValue.serverTimestamp")||this}return Object(i.c)(e,t),e.instance=new e,e}(zi),Ji=function(t){function e(e){var n=t.call(this,"FieldValue.arrayUnion")||this;return n._elements=e,n}return Object(i.c)(e,t),e}(zi),$i=function(t){function e(e){var n=t.call(this,"FieldValue.arrayRemove")||this;return n._elements=e,n}return Object(i.c)(e,t),e}(zi),Zi=function(t){function e(e){var n=t.call(this,"FieldValue.increment")||this;return n._operand=e,n}return Object(i.c)(e,t),e}(zi),to=_(zi,"Use FieldValue.<field>() instead."),eo=/^__.*__$/,no=function(){function t(t,e,n){this.data=t,this.fieldMask=e,this.fieldTransforms=n}return t.prototype.toMutations=function(t,e){var n=[];return null!==this.fieldMask?n.push(new ve(t,this.data,this.fieldMask,e)):n.push(new ge(t,this.data,e)),this.fieldTransforms.length>0&&n.push(new be(t,this.fieldTransforms)),n},t}(),ro=function(){function t(t,e,n){this.data=t,this.fieldMask=e,this.fieldTransforms=n}return t.prototype.toMutations=function(t,e){var n=[new ve(t,this.data,this.fieldMask,e)];return this.fieldTransforms.length>0&&n.push(new be(t,this.fieldTransforms)),n},t}();function io(t){switch(t){case Hi.Set:case Hi.MergeSet:case Hi.Update:return!0;case Hi.Argument:case Hi.ArrayArgument:return!1;default:throw y("Unexpected case for UserDataSource: "+t)}}!function(t){t[t.Set=0]="Set",t[t.Update=1]="Update",t[t.MergeSet=2]="MergeSet",t[t.Argument=3]="Argument",t[t.ArrayArgument=4]="ArrayArgument"}(Hi||(Hi={}));var oo=function(){function t(t,e,n,r,i,o){this.dataSource=t,this.methodName=e,this.path=n,this.arrayElement=r,void 0===i&&this.validatePath(),this.arrayElement=void 0!==r&&r,this.fieldTransforms=i||[],this.fieldMask=o||[]}return t.prototype.childContextForField=function(e){var n=null==this.path?null:this.path.child(e),r=new t(this.dataSource,this.methodName,n,!1,this.fieldTransforms,this.fieldMask);return r.validatePathSegment(e),r},t.prototype.childContextForFieldPath=function(e){var n=null==this.path?null:this.path.child(e),r=new t(this.dataSource,this.methodName,n,!1,this.fieldTransforms,this.fieldMask);return r.validatePath(),r},t.prototype.childContextForArray=function(e){return new t(this.dataSource,this.methodName,null,!0,this.fieldTransforms,this.fieldMask)},t.prototype.createError=function(t){var e=null===this.path||this.path.isEmpty()?"":" (found in field "+this.path.toString()+")";return new T(w.INVALID_ARGUMENT,"Function "+this.methodName+"() called with invalid data. "+t+e)},t.prototype.contains=function(t){return void 0!==this.fieldMask.find((function(e){return t.isPrefixOf(e)}))||void 0!==this.fieldTransforms.find((function(e){return t.isPrefixOf(e.field)}))},t.prototype.validatePath=function(){if(null!==this.path)for(var t=0;t<this.path.length;t++)this.validatePathSegment(this.path.get(t))},t.prototype.validatePathSegment=function(t){if(0===t.length)throw this.createError("Document fields must not be empty");if(io(this.dataSource)&&eo.test(t))throw this.createError('Document fields cannot begin and end with "__"')},t}(),ao=function(t,e){this.databaseId=t,this.key=e},so=function(){function t(t){this.preConverter=t}return t.prototype.parseSetData=function(t,e){var n=new oo(Hi.Set,t,ht.EMPTY_PATH);co("Data must be an object, but it was:",n,e);var r=this.parseData(e,n);return new no(r,null,n.fieldTransforms)},t.prototype.parseMergeData=function(t,e,n){var r=new oo(Hi.MergeSet,t,ht.EMPTY_PATH);co("Data must be an object, but it was:",r,e);var i,o,a=this.parseData(e,r);if(n){for(var s=new It(ht.comparator),u=0,c=n;u<c.length;u++){var h=c[u],l=void 0;if(h instanceof ji)l=h._internalPath;else{if("string"!=typeof h)throw y("Expected stringOrFieldPath to be a string or a FieldPath");l=lo(t,h)}if(!r.contains(l))throw new T(w.INVALID_ARGUMENT,"Field '"+l+"' is specified in your field mask but missing from your input data.");s=s.add(l)}i=he.fromSet(s),o=r.fieldTransforms.filter((function(t){return i.covers(t.field)}))}else i=he.fromArray(r.fieldMask),o=r.fieldTransforms;return new no(a,i,o)},t.prototype.parseUpdateData=function(t,e){var n=this,r=new oo(Hi.Update,t,ht.EMPTY_PATH);co("Data must be an object, but it was:",r,e);var i=new It(ht.comparator),o=Le.EMPTY;C(e,(function(e,a){var s=lo(t,e),u=r.childContextForFieldPath(s);if((a=n.runPreConverter(a,u))instanceof Yi)i=i.add(s);else{var c=n.parseData(a,u);null!=c&&(i=i.add(s),o=o.set(s,c))}}));var a=he.fromSet(i);return new ro(o,a,r.fieldTransforms)},t.prototype.parseUpdateVarargs=function(t,e,n,r){var i=new oo(Hi.Update,t,ht.EMPTY_PATH),o=[ho(t,e)],a=[n];if(r.length%2!=0)throw new T(w.INVALID_ARGUMENT,"Function "+t+"() needs to be called with an even number of arguments that alternate between field names and values.");for(var s=0;s<r.length;s+=2)o.push(ho(t,r[s])),a.push(r[s+1]);var u=new It(ht.comparator),c=Le.EMPTY;for(s=0;s<o.length;++s){var h=o[s],l=i.childContextForFieldPath(h),f=this.runPreConverter(a[s],l);if(f instanceof Yi)u=u.add(h);else{var p=this.parseData(f,l);null!=p&&(u=u.add(h),c=c.set(h,p))}}var d=he.fromSet(u);return new ro(c,d,i.fieldTransforms)},t.prototype.parseQueryValue=function(t,e,n){void 0===n&&(n=!1);var r=new oo(n?Hi.ArrayArgument:Hi.Argument,t,ht.EMPTY_PATH),i=this.parseData(e,r);return g(null!=i,"Parsed data should not be null."),g(0===r.fieldTransforms.length,"Field transforms should have been disallowed."),i},t.prototype.runPreConverter=function(t,e){try{return this.preConverter(t)}catch(t){var n=fo(t);throw e.createError(n)}},t.prototype.parseData=function(t,e){if(uo(t=this.runPreConverter(t,e)))return co("Unsupported field value:",e,t),this.parseObject(t,e);if(t instanceof zi)return this.parseSentinelFieldValue(t,e),null;if(e.path&&e.fieldMask.push(e.path),t instanceof Array){if(e.arrayElement&&e.dataSource!==Hi.ArrayArgument)throw e.createError("Nested arrays are not supported");return this.parseArray(t,e)}return this.parseScalarValue(t,e)},t.prototype.parseObject=function(t,e){var n=this,r=new Tt(X);return N(t)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):C(t,(function(t,i){var o=n.parseData(i,e.childContextForField(t));null!=o&&(r=r.insert(t,o))})),new Le(r)},t.prototype.parseArray=function(t,e){for(var n=[],r=0,i=0,o=t;i<o.length;i++){var a=o[i],s=this.parseData(a,e.childContextForArray(r));null==s&&(s=Ee.INSTANCE),n.push(s),r++}return new xe(n)},t.prototype.parseSentinelFieldValue=function(t,e){if(!io(e.dataSource))throw e.createError(t._methodName+"() can only be used with update() and set()");if(null===e.path)throw e.createError(t._methodName+"() is not currently supported inside arrays");if(t instanceof Yi){if(e.dataSource!==Hi.MergeSet)throw e.dataSource===Hi.Update?(g(e.path.length>0,"FieldValue.delete() at the top level should have already been handled."),e.createError("FieldValue.delete() can only appear at the top level of your update data")):e.createError("FieldValue.delete() cannot be used with set() unless you pass {merge:true}");e.fieldMask.push(e.path)}else if(t instanceof Xi)e.fieldTransforms.push(new le(e.path,Jr.instance));else if(t instanceof Ji){var n=this.parseArrayTransformElements(t._methodName,t._elements),r=new $r(n);e.fieldTransforms.push(new le(e.path,r))}else if(t instanceof $i){n=this.parseArrayTransformElements(t._methodName,t._elements);var i=new Zr(n);e.fieldTransforms.push(new le(e.path,i))}else if(t instanceof Zi){var o=this.parseQueryValue("FieldValue.increment",t._operand),a=new ti(o);e.fieldTransforms.push(new le(e.path,a))}else y("Unknown FieldValue type: "+t)},t.prototype.parseScalarValue=function(t,e){if(null===t)return Ee.INSTANCE;if("number"==typeof t)return Qn(t)?new Ne(t):new De(t);if("boolean"==typeof t)return Se.of(t);if("string"==typeof t)return new Ae(t);if(t instanceof Date)return new Oe(bt.fromDate(t));if(t instanceof bt)return new Oe(new bt(t.seconds,1e3*Math.floor(t.nanoseconds/1e3)));if(t instanceof Xr)return new Me(t);if(t instanceof nt)return new Re(t);if(t instanceof ao)return new Pe(t.databaseId,t.key);throw e.createError("Unsupported field value: "+B(t))},t.prototype.parseArrayTransformElements=function(t,e){var n=this;return e.map((function(e,r){var i=new oo(Hi.Argument,t,ht.EMPTY_PATH);return n.parseData(e,i.childContextForArray(r))}))},t}();function uo(t){return!("object"!=typeof t||null===t||t instanceof Array||t instanceof Date||t instanceof bt||t instanceof Xr||t instanceof nt||t instanceof ao||t instanceof zi)}function co(t,e,n){if(!uo(n)||!V(n)){var r=B(n);throw"an object"===r?e.createError(t+" a custom object"):e.createError(t+" "+r)}}function ho(t,e){if(e instanceof ji)return e._internalPath;if("string"==typeof e)return lo(t,e);throw new T(w.INVALID_ARGUMENT,"Function "+t+"() called with invalid data. Field path arguments must be of type string or FieldPath.")}function lo(t,e){try{return function(t){if(t.search(Ui)>=0)throw new T(w.INVALID_ARGUMENT,"Invalid field path ("+t+"). Paths must not contain '~', '*', '/', '[', or ']'");try{return new(ji.bind.apply(ji,Object(i.g)([void 0],t.split("."))))}catch(e){throw new T(w.INVALID_ARGUMENT,"Invalid field path ("+t+"). Paths must not be empty, begin with '.', end with '.', or contain '..'")}}(e)._internalPath}catch(e){var n=fo(e);throw new T(w.INVALID_ARGUMENT,"Function "+t+"() called with invalid data. "+n)}}function fo(t){return t instanceof Error?t.message:t.toString()}
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var po=Cn.COLLECTION_DISABLED,mo=function(){function t(t){if(void 0===t.host){if(void 0!==t.ssl)throw new T(w.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else L("settings","non-empty string","host",t.host),this.host=t.host,x("settings","boolean","ssl",t.ssl),this.ssl=S(t.ssl,!0);if(K("settings",t,["host","ssl","credentials","timestampsInSnapshots","cacheSizeBytes","experimentalForceLongPolling"]),x("settings","object","credentials",t.credentials),this.credentials=t.credentials,x("settings","boolean","timestampsInSnapshots",t.timestampsInSnapshots),!0===t.timestampsInSnapshots?d("\n  The timestampsInSnapshots setting now defaults to true and you no\n  longer need to explicitly set it. In a future release, the setting\n  will be removed entirely and so it is recommended that you remove it\n  from your firestore.settings() call now."):!1===t.timestampsInSnapshots&&d("\n  The timestampsInSnapshots setting will soon be removed. YOU MUST UPDATE\n  YOUR CODE.\n\n  To hide this warning, stop using the timestampsInSnapshots setting in your\n  firestore.settings({ ... }) call.\n\n  Once you remove the setting, Timestamps stored in Cloud Firestore will be\n  read back as Firebase Timestamp objects instead of as system Date objects.\n  So you will also need to update code expecting a Date to instead expect a\n  Timestamp. For example:\n\n  // Old:\n  const date = snapshot.get('created_at');\n  // New:\n  const timestamp = snapshot.get('created_at'); const date =\n  timestamp.toDate();\n\n  Please audit all existing usages of Date when you enable the new\n  behavior."),this.timestampsInSnapshots=S(t.timestampsInSnapshots,!0),x("settings","number","cacheSizeBytes",t.cacheSizeBytes),void 0===t.cacheSizeBytes)this.cacheSizeBytes=Cn.DEFAULT_CACHE_SIZE_BYTES;else{if(t.cacheSizeBytes!==po&&t.cacheSizeBytes<Cn.MINIMUM_CACHE_SIZE_BYTES)throw new T(w.INVALID_ARGUMENT,"cacheSizeBytes must be at least "+Cn.MINIMUM_CACHE_SIZE_BYTES);this.cacheSizeBytes=t.cacheSizeBytes}x("settings","boolean","experimentalForceLongPolling",t.experimentalForceLongPolling),this.forceLongPolling=void 0!==t.experimentalForceLongPolling&&t.experimentalForceLongPolling}return t.prototype.isEqual=function(t){return this.host===t.host&&this.ssl===t.ssl&&this.timestampsInSnapshots===t.timestampsInSnapshots&&this.credentials===t.credentials&&this.cacheSizeBytes===t.cacheSizeBytes&&this.forceLongPolling===t.forceLongPolling},t}(),yo=function(){function t(e,n){var r=this;if(this._firebaseApp=null,this._queue=new dt,this.INTERNAL={delete:function(){return Object(i.b)(r,void 0,void 0,(function(){return Object(i.d)(this,(function(t){switch(t.label){case 0:return this.ensureClientConfigured(),[4,this._firestoreClient.terminate()];case 1:return t.sent(),[2]}}))}))}},"object"==typeof e.options){var o=e;this._firebaseApp=o,this._databaseId=t.databaseIdFromApp(o),this._persistenceKey=o.name,this._credentials=new Bi(n)}else{var a=e;if(!a.projectId)throw new T(w.INVALID_ARGUMENT,"Must provide projectId");this._databaseId=new ot(a.projectId,a.database),this._persistenceKey="[DEFAULT]",this._credentials=new Vi}this._settings=new mo({}),this._dataConverter=this.createDataConverter(this._databaseId)}return t.prototype.settings=function(t){if(A("Firestore.settings",arguments,1),P("Firestore.settings","object",1,t),E(t,"persistence"))throw new T(w.INVALID_ARGUMENT,'"persistence" is now specified with a separate call to firestore.enablePersistence().');var e=new mo(t);if(this._firestoreClient&&!this._settings.isEqual(e))throw new T(w.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only call settings() before calling any other methods on a Firestore object.");this._settings=e,void 0!==e.credentials&&(this._credentials=Qi(e.credentials))},t.prototype.enableNetwork=function(){return this.ensureClientConfigured(),this._firestoreClient.enableNetwork()},t.prototype.disableNetwork=function(){return this.ensureClientConfigured(),this._firestoreClient.disableNetwork()},t.prototype.enablePersistence=function(t){if(this._firestoreClient)throw new T(w.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only call enablePersistence() before calling any other methods on a Firestore object.");var e=!1;return t&&(void 0!==t.experimentalTabSynchronization&&d("The 'experimentalTabSynchronization' setting has been renamed to 'synchronizeTabs'. In a future release, the setting will be removed and it is recommended that you update your firestore.enablePersistence() call to use 'synchronizeTabs'."),e=S(void 0!==t.synchronizeTabs?t.synchronizeTabs:t.experimentalTabSynchronization,!1)),this.configureClient(new Mi(this._settings.cacheSizeBytes,e))},t.prototype.clearPersistence=function(){var t=this,e=Mn.buildStoragePrefix(this.makeDatabaseInfo()),n=new ft;return this._queue.enqueueAndForgetEvenAfterShutdown((function(){return Object(i.b)(t,void 0,void 0,(function(){var t;return Object(i.d)(this,(function(r){switch(r.label){case 0:if(r.trys.push([0,2,,3]),void 0!==this._firestoreClient&&!this._firestoreClient.clientTerminated)throw new T(w.FAILED_PRECONDITION,"Persistence cannot be cleared after this Firestore instance is initialized.");return[4,Mn.clearPersistence(e)];case 1:return r.sent(),n.resolve(),[3,3];case 2:return t=r.sent(),n.reject(t),[3,3];case 3:return[2]}}))}))})),n.promise},t.prototype.terminate=function(){return this.app._removeServiceInstance("firestore"),this.INTERNAL.delete()},Object.defineProperty(t.prototype,"_isTerminated",{get:function(){return this.ensureClientConfigured(),this._firestoreClient.clientTerminated},enumerable:!0,configurable:!0}),t.prototype.waitForPendingWrites=function(){return this.ensureClientConfigured(),this._firestoreClient.waitForPendingWrites()},t.prototype.onSnapshotsInSync=function(t){if(this.ensureClientConfigured(),Gi(t))return this.onSnapshotsInSyncInternal(t);P("Firestore.onSnapshotsInSync","function",1,t);var e={next:t};return this.onSnapshotsInSyncInternal(e)},t.prototype.onSnapshotsInSyncInternal=function(t){var e=this,n=new Fi({next:function(){t.next&&t.next()},error:function(t){throw y("Uncaught Error in onSnapshotsInSync")}});return this._firestoreClient.addSnapshotsInSyncListener(n),function(){n.mute(),e._firestoreClient.removeSnapshotsInSyncListener(n)}},t.prototype.ensureClientConfigured=function(){return this._firestoreClient||this.configureClient(new Li),this._firestoreClient},t.prototype.makeDatabaseInfo=function(){return new it(this._databaseId,this._persistenceKey,this._settings.host,this._settings.ssl,this._settings.forceLongPolling)},t.prototype.configureClient=function(t){g(!!this._settings.host,"FirestoreSettings.host is not set"),g(!this._firestoreClient,"configureClient() called multiple times");var e=this.makeDatabaseInfo();return this._firestoreClient=new xi(v.getPlatform(),e,this._credentials,this._queue),this._firestoreClient.start(t)},t.prototype.createDataConverter=function(t){return new so((function(e){if(e instanceof bo){var n=t,r=e.firestore._databaseId;if(!r.isEqual(n))throw new T(w.INVALID_ARGUMENT,"Document reference is for database "+r.projectId+"/"+r.database+" but should be for database "+n.projectId+"/"+n.database);return new ao(t,e._key)}return e}))},t.databaseIdFromApp=function(t){var e=t.options;if(!E(e,"projectId"))throw new T(w.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');var n=e.projectId;if(!n||"string"!=typeof n)throw new T(w.INVALID_ARGUMENT,"projectId must be a string in FirebaseApp.options");return new ot(n)},Object.defineProperty(t.prototype,"app",{get:function(){if(!this._firebaseApp)throw new T(w.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._firebaseApp},enumerable:!0,configurable:!0}),t.prototype.collection=function(t){return A("Firestore.collection",arguments,1),P("Firestore.collection","non-empty string",1,t),this.ensureClientConfigured(),new Io(ut.fromString(t),this)},t.prototype.doc=function(t){return A("Firestore.doc",arguments,1),P("Firestore.doc","non-empty string",1,t),this.ensureClientConfigured(),bo.forPath(ut.fromString(t),this)},t.prototype.collectionGroup=function(t){if(A("Firestore.collectionGroup",arguments,1),P("Firestore.collectionGroup","non-empty string",1,t),t.indexOf("/")>=0)throw new T(w.INVALID_ARGUMENT,"Invalid collection ID '"+t+"' passed to function Firestore.collectionGroup(). Collection IDs must not contain '/'.");return this.ensureClientConfigured(),new Eo(new zn(ut.EMPTY_PATH,t),this)},t.prototype.runTransaction=function(t){var e=this;return A("Firestore.runTransaction",arguments,1),P("Firestore.runTransaction","function",1,t),this.ensureClientConfigured().transaction((function(n){return t(new go(e,n))}))},t.prototype.batch=function(){return this.ensureClientConfigured(),new vo(this)},Object.defineProperty(t,"logLevel",{get:function(){switch(l()){case e.DEBUG:return"debug";case e.ERROR:return"error";case e.SILENT:return"silent";default:return y("Unknown log level: "+l())}},enumerable:!0,configurable:!0}),t.setLogLevel=function(t){switch(A("Firestore.setLogLevel",arguments,1),P("Firestore.setLogLevel","non-empty string",1,t),t){case"debug":f(e.DEBUG);break;case"error":f(e.ERROR);break;case"silent":f(e.SILENT);break;default:throw new T(w.INVALID_ARGUMENT,"Invalid log level: "+t)}},t.prototype._areTimestampsInSnapshotsEnabled=function(){return this._settings.timestampsInSnapshots},t}(),go=function(){function t(t,e){this._firestore=t,this._transaction=e}return t.prototype.get=function(t){var e=this;A("Transaction.get",arguments,1);var n=Ao("Transaction.get",t,this._firestore);return this._transaction.lookup([n._key]).then((function(t){if(!t||1!==t.length)return y("Mismatch in docs returned from document lookup.");var r=t[0];if(r instanceof Ue)return new To(e._firestore,n._key,null,!1,!1,n._converter);if(r instanceof je)return new To(e._firestore,n._key,r,!1,!1,n._converter);throw y("BatchGetDocumentsRequest returned unexpected document type: "+r.constructor.name)}))},t.prototype.set=function(t,e,n){k("Transaction.set",arguments,2,3);var r=Ao("Transaction.set",t,this._firestore);n=Co("Transaction.set",n);var i=ko(r._converter,e,"Transaction.set"),o=i[0],a=i[1],s=n.merge||n.mergeFields?this._firestore._dataConverter.parseMergeData(a,o,n.mergeFields):this._firestore._dataConverter.parseSetData(a,o);return this._transaction.set(r._key,s),this},t.prototype.update=function(t,e,n){for(var r,i,o=[],a=3;a<arguments.length;a++)o[a-3]=arguments[a];return"string"==typeof e||e instanceof ji?(O("Transaction.update",arguments,3),r=Ao("Transaction.update",t,this._firestore),i=this._firestore._dataConverter.parseUpdateVarargs("Transaction.update",e,n,o)):(A("Transaction.update",arguments,2),r=Ao("Transaction.update",t,this._firestore),i=this._firestore._dataConverter.parseUpdateData("Transaction.update",e)),this._transaction.update(r._key,i),this},t.prototype.delete=function(t){A("Transaction.delete",arguments,1);var e=Ao("Transaction.delete",t,this._firestore);return this._transaction.delete(e._key),this},t}(),vo=function(){function t(t){this._firestore=t,this._mutations=[],this._committed=!1}return t.prototype.set=function(t,e,n){k("WriteBatch.set",arguments,2,3),this.verifyNotCommitted();var r=Ao("WriteBatch.set",t,this._firestore);n=Co("WriteBatch.set",n);var i=ko(r._converter,e,"WriteBatch.set"),o=i[0],a=i[1],s=n.merge||n.mergeFields?this._firestore._dataConverter.parseMergeData(a,o,n.mergeFields):this._firestore._dataConverter.parseSetData(a,o);return this._mutations=this._mutations.concat(s.toMutations(r._key,me.NONE)),this},t.prototype.update=function(t,e,n){for(var r,i,o=[],a=3;a<arguments.length;a++)o[a-3]=arguments[a];return this.verifyNotCommitted(),"string"==typeof e||e instanceof ji?(O("WriteBatch.update",arguments,3),r=Ao("WriteBatch.update",t,this._firestore),i=this._firestore._dataConverter.parseUpdateVarargs("WriteBatch.update",e,n,o)):(A("WriteBatch.update",arguments,2),r=Ao("WriteBatch.update",t,this._firestore),i=this._firestore._dataConverter.parseUpdateData("WriteBatch.update",e)),this._mutations=this._mutations.concat(i.toMutations(r._key,me.exists(!0))),this},t.prototype.delete=function(t){A("WriteBatch.delete",arguments,1),this.verifyNotCommitted();var e=Ao("WriteBatch.delete",t,this._firestore);return this._mutations=this._mutations.concat(new we(e._key,me.NONE)),this},t.prototype.commit=function(){return Object(i.b)(this,void 0,void 0,(function(){return Object(i.d)(this,(function(t){return this.verifyNotCommitted(),this._committed=!0,this._mutations.length>0?[2,this._firestore.ensureClientConfigured().write(this._mutations)]:[2]}))}))},t.prototype.verifyNotCommitted=function(){if(this._committed)throw new T(w.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")},t}(),bo=function(){function t(t,e,n){this._key=t,this.firestore=e,this._converter=n,this._firestoreClient=this.firestore.ensureClientConfigured()}return t.forPath=function(e,n,r){if(e.length%2!=0)throw new T(w.INVALID_ARGUMENT,"Invalid document reference. Document references must have an even number of segments, but "+e.canonicalString()+" has "+e.length);return new t(new lt(e),n,r)},Object.defineProperty(t.prototype,"id",{get:function(){return this._key.path.lastSegment()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"parent",{get:function(){return new Io(this._key.path.popLast(),this.firestore,this._converter)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"path",{get:function(){return this._key.path.canonicalString()},enumerable:!0,configurable:!0}),t.prototype.collection=function(t){if(A("DocumentReference.collection",arguments,1),P("DocumentReference.collection","non-empty string",1,t),!t)throw new T(w.INVALID_ARGUMENT,"Must provide a non-empty collection name to collection()");var e=ut.fromString(t);return new Io(this._key.path.child(e),this.firestore)},t.prototype.isEqual=function(e){if(!(e instanceof t))throw Q("isEqual","DocumentReference",1,e);return this.firestore===e.firestore&&this._key.isEqual(e._key)&&this._converter===e._converter},t.prototype.set=function(t,e){k("DocumentReference.set",arguments,1,2),e=Co("DocumentReference.set",e);var n=ko(this._converter,t,"DocumentReference.set"),r=n[0],i=n[1],o=e.merge||e.mergeFields?this.firestore._dataConverter.parseMergeData(i,r,e.mergeFields):this.firestore._dataConverter.parseSetData(i,r);return this._firestoreClient.write(o.toMutations(this._key,me.NONE))},t.prototype.update=function(t,e){for(var n,r=[],i=2;i<arguments.length;i++)r[i-2]=arguments[i];return"string"==typeof t||t instanceof ji?(O("DocumentReference.update",arguments,2),n=this.firestore._dataConverter.parseUpdateVarargs("DocumentReference.update",t,e,r)):(A("DocumentReference.update",arguments,1),n=this.firestore._dataConverter.parseUpdateData("DocumentReference.update",t)),this._firestoreClient.write(n.toMutations(this._key,me.exists(!0)))},t.prototype.delete=function(){return A("DocumentReference.delete",arguments,0),this._firestoreClient.write([new we(this._key,me.NONE)])},t.prototype.onSnapshot=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];k("DocumentReference.onSnapshot",arguments,1,4);var n,r={includeMetadataChanges:!1},i=0;"object"!=typeof t[i]||Gi(t[i])||(K("DocumentReference.onSnapshot",r=t[i],["includeMetadataChanges"]),x("DocumentReference.onSnapshot","boolean","includeMetadataChanges",r.includeMetadataChanges),i++);var o={includeMetadataChanges:r.includeMetadataChanges};return Gi(t[i])?n=t[i]:(P("DocumentReference.onSnapshot","function",i,t[i]),M("DocumentReference.onSnapshot","function",i+1,t[i+1]),M("DocumentReference.onSnapshot","function",i+2,t[i+2]),n={next:t[i],error:t[i+1],complete:t[i+2]}),this.onSnapshotInternal(o,n)},t.prototype.onSnapshotInternal=function(t,e){var n=this,r=function(t){console.error("Uncaught Error in onSnapshot:",t)};e.error&&(r=e.error.bind(e));var i=new Fi({next:function(t){if(e.next){g(t.docs.size<=1,"Too many documents returned on a document query");var r=t.docs.get(n._key);e.next(new To(n.firestore,n._key,r,t.fromCache,t.hasPendingWrites,n._converter))}},error:r}),o=this._firestoreClient.listen(zn.atPath(this._key.path),i,t);return function(){i.mute(),n._firestoreClient.unlisten(o)}},t.prototype.get=function(t){var e=this;return k("DocumentReference.get",arguments,0,1),Do("DocumentReference.get",t),new Promise((function(n,r){t&&"cache"===t.source?e.firestore.ensureClientConfigured().getDocumentFromLocalCache(e._key).then((function(t){n(new To(e.firestore,e._key,t,!0,t instanceof je&&t.hasLocalMutations,e._converter))}),r):e.getViaSnapshotListener(n,r,t)}))},t.prototype.getViaSnapshotListener=function(t,e,n){var r=this.onSnapshotInternal({includeMetadataChanges:!0,waitForSyncWhenOnline:!0},{next:function(i){r(),!i.exists&&i.metadata.fromCache?e(new T(w.UNAVAILABLE,"Failed to get document because the client is offline.")):i.exists&&i.metadata.fromCache&&n&&"server"===n.source?e(new T(w.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):t(i)},error:e})},t.prototype.withConverter=function(e){return new t(this._key,this.firestore,e)},t}(),wo=function(){function t(t,e){this.hasPendingWrites=t,this.fromCache=e}return t.prototype.isEqual=function(t){return this.hasPendingWrites===t.hasPendingWrites&&this.fromCache===t.fromCache},t}(),To=function(){function t(t,e,n,r,i,o){this._firestore=t,this._key=e,this._document=n,this._fromCache=r,this._hasPendingWrites=i,this._converter=o}return t.prototype.data=function(t){if(k("DocumentSnapshot.data",arguments,0,1),t=No("DocumentSnapshot.data",t),this._document){if(this._converter){var e=new _o(this._firestore,this._key,this._document,this._fromCache,this._hasPendingWrites);return this._converter.fromFirestore(e,t)}return this.toJSObject(this._document.data(),Te.fromSnapshotOptions(t,this._firestore._areTimestampsInSnapshotsEnabled()))}},t.prototype.get=function(t,e){if(k("DocumentSnapshot.get",arguments,1,2),e=No("DocumentSnapshot.get",e),this._document){var n=this._document.data().field(ho("DocumentSnapshot.get",t));if(null!==n)return this.toJSValue(n,Te.fromSnapshotOptions(e,this._firestore._areTimestampsInSnapshotsEnabled()))}},Object.defineProperty(t.prototype,"id",{get:function(){return this._key.path.lastSegment()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"ref",{get:function(){return new bo(this._key,this._firestore,this._converter)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"exists",{get:function(){return null!==this._document},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"metadata",{get:function(){return new wo(this._hasPendingWrites,this._fromCache)},enumerable:!0,configurable:!0}),t.prototype.isEqual=function(e){if(!(e instanceof t))throw Q("isEqual","DocumentSnapshot",1,e);return this._firestore===e._firestore&&this._fromCache===e._fromCache&&this._key.isEqual(e._key)&&(null===this._document?null===e._document:this._document.isEqual(e._document))&&this._converter===e._converter},t.prototype.toJSObject=function(t,e){var n=this,r={};return t.forEach((function(t,i){r[t]=n.toJSValue(i,e)})),r},t.prototype.toJSValue=function(t,e){if(t instanceof Le)return this.toJSObject(t,e);if(t instanceof xe)return this.toJSArray(t,e);if(t instanceof Pe){var n=t.value(e),r=this._firestore.ensureClientConfigured().databaseId();return t.databaseId.isEqual(r)||d("Document "+this._key.path+" contains a document reference within a different database ("+t.databaseId.projectId+"/"+t.databaseId.database+") which is not supported. It will be treated as a reference in the current database ("+r.projectId+"/"+r.database+") instead."),new bo(n,this._firestore,this._converter)}return t.value(e)},t.prototype.toJSArray=function(t,e){var n=this;return t.internalValue.map((function(t){return n.toJSValue(t,e)}))},t}(),_o=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(i.c)(e,t),e.prototype.data=function(e){var n=t.prototype.data.call(this,e);return g(void 0!==n,"Document in a QueryDocumentSnapshot should exist"),n},e}(To),Eo=function(){function t(t,e,n){this._query=t,this.firestore=e,this._converter=n}return t.prototype.where=function(e,n,r){A("Query.where",arguments,3),W("Query.where",3,r);var i,o=["<","<=","==",">=",">","array-contains","in","array-contains-any"];U("Query.where",o,2,n);var a=ho("Query.where",e),s=Xn.fromString(n);if(a.isKeyField()){if(s===Xn.ARRAY_CONTAINS||s===Xn.ARRAY_CONTAINS_ANY)throw new T(w.INVALID_ARGUMENT,"Invalid Query. You can't perform '"+s.toString()+"' queries on FieldPath.documentId().");if(s===Xn.IN){this.validateDisjunctiveFilterElements(r,s);for(var u=[],c=0,h=r;c<h.length;c++){var l=h[c];u.push(this.parseDocumentIdValue(l))}i=new xe(u)}else i=this.parseDocumentIdValue(r)}else s!==Xn.IN&&s!==Xn.ARRAY_CONTAINS_ANY||this.validateDisjunctiveFilterElements(r,s),i=this.firestore._dataConverter.parseQueryValue("Query.where",r,s===Xn.IN);var f=Jn.create(a,s,i);return this.validateNewFilter(f),new t(this._query.addFilter(f),this.firestore,this._converter)},t.prototype.orderBy=function(e,n){var r;if(k("Query.orderBy",arguments,1,2),M("Query.orderBy","non-empty string",2,n),void 0===n||"asc"===n)r=rr.ASCENDING;else{if("desc"!==n)throw new T(w.INVALID_ARGUMENT,"Function Query.orderBy() has unknown direction '"+n+"', expected 'asc' or 'desc'.");r=rr.DESCENDING}if(null!==this._query.startAt)throw new T(w.INVALID_ARGUMENT,"Invalid query. You must not call Query.startAt() or Query.startAfter() before calling Query.orderBy().");if(null!==this._query.endAt)throw new T(w.INVALID_ARGUMENT,"Invalid query. You must not call Query.endAt() or Query.endBefore() before calling Query.orderBy().");var i=ho("Query.orderBy",e),o=new or(i,r);return this.validateNewOrderBy(o),new t(this._query.addOrderBy(o),this.firestore,this._converter)},t.prototype.limit=function(e){return A("Query.limit",arguments,1),P("Query.limit","number",1,e),G("Query.limit",1,e),new t(this._query.withLimitToFirst(e),this.firestore,this._converter)},t.prototype.limitToLast=function(e){return A("Query.limitToLast",arguments,1),P("Query.limitToLast","number",1,e),G("Query.limitToLast",1,e),new t(this._query.withLimitToLast(e),this.firestore,this._converter)},t.prototype.startAt=function(e){for(var n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];O("Query.startAt",arguments,1);var i=this.boundFromDocOrFields("Query.startAt",e,n,!0);return new t(this._query.withStartAt(i),this.firestore,this._converter)},t.prototype.startAfter=function(e){for(var n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];O("Query.startAfter",arguments,1);var i=this.boundFromDocOrFields("Query.startAfter",e,n,!1);return new t(this._query.withStartAt(i),this.firestore,this._converter)},t.prototype.endBefore=function(e){for(var n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];O("Query.endBefore",arguments,1);var i=this.boundFromDocOrFields("Query.endBefore",e,n,!0);return new t(this._query.withEndAt(i),this.firestore,this._converter)},t.prototype.endAt=function(e){for(var n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];O("Query.endAt",arguments,1);var i=this.boundFromDocOrFields("Query.endAt",e,n,!1);return new t(this._query.withEndAt(i),this.firestore,this._converter)},t.prototype.isEqual=function(e){if(!(e instanceof t))throw Q("isEqual","Query",1,e);return this.firestore===e.firestore&&this._query.isEqual(e._query)},t.prototype.withConverter=function(e){return new t(this._query,this.firestore,e)},t.prototype.boundFromDocOrFields=function(t,e,n,r){if(W(t,1,e),e instanceof To){if(n.length>0)throw new T(w.INVALID_ARGUMENT,"Too many arguments provided to "+t+"().");var i=e;if(!i.exists)throw new T(w.NOT_FOUND,"Can't use a DocumentSnapshot that doesn't exist for "+t+"().");return this.boundFromDocument(t,i._document,r)}var o=[e].concat(n);return this.boundFromFields(t,o,r)},t.prototype.boundFromDocument=function(t,e,n){for(var r=[],i=0,o=this._query.orderBy;i<o.length;i++){var a=o[i];if(a.field.isKeyField())r.push(new Pe(this.firestore._databaseId,e.key));else{var s=e.field(a.field);if(s instanceof ke)throw new T(w.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+a.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null===s){var u=a.field.canonicalString();throw new T(w.INVALID_ARGUMENT,"Invalid query. You are trying to start or end a query using a document for which the field '"+u+"' (used as the orderBy) does not exist.")}r.push(s)}}return new ir(r,n)},t.prototype.boundFromFields=function(t,e,n){var r=this._query.explicitOrderBy;if(e.length>r.length)throw new T(w.INVALID_ARGUMENT,"Too many arguments provided to "+t+"(). The number of arguments must be less than or equal to the number of Query.orderBy() clauses");for(var i=[],o=0;o<e.length;o++){var a=e[o];if(r[o].field.isKeyField()){if("string"!=typeof a)throw new T(w.INVALID_ARGUMENT,"Invalid query. Expected a string for document ID in "+t+"(), but got a "+typeof a);if(!this._query.isCollectionGroupQuery()&&-1!==a.indexOf("/"))throw new T(w.INVALID_ARGUMENT,"Invalid query. When querying a collection and ordering by FieldPath.documentId(), the value passed to "+t+"() must be a plain document ID, but '"+a+"' contains a slash.");var s=this._query.path.child(ut.fromString(a));if(!lt.isDocumentKey(s))throw new T(w.INVALID_ARGUMENT,"Invalid query. When querying a collection group and ordering by FieldPath.documentId(), the value passed to "+t+"() must result in a valid document path, but '"+s+"' is not because it contains an odd number of segments.");var u=new lt(s);i.push(new Pe(this.firestore._databaseId,u))}else{var c=this.firestore._dataConverter.parseQueryValue(t,a);i.push(c)}}return new ir(i,n)},t.prototype.onSnapshot=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];k("Query.onSnapshot",arguments,1,4);var n,r={},i=0;return"object"!=typeof t[i]||Gi(t[i])||(K("Query.onSnapshot",r=t[i],["includeMetadataChanges"]),x("Query.onSnapshot","boolean","includeMetadataChanges",r.includeMetadataChanges),i++),Gi(t[i])?n=t[i]:(P("Query.onSnapshot","function",i,t[i]),M("Query.onSnapshot","function",i+1,t[i+1]),M("Query.onSnapshot","function",i+2,t[i+2]),n={next:t[i],error:t[i+1],complete:t[i+2]}),this.validateHasExplicitOrderByForLimitToLast(this._query),this.onSnapshotInternal(r,n)},t.prototype.onSnapshotInternal=function(t,e){var n=this,r=function(t){console.error("Uncaught Error in onSnapshot:",t)};e.error&&(r=e.error.bind(e));var i=new Fi({next:function(t){e.next&&e.next(new So(n.firestore,n._query,t,n._converter))},error:r}),o=this.firestore.ensureClientConfigured(),a=o.listen(this._query,i,t);return function(){i.mute(),o.unlisten(a)}},t.prototype.validateHasExplicitOrderByForLimitToLast=function(t){if(t.hasLimitToLast()&&0===t.explicitOrderBy.length)throw new T(w.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")},t.prototype.get=function(t){var e=this;return k("Query.get",arguments,0,1),Do("Query.get",t),this.validateHasExplicitOrderByForLimitToLast(this._query),new Promise((function(n,r){t&&"cache"===t.source?e.firestore.ensureClientConfigured().getDocumentsFromLocalCache(e._query).then((function(t){n(new So(e.firestore,e._query,t,e._converter))}),r):e.getViaSnapshotListener(n,r,t)}))},t.prototype.getViaSnapshotListener=function(t,e,n){var r=this.onSnapshotInternal({includeMetadataChanges:!0,waitForSyncWhenOnline:!0},{next:function(i){r(),i.metadata.fromCache&&n&&"server"===n.source?e(new T(w.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):t(i)},error:e})},t.prototype.parseDocumentIdValue=function(t){if("string"==typeof t){if(""===t)throw new T(w.INVALID_ARGUMENT,"Invalid query. When querying with FieldPath.documentId(), you must provide a valid document ID, but it was an empty string.");if(!this._query.isCollectionGroupQuery()&&-1!==t.indexOf("/"))throw new T(w.INVALID_ARGUMENT,"Invalid query. When querying a collection by FieldPath.documentId(), you must provide a plain document ID, but '"+t+"' contains a '/' character.");var e=this._query.path.child(ut.fromString(t));if(!lt.isDocumentKey(e))throw new T(w.INVALID_ARGUMENT,"Invalid query. When querying a collection group by FieldPath.documentId(), the value provided must result in a valid document path, but '"+e+"' is not because it has an odd number of segments ("+e.length+").");return new Pe(this.firestore._databaseId,new lt(e))}if(t instanceof bo){var n=t;return new Pe(this.firestore._databaseId,n._key)}throw new T(w.INVALID_ARGUMENT,"Invalid query. When querying with FieldPath.documentId(), you must provide a valid string or a DocumentReference, but it was: "+B(t)+".")},t.prototype.validateDisjunctiveFilterElements=function(t,e){if(!Array.isArray(t)||0===t.length)throw new T(w.INVALID_ARGUMENT,"Invalid Query. A non-empty array is required for '"+e.toString()+"' filters.");if(t.length>10)throw new T(w.INVALID_ARGUMENT,"Invalid Query. '"+e.toString()+"' filters support a maximum of 10 elements in the value array.");if(t.indexOf(null)>=0)throw new T(w.INVALID_ARGUMENT,"Invalid Query. '"+e.toString()+"' filters cannot contain 'null' in the value array.");if(t.filter((function(t){return Number.isNaN(t)})).length>0)throw new T(w.INVALID_ARGUMENT,"Invalid Query. '"+e.toString()+"' filters cannot contain 'NaN' in the value array.")},t.prototype.validateNewFilter=function(t){if(t instanceof Jn){var e=[Xn.ARRAY_CONTAINS,Xn.ARRAY_CONTAINS_ANY],n=[Xn.IN,Xn.ARRAY_CONTAINS_ANY],r=e.indexOf(t.op)>=0,i=n.indexOf(t.op)>=0;if(t.isInequality()){var o=this._query.getInequalityFilterField();if(null!==o&&!o.isEqual(t.field))throw new T(w.INVALID_ARGUMENT,"Invalid query. All where filters with an inequality (<, <=, >, or >=) must be on the same field. But you have inequality filters on '"+o.toString()+"' and '"+t.field.toString()+"'");var a=this._query.getFirstOrderByField();null!==a&&this.validateOrderByAndInequalityMatch(t.field,a)}else if(i||r){var s=null;if(i&&(s=this._query.findFilterOperator(n)),null===s&&r&&(s=this._query.findFilterOperator(e)),null!=s)throw s===t.op?new T(w.INVALID_ARGUMENT,"Invalid query. You cannot use more than one '"+t.op.toString()+"' filter."):new T(w.INVALID_ARGUMENT,"Invalid query. You cannot use '"+t.op.toString()+"' filters with '"+s.toString()+"' filters.")}}},t.prototype.validateNewOrderBy=function(t){if(null===this._query.getFirstOrderByField()){var e=this._query.getInequalityFilterField();null!==e&&this.validateOrderByAndInequalityMatch(e,t.field)}},t.prototype.validateOrderByAndInequalityMatch=function(t,e){if(!e.isEqual(t))throw new T(w.INVALID_ARGUMENT,"Invalid query. You have a where filter with an inequality (<, <=, >, or >=) on field '"+t.toString()+"' and so you must also use '"+t.toString()+"' as your first Query.orderBy(), but your first Query.orderBy() is on field '"+e.toString()+"' instead.")},t}(),So=function(){function t(t,e,n,r){this._firestore=t,this._originalQuery=e,this._snapshot=n,this._converter=r,this._cachedChanges=null,this._cachedChangesIncludeMetadataChanges=null,this.metadata=new wo(n.hasPendingWrites,n.fromCache)}return Object.defineProperty(t.prototype,"docs",{get:function(){var t=[];return this.forEach((function(e){return t.push(e)})),t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"empty",{get:function(){return this._snapshot.docs.isEmpty()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"size",{get:function(){return this._snapshot.docs.size},enumerable:!0,configurable:!0}),t.prototype.forEach=function(t,e){var n=this;k("QuerySnapshot.forEach",arguments,1,2),P("QuerySnapshot.forEach","function",1,t),this._snapshot.docs.forEach((function(r){t.call(e,n.convertToDocumentImpl(r))}))},Object.defineProperty(t.prototype,"query",{get:function(){return new Eo(this._originalQuery,this._firestore,this._converter)},enumerable:!0,configurable:!0}),t.prototype.docChanges=function(t){t&&(K("QuerySnapshot.docChanges",t,["includeMetadataChanges"]),x("QuerySnapshot.docChanges","boolean","includeMetadataChanges",t.includeMetadataChanges));var e=!(!t||!t.includeMetadataChanges);if(e&&this._snapshot.excludesMetadataChanges)throw new T(w.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===e||(this._cachedChanges=function(t,e,n,r){if(n.oldDocs.isEmpty()){var i,o=0;return n.docChanges.map((function(e){var a=new _o(t,e.doc.key,e.doc,n.fromCache,n.mutatedKeys.has(e.doc.key),r);return g(e.type===Mr.Added,"Invalid event type for first snapshot"),g(!i||n.query.docComparator(i,e.doc)<0,"Got added events in wrong order"),i=e.doc,{type:"added",doc:a,oldIndex:-1,newIndex:o++}}))}var a=n.oldDocs;return n.docChanges.filter((function(t){return e||t.type!==Mr.Metadata})).map((function(e){var i=new _o(t,e.doc.key,e.doc,n.fromCache,n.mutatedKeys.has(e.doc.key),r),o=-1,s=-1;return e.type!==Mr.Added&&(g((o=a.indexOf(e.doc.key))>=0,"Index for document not found"),a=a.delete(e.doc.key)),e.type!==Mr.Removed&&(s=(a=a.add(e.doc)).indexOf(e.doc.key)),{type:Oo(e.type),doc:i,oldIndex:o,newIndex:s}}))}(this._firestore,e,this._snapshot,this._converter),this._cachedChangesIncludeMetadataChanges=e),this._cachedChanges},t.prototype.isEqual=function(e){if(!(e instanceof t))throw Q("isEqual","QuerySnapshot",1,e);return this._firestore===e._firestore&&this._originalQuery.isEqual(e._originalQuery)&&this._snapshot.isEqual(e._snapshot)&&this._converter===e._converter},t.prototype.convertToDocumentImpl=function(t){return new _o(this._firestore,t.key,t,this.metadata.fromCache,this._snapshot.mutatedKeys.has(t.key),this._converter)},t}();Object(i.g)(["length","forEach","map"],"undefined"!=typeof Symbol?[Symbol.iterator]:[]).forEach((function(t){try{Object.defineProperty(So.prototype.docChanges,t,{get:function(){return function(){throw new T(w.INVALID_ARGUMENT,'QuerySnapshot.docChanges has been changed from a property into a method, so usages like "querySnapshot.docChanges" should become "querySnapshot.docChanges()"')}()}})}catch(t){}}));var Io=function(t){function e(e,n,r){var i=t.call(this,zn.atPath(e),n,r)||this;if(i._path=e,e.length%2!=1)throw new T(w.INVALID_ARGUMENT,"Invalid collection reference. Collection references must have an odd number of segments, but "+e.canonicalString()+" has "+e.length);return i}return Object(i.c)(e,t),Object.defineProperty(e.prototype,"id",{get:function(){return this._query.path.lastSegment()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"parent",{get:function(){var t=this._query.path.popLast();return t.isEmpty()?null:new bo(new lt(t),this.firestore)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"path",{get:function(){return this._query.path.canonicalString()},enumerable:!0,configurable:!0}),e.prototype.doc=function(t){if(k("CollectionReference.doc",arguments,0,1),0===arguments.length&&(t=Y.newId()),P("CollectionReference.doc","non-empty string",1,t),""===t)throw new T(w.INVALID_ARGUMENT,"Document path must be a non-empty string");var e=ut.fromString(t);return bo.forPath(this._query.path.child(e),this.firestore,this._converter)},e.prototype.add=function(t){A("CollectionReference.add",arguments,1),P("CollectionReference.add","object",1,t);var e=this.doc();return e.set(t).then((function(){return e}))},e.prototype.withConverter=function(t){return new e(this._path,this.firestore,t)},e}(Eo);function Co(t,e){if(void 0===e)return{merge:!1};if(K(t,e,["merge","mergeFields"]),x(t,"boolean","merge",e.merge),F(t,"mergeFields","a string or a FieldPath",e.mergeFields,(function(t){return"string"==typeof t||t instanceof ji})),void 0!==e.mergeFields&&void 0!==e.merge)throw new T(w.INVALID_ARGUMENT,"Invalid options passed to function "+t+'(): You cannot specify both "merge" and "mergeFields".');return e}function No(t,e){return void 0===e?{}:(K(t,e,["serverTimestamps"]),j(t,0,"serverTimestamps",e.serverTimestamps,["estimate","previous","none"]),e)}function Do(t,e){M(t,"object",1,e),e&&(K(t,e,["source"]),j(t,0,"source",e.source,["default","server","cache"]))}function Ao(t,e,n){if(e instanceof bo){if(e.firestore!==n)throw new T(w.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return e}throw Q(t,"DocumentReference",1,e)}function Oo(t){switch(t){case Mr.Added:return"added";case Mr.Modified:case Mr.Metadata:return"modified";case Mr.Removed:return"removed";default:return y("Unknown change type: "+t)}}function ko(t,e,n){var r;return t?(r=t.toFirestore(e),n="toFirestore() in "+n):r=e,[r,n]}var Ro=_(yo,"Use firebase.firestore() instead."),Po=_(go,"Use firebase.firestore().runTransaction() instead."),Mo=_(vo,"Use firebase.firestore().batch() instead."),Lo=_(bo,"Use firebase.firestore().doc() instead."),xo=_(To),Fo=_(_o),jo=_(Eo),Uo=_(So),qo=_(Io,"Use firebase.firestore().collection() instead."),Vo={Firestore:Ro,GeoPoint:Xr,Timestamp:bt,Blob:rt,Transaction:Po,WriteBatch:Mo,DocumentReference:Lo,DocumentSnapshot:xo,Query:jo,QueryDocumentSnapshot:Fo,QuerySnapshot:Uo,CollectionReference:qo,FieldPath:ji,FieldValue:to,setLogLevel:yo.setLogLevel,CACHE_SIZE_UNLIMITED:po};function Bo(t){t.INTERNAL.registerComponent(new s.a("firestore",(function(t){var e=t.getProvider("app").getImmediate();return new yo(e,t.getProvider("auth-internal"))}),"PUBLIC").setServiceProps(function(t){g(t&&"object"==typeof t,"shallowCopy() expects object parameter.");var e={};for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e}(Vo)))}
/**
 * @license
 * Copyright 2019 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Wo=function(){function t(){}return t.prototype.addCallback=function(t){},t.prototype.shutdown=function(){},t}(),Ko=function(){function t(){var t=this;this.networkAvailableListener=function(){return t.onNetworkAvailable()},this.networkUnavailableListener=function(){return t.onNetworkUnavailable()},this.callbacks=[],this.configureNetworkMonitoring()}return t.prototype.addCallback=function(t){this.callbacks.push(t)},t.prototype.shutdown=function(){window.removeEventListener("online",this.networkAvailableListener),window.removeEventListener("offline",this.networkUnavailableListener)},t.prototype.configureNetworkMonitoring=function(){window.addEventListener("online",this.networkAvailableListener),window.addEventListener("offline",this.networkUnavailableListener)},t.prototype.onNetworkAvailable=function(){p("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(var t=0,e=this.callbacks;t<e.length;t++){(0,e[t])(0)}},t.prototype.onNetworkUnavailable=function(){p("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(var t=0,e=this.callbacks;t<e.length;t++){(0,e[t])(1)}},t.isAvailable=function(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener},t}(),Qo=function(){function t(t){this.sendFn=t.sendFn,this.closeFn=t.closeFn}return t.prototype.onOpen=function(t){g(!this.wrappedOnOpen,"Called onOpen on stream twice!"),this.wrappedOnOpen=t},t.prototype.onClose=function(t){g(!this.wrappedOnClose,"Called onClose on stream twice!"),this.wrappedOnClose=t},t.prototype.onMessage=function(t){g(!this.wrappedOnMessage,"Called onMessage on stream twice!"),this.wrappedOnMessage=t},t.prototype.close=function(){this.closeFn()},t.prototype.send=function(t){this.sendFn(t)},t.prototype.callOnOpen=function(){g(void 0!==this.wrappedOnOpen,"Cannot call onOpen because no callback was set"),this.wrappedOnOpen()},t.prototype.callOnClose=function(t){g(void 0!==this.wrappedOnClose,"Cannot call onClose because no callback was set"),this.wrappedOnClose(t)},t.prototype.callOnMessage=function(t){g(void 0!==this.wrappedOnMessage,"Cannot call onMessage because no callback was set"),this.wrappedOnMessage(t)},t}(),Go="Connection",Ho={BatchGetDocuments:"batchGet",Commit:"commit"},zo="gl-js/ fire/"+c,Yo=function(){function t(t){this.databaseId=t.databaseId;var e=t.ssl?"https":"http";this.baseUrl=e+"://"+t.host,this.forceLongPolling=t.forceLongPolling}return t.prototype.modifyHeadersForRequest=function(t,e){if(e)for(var n in e.authHeaders)e.authHeaders.hasOwnProperty(n)&&(t[n]=e.authHeaders[n]);t["X-Goog-Api-Client"]=zo},t.prototype.invokeRPC=function(t,e,n){var r=this,o=this.makeUrl(t);return new Promise((function(a,s){var c=new u.d;c.listenOnce(u.b.COMPLETE,(function(){try{switch(c.getLastErrorCode()){case u.a.NO_ERROR:var e=c.getResponseJson();p(Go,"XHR received:",JSON.stringify(e)),a(e);break;case u.a.TIMEOUT:p(Go,'RPC "'+t+'" timed out'),s(new T(w.DEADLINE_EXCEEDED,"Request time out"));break;case u.a.HTTP_ERROR:var n=c.getStatus();if(p(Go,'RPC "'+t+'" failed with status:',n,"response text:",c.getResponseText()),n>0){var r=c.getResponseJson().error;if(r&&r.status&&r.message){var i=(o=r.status,h=o.toLowerCase().replace("_","-"),Object.values(w).indexOf(h)>=0?h:w.UNKNOWN);s(new T(i,r.message))}else s(new T(w.UNKNOWN,"Server responded with status "+c.getStatus()))}else p(Go,'RPC "'+t+'" failed'),s(new T(w.UNAVAILABLE,"Connection failed."));break;default:y('RPC "'+t+'" failed with unanticipated webchannel error '+c.getLastErrorCode()+": "+c.getLastError()+", giving up.")}}finally{p(Go,'RPC "'+t+'" completed.')}var o,h}));var h=Object(i.a)({},e);delete h.database;var l=JSON.stringify(h);p(Go,"XHR sending: ",o+" "+l);var f={"Content-Type":"text/plain"};r.modifyHeadersForRequest(f,n),c.send(o,"POST",l,f,15)}))},t.prototype.invokeStreamingRPC=function(t,e,n){return this.invokeRPC(t,e,n)},t.prototype.openStream=function(t,e){var n=[this.baseUrl,"/","google.firestore.v1.Firestore","/",t,"/channel"],r=Object(u.e)(),i={backgroundChannelTest:!0,httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:"projects/"+this.databaseId.projectId+"/databases/"+this.databaseId.database},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling};this.modifyHeadersForRequest(i.initMessageHeaders,e),Object(a.x)()||Object(a.r)()||Object(a.t)()||Object(a.y)()||(i.httpHeadersOverwriteParam="$httpHeaders");var o=n.join("");p(Go,"Creating WebChannel: "+o+" "+i);var s=r.createWebChannel(o,i),c=!1,h=!1,l=new Qo({sendFn:function(t){h?p(Go,"Not sending because WebChannel is closed:",t):(c||(p(Go,"Opening WebChannel transport."),s.open(),c=!0),p(Go,"WebChannel sending:",t),s.send(t))},closeFn:function(){return s.close()}}),f=function(t,e){s.listen(t,(function(t){try{e(t)}catch(t){setTimeout((function(){throw t}),0)}}))};return f(u.c.EventType.OPEN,(function(){h||p(Go,"WebChannel transport opened.")})),f(u.c.EventType.CLOSE,(function(){h||(h=!0,p(Go,"WebChannel transport closed"),l.callOnClose())})),f(u.c.EventType.ERROR,(function(t){h||(h=!0,p(Go,"WebChannel transport errored:",t),l.callOnClose(new T(w.UNAVAILABLE,"The operation could not be completed")))})),f(u.c.EventType.MESSAGE,(function(t){var e;if(!h){var n=t.data[0];g(!!n,"Got a webchannel message without data.");var r=n,i=r.error||(null===(e=r[0])||void 0===e?void 0:e.error);if(i){p(Go,"WebChannel received error:",i);var o=i.status,a=function(t){var e=Ar[t];if(void 0!==e)return Rr(e)}(o),u=i.message;void 0===a&&(a=w.INTERNAL,u="Unknown error status: "+o+" with message "+i.message),h=!0,l.callOnClose(new T(a,u)),s.close()}else p(Go,"WebChannel received:",n),l.callOnMessage(n)}})),setTimeout((function(){l.callOnOpen()}),0),l},t.prototype.makeUrl=function(t){var e=Ho[t];return g(void 0!==e,"Unknown REST mapping for: "+t),this.baseUrl+"/v1/projects/"+this.databaseId.projectId+"/databases/"+this.databaseId.database+"/documents:"+e},t}(),Xo=function(){function t(){this.emptyByteString="",this.base64Available="undefined"!=typeof atob}return Object.defineProperty(t.prototype,"document",{get:function(){return"undefined"!=typeof document?document:null},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"window",{get:function(){return"undefined"!=typeof window?window:null},enumerable:!0,configurable:!0}),t.prototype.loadConnection=function(t){return Promise.resolve(new Yo(t))},t.prototype.newConnectivityMonitor=function(){return Ko.isAvailable()?new Ko:new Wo},t.prototype.newSerializer=function(t){return new hi(t,{useProto3Json:!0})},t.prototype.formatJSON=function(t){return JSON.stringify(t)},t.prototype.atob=function(t){return atob(t)},t.prototype.btoa=function(t){return btoa(t)},t}();
/**
 * @license
 * Copyright 2019 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
v.setPlatform(new Xo);var Jo;Bo(Jo=r.default),Jo.registerVersion("@firebase/firestore","1.9.2")}).call(this,n(4))},function(t,e,n){"use strict";(function(t){n.d(e,"a",(function(){return cr})),n.d(e,"b",(function(){return hr})),n.d(e,"c",(function(){return lr})),n.d(e,"d",(function(){return fr})),n.d(e,"e",(function(){return ur}));var r,i="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:void 0!==t?t:"undefined"!=typeof self?self:{},o=o||{},a=i;function s(t){return"string"==typeof t}function u(t){return"number"==typeof t}function c(t,e){t=t.split("."),e=e||a;for(var n=0;n<t.length;n++)if(null==(e=e[t[n]]))return null;return e}function h(){}function l(t){var e=typeof t;if("object"==e){if(!t)return"null";if(t instanceof Array)return"array";if(t instanceof Object)return e;var n=Object.prototype.toString.call(t);if("[object Window]"==n)return"object";if("[object Array]"==n||"number"==typeof t.length&&void 0!==t.splice&&void 0!==t.propertyIsEnumerable&&!t.propertyIsEnumerable("splice"))return"array";if("[object Function]"==n||void 0!==t.call&&void 0!==t.propertyIsEnumerable&&!t.propertyIsEnumerable("call"))return"function"}else if("function"==e&&void 0===t.call)return"object";return e}function f(t){return"array"==l(t)}function p(t){var e=l(t);return"array"==e||"object"==e&&"number"==typeof t.length}function d(t){var e=typeof t;return"object"==e&&null!=t||"function"==e}var m="closure_uid_"+(1e9*Math.random()>>>0),y=0;function g(t,e,n){return t.call.apply(t.bind,arguments)}function v(t,e,n){if(!t)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var n=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(n,r),t.apply(e,n)}}return function(){return t.apply(e,arguments)}}function b(t,e,n){return(b=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?g:v).apply(null,arguments)}function w(t,e){var n=Array.prototype.slice.call(arguments,1);return function(){var e=n.slice();return e.push.apply(e,arguments),t.apply(this,e)}}var T=Date.now||function(){return+new Date};function _(t,e){function n(){}n.prototype=e.prototype,t.N=e.prototype,t.prototype=new n,t.prototype.constructor=t,t.xb=function(t,n,r){for(var i=Array(arguments.length-2),o=2;o<arguments.length;o++)i[o-2]=arguments[o];return e.prototype[n].apply(t,i)}}function E(){this.j=this.j,this.i=this.i}E.prototype.j=!1,E.prototype.la=function(){if(!this.j&&(this.j=!0,this.G(),0))this[m]||(this[m]=++y)},E.prototype.G=function(){if(this.i)for(;this.i.length;)this.i.shift()()};var S=Array.prototype.indexOf?function(t,e){return Array.prototype.indexOf.call(t,e,void 0)}:function(t,e){if(s(t))return s(e)&&1==e.length?t.indexOf(e,0):-1;for(var n=0;n<t.length;n++)if(n in t&&t[n]===e)return n;return-1},I=Array.prototype.forEach?function(t,e,n){Array.prototype.forEach.call(t,e,n)}:function(t,e,n){for(var r=t.length,i=s(t)?t.split(""):t,o=0;o<r;o++)o in i&&e.call(n,i[o],o,t)};function C(t){return Array.prototype.concat.apply([],arguments)}function N(t){var e=t.length;if(0<e){for(var n=Array(e),r=0;r<e;r++)n[r]=t[r];return n}return[]}function D(t){return/^[\s\xa0]*$/.test(t)}var A,O=String.prototype.trim?function(t){return t.trim()}:function(t){return/^[\s\xa0]*([\s\S]*?)[\s\xa0]*$/.exec(t)[1]};function k(t,e){return-1!=t.indexOf(e)}function R(t,e){return t<e?-1:t>e?1:0}t:{var P=a.navigator;if(P){var M=P.userAgent;if(M){A=M;break t}}A=""}function L(t,e,n){for(var r in t)e.call(n,t[r],r,t)}function x(t){var e,n={};for(e in t)n[e]=t[e];return n}var F="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function j(t,e){for(var n,r,i=1;i<arguments.length;i++){for(n in r=arguments[i])t[n]=r[n];for(var o=0;o<F.length;o++)n=F[o],Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}}function U(t){return U[" "](t),t}U[" "]=h;var q,V,B=k(A,"Opera"),W=k(A,"Trident")||k(A,"MSIE"),K=k(A,"Edge"),Q=K||W,G=k(A,"Gecko")&&!(k(A.toLowerCase(),"webkit")&&!k(A,"Edge"))&&!(k(A,"Trident")||k(A,"MSIE"))&&!k(A,"Edge"),H=k(A.toLowerCase(),"webkit")&&!k(A,"Edge");function z(){var t=a.document;return t?t.documentMode:void 0}t:{var Y="",X=(V=A,G?/rv:([^\);]+)(\)|;)/.exec(V):K?/Edge\/([\d\.]+)/.exec(V):W?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(V):H?/WebKit\/(\S+)/.exec(V):B?/(?:Version)[ \/]?(\S+)/.exec(V):void 0);if(X&&(Y=X?X[1]:""),W){var J=z();if(null!=J&&J>parseFloat(Y)){q=String(J);break t}}q=Y}var $,Z={};function tt(t){return function(t,e){var n=Z;return Object.prototype.hasOwnProperty.call(n,t)?n[t]:n[t]=e(t)}(t,(function(){for(var e=0,n=O(String(q)).split("."),r=O(String(t)).split("."),i=Math.max(n.length,r.length),o=0;0==e&&o<i;o++){var a=n[o]||"",s=r[o]||"";do{if(a=/(\d*)(\D*)(.*)/.exec(a)||["","","",""],s=/(\d*)(\D*)(.*)/.exec(s)||["","","",""],0==a[0].length&&0==s[0].length)break;e=R(0==a[1].length?0:parseInt(a[1],10),0==s[1].length?0:parseInt(s[1],10))||R(0==a[2].length,0==s[2].length)||R(a[2],s[2]),a=a[3],s=s[3]}while(0==e)}return 0<=e}))}var et=a.document;$=et&&W?z()||("CSS1Compat"==et.compatMode?parseInt(q,10):5):void 0;var nt=!W||9<=Number($),rt=W&&!tt("9"),it=function(){if(!a.addEventListener||!Object.defineProperty)return!1;var t=!1,e=Object.defineProperty({},"passive",{get:function(){t=!0}});try{a.addEventListener("test",h,e),a.removeEventListener("test",h,e)}catch(t){}return t}();function ot(t,e){this.type=t,this.a=this.target=e,this.Ia=!0}function at(t,e){if(ot.call(this,t?t.type:""),this.relatedTarget=this.a=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.pointerId=0,this.pointerType="",this.c=null,t){var n=this.type=t.type,r=t.changedTouches&&t.changedTouches.length?t.changedTouches[0]:null;if(this.target=t.target||t.srcElement,this.a=e,e=t.relatedTarget){if(G){t:{try{U(e.nodeName);var i=!0;break t}catch(t){}i=!1}i||(e=null)}}else"mouseover"==n?e=t.fromElement:"mouseout"==n&&(e=t.toElement);this.relatedTarget=e,r?(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=void 0!==t.clientX?t.clientX:t.pageX,this.clientY=void 0!==t.clientY?t.clientY:t.pageY,this.screenX=t.screenX||0,this.screenY=t.screenY||0),this.button=t.button,this.key=t.key||"",this.ctrlKey=t.ctrlKey,this.altKey=t.altKey,this.shiftKey=t.shiftKey,this.metaKey=t.metaKey,this.pointerId=t.pointerId||0,this.pointerType=s(t.pointerType)?t.pointerType:st[t.pointerType]||"",this.c=t,t.defaultPrevented&&this.b()}}ot.prototype.b=function(){this.Ia=!1},_(at,ot);var st={2:"touch",3:"pen",4:"mouse"};at.prototype.b=function(){at.N.b.call(this);var t=this.c;if(t.preventDefault)t.preventDefault();else if(t.returnValue=!1,rt)try{(t.ctrlKey||112<=t.keyCode&&123>=t.keyCode)&&(t.keyCode=-1)}catch(t){}};var ut="closure_listenable_"+(1e6*Math.random()|0),ct=0;function ht(t,e,n,r,i){this.listener=t,this.proxy=null,this.src=e,this.type=n,this.capture=!!r,this.da=i,this.key=++ct,this.X=this.Z=!1}function lt(t){t.X=!0,t.listener=null,t.proxy=null,t.src=null,t.da=null}function ft(t){this.src=t,this.a={},this.b=0}function pt(t,e){var n=e.type;if(n in t.a){var r,i=t.a[n],o=S(i,e);(r=0<=o)&&Array.prototype.splice.call(i,o,1),r&&(lt(e),0==t.a[n].length&&(delete t.a[n],t.b--))}}function dt(t,e,n,r){for(var i=0;i<t.length;++i){var o=t[i];if(!o.X&&o.listener==e&&o.capture==!!n&&o.da==r)return i}return-1}ft.prototype.add=function(t,e,n,r,i){var o=t.toString();(t=this.a[o])||(t=this.a[o]=[],this.b++);var a=dt(t,e,r,i);return-1<a?(e=t[a],n||(e.Z=!1)):((e=new ht(e,this.src,o,!!r,i)).Z=n,t.push(e)),e};var mt="closure_lm_"+(1e6*Math.random()|0),yt={};function gt(t,e,n,r,i){if(r&&r.once)return function t(e,n,r,i,o){if(f(n)){for(var a=0;a<n.length;a++)t(e,n[a],r,i,o);return null}return r=It(r),e&&e[ut]?e.Aa(n,r,d(i)?!!i.capture:!!i,o):vt(e,n,r,!0,i,o)}(t,e,n,r,i);if(f(e)){for(var o=0;o<e.length;o++)gt(t,e[o],n,r,i);return null}return n=It(n),t&&t[ut]?t.za(e,n,d(r)?!!r.capture:!!r,i):vt(t,e,n,!1,r,i)}function vt(t,e,n,r,i,o){if(!e)throw Error("Invalid event type");var a=d(i)?!!i.capture:!!i;if(a&&!nt)return null;var s=Et(t);if(s||(t[mt]=s=new ft(t)),(n=s.add(e,n,r,a,o)).proxy)return n;if(r=function(){var t=_t,e=nt?function(n){return t.call(e.src,e.listener,n)}:function(n){if(!(n=t.call(e.src,e.listener,n)))return n};return e}(),n.proxy=r,r.src=t,r.listener=n,t.addEventListener)it||(i=a),void 0===i&&(i=!1),t.addEventListener(e.toString(),r,i);else if(t.attachEvent)t.attachEvent(wt(e.toString()),r);else{if(!t.addListener||!t.removeListener)throw Error("addEventListener and attachEvent are unavailable.");t.addListener(r)}return n}function bt(t){if(!u(t)&&t&&!t.X){var e=t.src;if(e&&e[ut])pt(e.c,t);else{var n=t.type,r=t.proxy;e.removeEventListener?e.removeEventListener(n,r,t.capture):e.detachEvent?e.detachEvent(wt(n),r):e.addListener&&e.removeListener&&e.removeListener(r),(n=Et(e))?(pt(n,t),0==n.b&&(n.src=null,e[mt]=null)):lt(t)}}}function wt(t){return t in yt?yt[t]:yt[t]="on"+t}function Tt(t,e){var n=t.listener,r=t.da||t.src;return t.Z&&bt(t),n.call(r,e)}function _t(t,e){return!!t.X||(nt?Tt(t,new at(e,this)):Tt(t,e=new at(e||c("window.event"),this)))}function Et(t){return(t=t[mt])instanceof ft?t:null}var St="__closure_events_fn_"+(1e9*Math.random()>>>0);function It(t){return"function"==l(t)?t:(t[St]||(t[St]=function(e){return t.handleEvent(e)}),t[St])}function Ct(){E.call(this),this.c=new ft(this),this.J=this,this.B=null}function Nt(t,e,n,r){if(!(e=t.c.a[String(e)]))return!0;e=e.concat();for(var i=!0,o=0;o<e.length;++o){var a=e[o];if(a&&!a.X&&a.capture==n){var s=a.listener,u=a.da||a.src;a.Z&&pt(t.c,a),i=!1!==s.call(u,r)&&i}}return i&&0!=r.Ia}_(Ct,E),Ct.prototype[ut]=!0,(r=Ct.prototype).addEventListener=function(t,e,n,r){gt(this,t,e,n,r)},r.removeEventListener=function(t,e,n,r){!function t(e,n,r,i,o){if(f(n))for(var a=0;a<n.length;a++)t(e,n[a],r,i,o);else i=d(i)?!!i.capture:!!i,r=It(r),e&&e[ut]?(e=e.c,(n=String(n).toString())in e.a&&(-1<(r=dt(a=e.a[n],r,i,o))&&(lt(a[r]),Array.prototype.splice.call(a,r,1),0==a.length&&(delete e.a[n],e.b--)))):e&&(e=Et(e))&&(n=e.a[n.toString()],e=-1,n&&(e=dt(n,r,i,o)),(r=-1<e?n[e]:null)&&bt(r))}(this,t,e,n,r)},r.dispatchEvent=function(t){var e,n=this.B;if(n)for(e=[];n;n=n.B)e.push(n);n=this.J;var r=t.type||t;if(s(t))t=new ot(t,n);else if(t instanceof ot)t.target=t.target||n;else{var i=t;j(t=new ot(r,n),i)}if(i=!0,e)for(var o=e.length-1;0<=o;o--){var a=t.a=e[o];i=Nt(a,r,!0,t)&&i}if(i=Nt(a=t.a=n,r,!0,t)&&i,i=Nt(a,r,!1,t)&&i,e)for(o=0;o<e.length;o++)i=Nt(a=t.a=e[o],r,!1,t)&&i;return i},r.G=function(){if(Ct.N.G.call(this),this.c){var t,e=this.c;for(t in e.a){for(var n=e.a[t],r=0;r<n.length;r++)lt(n[r]);delete e.a[t],e.b--}}this.B=null},r.za=function(t,e,n,r){return this.c.add(String(t),e,!1,n,r)},r.Aa=function(t,e,n,r){return this.c.add(String(t),e,!0,n,r)};var Dt=a.JSON.stringify;function At(t,e){this.c=t,this.f=e,this.b=0,this.a=null}function Ot(){this.b=this.a=null}At.prototype.get=function(){if(0<this.b){this.b--;var t=this.a;this.a=t.next,t.next=null}else t=this.c();return t};var kt,Rt=new At((function(){return new Mt}),(function(t){t.reset()}));function Pt(){var t=jt,e=null;return t.a&&(e=t.a,t.a=t.a.next,t.a||(t.b=null),e.next=null),e}function Mt(){this.next=this.b=this.a=null}function Lt(t){a.setTimeout((function(){throw t}),0)}function xt(t,e){kt||function(){var t=a.Promise.resolve(void 0);kt=function(){t.then(Ut)}}(),Ft||(kt(),Ft=!0),jt.add(t,e)}Ot.prototype.add=function(t,e){var n=Rt.get();n.set(t,e),this.b?this.b.next=n:this.a=n,this.b=n},Mt.prototype.set=function(t,e){this.a=t,this.b=e,this.next=null},Mt.prototype.reset=function(){this.next=this.b=this.a=null};var Ft=!1,jt=new Ot;function Ut(){for(var t;t=Pt();){try{t.a.call(t.b)}catch(t){Lt(t)}var e=Rt;e.f(t),100>e.b&&(e.b++,t.next=e.a,e.a=t)}Ft=!1}function qt(t,e){Ct.call(this),this.b=t||1,this.a=e||a,this.f=b(this.fb,this),this.g=T()}function Vt(t){t.ba=!1,t.L&&(t.a.clearTimeout(t.L),t.L=null)}function Bt(t,e,n){if("function"==l(t))n&&(t=b(t,n));else{if(!t||"function"!=typeof t.handleEvent)throw Error("Invalid listener argument");t=b(t.handleEvent,t)}return 2147483647<Number(e)?-1:a.setTimeout(t,e||0)}function Wt(t,e,n){E.call(this),this.f=null!=n?b(t,n):t,this.c=e,this.b=b(this.$a,this),this.a=[]}function Kt(t){t.U=Bt(t.b,t.c),t.f.apply(null,t.a)}function Qt(t){E.call(this),this.b=t,this.a={}}_(qt,Ct),(r=qt.prototype).ba=!1,r.L=null,r.fb=function(){if(this.ba){var t=T()-this.g;0<t&&t<.8*this.b?this.L=this.a.setTimeout(this.f,this.b-t):(this.L&&(this.a.clearTimeout(this.L),this.L=null),this.dispatchEvent("tick"),this.ba&&(Vt(this),this.start()))}},r.start=function(){this.ba=!0,this.L||(this.L=this.a.setTimeout(this.f,this.b),this.g=T())},r.G=function(){qt.N.G.call(this),Vt(this),delete this.a},_(Wt,E),(r=Wt.prototype).ea=!1,r.U=null,r.Ta=function(t){this.a=arguments,this.U?this.ea=!0:Kt(this)},r.G=function(){Wt.N.G.call(this),this.U&&(a.clearTimeout(this.U),this.U=null,this.ea=!1,this.a=[])},r.$a=function(){this.U=null,this.ea&&(this.ea=!1,Kt(this))},_(Qt,E);var Gt=[];function Ht(t,e,n,r){f(n)||(n&&(Gt[0]=n.toString()),n=Gt);for(var i=0;i<n.length;i++){var o=gt(e,n[i],r||t.handleEvent,!1,t.b||t);if(!o)break;t.a[o.key]=o}}function zt(t){L(t.a,(function(t,e){this.a.hasOwnProperty(e)&&bt(t)}),t),t.a={}}function Yt(){}Qt.prototype.G=function(){Qt.N.G.call(this),zt(this)},Qt.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var Xt=new Ct;function Jt(t){ot.call(this,"serverreachability",t)}function $t(t){Xt.dispatchEvent(new Jt(Xt,t))}function Zt(t){ot.call(this,"statevent",t)}function te(t){Xt.dispatchEvent(new Zt(Xt,t))}function ee(t){ot.call(this,"timingevent",t)}function ne(t,e){if("function"!=l(t))throw Error("Fn must not be null and must be a function");return a.setTimeout((function(){t()}),e)}_(Jt,ot),_(Zt,ot),_(ee,ot);var re={NO_ERROR:0,gb:1,nb:2,mb:3,jb:4,lb:5,ob:6,La:7,TIMEOUT:8,rb:9},ie={ib:"complete",vb:"success",Ma:"error",La:"abort",tb:"ready",ub:"readystatechange",TIMEOUT:"timeout",pb:"incrementaldata",sb:"progress",kb:"downloadprogress",wb:"uploadprogress"};function oe(){}function ae(t){var e;return(e=t.a)||(e=t.a={}),e}function se(){}oe.prototype.a=null;var ue,ce={OPEN:"a",hb:"b",Ma:"c",qb:"d"};function he(){ot.call(this,"d")}function le(){ot.call(this,"c")}function fe(){}function pe(t,e,n){this.g=t,this.W=e,this.V=n||1,this.I=new Qt(this),this.O=de,t=Q?125:void 0,this.P=new qt(t),this.h=null,this.b=!1,this.l=this.D=this.f=this.F=this.v=this.R=this.i=null,this.j=[],this.a=null,this.A=0,this.c=this.w=null,this.o=-1,this.m=!1,this.J=0,this.B=null,this.s=this.S=this.H=!1}_(he,ot),_(le,ot),_(fe,oe),ue=new fe;var de=45e3,me={},ye={};function ge(t,e,n){t.F=1,t.f=Be(Le(e)),t.l=n,t.H=!0,be(t,null)}function ve(t,e,n,r){t.F=1,t.f=Be(Le(e)),t.l=null,t.H=n,be(t,r)}function be(t,e){t.v=T(),_e(t),t.D=Le(t.f),Ve(t.D,"t",t.V),t.A=0,t.a=t.g.$(t.g.Y()?e:null),0<t.J&&(t.B=new Wt(b(t.Ja,t,t.a),t.J)),Ht(t.I,t.a,"readystatechange",t.cb),e=t.h?x(t.h):{},t.l?(t.w||(t.w="POST"),e["Content-Type"]="application/x-www-form-urlencoded",t.a.ca(t.D,t.w,t.l,e)):(t.w="GET",t.a.ca(t.D,t.w,null,e)),$t(1)}function we(t,e,n){for(var r=!0;!t.m&&t.A<n.length;){var i=Te(t,n);if(i==ye){4==e&&(t.c=4,te(14),r=!1);break}if(i==me){t.c=4,te(15),r=!1;break}Ne(t,i)}4==e&&0==n.length&&(t.c=1,te(16),r=!1),t.b=t.b&&r,r||(Ce(t),Ie(t))}function Te(t,e){var n=t.A,r=e.indexOf("\n",n);return-1==r?ye:(n=Number(e.substring(n,r)),isNaN(n)?me:(r+=1)+n>e.length?ye:(e=e.substr(r,n),t.A=r+n,e))}function _e(t){t.R=T()+t.O,Ee(t,t.O)}function Ee(t,e){if(null!=t.i)throw Error("WatchDog timer not null");t.i=ne(b(t.ab,t),e)}function Se(t){t.i&&(a.clearTimeout(t.i),t.i=null)}function Ie(t){t.g.Ca()||t.m||t.g.na(t)}function Ce(t){Se(t);var e=t.B;e&&"function"==typeof e.la&&e.la(),t.B=null,Vt(t.P),zt(t.I),t.a&&(e=t.a,t.a=null,e.abort(),e.la())}function Ne(t,e){try{t.g.Fa(t,e),$t(4)}catch(t){}}function De(t,e){if(t.forEach&&"function"==typeof t.forEach)t.forEach(e,void 0);else if(p(t)||s(t))I(t,e,void 0);else{if(t.K&&"function"==typeof t.K)var n=t.K();else if(t.C&&"function"==typeof t.C)n=void 0;else if(p(t)||s(t)){n=[];for(var r=t.length,i=0;i<r;i++)n.push(i)}else for(i in n=[],r=0,t)n[r++]=i;i=(r=function(t){if(t.C&&"function"==typeof t.C)return t.C();if(s(t))return t.split("");if(p(t)){for(var e=[],n=t.length,r=0;r<n;r++)e.push(t[r]);return e}for(r in e=[],n=0,t)e[n++]=t[r];return e}(t)).length;for(var o=0;o<i;o++)e.call(void 0,r[o],n&&n[o],t)}}function Ae(t,e){this.b={},this.a=[],this.c=0;var n=arguments.length;if(1<n){if(n%2)throw Error("Uneven number of arguments");for(var r=0;r<n;r+=2)this.set(arguments[r],arguments[r+1])}else if(t)if(t instanceof Ae)for(n=t.K(),r=0;r<n.length;r++)this.set(n[r],t.get(n[r]));else for(r in t)this.set(r,t[r])}function Oe(t,e){Re(t.b,e)&&(delete t.b[e],t.c--,t.a.length>2*t.c&&ke(t))}function ke(t){if(t.c!=t.a.length){for(var e=0,n=0;e<t.a.length;){var r=t.a[e];Re(t.b,r)&&(t.a[n++]=r),e++}t.a.length=n}if(t.c!=t.a.length){var i={};for(n=e=0;e<t.a.length;)Re(i,r=t.a[e])||(t.a[n++]=r,i[r]=1),e++;t.a.length=n}}function Re(t,e){return Object.prototype.hasOwnProperty.call(t,e)}(r=pe.prototype).setTimeout=function(t){this.O=t},r.cb=function(t){t=t.target;var e=this.B;e&&3==Ln(t)?e.Ta():this.Ja(t)},r.Ja=function(t){try{if(t==this.a)t:{var e=Ln(this.a),n=this.a.ya(),r=this.a.T();if(!(3>e||3==e&&!Q&&!this.a.aa())){this.m||4!=e||7==n||$t(8==n||0>=r?3:2),Se(this);var i=this.a.T();this.o=i;var o=this.a.aa();if(this.b=200==i){if(this.S&&!this.s){e:{if(this.a){var a=xn(this.a,"X-HTTP-Initial-Response");if(a&&!D(a)){var s=a;break e}}s=null}if(!s){this.b=!1,this.c=3,te(12),Ce(this),Ie(this);break t}this.s=!0,Ne(this,s)}this.H?(we(this,e,o),Q&&this.b&&3==e&&(Ht(this.I,this.P,"tick",this.bb),this.P.start())):Ne(this,o),4==e&&Ce(this),this.b&&!this.m&&(4==e?this.g.na(this):(this.b=!1,_e(this)))}else 400==i&&0<o.indexOf("Unknown SID")?(this.c=3,te(12)):(this.c=0,te(13)),Ce(this),Ie(this)}}}catch(t){}},r.bb=function(){if(this.a){var t=Ln(this.a),e=this.a.aa();this.A<e.length&&(Se(this),we(this,t,e),this.b&&4!=t&&_e(this))}},r.cancel=function(){this.m=!0,Ce(this)},r.ab=function(){this.i=null;var t=T();0<=t-this.R?(2!=this.F&&($t(3),te(17)),Ce(this),this.c=2,Ie(this)):Ee(this,this.R-t)},(r=Ae.prototype).C=function(){ke(this);for(var t=[],e=0;e<this.a.length;e++)t.push(this.b[this.a[e]]);return t},r.K=function(){return ke(this),this.a.concat()},r.get=function(t,e){return Re(this.b,t)?this.b[t]:e},r.set=function(t,e){Re(this.b,t)||(this.c++,this.a.push(t)),this.b[t]=e},r.forEach=function(t,e){for(var n=this.K(),r=0;r<n.length;r++){var i=n[r],o=this.get(i);t.call(e,o,i,this)}};var Pe=/^(?:([^:/?#.]+):)?(?:\/\/(?:([^/?#]*)@)?([^/#?]*?)(?::([0-9]+))?(?=[/#?]|$))?([^?#]+)?(?:\?([^#]*))?(?:#([\s\S]*))?$/;function Me(t,e){var n;this.b=this.j=this.f="",this.i=null,this.g=this.a="",this.h=!1,t instanceof Me?(this.h=void 0!==e?e:t.h,xe(this,t.f),this.j=t.j,Fe(this,t.b),je(this,t.i),this.a=t.a,Ue(this,nn(t.c)),this.g=t.g):t&&(n=String(t).match(Pe))?(this.h=!!e,xe(this,n[1]||"",!0),this.j=We(n[2]||""),Fe(this,n[3]||"",!0),je(this,n[4]),this.a=We(n[5]||"",!0),Ue(this,n[6]||"",!0),this.g=We(n[7]||"")):(this.h=!!e,this.c=new Je(null,this.h))}function Le(t){return new Me(t)}function xe(t,e,n){t.f=n?We(e,!0):e,t.f&&(t.f=t.f.replace(/:$/,""))}function Fe(t,e,n){t.b=n?We(e,!0):e}function je(t,e){if(e){if(e=Number(e),isNaN(e)||0>e)throw Error("Bad port number "+e);t.i=e}else t.i=null}function Ue(t,e,n){e instanceof Je?(t.c=e,function(t,e){e&&!t.f&&($e(t),t.c=null,t.a.forEach((function(t,e){var n=e.toLowerCase();e!=n&&(Ze(this,e),en(this,n,t))}),t)),t.f=e}(t.c,t.h)):(n||(e=Ke(e,Ye)),t.c=new Je(e,t.h))}function qe(t,e,n){t.c.set(e,n)}function Ve(t,e,n){f(n)||(n=[String(n)]),en(t.c,e,n)}function Be(t){return qe(t,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^T()).toString(36)),t}function We(t,e){return t?e?decodeURI(t.replace(/%25/g,"%2525")):decodeURIComponent(t):""}function Ke(t,e,n){return s(t)?(t=encodeURI(t).replace(e,Qe),n&&(t=t.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),t):null}function Qe(t){return"%"+((t=t.charCodeAt(0))>>4&15).toString(16)+(15&t).toString(16)}Me.prototype.toString=function(){var t=[],e=this.f;e&&t.push(Ke(e,Ge,!0),":");var n=this.b;return(n||"file"==e)&&(t.push("//"),(e=this.j)&&t.push(Ke(e,Ge,!0),"@"),t.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.i)&&t.push(":",String(n))),(n=this.a)&&(this.b&&"/"!=n.charAt(0)&&t.push("/"),t.push(Ke(n,"/"==n.charAt(0)?ze:He,!0))),(n=this.c.toString())&&t.push("?",n),(n=this.g)&&t.push("#",Ke(n,Xe)),t.join("")},Me.prototype.resolve=function(t){var e=Le(this),n=!!t.f;n?xe(e,t.f):n=!!t.j,n?e.j=t.j:n=!!t.b,n?Fe(e,t.b):n=null!=t.i;var r=t.a;if(n)je(e,t.i);else if(n=!!t.a){if("/"!=r.charAt(0))if(this.b&&!this.a)r="/"+r;else{var i=e.a.lastIndexOf("/");-1!=i&&(r=e.a.substr(0,i+1)+r)}if(".."==(i=r)||"."==i)r="";else if(k(i,"./")||k(i,"/.")){r=0==i.lastIndexOf("/",0),i=i.split("/");for(var o=[],a=0;a<i.length;){var s=i[a++];"."==s?r&&a==i.length&&o.push(""):".."==s?((1<o.length||1==o.length&&""!=o[0])&&o.pop(),r&&a==i.length&&o.push("")):(o.push(s),r=!0)}r=o.join("/")}else r=i}return n?e.a=r:n=""!==t.c.toString(),n?Ue(e,nn(t.c)):n=!!t.g,n&&(e.g=t.g),e};var Ge=/[#\/\?@]/g,He=/[#\?:]/g,ze=/[#\?]/g,Ye=/[#\?@]/g,Xe=/#/g;function Je(t,e){this.b=this.a=null,this.c=t||null,this.f=!!e}function $e(t){t.a||(t.a=new Ae,t.b=0,t.c&&function(t,e){if(t){t=t.split("&");for(var n=0;n<t.length;n++){var r=t[n].indexOf("="),i=null;if(0<=r){var o=t[n].substring(0,r);i=t[n].substring(r+1)}else o=t[n];e(o,i?decodeURIComponent(i.replace(/\+/g," ")):"")}}}(t.c,(function(e,n){t.add(decodeURIComponent(e.replace(/\+/g," ")),n)})))}function Ze(t,e){$e(t),e=rn(t,e),Re(t.a.b,e)&&(t.c=null,t.b-=t.a.get(e).length,Oe(t.a,e))}function tn(t,e){return $e(t),e=rn(t,e),Re(t.a.b,e)}function en(t,e,n){Ze(t,e),0<n.length&&(t.c=null,t.a.set(rn(t,e),N(n)),t.b+=n.length)}function nn(t){var e=new Je;return e.c=t.c,t.a&&(e.a=new Ae(t.a),e.b=t.b),e}function rn(t,e){return e=String(e),t.f&&(e=e.toLowerCase()),e}function on(t){this.a=t,this.b=this.h=null,this.g=!1,this.i=null,this.c=-1,this.l=this.f=null}function an(t){var e=t.a.F.a;if(null!=e)te(4),e?(te(10),zn(t.a,t,!1)):(te(11),zn(t.a,t,!0));else{t.b=new pe(t,void 0,void 0),t.b.h=t.h,e=Zn(e=t.a,e.Y()?t.f:null,t.i),te(4),Ve(e,"TYPE","xmlhttp");var n=t.a.j,r=t.a.I;n&&r&&qe(e,n,r),ve(t.b,e,!1,t.f)}}function sn(){this.a=this.b=null}function un(){this.a=new Ae}function cn(t){var e=typeof t;return"object"==e&&t||"function"==e?"o"+(t[m]||(t[m]=++y)):e.charAt(0)+t}function hn(t,e){this.b=t,this.a=e}function ln(t){this.g=t||fn,a.PerformanceNavigationTiming?t=0<(t=a.performance.getEntriesByType("navigation")).length&&("hq"==t[0].nextHopProtocol||"h2"==t[0].nextHopProtocol):t=!!(a.ka&&a.ka.Da&&a.ka.Da()&&a.ka.Da().yb),this.f=t?this.g:1,this.a=null,1<this.f&&(this.a=new un),this.b=null,this.c=[]}(r=Je.prototype).add=function(t,e){$e(this),this.c=null,t=rn(this,t);var n=this.a.get(t);return n||this.a.set(t,n=[]),n.push(e),this.b+=1,this},r.forEach=function(t,e){$e(this),this.a.forEach((function(n,r){I(n,(function(n){t.call(e,n,r,this)}),this)}),this)},r.K=function(){$e(this);for(var t=this.a.C(),e=this.a.K(),n=[],r=0;r<e.length;r++)for(var i=t[r],o=0;o<i.length;o++)n.push(e[r]);return n},r.C=function(t){$e(this);var e=[];if(s(t))tn(this,t)&&(e=C(e,this.a.get(rn(this,t))));else{t=this.a.C();for(var n=0;n<t.length;n++)e=C(e,t[n])}return e},r.set=function(t,e){return $e(this),this.c=null,tn(this,t=rn(this,t))&&(this.b-=this.a.get(t).length),this.a.set(t,[e]),this.b+=1,this},r.get=function(t,e){return t&&0<(t=this.C(t)).length?String(t[0]):e},r.toString=function(){if(this.c)return this.c;if(!this.a)return"";for(var t=[],e=this.a.K(),n=0;n<e.length;n++){var r=e[n],i=encodeURIComponent(String(r));r=this.C(r);for(var o=0;o<r.length;o++){var a=i;""!==r[o]&&(a+="="+encodeURIComponent(String(r[o]))),t.push(a)}}return this.c=t.join("&")},_((function(){}),(function(){})),(r=on.prototype).M=null,r.$=function(t){return this.a.$(t)},r.abort=function(){this.b&&(this.b.cancel(),this.b=null),this.c=-1},r.Ca=function(){return!1},r.Fa=function(t,e){if(this.c=t.o,0==this.M){if(!this.a.o&&(t=t.a)){var n=xn(t,"X-Client-Wire-Protocol");this.l=n||null,this.a.j&&(t=xn(t,"X-HTTP-Session-Id"))&&(this.a.I=t)}if(e){try{var r=this.a.ja.a.parse(e)}catch(t){return(e=this.a).m=this.c,void Jn(e,2)}this.f=r[0]}else(e=this.a).m=this.c,Jn(e,2)}else 1==this.M&&(this.g?te(6):"11111"==e?(te(5),this.g=!0,(!W||10<=Number($))&&(this.c=200,this.b.cancel(),te(11),zn(this.a,this,!0))):(te(7),this.g=!1))},r.na=function(){if(this.c=this.b.o,this.b.b)0==this.M?(this.M=1,an(this)):1==this.M&&(this.g?(te(11),zn(this.a,this,!0)):(te(10),zn(this.a,this,!1)));else{0==this.M?te(8):1==this.M&&te(9);var t=this.a;t.m=this.c,Jn(t,2)}},r.Y=function(){return this.a.Y()},r.ma=function(){return this.a.ma()},un.prototype.add=function(t){this.a.set(cn(t),t)},un.prototype.C=function(){return this.a.C()};var fn=10;function pn(t,e){!t.a&&(k(e,"spdy")||k(e,"quic")||k(e,"h2"))&&(t.f=t.g,t.a=new un,t.b&&(gn(t,t.b),t.b=null))}function dn(t){return!!t.b||!!t.a&&t.a.a.c>=t.f}function mn(t){return t.b?1:t.a?t.a.a.c:0}function yn(t,e){return t.b?t=t.b==e:t.a?(e=cn(e),t=Re(t.a.a.b,e)):t=!1,t}function gn(t,e){t.a?t.a.add(e):t.b=e}function vn(t,e){var n;t.b&&t.b==e?t.b=null:((n=t.a)&&(n=cn(e),n=Re(t.a.a.b,n)),n&&Oe(t.a.a,cn(e)))}function bn(t){if(null!=t.b)return t.c.concat(t.b.j);if(null!=t.a&&0!=t.a.a.c){var e=t.c;return I(t.a.C(),(function(t){e=e.concat(t.j)})),e}return N(t.c)}function wn(){}function Tn(){this.a=new wn}function _n(t,e,n){var r=n||"";try{De(t,(function(t,n){var i=t;d(t)&&(i=Dt(t)),e.push(r+n+"="+encodeURIComponent(i))}))}catch(t){throw e.push(r+"type="+encodeURIComponent("_badmap")),t}}function En(t,e,n,r,i){try{e.onload=null,e.onerror=null,e.onabort=null,e.ontimeout=null,i(r)}catch(t){}}ln.prototype.cancel=function(){this.c=bn(this),this.b?(this.b.cancel(),this.b=null):this.a&&0!=this.a.a.c&&(I(this.a.C(),(function(t){t.cancel()})),function(t){t.b={},t.a.length=0,t.c=0}(this.a.a))},wn.prototype.stringify=function(t){return a.JSON.stringify(t,void 0)},wn.prototype.parse=function(t){return a.JSON.parse(t,void 0)};var Sn=a.JSON.parse;function In(t){Ct.call(this),this.headers=new Ae,this.H=t||null,this.b=!1,this.s=this.a=null,this.A="",this.h=0,this.f="",this.g=this.w=this.l=this.v=!1,this.o=0,this.m=null,this.I=Cn,this.D=this.F=!1}_(In,Ct);var Cn="",Nn=/^https?$/i,Dn=["POST","PUT"];function An(t){return"content-type"==t.toLowerCase()}function On(t,e){t.b=!1,t.a&&(t.g=!0,t.a.abort(),t.g=!1),t.f=e,t.h=5,kn(t),Pn(t)}function kn(t){t.v||(t.v=!0,t.dispatchEvent("complete"),t.dispatchEvent("error"))}function Rn(t){if(t.b&&void 0!==o&&(!t.s[1]||4!=Ln(t)||2!=t.T()))if(t.l&&4==Ln(t))Bt(t.Ea,0,t);else if(t.dispatchEvent("readystatechange"),4==Ln(t)){t.b=!1;try{var e,n=t.T();t:switch(n){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var r=!0;break t;default:r=!1}if(!(e=r)){var i;if(i=0===n){var s=String(t.A).match(Pe)[1]||null;if(!s&&a.self&&a.self.location){var u=a.self.location.protocol;s=u.substr(0,u.length-1)}i=!Nn.test(s?s.toLowerCase():"")}e=i}if(e)t.dispatchEvent("complete"),t.dispatchEvent("success");else{t.h=6;try{var c=2<Ln(t)?t.a.statusText:""}catch(t){c=""}t.f=c+" ["+t.T()+"]",kn(t)}}finally{Pn(t)}}}function Pn(t,e){if(t.a){Mn(t);var n=t.a,r=t.s[0]?h:null;t.a=null,t.s=null,e||t.dispatchEvent("ready");try{n.onreadystatechange=r}catch(t){}}}function Mn(t){t.a&&t.D&&(t.a.ontimeout=null),t.m&&(a.clearTimeout(t.m),t.m=null)}function Ln(t){return t.a?t.a.readyState:0}function xn(t,e){return t.a?t.a.getResponseHeader(e):null}function Fn(t,e,n){t:{for(r in n){var r=!1;break t}r=!0}if(r)return t;if(n=function(t){var e="";return L(t,(function(t,n){e+=n,e+=":",e+=t,e+="\r\n"})),e}(n),s(t)){if(e=encodeURIComponent(String(e)),e+=n=null!=n?"="+encodeURIComponent(String(n)):""){if(0>(n=t.indexOf("#"))&&(n=t.length),0>(r=t.indexOf("?"))||r>n){r=n;var i=""}else i=t.substring(r+1,n);n=(t=[t.substr(0,r),i,t.substr(n)])[1],t[1]=e?n?n+"&"+e:e:n,t=t[0]+(t[1]?"?"+t[1]:"")+t[2]}return t}return qe(t,e,n),t}function jn(t){this.f=[],this.F=new sn,this.ga=this.pa=this.B=this.ha=this.a=this.I=this.j=this.V=this.g=this.J=this.i=null,this.Qa=this.P=0,this.Oa=!!c("internalChannelParams.failFast",t),this.ia=this.w=this.s=this.l=this.h=this.c=null,this.oa=!0,this.m=this.ra=this.O=-1,this.S=this.v=this.A=0,this.Na=c("internalChannelParams.baseRetryDelayMs",t)||5e3,this.Ra=c("internalChannelParams.retryDelaySeedMs",t)||1e4,this.Pa=c("internalChannelParams.forwardChannelMaxRetries",t)||2,this.qa=c("internalChannelParams.forwardChannelRequestTimeoutMs",t)||2e4,this.Ka=t&&t.zb||void 0,this.D=void 0,this.R=t&&t.supportsCrossDomainXhr||!1,this.H="",this.b=new ln(t&&t.concurrentRequestLimit),this.ja=new Tn,this.o=!t||void 0===t.backgroundChannelTest||t.backgroundChannelTest,(this.W=t&&t.fastHandshake||!1)&&!this.o&&(this.o=!0),t&&t.forceLongPolling&&(this.oa=!1),this.fa=void 0}function Un(t){if(qn(t),3==t.u){var e=t.P++,n=Le(t.B);qe(n,"SID",t.H),qe(n,"RID",e),qe(n,"TYPE","terminate"),Kn(t,n),(e=new pe(t,e,void 0)).F=2,e.f=Be(Le(n)),n=!1,a.navigator&&a.navigator.sendBeacon&&(n=a.navigator.sendBeacon(e.f.toString(),"")),!n&&a.Image&&((new Image).src=e.f,n=!0),n||(e.a=e.g.$(null),e.a.ca(e.f)),e.v=T(),_e(e)}$n(t)}function qn(t){t.w&&(t.w.abort(),t.w=null),t.a&&(t.a.cancel(),t.a=null),t.l&&(a.clearTimeout(t.l),t.l=null),Yn(t),t.b.cancel(),t.h&&(u(t.h)&&a.clearTimeout(t.h),t.h=null)}function Vn(t,e){t.f.push(new hn(t.Qa++,e)),3==t.u&&Bn(t)}function Bn(t){dn(t.b)||t.h||(t.h=!0,xt(t.Ha,t),t.A=0)}function Wn(t,e){var n;n=e?e.W:t.P++;var r=Le(t.B);qe(r,"SID",t.H),qe(r,"RID",n),qe(r,"AID",t.O),Kn(t,r),t.g&&t.i&&Fn(r,t.g,t.i),n=new pe(t,n,t.A+1),null===t.g&&(n.h=t.i),e&&(t.f=e.j.concat(t.f)),e=Qn(t,n,1e3),n.setTimeout(Math.round(.5*t.qa)+Math.round(.5*t.qa*Math.random())),gn(t.b,n),ge(n,r,e)}function Kn(t,e){t.c&&De({},(function(t,n){qe(e,n,t)}))}function Qn(t,e,n){n=Math.min(t.f.length,n);var r=t.c?b(t.c.Sa,t.c,t):null;t:for(var i=t.f,o=-1;;){var a=["count="+n];-1==o?0<n?(o=i[0].b,a.push("ofs="+o)):o=0:a.push("ofs="+o);for(var s=!0,u=0;u<n;u++){var c=i[u].b,h=i[u].a;if(0>(c-=o))o=Math.max(0,i[u].b-100),s=!1;else try{_n(h,a,"req"+c+"_")}catch(t){r&&r(h)}}if(s){r=a.join("&");break t}}return t=t.f.splice(0,n),e.j=t,r}function Gn(t){t.a||t.l||(t.S=1,xt(t.Ga,t),t.v=0)}function Hn(t){return!(t.a||t.l||3<=t.v)&&(t.S++,t.l=ne(b(t.Ga,t),Xn(t,t.v)),t.v++,!0)}function zn(t,e,n){var r=e.l;r&&pn(t.b,r),t.ia=t.oa&&n,t.m=e.c,t.B=Zn(t,null,t.ha),Bn(t)}function Yn(t){null!=t.s&&(a.clearTimeout(t.s),t.s=null)}function Xn(t,e){var n=t.Na+Math.floor(Math.random()*t.Ra);return t.ma()||(n*=2),n*e}function Jn(t,e){if(2==e){var n=null;t.c&&(n=null);var r=b(t.eb,t);n||(n=new Me("//www.google.com/images/cleardot.gif"),a.location&&"http"==a.location.protocol||xe(n,"https"),Be(n)),function(t,e){var n=new Yt;if(a.Image){var r=new Image;r.onload=w(En,n,r,"TestLoadImage: loaded",!0,e),r.onerror=w(En,n,r,"TestLoadImage: error",!1,e),r.onabort=w(En,n,r,"TestLoadImage: abort",!1,e),r.ontimeout=w(En,n,r,"TestLoadImage: timeout",!1,e),a.setTimeout((function(){r.ontimeout&&r.ontimeout()}),1e4),r.src=t}else e(!1)}(n.toString(),r)}else te(2);t.u=0,t.c&&t.c.ta(e),$n(t),qn(t)}function $n(t){t.u=0,t.m=-1,t.c&&(0==bn(t.b).length&&0==t.f.length||(t.b.c.length=0,N(t.f),t.f.length=0),t.c.sa())}function Zn(t,e,n){var r=function(t){return t instanceof Me?Le(t):new Me(t,void 0)}(n);if(""!=r.b)e&&Fe(r,e+"."+r.b),je(r,r.i);else{var i,o=a.location;i=e?e+"."+o.hostname:o.hostname,r=function(t,e,n,r){var i=new Me(null,void 0);return t&&xe(i,t),e&&Fe(i,e),n&&je(i,n),r&&(i.a=r),i}(o.protocol,i,+o.port,n)}return t.V&&L(t.V,(function(t,e){qe(r,e,t)})),e=t.j,n=t.I,e&&n&&qe(r,e,n),qe(r,"VER",t.wa),Kn(t,r),r}function tr(){}function er(){if(W&&!(10<=Number($)))throw Error("Environmental error: no available transport.")}function nr(t,e){Ct.call(this),this.a=new jn(e),this.g=t,this.m=e&&e.testUrl?e.testUrl:function(t){for(var e=arguments[0],n=1;n<arguments.length;n++){var r,i=arguments[n];if(0==i.lastIndexOf("/",0))e=i;else(r=""==e)||(r=0<=(r=e.length-1)&&e.indexOf("/",r)==r),e+=r?i:"/"+i}return e}(this.g,"test"),this.b=e&&e.messageUrlParams||null,t=e&&e.messageHeaders||null,e&&e.clientProtocolHeaderRequired&&(t?t["X-Client-Protocol"]="webchannel":t={"X-Client-Protocol":"webchannel"}),this.a.i=t,t=e&&e.initMessageHeaders||null,e&&e.messageContentType&&(t?t["X-WebChannel-Content-Type"]=e.messageContentType:t={"X-WebChannel-Content-Type":e.messageContentType}),e&&e.xa&&(t?t["X-WebChannel-Client-Profile"]=e.xa:t={"X-WebChannel-Client-Profile":e.xa}),this.a.J=t,(t=e&&e.httpHeadersOverwriteParam)&&!D(t)&&(this.a.g=t),this.l=e&&e.supportsCrossDomainXhr||!1,this.h=e&&e.sendRawJson||!1,(e=e&&e.httpSessionIdParam)&&!D(e)&&(this.a.j=e,null!==(t=this.b)&&e in t&&(e in(t=this.b)&&delete t[e])),this.f=new or(this)}function rr(t){he.call(this);var e=t.__sm__;if(e){t:{for(var n in e){t=n;break t}t=void 0}(this.c=t)?(t=this.c,this.data=null!==e&&t in e?e[t]:void 0):this.data=e}else this.data=t}function ir(){le.call(this),this.status=1}function or(t){this.a=t}(r=In.prototype).ca=function(t,e,n,r){if(this.a)throw Error("[goog.net.XhrIo] Object is active with another request="+this.A+"; newUri="+t);e=e?e.toUpperCase():"GET",this.A=t,this.f="",this.h=0,this.v=!1,this.b=!0,this.a=new XMLHttpRequest,this.s=this.H?ae(this.H):ae(ue),this.a.onreadystatechange=b(this.Ea,this);try{this.w=!0,this.a.open(e,String(t),!0),this.w=!1}catch(t){return void On(this,t)}t=n||"";var i=new Ae(this.headers);r&&De(r,(function(t,e){i.set(e,t)})),r=function(t){t:{for(var e=An,n=t.length,r=s(t)?t.split(""):t,i=0;i<n;i++)if(i in r&&e.call(void 0,r[i],i,t)){e=i;break t}e=-1}return 0>e?null:s(t)?t.charAt(e):t[e]}(i.K()),n=a.FormData&&t instanceof a.FormData,!(0<=S(Dn,e))||r||n||i.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8"),i.forEach((function(t,e){this.a.setRequestHeader(e,t)}),this),this.I&&(this.a.responseType=this.I),"withCredentials"in this.a&&this.a.withCredentials!==this.F&&(this.a.withCredentials=this.F);try{Mn(this),0<this.o&&((this.D=function(t){return W&&tt(9)&&u(t.timeout)&&void 0!==t.ontimeout}(this.a))?(this.a.timeout=this.o,this.a.ontimeout=b(this.Ba,this)):this.m=Bt(this.Ba,this.o,this)),this.l=!0,this.a.send(t),this.l=!1}catch(t){On(this,t)}},r.Ba=function(){void 0!==o&&this.a&&(this.f="Timed out after "+this.o+"ms, aborting",this.h=8,this.dispatchEvent("timeout"),this.abort(8))},r.abort=function(t){this.a&&this.b&&(this.b=!1,this.g=!0,this.a.abort(),this.g=!1,this.h=t||7,this.dispatchEvent("complete"),this.dispatchEvent("abort"),Pn(this))},r.G=function(){this.a&&(this.b&&(this.b=!1,this.g=!0,this.a.abort(),this.g=!1),Pn(this,!0)),In.N.G.call(this)},r.Ea=function(){this.j||(this.w||this.l||this.g?Rn(this):this.Za())},r.Za=function(){Rn(this)},r.T=function(){try{return 2<Ln(this)?this.a.status:-1}catch(t){return-1}},r.aa=function(){try{return this.a?this.a.responseText:""}catch(t){return""}},r.Ua=function(t){if(this.a){var e=this.a.responseText;return t&&0==e.indexOf(t)&&(e=e.substring(t.length)),Sn(e)}},r.ya=function(){return this.h},r.Xa=function(){return s(this.f)?this.f:String(this.f)},(r=jn.prototype).wa=8,r.u=1,r.Ca=function(){return 0==this.u},r.Ha=function(t){if(this.h)if(this.h=null,1==this.u){if(!t){this.P=Math.floor(1e5*Math.random());var e,n=new pe(this,t=this.P++,void 0),r=this.i;if(this.J&&(r?j(r=x(r),this.J):r=this.J),null===this.g&&(n.h=r),this.W)t:{for(var i=e=0;i<this.f.length;i++){var o=this.f[i];if(void 0===(o="__data__"in o.a&&s(o=o.a.__data__)?o.length:void 0))break;if(4096<(e+=o)){e=i;break t}if(4096===e||i===this.f.length-1){e=i+1;break t}}e=1e3}else e=1e3;e=Qn(this,n,e),qe(i=Le(this.B),"RID",t),qe(i,"CVER",22),this.o&&this.j&&qe(i,"X-HTTP-Session-Id",this.j),Kn(this,i),this.g&&r&&Fn(i,this.g,r),gn(this.b,n),this.W?(qe(i,"$req",e),qe(i,"SID","null"),n.S=!0,ge(n,i,null)):ge(n,i,e),this.u=2}}else 3==this.u&&(t?Wn(this,t):0==this.f.length||dn(this.b)||Wn(this))},r.Ga=function(){this.l=null,this.a=new pe(this,"rpc",this.S),null===this.g&&(this.a.h=this.i),this.a.J=0;var t=Le(this.pa);qe(t,"RID","rpc"),qe(t,"SID",this.H),qe(t,"CI",this.ia?"0":"1"),qe(t,"AID",this.O),Kn(this,t),qe(t,"TYPE","xmlhttp"),this.g&&this.i&&Fn(t,this.g,this.i),this.D&&this.a.setTimeout(this.D),ve(this.a,t,!0,this.ga)},r.Fa=function(t,e){if(0!=this.u&&(this.a==t||yn(this.b,t)))if(this.m=t.o,!t.s&&yn(this.b,t)&&3==this.u){try{var n=this.ja.a.parse(e)}catch(t){n=null}if(f(n)&&3==n.length){if(0==(e=n)[0]){t:if(!this.l){if(this.a){if(!(this.a.v+3e3<t.v))break t;Yn(this),this.a.cancel(),this.a=null}Hn(this),te(18)}}else this.ra=e[1],0<this.ra-this.O&&37500>e[2]&&this.ia&&0==this.v&&!this.s&&(this.s=ne(b(this.Ya,this),6e3));if(1>=mn(this.b)&&this.fa){try{this.fa()}catch(t){}this.fa=void 0}}else Jn(this,11)}else if((t.s||this.a==t)&&Yn(this),!D(e))for(e=n=this.ja.a.parse(e),n=0;n<e.length;n++){var r=e[n];if(this.O=r[0],r=r[1],2==this.u)if("c"==r[0]){this.H=r[1],this.ga=r[2];var i=r[3];null!=i&&(this.wa=i),null!=(r=r[5])&&u(r)&&0<r&&(this.D=1.5*r),this.o&&(r=t.a)&&((i=xn(r,"X-Client-Wire-Protocol"))&&pn(this.b,i),this.j&&(r=xn(r,"X-HTTP-Session-Id")))&&(this.I=r,qe(this.B,this.j,r)),this.u=3,this.c&&this.c.va(),r=t,this.pa=Zn(this,this.Y()?this.ga:null,this.ha),r.s?(vn(this.b,r),(i=this.D)&&r.setTimeout(i),r.i&&(Se(r),_e(r)),this.a=r):Gn(this),0<this.f.length&&Bn(this)}else"stop"!=r[0]&&"close"!=r[0]||Jn(this,7);else 3==this.u&&("stop"==r[0]||"close"==r[0]?"stop"==r[0]?Jn(this,7):Un(this):"noop"!=r[0]&&this.c&&this.c.ua(r),this.v=0)}},r.Ya=function(){null!=this.s&&(this.s=null,this.a.cancel(),this.a=null,Hn(this),te(19))},r.na=function(t){var e=null;if(this.a==t){Yn(this),this.a=null;var n=2}else{if(!yn(this.b,t))return;e=t.j,vn(this.b,t),n=1}if(this.m=t.o,0!=this.u)if(t.b)1==n?(e=T()-t.v,Xt.dispatchEvent(new ee(Xt,t.l?t.l.length:0,e,this.A)),Bn(this)):Gn(this);else{var r=t.c;if(3==r||0==r&&0<this.m||!(1==n&&function(t,e){return!(mn(t.b)>=t.b.f-(t.h?1:0))&&(t.h?(t.f=e.j.concat(t.f),!0):!(1==t.u||2==t.u||t.A>=(t.Oa?0:t.Pa))&&(t.h=ne(b(t.Ha,t,e),Xn(t,t.A)),t.A++,!0))}(this,t)||2==n&&Hn(this)))switch(e&&0<e.length&&(t=this.b,t.c=t.c.concat(e)),r){case 1:Jn(this,5);break;case 4:Jn(this,10);break;case 3:Jn(this,6);break;default:Jn(this,2)}}},r.eb=function(t){te(t?2:1)},r.$=function(t){if(t&&!this.R)throw Error("Can't create secondary domain capable XhrIo object.");return(t=new In(this.Ka)).F=this.R,t},r.ma=function(){return!!this.c&&!0},r.Y=function(){return this.R},(r=tr.prototype).va=function(){},r.ua=function(){},r.ta=function(){},r.sa=function(){},r.Sa=function(){},er.prototype.a=function(t,e){return new nr(t,e)},_(nr,Ct),(r=nr.prototype).addEventListener=function(t,e,n,r){nr.N.addEventListener.call(this,t,e,n,r)},r.removeEventListener=function(t,e,n,r){nr.N.removeEventListener.call(this,t,e,n,r)},r.Va=function(){this.a.c=this.f,this.l&&(this.a.R=!0);var t=this.a,e=this.m,n=this.g,r=this.b||void 0;te(0),t.ha=n,t.V=r||{},t.o&&(t.F.b=[],t.F.a=!1),t.w=new on(t),null===t.g&&(t.w.h=t.i),n=e,t.g&&t.i&&(n=Fn(e,t.g,t.i)),(t=t.w).i=n,e=Zn(t.a,null,t.i),te(3),null!=(n=t.a.F.b)?(t.f=n[0],t.M=1,an(t)):(Ve(e,"MODE","init"),!t.a.o&&t.a.j&&Ve(e,"X-HTTP-Session-Id",t.a.j),t.b=new pe(t,void 0,void 0),t.b.h=t.h,ve(t.b,e,!1,null),t.M=0)},r.close=function(){Un(this.a)},r.Wa=function(t){if(s(t)){var e={};e.__data__=t,Vn(this.a,e)}else this.h?((e={}).__data__=Dt(t),Vn(this.a,e)):Vn(this.a,t)},r.G=function(){this.a.c=null,delete this.f,Un(this.a),delete this.a,nr.N.G.call(this)},_(rr,he),_(ir,le),_(or,tr),or.prototype.va=function(){this.a.dispatchEvent("a")},or.prototype.ua=function(t){this.a.dispatchEvent(new rr(t))},or.prototype.ta=function(t){this.a.dispatchEvent(new ir(t))},or.prototype.sa=function(){this.a.dispatchEvent("b")};var ar=w((function(t,e){function n(){}n.prototype=t.prototype;var r=new n;return t.apply(r,Array.prototype.slice.call(arguments,1)),r}),er);er.prototype.createWebChannel=er.prototype.a,nr.prototype.send=nr.prototype.Wa,nr.prototype.open=nr.prototype.Va,nr.prototype.close=nr.prototype.close,re.NO_ERROR=0,re.TIMEOUT=8,re.HTTP_ERROR=6,ie.COMPLETE="complete",se.EventType=ce,ce.OPEN="a",ce.CLOSE="b",ce.ERROR="c",ce.MESSAGE="d",Ct.prototype.listen=Ct.prototype.za,In.prototype.listenOnce=In.prototype.Aa,In.prototype.getLastError=In.prototype.Xa,In.prototype.getLastErrorCode=In.prototype.ya,In.prototype.getStatus=In.prototype.T,In.prototype.getResponseJson=In.prototype.Ua,In.prototype.getResponseText=In.prototype.aa,In.prototype.send=In.prototype.ca;var sr={createWebChannelTransport:ar,ErrorCode:re,EventType:ie,WebChannel:se,XhrIo:In},ur=sr.createWebChannelTransport,cr=sr.ErrorCode,hr=sr.EventType,lr=sr.WebChannel,fr=sr.XhrIo}).call(this,n(3))}]]);